<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Apache Kafka</title>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" ></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://mohan-chinnappan-n.github.io/css/navbar-blue.css" />
    <script src="https://mohan-chinnappan-n.github.io/sfdc/gs/js/split.js"></script>
    <link rel="stylesheet" href="https://mohan-chinnappan-n.github.io/sfdc/gs/css/split.css" />

    <link rel="stylesheet" href="https://mohan-chinnappan-n2.github.io/2019/dx/css/slides.css?v=17" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.js"></script>

  


<style>
    @keyframes demo {
      from {background-color: #99ffcc;color:black;  transform: rotate(-1deg)}
      to {background-color: ##337ab7;color:white;  transform: rotate(+1deg)}
  }

  .demo {
      animation-name: demo;
      animation-duration: 10s;
      animation:demo 5s linear 2s infinite alternate;
  }
  .center {
    text-align: center;
  }
  img {
    border-radius: 10px;
    border: 1px solid;
  }
  .reflink {
    width:600px;
    padding: 10px;
    font-size: 18px;
  }
  </style>
     
  
  </head>

  <body>
    <nav
      class="navbar navbar-default"
      role="navigation"
      style="margin-bottom:0px;"
    >
      <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button
          type="button"
          class="navbar-toggle"
          data-toggle="collapse"
          data-target="#bs-example-navbar-collapse-1"
        >
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="javascript:void(0)">Apache Kafka</a>
      </div>

      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#/home">Home</a></li>
          <li>
              <a href="#" id='help' data-toggle="tooltip" title="Use Space Bar to move the slides">Help</a>

          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li>
            <select style="display:none2;margin-top:10px;" id='outline'> </select>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>

    <div class="split split-horizontal" id="menu">
      <span style="display:none">
        <button class="btn btn-success" onclick="prevSlide()">Prev</button>
        <button class="btn btn-success" onclick="nextSlide()">Next</button>
      </span>
      <select style="display:none;margin-top:10px;" id='outline2'> </select>
      <ol class="list-group" id='mitems'> </ol>


    </div>
    <div class="split split-horizontal" id="content">


        <div class="slide" id='What is Kafka?'>
           <h3 class='center'>What is Apache Kafka?</h3>
            <div class="row">
              <div class="col-lg-0"></div>
              <div class="col-lg-12">
                <ul class="list-group largelist">
                  <li class="list-group-item">
                    <img src="https://mohan-chinnappan-n.github.io/sfdc/img/kafka/kafka-logo.jpg" height="100" alt="">
                    <img src="https://mohan-chinnappan-n.github.io/sfdc/img/kafka/kafka-arch-2.png" height="300" alt="">
                  </li>
                  <li class="list-group-item">
                    High Throughput, Low Latency, Distributed Commit Log
                   </li>
                   <li class='list-group-item'>
                     Messaging System with { Brokers, Topics, Publishers, Subscribers }
                   </li>
                   <li class='list-group-item'>
                      <a  class="btn btn-info  reflink " target="_blank" href="https://mohan-chinnappan-n.github.io/sfdc/kafka.html#/22"> Key Points</a>
                    </li>

                </ul>
              </div>
            </div>
        </div>


        <div class="slide" id='Typical Install'>
            <h3 class='center'>Typical Install</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                      Having: 10 Brokers, 700 M Publishes from 100 Publishers, 50 Subscribers
                   </li>
                   <li class="list-group-item">
                       Used for: Clickstream, Synching multiple sub-systems, Application logs...
                   </li>
                   <li class="list-group-item">
                       Data size: 2+ TB
                   </li>
                 </ul>
               </div>
             </div>
         </div>

        <div class="slide" id='Best of Pub-Sub and  Queuing'>
            <h3 class='center'>Best of Pub-Sub and  Queuing</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="https://mohan-chinnappan-n.github.io/sfdc/img/kafka/kafka-arch-1.png" height="250" alt="">
                     <img src="https://mohan-chinnappan-n.github.io/sfdc/img/kafka/log_anatomy.png" height="250" alt="">
 
                     <hr/>
                     <a href="https://mohan-chinnappan-n.github.io/sfdc/kafka.html#/1" 
                     class='btn btn-info' target="_blank">Strength and Weakness of Queuing and Pub-Sub</a>
                     <br/> As in queuing: consumer group feature allows to divide up processing over a collection of processes : members of the consumer group
                   </li>
                      <li class="list-group-item">
                          As in pub-sub: Kafka broadcasts messages to multiple consumer groups
                      </li>
                      <li class="list-group-item">
                          Parallel consumption to Scale Processing:  with the Partitions
                      </li>
                      <li class="list-group-item">
                        Zookeeper provides the consistent view of the system: 
                          keeps track of status of the Kafka cluster nodes and it also keeps track of Kafka topics, partitions etc.
                      </li>
                 </ul>
               </div>
             </div>
         </div>

         <div class="slide" id='DB Person View'>
            <h3 class='center'>DB Person View</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="img/kafka-arch-1.svg"  alt="">
                      </li>
                 </ul>
               </div>
             </div>
         </div>

         

         <div class="slide" id='Kafka Full View - Detailed'>
            <h3 class='center'>Kafka Full View - Detailed</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="img/kafka-arch-4.png"  height="600" alt="">
                      </li>
                 </ul>
               </div>
             </div>
         </div>




         <div class="slide" id='Controller Role'>
            <h3 class='center'>Controller Role</h3>
            <div class="row">
              <div class="col-lg-0"></div>
              <div class="col-lg-12">
                <ul class="list-group largelist">
                  <li class="list-group-item">
                    
                    <a href="../viz/seq/seq.html?f=./seqs/Kafka-controller.seq.txt" 
                    class='btn btn-info reflink' target="_blank">Function of the controller</a>
                    <br/> 
                    The controller is one of the most important brokering entity in a Kafka ecosystem responsible:
                     to maintain the <b>leader-follower</b> relationship across all the partitions.

                     <br>
                     Every cluster has one leader node and the rest of the nodes are followers.
                     <img height='220' src="img/leader-follower.png" alt="">
                     <a class='btn btn-warning reflink' href="img/Zab_2011.pdf"> Paper on ZAB</a>


                  </li>
                     <li class="list-group-item">
                         All incoming client requests and state changes are received at first by the leader with 
                         responsibility to replicate it across all its followers (and itself).

                     </li>
                     <li class="list-group-item">
                         All incoming read requests are also <b>load balanced</b> by the leader within itself and its followers.

                     </li>
                     <li class="list-group-item">

                     </li>


                    
                </ul>
              </div>
            </div>
        </div>


         <div class="slide" id='Why Kafka - Durable Message Retention'>
            <h3 class='center'>Why Kafka - Durable Message Retention</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                      Support for Multiple Producers and Consumers
                      </li>
                   <li class="list-group-item">
                      Disk based durable message retention: 
                      consumers do not always need to work in real time. <hr/>
                      Messages are committed to disk, and will be stored with configurable (per-topic basis) retention rules.<hr/>
                      If a consumer falls behind, either due to slow processing or a burst in traffic, there is no danger of losing data. <hr/>
                      Consumers can be stopped, and the messages will be retained in Kafka. <hr/>
                      This allows them to restart and pick up processing messages where they left off with no data loss. 

                      </li>


                 </ul>
               </div>
             </div>
         </div>


         <div class="slide" id='Why Kafka - Scalable'>
            <h3 class='center'>Why Kafka - Scalable</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                      Flexible scalability:  easy to handle any amount of data
                      </li>
                   <li class="list-group-item">
                      Users can start with a single broker as a proof of concept <br/>
                      Expand to a small development cluster of 3 brokers</br/>
                      Move into production with a larger cluster of 10s or even 100s of brokers 
                      that grows over time as the data scales up.
                     </li>
                   <li class="list-group-item">
                      Expansions can be performed while the cluster is online, with no impact on the availability of the system as
                      a whole. <br/>
                      A cluster of multiple brokers can handle the failure of an individual broker, and continue servicing clients. <br/>
                      Clusters that need to tolerate more simultaneous failures can be configured with higher replication factors. 

                   </li>
                 </ul>
               </div>
             </div>
         </div>


         <div class="slide" id='Why Kafka - High Performance'>
            <h3 class='center'>Why Kafka - High Performance</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                      Producers, Consumers,
                      and Brokers can all be <b>scaled out</b> to handle very large message streams with ease. <br/>
                      This can be done while still providing sub-second message latency.<br/>
                      Kafka provides the <b>circulatory system</b> for the data ecosystem
                      <br/>
                      <img src="img/kafka-big-data-sys-1.png" height="350" alt="">
                    </li>

                   </li>
                 </ul>
               </div>
             </div>
         </div>

         <div class="slide" id='The name Kafka'>
            <h3 class='center'>The name Kafka</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="img/franzKafka-1.png" alt="">
                       <pre style='font-size: 14px;'>
                          I thought that since Kafka was a system optimized for writing, using a writer’s name
                          would make sense. 
                          
                          I had taken a lot of lit classes in college and liked Franz Kafka. Plus
                          the name sounded cool for an open source project.
                          
                          So basically there is not much of a relationship.

                          - Jay Kreps (Team Lead at LinkedIn for Kafka Project)
                       </pre>
                    </li>

                   </li>
                 </ul>
               </div>
             </div>
         </div>










         <div class="slide" id='ZooKeeper'>
            <h3 class='center'>ZooKeeper &rarr;	 highly reliable distributed coordination 
              </h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="img/zookeeper-1.png" height="200" alt="">
                     <img src="https://zookeeper.apache.org/images/zookeeper_small.gif" height="100" alt="">
                    Centralized service  used to maintain naming and configuration data.<br/>
                    Used to store metadata about the Kafka cluster, as well as consumer client details.
                   </li>
                      <li class="list-group-item">
                          Provides flexible and robust synchronization within distributed systems                      </li>
                      <li class="list-group-item">
                          Allows multiple clients to perform simultaneous reads and writes and acts as a shared configuration service within the system
                      </li>
                      <li class="list-group-item">
                        Provides the consistent view of the system: 
                          keeps track of status of the Kafka cluster nodes and it also keeps track of Kafka topics, partitions etc.

                      </li>
                      

                     
                 </ul>
               </div>
             </div>
         </div>


         <div class="slide" id='Quick Demo'>
          <h3 class='center'>Quick Demo</h3> 
            </h3>
           <div class="row">
             <div class="col-lg-0"></div>
             <div class="col-lg-12">
               <ul class="list-group largelist">
                 <li class="list-group-item">
                    <img src="img/kafka-run-1.gif" width="1000" alt="">

                  </li>
                      

                     
                </ul>
              </div>
            </div>
        </div>


       


                

         <div class="slide" id='Download and Start ZooKeeper'>
            <h3 class='center'>Download and Start ZooKeeper</h3> 
              </h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                  
                    <pre>
mkdir ~/apache/kafka
curl -O  https://archive.apache.org/dist/kafka/0.11.0.0/kafka_2.11-0.11.0.0.tgz 


tar -xzf kafka_2.11-0.11.0.0.tgz
cd kafka_2.11-0.11.0.0
# Kafka uses ZooKeeper so you need to first start a ZooKeeper server 

#--------------------------
cat config/zookeeper.properties 
dataDir=/tmp/zookeeper
# the port at which the clients will connect
clientPort=2181
# disable the per-ip limit on the number of connections since this is a non-production config
maxClientCnxns=0

# check any process running on this port: 
lsof -t -i :2181
# if found kill them using:  kill $(lsof -t -i :2181)
#--------------------------start Zookeeper ----
bin/zookeeper-server-start.sh config/zookeeper.properties

...
[2019-04-09 03:47:30,216] INFO binding to port 0.0.0.0/0.0.0.0:2181 (org.apache.zookeeper.server.NIOServerCnxnFactory)
...
  

                        
                    </pre>
                   </li>
                      <li>
                        <a href="./downloads/kafka_2.11-0.11.0.0.zip">Download for Windows Users </a>
                      </li>

                     
                 </ul>
               </div>
             </div>
         </div>



         <div class="slide" id='Start Kafka Server (Broker)'>
            <h3 class='center'>Start Kafka Server (Broker)' </h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                  
                    <pre>
cat config/server.properties
# Hostname and port the broker will advertise to producers and consumers. If not set, 
# it uses the value for "listeners" if configured.  Otherwise, it will use the value
# returned from java.net.InetAddress.getCanonicalHostName().
#advertised.listeners=PLAINTEXT://your.host.name:9092

# check the port 9092 is free
lsof -t -i :9092
# if port 9092 is in use, kill it:  kill $(lsof -t -i :9092) 

# start the kafka server (broker)
bin/kafka-server-start.sh config/server.properties

...
[2019-04-09 03:47:30,216] INFO binding to port 0.0.0.0/0.0.0.0:2181 (org.apache.zookeeper.server.NIOServerCnxnFactory)
...
  

                        
                    </pre>
                   </li>
                      

                     
                 </ul>
               </div>
             </div>
         </div>

         <div class="slide" id='Create and List a Topic'>
          <h3 class='center'>Create and List a Topic</h3>
           <div class="row">
             <div class="col-lg-0"></div>
             <div class="col-lg-12">
               <ul class="list-group largelist">
                 <li class="list-group-item">
                
                  <pre>

                    # create a topic 'test'
                    bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test

                    # list the topics
                    bin/kafka-topics.sh --list   --zookeeper localhost:2181
                      
                  </pre>
                 </li>
                    

                   
               </ul>
             </div>
           </div>
       </div>

       <div class="slide" id='Produce Messages'>
        <h3 class='center'>Produce Messages</h3>
         <div class="row">
           <div class="col-lg-0"></div>
           <div class="col-lg-12">
             <ul class="list-group largelist">
               <li class="list-group-item">
              
                <pre>

                  # produce messages for the topic 'test'
                  bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test
                    
                </pre>
               </li>
                  

                 
             </ul>
           </div>
         </div>
     </div>

     <div class="slide" id='Consume Messages'>
      <h3 class='center'>Consume Messages</h3>
       <div class="row">
         <div class="col-lg-0"></div>
         <div class="col-lg-12">
           <ul class="list-group largelist">
             <li class="list-group-item">
            
              <pre>

                # consume messages for the topic 'test'
                bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning

                  
              </pre>
             </li>
                

               
           </ul>
         </div>
       </div>
   </div>

   <div class="slide" id='Quick Demo Scala'>
      <h3 class='center'>Quick Demo Scala</h3> 
        </h3>
       <div class="row">
         <div class="col-lg-0"></div>
         <div class="col-lg-12">
           <ul class="list-group largelist">
             <li class="list-group-item">
                <img src="https://raw.githubusercontent.com/mohan-chinnappan-n/kafka-demo/master/img/kafka-1.gif" width="1000" alt="">

              </li>
                  

                 
            </ul>
          </div>
        </div>
    </div>

    <div class="slide" id='Quick Demo Heroku Kafka'>
        <h3 class='center'>Quick Demo Heroku Kafka</h3> 
          </h3>
         <div class="row">
           <div class="col-lg-0"></div>
           <div class="col-lg-12">
             <ul class="list-group largelist">
                <li class="list-group-item">
                  <a target="_blank" href="https://mohan-chinnappan-n2.github.io/2019/kafka/HerokuKafka.html">Heroku Kafka Sample Session</a>
                  </li>
                </li>

               <li class="list-group-item">
                  <img src="https://raw.githubusercontent.com/mohan-chinnappan-n/kafka-demo/master/img/heroku-kafka-2.gif" width="1000" alt="">

                </li>
                    

                   
              </ul>
            </div>
          </div>
      </div>




      

         <div class="slide" id='ZooKeeper Ensemble'>
            <h3 class='center'>ZooKeeper Ensemble</h3> 
              </h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                  
                      A Zookeeper cluster is called an ensemble. Due to the algorithm used, it is recommended 
                      that ensembles contain an odd number of servers (e.g., 3, 5, etc.) as a majority
                       of ensemble members (a quorum) must be working in order for Zookeeper to
                      respond to requests. 
                      <hr/>
                      This means that in a 3-node ensemble, you can run with 1 node missing. 
                      <hr/> With a <b>5-node ensemble (recommended) </b>, you can run with 2 nodes missing.

                       
                        
                   </li>
                      

                     
                 </ul>
               </div>
             </div>
         </div>


         <div class="slide" id='ZooKeeper Ensemble Config'>
            <h3 class='center'>ZooKeeper Ensemble Config</h3> 
              </h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                  
                   
                      <pre>
                        $ cat /usr/local/zookeeper/conf/zoo.cfg 
                          # in ms
                          tickTime=2000

                          dataDir=/var/lib/zookeeper

                          clientPort=2181

                          #  the amount of time to allow followers to connect with a leader :
                          initLimit=20

                          # limits how out-of-sync followers can be with the leader :
                          syncLimit=5
                          
                          #  servers in the ensemble:
                          #  format: server.X=hostname:peerPort:leaderPort
                          #  X: ID
                          #  peerPort: The TCP port over which servers in the ensemble communicate with each other
                          #  leaderPort: The TCP port over which leader election is performed.
                          #  each server must have a file in the data Dir directory with the name myid:
                          #     this file must contain the ID number of the server

                          which must match the configuration file. 
                          server.1=zoo1.example.com:2888:3888
                          server.2=zoo2.example.com:2888:3888
                          server.3=zoo3.example.com:2888:3888
                          server.4=zoo4.example.com:2888:3888
                          server.5=zoo5.example.com:2888:3888

                      </pre>
                        
                   </li>
                      

                     
                 </ul>
               </div>
             </div>
         </div>



         <div class="slide" id='ZAB'>
            <h3 class='center'>ZAB: Zookeeper Atomic Broadcast Protocol Papers</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                      <li class="list-group-item">
                          <img src="img/leader-follower.png" height="200" alt=""><br/>
                          Upon leader crashes, nodes execute a recovery protocol  to agree upon a common consistent state before resuming regular operation 
                          and to establish a new leader to broadcast state changes

                          <br/>
                          <a class='btn btn-warning reflink' href="img/zab.totally-ordered-broadcast-protocol.2008.pdf">
                            A simple totally ordered broadcast protocol</a>
                      </li>
                      <li class="list-group-item">
                        <a class='btn btn-warning reflink' href="img/2012-deSouzaMedeiros.pdf">ZooKeeper’s atomic broadcast protocol: Theory and practice</a>

                      </li>

                 </ul>
               </div>
             </div>
         </div>

       

         <div class="slide" id='Producer'>
            <h3 class='center'>Producer</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="img/kafka-producer-1.png" height="500" alt="">
                    </li>
                 </ul>
               </div>
             </div>
         </div>

         




         <div class="slide" id='How Kafka Data is stored?'>
            <h3 class='center'>How Kafka Data is Stored?</h3>
             <div class="row">
               <div class="col-lg-0"></div>
               <div class="col-lg-12">
                 <ul class="list-group largelist">
                   <li class="list-group-item">
                     <img src="img/kafka-log-rep-1.png" height="300" alt=""> <br/>
                      Data written to Kafka is written to disk and replicated for <b>fault-tolerance</b>

                    </li>  
                    <li class="list-group-item">
                        Producers to wait on acknowledgement so that a write isn't considered complete until it is fully replicated
                    </li>

                      <li class="list-group-item">
                          Special purpose <b>distributed filesystem</b> dedicated to:<br> { hi-perf, low-latency commit log storage, replication...}
                      </li>
                     
                 </ul>
               </div>
             </div>
         </div>


         

          




  

         













  






    </div>

    <script> Split(["#menu", "#content"], { sizes: [15, 80] }); </script>
     <script src='https://mohan-chinnappan-n2.github.io/2019/dx/js/slides.js?v=17'> </script>

  </body>
</html>
