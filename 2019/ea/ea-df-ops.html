<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>
    EA Dataflow operations
  </title>
  <link rel="icon" type="image/x-icon" href="https://mohan-chinnappan-n2.github.io/favicon.ico">

  <meta name="viewport" content="width=device-width,initial-scale=1">

  <link rel="stylesheet" href="https://mohan-chinnappan-n2.github.io/2019/stats/css/gridism.css">
  <link rel="stylesheet" href="https://mohan-chinnappan-n2.github.io/2019/stats/css/markdown.css">
  <link rel="stylesheet" href="https://mohan-chinnappan-n2.github.io/2019/stats/css/octicons.css">
  <link href="https://mohan-chinnappan-n2.github.io/2019/stats/css/main.css" rel="stylesheet" />
  <link href="https://mohan-chinnappan-n2.github.io/2019/stats/css/pygments.css" rel="stylesheet" />

  <script src="https://mohan-chinnappan-n2.github.io/2019/stats/js/jquery.js" type="text/javascript"></script>
  <script src="https://mohan-chinnappan-n2.github.io/2019/stats/js/snap.svg-min.js" type="text/javascript"></script>
  <script src="https://mohan-chinnappan-n2.github.io/2019/stats/js/application.js" type="text/javascript"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.0/showdown.js"></script>


</head>

<body>

  <header>
    <div class="wrap">
      <ul class="links">
        <li><a target="_blank" href="http://www.einsteinanalyticslearningmap.com/">EA Learning Map</a>
        </li>
      </ul>
    </div>
  </header>

  <article class="full">
    <div class="article-heading js-article-heading js-geopattern" style="background:steelblue;">
      <div class="wrap">
        <div class="icon-container">
          <span class="mega-octicon octicon-light-bulb"></span>
        </div>
        <h1>EA Dataflow operations</h1>
        <span class="article-read-time article-meta">
            <span class="octicon octicon-clock"></span> 20 minutes read
        </span>

      </div>
    </div>


    <div class="wrap">

      <!-- toc-->
      <div class="toc-wrapper">
           <span class='octicon octicon-clippy' style='color:steelblue; padding-left:30px;'></span> 
        <ol class="toc js-toc"></ol>
      </div>


      <!-- main content-->
      <div class="markdown-body content-body ">

        <p><a id="dfDesign" title="Dataflow Design" class="toc-item"></a></p>
        <div id='dfDesign-md' data-trim='false' style='display:none;'>

## Dataflow Design

### Usual Pattern
- Extract
- Transform 
- Register

### Example
![Augment Fruit 1](img/df/augment-fruit-1.png)

![Dataset Desgin](https://resources.help.salesforce.com/images/9adbb6369150c52c4a27ad155d41dbc8.png)
</div>

        <p><a id="augmenttransform" title="Augment Transformation" class="toc-item"></a></p>
        <div id='augment-md' data-trim='false' style='display:none;'>


## Augment Transformation

- Takes in input dataset
- Augments it by combining elements from another **related** dataset
- Example: Augment the Account dataset with the User dataset to enable a query to return account records and the full names of the account owners.

![account contact user erd](img/account-user-contact-dict-erd.svg)

- To create augment identify each input dataset as the **left** or **right** dataset and specify the relationship between them.
- EA combines all the columns of the **left dataset** with only the **specified columns from the right dataset**
- EA  adds the relationship to column names from the right dataset  (useful when the left and right datasets have columns with the same names)
- Users that have access to registered datasets can query the data. 
- You can apply row-level security on a dataset to restrict access to records

```
// pseudo code
let augment = (leftDataset, rightDataset, matchCondition, rightColumns ) => {
     // matcCondtion format: "left_key": [ "Id" ],"right_key": [ "Prod_ID" ] 
    leftDataset.forEach( (lrecord, ndx) =>  {
      //  A key can be a single-column key or a composite key
      lookup(lrecord, rightDataset, matchCondition, (rrecord)  => {
          augmentedDataset.push(combine(lrecord, project(rrecord, rightColumns)) );
      });
      return augmentedDataset;    
    });
}

```

-  To augment more than two datasets, augment two datasets at a time

### Example  Opportunities and Accounts

![Oppty - Account](https://resources.help.salesforce.com/images/b6c1d1e7d66a28e344cae76258e5448f.png)


- Extract Opportunity
```
"Extract_Opportunity": {
  "action": "sfdcDigest",
  "parameters": {
      "object": "Opportunity",
      "fields": [
          { "name": "Id" },
          { "name": "Name" },
          { "name": "Amount" },
          { "name": "StageName" },
          { "name": "CloseDate" },
          { "name": "AccountId" },
          { "name": "OwnerId" }
      ]
  }
}
```
- Extract Account
```
"Extract_Account": {
  "action": "sfdcDigest",
  "parameters": {
      "object": "Account",
      "fields": [
          { "name": "Id" },
          { "name": "Name" }
      ]
  }
}

```

- Augment Opportunities With Accounts
```

"Augment_OpportunitiesWithAccount": {
  "action": "augment",
  "parameters": {
      "operation": "LookupSingleValue",

      "left": "Extract_Opportunity",
      "left_key": [ "AccountId" ],

      "relationship": "OpptyAcct",

      "right": "Extract_Account",
      "right_key": [ "Id" ],
      "right_select": [ "Name" ]
  }
}

```

- Register the resulted augmented dataset (Opportunity_Account)
```

"Register_OpportunityDetails": {
  "action": "sfdcRegister",
  "parameters": {
      "alias": "Opportunity_Account",
      "name": "Opportunity_Account",
      "source": "Augment_OpportunitiesWithAccount" }
}



```

![Opportunity_Account](https://resources.help.salesforce.com/images/9e70ea854d5922f2f819db87b569f3a8.png)

</div>




<p><a id="fruitsaugment" title="Augment Transformation Fruits dataset" class="toc-item"></a></p>
<div id='fruitsaugment-md' data-trim='false' style='display:none;'>

## Augment example with fruits dataset

### Data sources
```
$ cat data/fruits.csv 
name,qty
Mango,150
Jackfruit,200
Banana,250

$ cat data/botnames.csv 
name,botName
Mango,Mangifera indica
Jackfruit,Artocarpus heterophyllus
Banana,Musa

```

### Dataflow JSON
```
{
  "ExtractFruits": {
    "action": "edgemart",
    "parameters": {
      "alias": "fruits1"
    }
  },
  "ExtractBotNames": {
    "action": "edgemart",
    "parameters": {
      "alias": "botnames"
    }
  },
  "AugumentFruitsWithBotNames": {
    "action": "augment",
    "parameters": {
      "operation": "LookupSingleValue",
      "relationship": "fruits",
      "left": "ExtractFruits",
      "right": "ExtractBotNames",
      "left_key": [
        "name"
      ],
      "right_key": [
        "name"
      ],
      "right_select": [
        "botName"
      ]
    }
  },
  "RegisterFruitsWithBotNames": {
    "action": "sfdcRegister",
    "parameters": {
      "alias": "FruitsBotNames",
      "source": "AugumentFruitsWithBotNames",
      "name": "FruitsBotNames"
    }
  }
}


```


### Dataflow Design
![Augment Fruit 1](img/df/augment-fruit-1.png)
### Running dataflow **fruits**
![Augment Fruit 1](img/df/augment-fruit-2.png)
### Dataflow run complete and created **FruitBotNames** dataset
![Augment Fruit 1](img/df/augment-fruit-3.png)
### Looking at the newly created dataset **FruitBotNames** using Recipe
![Augment Fruit 1](img/df/augment-fruit-4.png)

### Dashboard 
![Augment Fruit 1](img/df/augment-fruit-5.png)


</div>

<p><a id="jqaugment" title="Augment Transformation using jq" class="toc-item"></a></p>
<div id='jqaugment-md' data-trim='false' style='display:none;'>
## Using jq to augmenting 2 json files
### If you have data in json and you like to start with an augmented data source, you can methods like this

```
$ cat fruits.json | jq
[
  {
    "name": "Mango",
    "qty": 150
  },
  {
    "name": "Jackfruit",
    "qty": 200
  },
  {
    "name": "Banana",
    "qty": 250
  }
]

$ cat botnames.json | jq
[
  {
    "name": "Mango",
    "BotName": "Mangifera indica"
  },
  {
    "name": "Jackfruit",
    "BotName": "Artocarpus heterophyllus"
  },
  {
    "name": "Banana",
    "BotName": "Musa"
  }
]

# augment to fruits with botnames

$ jq -s '[ .[0] + .[1] | group_by(.name)[] | select(length > 1) | add ]' fruits.json botnames.json
[
  {
    "name": "Banana",
    "qty": 250,
    "BotName": "Musa"
  },
  {
    "name": "Jackfruit",
    "qty": 200,
    "BotName": "Artocarpus heterophyllus"
  },
  {
    "name": "Mango",
    "qty": 150,
    "BotName": "Mangifera indica"
  }
]

```



</div>



<p><a id="links" title="Links" class="toc-item"></a></p>
<div id='links-md' data-trim='false'>

### Links 

- [augment Transformation](https://help.salesforce.com/articleView?id=bi_integrate_augment_transformation.htm&type=0)
- [Design Dataflow](https://help.salesforce.com/articleView?id=bi_integrate_dataflow_design.htm&type=5)

</div>


  


</div>
</article>

<script> const mds = ['dfDesign-md', 'augment-md','fruitsaugment-md','jqaugment-md', 'links-md'];</script>
<script src="../stats/js/md2html.js"> </script>
</body>

</html>
