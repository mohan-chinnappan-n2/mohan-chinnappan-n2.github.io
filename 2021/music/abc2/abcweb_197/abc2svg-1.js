// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2020 Jean-Francois Moine - LGPL3+
// commit [2f252c632d]
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(q){var A=0;return function(){return A<q.length?{done:!1,value:q[A++]}:{done:!0}}};$jscomp.arrayIterator=function(q){return{next:$jscomp.arrayIteratorImpl(q)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(q,A,D){q!=Array.prototype&&q!=Object.prototype&&(q[A]=D.value)};$jscomp.getGlobal=function(q){q=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,q];for(var A=0;A<q.length;++A){var D=q[A];if(D&&D.Math==Math)return D}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(q,A){this.$jscomp$symbol$id_=q;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:A})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function q(D){if(this instanceof q)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(D||"")+"_"+A++,D)}var A=0;return q}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.iterator;q||(q=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[q]&&$jscomp.defineProperty(Array.prototype,q,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var q=$jscomp.global.Symbol.asyncIterator;q||(q=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(q){$jscomp.initSymbolIterator();q={next:q};q[$jscomp.global.Symbol.iterator]=function(){return this};return q};
$jscomp.iteratorFromArray=function(q,A){$jscomp.initSymbolIterator();q instanceof String&&(q+="");var D=0,v={next:function(){if(D<q.length){var O=D++;return{value:A(O,q[O]),done:!1}}v.next=function(){return{done:!0,value:void 0}};return v.next()}};v[Symbol.iterator]=function(){return v};return v};
$jscomp.polyfill=function(q,A,D,v){if(A){D=$jscomp.global;q=q.split(".");for(v=0;v<q.length-1;v++){var O=q[v];O in D||(D[O]={});D=D[O]}q=q[q.length-1];v=D[q];A=A(v);A!=v&&null!=A&&$jscomp.defineProperty(D,q,{configurable:!0,writable:!0,value:A})}};$jscomp.polyfill("Array.prototype.keys",function(q){return q?q:function(){return $jscomp.iteratorFromArray(this,function(q){return q})}},"es6","es3");if("undefined"==typeof abc2svg)var abc2svg={};
abc2svg.C={BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8};abc2svg.sym_name="bar clef custos  grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" ");
abc2svg.keys=[new Int8Array([-1,-1,-1,-1,-1,-1,-1]),new Int8Array([-1,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,0]),new Int8Array([0,0,0,1,0,0,0]),new Int8Array([1,0,0,1,0,0,0]),new Int8Array([1,0,0,1,1,0,0]),new Int8Array([1,1,0,1,1,0,0]),new Int8Array([1,1,0,1,1,1,0]),new Int8Array([1,1,1,1,1,1,0]),new Int8Array([1,1,1,1,1,
1,1])];abc2svg.p_b40=new Int8Array([2,8,14,19,25,31,37]);abc2svg.b40_p=new Int8Array([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6]);abc2svg.b40_a=new Int8Array([-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2]);abc2svg.b40_m=new Int8Array([-2,-1,0,1,2,0,0,1,2,3,4,0,2,3,4,5,6,3,4,5,6,7,0,5,6,7,8,9,0,7,8,9,10,11,0,9,10,11,12,13]);
abc2svg.b40k=new Int8Array([36,1,2,3,8,2,2,7,8,13,14,2,8,13,14,19,20,13,14,19,20,25,2,19,24,25,30,31,2,25,30,31,36,37,2,31,36,37,38,3]);abc2svg.b40sf=new Int8Array([-2,-7,0,7,2,88,0,-5,2,-3,4,88,2,-3,4,-1,6,-3,4,-1,6,1,88,-1,-6,1,-4,3,88,1,-4,3,-2,5,88,3,-2,5,0,7]);abc2svg.isb40=new Int8Array([0,1,6,11,12,17,18,23,28,29,34,35]);abc2svg.ifb40=new Int8Array([0,5,6,11,12,17,22,23,28,29,34,39]);abc2svg.pab40=function(q,A){q+=19;q=40*(q/7|0)+abc2svg.p_b40[q%7];A&&3!=A&&(q+=A);return q};
abc2svg.b40p=function(q){return 7*(q/40|0)+abc2svg.b40_p[q%40]-19};abc2svg.b40a=function(q){return abc2svg.b40_a[q%40]};abc2svg.b40m=function(q){return 12*(q/40|0)+abc2svg.b40_m[q%40]};abc2svg.ch_alias={maj:"",min:"m","-":"m","\u00b0":"dim","+":"aug","+5":"aug",maj7:"M7","\u03947":"M7","\u0394":"M7",min7:"m7","-7":"m7","\u00f87":"m7b5","\u00b07":"dim7","min+7":"m+7",aug7:"+7","7+5":"+7","7#5":"+7",sus:"sus4","7sus":"7sus4"};
abc2svg.rat=function(q,A){for(var D,v,O=0,y=0,ua=1,V=1;0!=A;)v=A,D=q/A|0,A=q%A,q=v,v=O+D*ua,O=ua,ua=v,v=V+D*y,V=y,y=v;return[ua,y]};abc2svg.pitcmp=function(q,A){return q.pit-A.pit};
abc2svg.Abc=function(q){function A(a,c){if(!a)return a;var d=new a.constructor,e;for(e in a)a.hasOwnProperty(e)&&(d[e]=c&&"object"==typeof a[e]?A(a[e],c-1):a[e]);return d}function D(a,c,d,e){var g,f;if(q.errbld){switch(a){case 0:a="warn";break;case 1:a="error";break;default:a="fatal"}q.errbld(a,c,d,e)}else{if(void 0!=e&&0<=e){for(g=f=0;;){var h=t.file.indexOf("\n",g);if(0>h||h>e)break;f++;g=h+1}g=e-g}e="";d&&(e=d,f&&(e+=":"+(f+1)+":"+(g+1)),e+=" ");switch(a){case 0:e+="Warning: ";break;case 1:e+=
"Error: ";break;default:e+="Internal bug: "}q.errmsg(e+c,f,g)}}function v(a,c,d,e,g,f,h){var l;if(a||!r.quiet){if(c){if(c.err)return;c.err=!0}q.textrans&&(l=q.textrans[d])&&(d=l);3<arguments.length&&(d=d.replace(/\$./g,function(a){switch(a){case "$1":return e;case "$2":return g;case "$3":return f;default:return h}}));c&&c.fname?D(a,d,c.fname,c.istart):D(a,d)}}function O(){this.index=0;O.prototype.char=function(){return this.buffer[this.index]};O.prototype.next_char=function(){return this.buffer[++this.index]};
O.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function y(a,c,d,e,g,f){v(a,{fname:t.fname,istart:t.istart+t.line.index},c,d,e,g,f)}function ua(a){/eval *\(|Function|setTimeout|setInterval/.test(a)?y(1,"Unsecure code"):eval('"use strict";\n'+a)}function V(a,c,d,e){a=B[a];var g=d/pa*256|0;d=(d+e)/pa*256|0;0>g&&(g=0);256<=d&&(d=255,g>d&&(g=d));if(c)for(c=a.top[g++];g<=d;)c<a.top[g]&&(c=a.top[g]),g++;else for(c=a.bot[g++];g<=
d;)c>a.bot[g]&&(c=a.bot[g]),g++;return c}function ea(a,c,d,e,g){a=B[a];var f=d/pa*256|0;d=(d+e)/pa*256|0;0>f&&(f=0);256<=d&&(d=255,f>d&&(f=d));if(c)for(;f<=d;)a.top[f]<g&&(a.top[f]=g),f++;else for(;f<=d;)a.bot[f]>g&&(a.bot[f]=g),f++}function fd(a,c){switch(c){case n.SL_ABOVE:return!0;case n.SL_BELOW:return!1}return a.multi&&0!=a.multi?0<a.multi:a.p_v.have_ly?a.pos.voc!=n.SL_ABOVE:!1}function gd(a){if(!a.ldst){var c,d=a.s;var e=a.start;var g=e.s;var f=g.x+3;e=e.ix;0<e&&(c=U[e-1]);a.st=d.st;a.lden=
!1;a.has_val=!0;if(e=fd(d,d.pos.dyn))a.up=!0;if(c&&c.s==g&&(a.up&&!c.up||!a.up&&c.up)){var h=c.dd;ab[h.func]&&(c=c.x+c.val+4,c>f&&(f=c))}a.defl.noen?(g=a.x-f,20>g&&(f=a.x-20-3,g=20)):(c=d.x,(d=U[a.ix+1])&&d.s==g&&(a.up&&!d.up||!a.up&&d.up)&&(h=d.dd,ab[h.func]&&(c-=5)),g=c-f-4,20>g&&(f-=.5*(20-g),g=20));a.val=g;a.x=f;a.y=V(a.st,e,f,g);e||(f=a.dd,a.y-=f.h)}}function hd(a){if(!a.ldst){var c=a.dd,d=a.prev,e=a.s,g=e.st,f=a.start.s,h=f.x;d&&(h=d.s.x+a.dd.wl+2,d.val-=d.dd.wr,8>d.val&&(d.val=8));a.st=g;if(4!=
c.func)switch(c.glyph){case "8va":case "15ma":var l=1;break;default:l=0<=e.multi}if(a.defl.noen){var k=a.x-h;20>k&&(h=a.x-20-3,k=20)}else k=e.x-h-6,e.type==n.NOTE&&(k-=6),10>k&&(h-=10-k,k=10);c=a.dd;var x=V(g,l,h-c.wl-5,k);if(l){var E=B[f.st].topbar+2;x<E&&(x=E)}else E=B[f.st].botbar-2,x>E&&(x=E),x-=c.h;if(d)if(l)x<d.y&&(x=d.y);else if(x>=d.y)x=d.y;else{do d.y=x,d=d.prev;while(d)}a.lden=!1;a.has_val=!0;a.val=k;a.x=h;a.y=x;l&&(x+=c.h);ea(g,l,h,k,x);l?f.ymx=e.ymx=x:f.ymn=e.ymn=x}}function id(a){if(!a.ldst)if(a.start)hd(a);
else{var c=a.s,d=a.dd,e=a.x,g=d.wl+d.wr,f=B[c.st].topbar+2,h=B[c.st].botbar-2;c.nhd&&(e+=c.notes[0<=c.stem?0:c.nhd].shhd);var l=-1;if(4==d.func)l=0;else if(c.pos)switch(c.pos.orn){case n.SL_ABOVE:l=1;break;case n.SL_BELOW:l=0}switch(d.glyph){case "accent":case "roll":if(!l||0>l&&(0>c.multi||!c.multi&&0<c.stem)){l=V(c.st,!1,c.x-d.wl,g)-2;l>h&&(l=h);l-=d.h;ea(c.st,!1,c.x,0,l);var k=!0;c.ymn=l}else l=V(c.st,!0,c.x-d.wl,g)+2,l<f&&(l=f),ea(c.st,!0,c.x-d.wl,g,l+d.h),c.ymx=l+d.h;break;case "brth":case "lphr":case "mphr":case "sphr":l=
f+1;"brth"==d.glyph&&l<c.ymx&&(l=c.ymx);for(c=c.ts_next;c&&!c.seqst;c=c.ts_next);e+=.45*((c?c.x:pa)-e);break;default:0==d.name.indexOf("invert")&&(k=!0),"invertedfermata"!=d.name&&(0<l||0>l&&0<=c.multi)?(l=V(c.st,!0,c.x-d.wl,g)+2+d.hd,l<f&&(l=f),ea(c.st,!0,c.x-d.wl,g,l+d.h),c.ymx=l+d.h):(l=V(c.st,!1,c.x-d.wl,g)-3+d.hd,l>h&&(l=h),l-=d.h,ea(c.st,!1,c.x-d.wl,g,l-d.hd),"fermata"==d.name&&(k=!0),c.ymn=l)}k&&(l+=d.h,a.inv=!0);a.x=e;a.y=l}}function cc(a){var c,d=xc[a];if(d)if(c=d.match(/(\d+)\s+(.+?)\s+([0-9.,]+)\s+([0-9.]+)\s+([0-9.]+)/)){var e=
Number(c[1]),g=c[3],f=parseFloat(c[4]),h=parseFloat(c[5]);if(isNaN(e))v(1,null,"%%deco: bad C function value '$1'",c[1]);else if(10<e&&(32>e||44<e))v(1,null,"%%deco: bad C function index '$1'",e);else{5==e&&(e=3);7==e&&(e=6);if(0<g.indexOf(",")){g=g.split(",");var l=g[1];g=g[0]}else l=0;if(50<g||80<f||80<h)v(1,null,"%%deco: abnormal h/wl/wr value '$1'",d);else{var k=Cb[a];k||(k={name:a},Cb[a]=k);k.func=0==k.name.indexOf("head-")?9:e;k.glyph=c[2];k.h=Number(g);k.hd=Number(l);k.wl=f;k.wr=h;if(a=d.replace(c[0],
"").trim())'"'==a[0]&&(a=a.slice(1,-1)),k.str=a;6==k.func&&void 0==k.str&&(k.str=k.name);l=k.name.slice(-1);if("("==l||")"==l&&0>k.name.indexOf("("))if(k.str=null,c=k.name.slice(0,-1)+("("==l?")":"("),a=Cb[c])"("==l?(k.dd_en=a,a.dd_st=k):(k.dd_st=a,a.dd_en=k);else if(a=cc(c),!a)return;return k}}}else v(1,null,"Invalid decoration '$1'",a);else r.decoerr&&v(1,null,"Unknown decoration '$1'",a)}function Db(a,c,d){var e,g=a.length;for(e=0;e<g;e++){var f=a[e];var h=Cb[f];if(!h&&(h=cc(f),!h))continue;switch(h.func){case 0:if(c.type==
n.BAR&&"dot"==h.name){c.bar_dotted=!0;break}case 1:case 2:if(!c.notes){v(1,c,H.must_note_rest,h.name);continue}break;case 8:if(c.type!=n.NOTE){v(1,c,H.must_note,h.name);continue}var l=c.notes[c.nhd];l.a_dcn||(l.a_dcn=[]);l.a_dcn.push(h.name);continue;case 9:if(!c.notes){v(1,c,H.must_note_rest,h.name);continue}for(f=0;f<=c.nhd;f++)l=c.notes[f],l.a_dcn||(l.a_dcn=[]),l.a_dcn.push(h.name);continue;case 10:if(c.notes)for(f=0;f<=c.nhd;f++)c.notes[f].color=h.name;else c.color=h.name;break;case 32:c.invis=
!0;break;case 33:if(c.type!=n.BAR){v(1,c,"!beamon! must be on a bar");continue}c.beam_on=!0;break;case 34:if(c.type!=n.NOTE||!d||d.type!=n.NOTE||c.dur!=d.dur){v(1,c,"!$1! must be on the last of a couple of notes",h.name);continue}c.trem2=!0;c.beam_end=!0;c.beam_st=!1;d.beam_st=!0;d.beam_end=!1;c.ntrem=d.ntrem=Number(h.name[4]);for(f=0;f<=c.nhd;f++)c.notes[f].dur*=2;for(f=0;f<=d.nhd;f++)d.notes[f].dur*=2;break;case 35:if(c.type!=n.NOTE){v(1,c,H.must_note,h.name);continue}c.xstem=!0;break;case 36:if(c.type!=
n.NOTE){v(1,c,H.must_note,h.name);continue}"1"==h.name[6]?c.beam_br1=!0:c.beam_br2=!0;break;case 37:c.rbstop=1;break;case 38:if(c.type!=n.NOTE){v(1,c,H.must_note,h.name);continue}c.trem1=!0;c.ntrem=h.name.length;break;case 39:if(c.type!=n.NOTE){v(1,c,H.must_note,h.name);continue}c.feathered_beam="a"==h.name[5]?1:-1;break;case 40:c.stemless=!0;break;case 41:c.rbstop=2;break;case 42:if(!c.notes[0].acc)continue;f="sacc"+c.notes[0].acc.toString();h=Cb[f];if(!h&&(h=cc(f),!h)){v(1,c,H.bad_val,"!editorial!");
continue}delete c.notes[0].acc;m.acc[c.notes[0].pit+19]=0;break;case 43:f=m.acc[c.notes[0].pit+19];if(c.notes[0].acc||!f)continue;c.notes[0].a_dcn||(c.notes[0].a_dcn=[]);c.notes[0].a_dcn.push("cacc"+f);break;case 44:if(hb[h.name]){v(1,c,"Conflict on !$1!",h.name);continue}f=h.name.slice(0,-1)+("("==h.name.slice(-1)?")":"(");if(!hb[f]){hb[h.name]=c;continue}"("==f.slice(-1)?l=hb[f]:(l=c,c=hb[f]);hb[f]=null;for(f=0;f<=l.nhd;f++)l.notes[f].tie_ty=n.SL_AUTO,l.notes[f].s=l;jd(c,l)}c.a_dd||(c.a_dd=[]);
c.a_dd.push(h)}}function yc(a){var c,d=0,e=a.a_dd,g=e.length;for(c=0;c<g;c++){var f=e[c];switch(f.func){case 1:7>d&&(d=7);break;case 2:14>d&&(d=14);break;case 3:switch(f.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=20)}}}0!=d&&a.prev&&a.prev.type==n.BAR&&(d-=3);return d}function Ie(){function a(a){var c=a.x-a.wl,d=U.length;for(a=0;a<d;a++){var e=U[a];e.ix=a;e.s.x=e.x=c;e.defl.nost=!0}}function c(a){if(a.a_dd){var c,d=a.a_dd.length;for(c=0;c<d;c++){var e=a.a_dd[c];switch(e.func){default:if(32<=
e.func)continue;var g=0;break;case 3:case 4:g=a.pos.orn;break;case 6:g=a.pos.vol;break;case 7:g=a.pos.dyn}if(g!=n.SL_HIDDEN&&(g={s:a,dd:e,st:a.st,ix:U.length,defl:{},x:a.x,y:a.y},a.type==n.BAR&&(g.x-=a.wl/2-2),U.push(g),e.dd_en?g.ldst=!0:e.dd_st&&(g.lden=!0,g.defl.nost=!0),Je[e.func]))zc[e.func](g)}}if(a.notes)for(e=0;e<a.notes.length;e++)if(a.notes[e].a_dcn){g=a;var x=e,E=g.notes[x],m=E.a_dcn.length;for(d=0;d<m;d++){var u=E.a_dcn[d];c=Cb[u];if(!c&&(c=cc(u),!c))continue;switch(c.func){case 0:case 1:case 3:case 4:case 8:break;
default:v(1,null,"Cannot have !$1! on a head",c.name);continue;case 9:E.invis=!0;break;case 10:E.color=c.name;continue;case 32:E.invis=!0;continue;case 40:g.stemless=!0;continue}u={s:g,dd:c,st:g.st,m:x,ix:0,defl:{},x:g.x,y:3*(E.pit-18)};U.push(u);c.dd_en?u.ldst=!0:c.dd_st&&(u.lden=!0,u.defl.nost=!0)}}}var d,e;for(d=P;d;d=d.ts_next){switch(d.type){case n.CLEF:case n.KEY:case n.METER:continue}break}for(U.length&&a(d);d;d=d.ts_next){switch(d.type){case n.BAR:case n.MREST:case n.NOTE:case n.REST:case n.SPACE:break;
case n.GRACE:for(e=d.extra;e;e=e.next)c(e);break;default:continue}c(d)}(function(){var a,c,d=U.length;for(a=0;a<d;a++){var e=U[a];if(e.ldst){var k=e.dd;var x=k.dd_en;var E=e.s;var m=E.v;for(c=a+1;c<d;c++){var u=U[c];if(!u.start&&u.dd==x&&u.s.v==m)break}if(c==d)for(m=E.st,c=a+1;c<d&&(u=U[c],u.start||u.dd!=x||u.s.st!=m);c++);c==d&&(u={s:E,st:e.st,dd:x,ix:U.length-1,x:pa-6,y:E.y,cont:!0,lden:!0,defl:{noen:!0}},u.x<E.x+10&&(u.x=E.x+10),void 0!=e.m&&(u.m=e.m),U.push(u));u.start=e;u.defl.nost=e.defl.nost;
0<a&&U[a-1].s.time==e.s.time&&U[a-1].dd.name.slice(0,k.name.length-1)==k.name.slice(0,k.name.length-1)&&(u.prev=U[a-1])}}for(a=0;a<d;a++)if(u=U[a],u.lden&&!u.start){E=u.s;a:{for(c=E;c.prev;)if(c=c.prev,c.rbstart)break a;for(c=c.p_v.sym;c.type!=n.CLEF;)c=c.ts_prev;c.next&&c.next.type==n.KEY&&(c=c.next);c=c.next&&c.next.type==n.METER?c.next:c}e={s:c,st:u.st,dd:u.dd.dd_st,ix:U.length-1,y:E.y,ldst:!0};e.x=e.s.x;void 0!=u.m&&(e.m=u.m);U.push(e);u.start=e}})()}function Ke(){var a,c=U.length;for(a=0;a<c;a++){var d=
U[a];var e=d.dd;e=e.func;if(Le[e]&&void 0==d.m)zc[e](d)}}function Me(){var a,c,d=Array(S+1),e=U.length;for(a=0;a<=S;a++)d[a]={ymin:0,ymax:0};for(a=0;a<e;a++){var g=U[a];(c=g.dd)&&ab[c.func]&&void 0==g.m&&(zc[c.func](g),!c.dd_en&&r.dynalign&&(g.up?g.y>d[g.st].ymax&&(d[g.st].ymax=g.y):g.y<d[g.st].ymin&&(d[g.st].ymin=g.y)))}for(a=0;a<e;a++)if(g=U[a],(c=g.dd)&&!c.dd_en&&ab[c.func]){if(r.dynalign){var f=g.up?d[g.st].ymax:d[g.st].ymin;g.y=f}else f=g.y;g.up&&(f+=c.h);ea(g.st,g.up,g.x,g.val,f)}Ne();for(f=
0;f<F.length;f++)if(a=F[f],!a.second&&a.sym){e=void 0;d=a;a=B[d.st].topbar+25;for(c=d.sym;c;c=c.next)if(c.type==n.BAR&&c.rbstart&&!c.norepbra){if(!c.next)break;e||(e=c,ba("repeat"));for(g=c;c.next&&(c=c.next,!c.rbstop););var h=V(d.st,!0,g.x,c.x-g.x);a<h&&(a=h);g.text&&(h=va(g.text),h=V(d.st,!0,g.x+4,h[0])+h[1],a<h&&(a=h));c.rbstart&&(c=c.prev)}if(c=e)for(Ma(d.st,!0),h=a*B[d.st].staffscale;c;c=c.next)if(c.rbstart&&!c.norepbra){for(g=c;c.next&&(c=c.next,!c.rbstop););if(g==c)break;var l=g.x;0<r.measurenb&
c.bar_num&&c.bar_num%r.measurenb&&(l+=6);e=c.type!=n.BAR?c.rbstop?0:c.x-pa+4:1<c.bar_type.length&&"[]"!=c.bar_type||"]"==c.bar_type?0<g.st&&!(L.staves[g.st-1].flags&64)?c.wl:":"==c.bar_type.slice(-1)?12:":"!=c.bar_type[0]?0:8:c.rbstop?0:8;e=c.x-l-e;c.next||c.rbstop||d.bar_start||(d.bar_start=A(c),d.bar_start.type=n.BAR,d.bar_start.bar_type="",delete d.bar_start.text,d.bar_start.rbstart=1,delete d.bar_start.a_gch);g.text&&la(l+4,h-J.curfont.size-3,g.text);Eb(l,h);2==g.rbstart&&(G+="m0 20v-20");G+=
"h"+e.toFixed(1);2==c.rbstop&&(G+="v20");G+='"/>\n';ea(g.st,!0,l,e,a+2);c.rbstart&&(c=c.prev)}}}function Oe(){var a;var c=L;for(a=0;a<=S&&!c.st_print[a];a++);if(!(a>S)){Ma(a);if(1!=B[a].staffscale){var d=Ja("measure").size;nb("measurefont","* "+(d/B[a].staffscale).toString())}ba("measure");var e=Tb("0");var g=P;var f=J.nbar;if(1<f)if(0==r.measurenb){var h=!0;var l=V(a,!0,0,20);l<B[a].topbar+14&&(l=B[a].topbar+14);la(0,l,f.toString());ea(a,!0,0,20,l+J.curfont.size+2)}else if(0==f%r.measurenb){for(;;g=
g.ts_next){switch(g.type){case n.CLEF:case n.KEY:case n.METER:case n.STBRK:continue}break}if(g.type!=n.BAR||!g.bar_num){g.prev&&(g=g.prev);h=!0;var k=e;10<=f&&(k*=100<=f?3:2);J.curfont.pad&&(k+=2*J.curfont.pad);c=g.x+g.wr+1;l=V(a,!0,c,k);l<B[a].topbar+6&&(l=B[a].topbar+6);l+=2+J.curfont.pad;la(c,l,f.toString());l+=J.curfont.size+J.curfont.pad;ea(a,!0,c,k,l)}}for(;g;g=g.ts_next){switch(g.type){case n.STAVES:c=g.sy;for(a=0;a<S&&!c.st_print[a];a++);Ma(a);continue;default:continue;case n.BAR:if(!g.bar_num||
1>=g.bar_num)continue}f=g.bar_num;0!=r.measurenb&&0==f%r.measurenb&&g.next&&!g.bar_mrep&&(h||(h=!0),k=e,10<=f&&(k*=100<=f?3:2),J.curfont.pad&&(k+=2*J.curfont.pad),c=g.x-k*(g.text?.6:.4),l=V(a,!0,c,k),l<B[a].topbar+3&&(l=B[a].topbar+3),g.next.type==n.NOTE&&(0<g.next.stem?l<g.next.ys-J.curfont.size&&(l=g.next.ys-J.curfont.size):l<g.next.y&&(l=g.next.y)),l+=2+J.curfont.pad,la(c,l,f.toString()),l+=J.curfont.size+J.curfont.pad,ea(a,!0,c,k,l))}J.nbar=f;d&&nb("measurefont","* "+d.toString())}}function Pe(a,
c,d,e){function g(a){return 6*Math.round((a+12)/6)-12-a}var f=a?3.5:5;a=a?1.8:3.2;if(0<c){c=e-(d-1)*f-a;if(26<c)return 0;d=e}else{d=e+(d-1)*f+a;if(-2>d)return 0;c=e}e=g(d-.25);c=g(c+.25);return e*e>c*c?c:e}function kd(a){var c;a=A(a);a.invis=!0;delete a.extra;delete a.text;delete a.a_gch;delete a.a_ly;delete a.a_dd;delete a.tp;a.notes=A(a.notes);for(c=0;c<=a.nhd;c++){var d=a.notes[c]=A(a.notes[c]);delete d.a_dcn}return a}function ld(a){function c(a,c,d,e,f,g){var h=f.s1,k=h.nflags;h.ntrem&&(k-=h.ntrem);
h.trem2&&g>k&&(h.dur>=n.BLEN/2?(a=h.x+6,c=f.s2.x-6):h.dur<n.BLEN/4&&(a+=5,c-=6));d=f.a*a+f.b-d;c=(c-a)/I.scale;f=f.a*c;Eb(a,d,!0);G+="l"+c.toFixed(1)+" "+(-f).toFixed(1)+"v"+e.toFixed(1)+"l"+(-c).toFixed(1)+" "+f.toFixed(1)+'z"/>\n'}var d,e,g,f,h=a.s1,l=a.s2;za(h,"beam");if(h.grace){var k=3.5;var x=3.2;var E=.29;var m=1.8}else k=5,x=8,E=.34,m=3.2;var u=h.stem;h.stem!=l.stem&&h.nflags<l.nflags&&(u=l.stem);0>u&&(m=-m);c(h.xs-E,l.xs+E,0,m,a,1);var p=0;for(d=h;d.type==n.NOTE&&d.stem!=u&&(d.ys=a.a*d.xs+
a.b-B[d.st].y+k*(d.nflags-1)*d.stem-m),d!=l;d=d.next);h.feathered_beam&&(p=k/(l.xs-h.xs),0<h.feathered_beam?(p=-p,k=p*h.xs):k=p*l.xs,p*=u);E=0;for(e=2;e<=a.nflags;e++)for(E+=k,0!=p&&(a.a+=p),d=h;;d=d.next){if(!(d.type!=n.NOTE||d.nflags<e))if(d.trem1&&e>d.nflags-d.ntrem){var r=d.dur>=n.BLEN/2?d.x:d.xs;c(r-5,r+5,(E+2.5)*u,m,a,e)}else{for(g=d;d!=l;){var t=d.next;if(t.type==n.NOTE||t.type==n.REST)if(t.trem1){if(t.nflags-t.ntrem<e)break}else if(t.nflags<e)break;if(t.beam_br1||t.beam_br2&&2<e)break;d=t}for(f=
d;f.type!=n.NOTE;)f=f.prev;r=g.xs;if(g==f)if(g==h)r+=x;else if(g==l)r-=x;else if(g.beam_br1||g.beam_br2&&2<e)r+=x;else{for(t=g.next;t.type!=n.NOTE;)t=t.next;if(t.beam_br1||t.beam_br2&&2<e)r-=x;else{for(g=g.prev;g.type!=n.NOTE;)g=g.prev;r=g.nflags<t.nflags||g.nflags==t.nflags&&g.dots<t.dots?r+x:r-x}}c(r,f.xs,E*u,m,a,e)}if(d==l)break}h.tmp?ob(h):l.tmp&&ob(l);Oa(h,"beam")}function md(a){function c(a,c,d){for(var e,f;!L.st_print[c];){if(L.staves[c].flags&d)return;c++}for(e=f=c;;){L.st_print[e]&&(f=e);
if(L.staves[e].flags&d)break;e++}c=B[c].y+B[c].topbar*B[c].staffscale;f=B[f].y+B[f].botbar*B[f].staffscale;d&514?(a+=Ub-6,d=fa-f,c=(c-f)/24,G+='<text transform="translate('+a.toFixed(1)+","+d.toFixed(1)+") scale(2.5,"+c.toFixed(2)+')">'+Ac.brace.c+"</text>\n"):(a+=Ub-5,d=fa-c-3,c=c-f+2,G+='<path d="m'+a.toFixed(1)+" "+d.toFixed(1)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+c.toFixed(1)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}var d,e,g=L.nstaff;for(d=e=0;;d++){var f=L.staves[d].flags;
f&5&&e++;if(L.st_print[d])break;f&10&&e--;if(d==g)break}for(f=g;f>d&&!L.st_print[f];f--);if(d!=f||0!=e)for(e=B[f].y+B[f].botbar*B[f].staffscale,d=B[d].y+B[d].topbar*B[d].staffscale-e,Eb(a,e),G+="v"+(-d).toFixed(1)+'"/>\n',d=0;d<=g;d++)f=L.staves[d].flags,f&1&&c(a,d,2),f&4&&c(a,d,8),f&256&&c(a-6,d,512),f&1024&&c(a-6,d,2048)}function nd(a){if(a.a_meter){var c=B[a.st];var d=c.y;"|||||"!=c.stafflines&&(d+=(c.topbar+c.botbar)/2-12);for(c=0;c<a.a_meter.length;c++){var e=a.a_meter[c];var g=a.x+a.x_meter[c];
e.bot?da('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',g,d+6,Bc(e.top),Bc(e.bot)):da('<text x="X" y="Y" text-anchor="middle">A</text>\n',g,d+12,Bc(e.top))}}}function Cc(a,c,d){if("object"==typeof d){var e=d[0],g=d[1];var f=e+"_"+g;d=od[f];d||(d=abc2svg.rat(Math.abs(e),g),g=d[1],d=(0>e?-d[0]:d[0]).toString(),1!=g&&(d+="_"+g),od[f]=d)}Z(a,c,"acc"+d)}function ib(a,c,d,e,g){var f;0<=c?(f=a.hlu[c])||(f=a.hlu[c]=[]):(f=a.hld[-c])||(f=a.hld[-c]=
[]);for(a=0;a<f.length&&!(d>=f[a][0]);a++);a==f.length?f.push([d,e,g]):d>f[a][0]?f.splice(++a,0,[d,e,g]):(e<f[a][1]&&(f[a][1]=e),g>f[a][2]&&(f[a][2]=g))}function pd(a,c,d){c-=3;10>d?Z(a-4,c,"mtr"+d):(Z(a-10,c,"mtr"+(d/10|0)),Z(a-2,c,"mtr"+d%10))}function Qe(a){var c,d,e=a;for(c=a.extra;c.next;)c=c.next;var g=c;if(d=(0<=c.stem||0>a.multi)&&28>=c.notes[0].pit||16>c.notes[0].pit){var f=127;for(c=a.extra;c;c=c.next)c.y<f&&(f=c.y,g=c);c=g.x;f=g.y-5;a.extra!=g&&(c-=4,f+=1);a=a.next;var h=a.x-1;0>a.stem&&
-2<a.nflags&&(h-=4);var l=3*(a.notes[0].pit-18)-5;var k=.4*(h-c);3<k&&(k=3);var x=k;var n=.2;var m=.8;f>l+7?(c=g.x-1,f+=.5,l+=6.5,h=a.x-5.5,k=.8*(f-l),x=.2*(f-l),n=0):l>f+4&&(l=f+4,c=g.x+2,f=g.y-4)}else{f=-127;for(c=a.extra;c;c=c.next)c.y>f&&(f=c.y,g=c);c=g.x;f=g.y+5;a.extra!=g&&(c-=4,--f);a=a.next;h=a.x-1;0<=a.stem&&-2<a.nflags&&(h-=2);l=3*(a.notes[a.nhd].pit-18)+5;k=.4*(c-h);-3>k&&(k=-3);x=k;n=.2;m=.8;f<l-7?(c=g.x-1,f-=.5,l-=6.5,h=a.x-5.5,k=.8*(f-l),x=.2*(f-l),n=0):l<f-4&&(l=f-4,c=g.x+2,f=g.y+4)}e.slur=
{x0:c,y0:f,x1:n*h+(1-n)*c-c,y1:f-n*l-(1-n)*f+k,x2:m*h+(1-m)*c-c,y2:f-m*l-(1-m)*f+x,x3:h-c,y3:f-l};f-=e.slur.y1;c=e.extra;d?f<c.ymn&&(c.ymn=f):f>c.ymx&&(c.ymx=f)}function dc(a,c){var d,e=Array(a.nhd+1);if(a.dots){for(d=0;d<=a.nhd;d++){var g=3*(a.notes[d].pit-18);0==g%6&&(g=a.dot_low?g-3:g+3);e[d]=g}for(d=0;d<a.nhd;d++)if(!(e[d+1]>e[d])){for(g=d;0<g&&!(e[g]>e[g-1]+6);)g--;if(3*(a.notes[g].pit-18)-e[g]<e[d+1]-3*(a.notes[d+1].pit-18))for(;g<=d;)e[g++]-=6;else e[d+1]=e[d]+6}}var f=a.notes[0>a.stem?a.nhd:
0];d=a.x+f.shhd*I.scale;g=B[a.st].y;W.draw_hl(a);var h=B[a.st].y+3*(f.pit-18);if(a.stemless)a.xstem&&(l=a.ts_prev,f=(0<l.stem?l.y:l.ys)-a.y,f+=B[l.st].y-g,Dc(d,h,f));else{f=a.ys-a.y;var l=a.nflags;a.ntrem&&(l-=a.ntrem);!c||0>=l?(0<a.nflags&&(f=0<=a.stem?f-1:f+1),Dc(d,h,f,a.grace)):Dc(d,h,f,a.grace,l,r.straightflags)}if(c&&a.trem1){c=a.ntrem||0;f=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==n.FULL||a.head==n.EMPTY?(d+=(a.grace?2.3:3.5)*a.stem,f=0<a.stem?f+(6+5.4*c):f-11.4):f=0<a.stem?f+(5+5.4*c):f-
10.4;f/=a.p_v.scale;for(da('<path d="mX Y\n\t',d-4.5,g+f);;){G+="l9 -3v3l-9 3z";if(0>=--c)break;G+="m0 5.4"}G+='"/>\n'}d=a.x;for(c=0;c<=a.nhd;c++){var k=void 0,x=void 0;g=d;f=a;var m=c;var Q=e;h=!1;l=f.notes[m];var u=B[f.st].y,p=3*(l.pit-18),C=g+l.shhd*I.scale,t=p+u,z=ec(f,l.dur);var q=z[0];var y=z[1];z=z[2];if(!l.invis)if(f.grace)x="ghd",C-=4.5*I.scale;else if(l.map&&l.map[0])q=f.head,(x=l.map[0][q])||(x=l.map[0][l.map[0].length-1]),q=x.indexOf("/"),0<=q&&(x=0<=f.stem?x.slice(0,q):x.slice(q+1));
else if(f.type==n.CUSTOS)x="custos";else switch(q){case n.OVAL:x="HD";break;case n.OVALBARS:if(f.head!=n.SQUARE){x="HDD";break}case n.SQUARE:-4<z?x="breve":(x="longa",k=0<f.stem);Pa||!f.next||f.next.type!=n.BAR||f.next.next||(y=0);C+=1;break;case n.EMPTY:x="Hd";break;default:x="hd"}void 0!=l.color&&(h=qa(l.color));x&&(k&&(Kb(C,t,0,1,-1),C=t=0),W.psxygl(C,t,x)||Z(C,t,x),k&&Fb());if(y)for(k=g+(7.7+f.xmx)*I.scale,void 0==Q[m]&&(Q[m]=3*(f.notes[m].pit-18),0==(f.notes[m].pit&1)&&(Q[m]+=3)),m=Q[m]+u,q=
l.dur/12>>5-z-y;0<y--;)Z(k,m,q&1<<y?"dot":"dot+"),k+=3.5;l.acc&&(g-=l.shac*I.scale,f.grace?(Kb(g,p+u,0,.75),Cc(0,0,l.acc),Fb()):Cc(g,p+u,l.acc));0!=h&&qa(h)}}function Re(a,c){var d;if(a.grace&&0<a.stem)return-1;var e=a.multi?a.multi:c.multi?c.multi:0;if(e)return e;for(;;a=a.next){if(a.type==n.NOTE){if(!a.stemless){if(0>a.stem)return 1;var g=!0}22>a.notes[0].pit&&(d=!0)}if(a.time==c.time)break}return g||d?-1:1}function qd(a,c,d,e,g,f,h){var l=.3;var k=e-c;0>k&&(k=-k);var n=d-a;40<n&&.7>k/n&&(l=.3+
.002*(n-40),.7<l&&(l=.7));var m=.5*(a+d);k=.5*(c+e);var r=a+.45*(m+l*(a-m)-a);var u=c+.45*(k+l*(c-k)+f-c);m=d+.45*(m+l*(d-m)-d);l=e+.45*(k+l*(e-k)+f-e);k=2*g;f=.2+.001*n;.6<f&&(f=.6);f*=g;n*=.03;G=h?G+'<path class="stroke" stroke-dasharray="5,5" d="M':G+'<path d="M';Ra(a," ",c);G+="c"+((r-a)/I.scale).toFixed(1)+" "+(c-u).toFixed(1)+" "+((m-a)/I.scale).toFixed(1)+" "+(c-l).toFixed(1)+" "+((d-a)/I.scale).toFixed(1)+" "+(c-e).toFixed(1);h||(G+="\n\tv"+(-f).toFixed(1)+"c"+((m-n-d)/I.scale).toFixed(1)+
" "+(e+f-l-k).toFixed(1)+" "+((r+n-d)/I.scale).toFixed(1)+" "+(e+f-u-k).toFixed(1)+" "+((a-d)/I.scale).toFixed(1)+" "+(e-c).toFixed(1));G+='"/>\n'}function rd(a,c,d){var e,g=d.ty,f=(g&7)==n.SL_ABOVE?1:-1;var h=a.length;var l=h-1;var k=a[0];var x=a[l];var m=1;var Q=k.st;var u=!1;Ma(k.st);for(e=1;e<h;e++){var p=a[e];if(p.type==n.NOTE||p.type==n.REST)m++,p.st!=Q&&(u=!0,p.st<Q&&(Q=p.st))}u&&v(2,k,"*** multi-staves slurs not treated yet");h=k.x;k.notes&&k.notes[0].shhd&&(h+=k.notes[0].shhd);u=x.x;x.notes&&
(u+=x.notes[0].shhd);c?(c=3*(c.pit-18)+2*f,h+=3):(c=0<f?k.ymx+2:k.ymn-2,k.type==n.NOTE&&(0<f?0<k.stem&&(h+=5,k.beam_end&&-1<=k.nflags&&!k.in_tuplet&&(0<k.nflags?(h+=2,c=k.ys-3):c=k.ys-6)):0>k.stem&&(--h,x.grace?c=k.y-8:k.beam_end&&-1<=k.nflags&&(!k.in_tuplet||k.ys<c+3)&&(0<k.nflags?(h+=2,c=k.ys+3):c=k.ys+6))));d.is_note?(d=3*(d.note.pit-18)+2*f,u-=3):(d=0<f?x.ymx+2:x.ymn-2,x.type==n.NOTE&&(0<f?0<x.stem&&(u+=1,x.beam_st&&-1<=x.nflags&&!x.in_tuplet&&(d=x.ys-6)):0>x.stem&&(u-=5,x.beam_st&&-1<=x.nflags&&
!x.in_tuplet&&(d=x.ys+6))));k.type!=n.NOTE&&(c=d+1.2*f,h=k.x+.5*k.wr,h>u-12&&(h=u-12));x.type!=n.NOTE&&(d=k.type==n.NOTE?c+1.2*f:c,k!=x&&(u=x.x-.3*x.wl));if(3<=m){p=a[1];if(p.type!=n.BAR&&p.x<h+48)if(0<f){var C=p.ymx-2;c<C&&(c=C)}else C=p.ymn+2,c>C&&(c=C);p=a[l-1];p.type!=n.BAR&&p.x>u-48&&(0<f?(C=p.ymx-2,d<C&&(d=C)):(C=p.ymn+2,d>C&&(d=C)))}var t=(d-c)/(u-h);if(.5<t||-.5>t)t=.5<t?.5:-.5,0<t*f?c=d-t*(u-h):d=c+t*(u-h);C=d-c;8<C?C=8:-8>C&&(C=-8);e=C;0>e&&(e=-e);var z=.5*e;e=.3*C;0<C*f?(u-=z,d-=e):(h+=
z,c+=e);k.grace&&(h=k.x-1.15);x.grace&&(u=x.x+2.3*1.5);z=0;t=(d-c)/(u-h);if(k!=x&&k.v==x.v){k=c-t*h;for(e=1;e<l;e++)if(p=a[e],p.st==Q)switch(p.type){case n.NOTE:case n.REST:0<f?(C=3*(p.notes[p.nhd].pit-18)+6,C<p.ymx&&(C=p.ymx),C-=t*p.x+k,C>z&&(z=C)):(C=3*(p.notes[0].pit-18)-6,C>p.ymn&&(C=p.ymn),C-=t*p.x+k,C<z&&(z=C));break;case n.GRACE:for(p=p.extra;p;p=p.next)0<f?(C=3*(p.notes[p.nhd].pit-18)+6,C<p.ymx&&(C=p.ymx),C-=t*p.x+k,C>z&&(z=C)):(C=3*(p.notes[0].pit-18)-6,C>p.ymn&&(C=p.ymn),C-=t*p.x+k,C<z&&
(z=C))}c+=.45*z;d+=.45*z;z*=.65}m=3<m?(.08*(u-h)+12)*f:(.03*(u-h)+8)*f;0<f?(m<3*z&&(m=3*z),40<m&&(m=40)):(m>3*z&&(m=3*z),-40>m&&(m=-40));C=d-c;0>C&&(C=-C);0<f?m<.8*C&&(m=.8*C):m>-.8*C&&(m=-.8*C);m*=r.slurheight;qd(h,c,u,d,f,m,g&n.SL_DOTTED);t=(d-c)/(u-h);k=c-t*h;k=0<m?k+(4*Math.sqrt(m)-2):k-(4*Math.sqrt(-m)-2);for(e=0;e<l;e++)p=a[e],p.st==Q&&p.type!=n.BAR&&(C=t*p.x+k,p.ymx<C?p.ymx=C:p.ymn>C&&(p.ymn=C),e==l-1?(z=u,x.sl1&&(z-=5),e&&(C-=m/3)):z=a[e+1].x,0!=e?h=p.x:C-=m/3,z-=h,ea(Q,0<f,h,z,C))}function fc(a,
c){function d(a,d,f){var g=[];var h=d.note.s;if(!(c&&h.time>c.time)){if(Pa&&h.time>=Pa.time){a.p_v.sls.push(d);for(h=a.p_v.s_next.prev;h.next;)h=h.next;d=Object.create(d);d.note={s:h}}switch(d.ty&7){case n.SL_ABOVE:var k=1;break;case n.SL_BELOW:k=-1;break;default:k=a.v!=h.v?1:Re(a,h),d.ty&=-8,d.ty|=0<k?n.SL_ABOVE:n.SL_BELOW}var l=L.voices[a.v]&&L.voices[h.v]?0<k*(L.voices[a.v].range<=L.voices[h.v].range?1:-1)?a.v:h.v:a.v>h.v?a.v:h.v;if(!e||h.grace&&a.v==h.v&&a.time==h.time)g.push(a),a=a.grace?a.next:
a.ts_next;else{do g.push(a),a=a.next;while(a);a=e.next}if(h.grace){if(!a.grace){for(k=h;k.prev;)k=k.prev;for(;;){a.v==l&&g.push(a);if(a.extra==k)break;a=a.ts_next}a=k}for(;;){g.push(a);if(a==h)break;a=a.next}}else for(;a;){a.v==l&&g.push(a);if(a==h)break;a=a.ts_next}for(h=1;h<g.length-1;h++)a=g[h],(a.sls||a.sl1)&&fc(a,c),a.tp&&Ec(a);rd(g,f,d);return 1}}for(var e,g,f,h,l,k;;){if(!a||a==c){if(!e||!(a=e.next)||a==c)break;e=null}if(a.type==n.GRACE)e=a,a=a.extra;else{if(a.sls){l=a.sls;a.sls=null;k=[];
for(g=0;g<l.length;g++)d(a,l[g])||k.push(l[g]);k.length&&(a.sls=k)}if(a.sl1)for(f=0;f<=a.nhd;f++)if(h=a.notes[f],h.sls){l=h.sls;h.sls=null;k=[];for(g=0;g<l.length;g++)d(a,l[g],h)||k.push(l[g]);k.length&&(h.sls=k)}a=a.next}}}function Ec(a){var c,d,e,g,f=a.tp.shift();a.tp.length||delete a.tp;var h=a.st;Ma(a.st);for(c=a;c;c=c.next){switch(c.type){case n.GRACE:for(e=c.extra;e;e=e.next)(e.sls||e.sl1)&&fc(e);default:continue;case n.NOTE:case n.REST:}(c.sls||c.sl1)&&fc(c);c.st<h&&(h=c.st);c.tp&&Ec(c);if(c.tpe)break}c&&
c.tpe--;if(1!=f.f[0])if(c){e=f.f[3];if(!e){for(d=a;d.type!=n.NOTE;)d=d.next;e=0<d.stem?n.SL_ABOVE:n.SL_BELOW}if(a==c||2==f.f[1])var l=!0;else if(1==f.f[1])l=!0,rd([a,c],null,{ty:e});else if(2!=f.f[0]&&a.type==n.NOTE&&c.type==n.NOTE){l=!0;for(d=a;;d=d.next){if(d.type!=n.NOTE&&d.type!=n.REST){if(d.type==n.GRACE||d.type==n.SPACE)continue;l=!1;break}if(d==c)break;if(d.beam_end){l=!1;break}}if(l&&!a.beam_st&&!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==n.NOTE||d.type==n.REST){d.nflags>=
a.nflags&&(l=!1);break}if(l&&!c.beam_end)for(d=c.next;d;d=d.next)if(d.type==n.NOTE||d.type==n.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=c.nflags&&(l=!1);break}}if(l){if(1!=f.f[2]){ba("tuplet");l=(c.x+a.x)/2;var k=e==n.SL_ABOVE?V(h,1,l-4,8):V(h,0,l-4,8)-J.curfont.size;0<a.stem*c.stem&&(l=0<a.stem?l+1.5:l-1.5);0==f.f[2]?la(l,k,f.p.toString(),"c"):la(l,k,f.p+":"+f.q,"c");for(d=a;!(d.x>=l);d=d.next);e==n.SL_ABOVE?(k+=J.curfont.size,d.ymx<k&&(d.ymx=k),ea(h,!0,l-3,6,k)):(d.ymn>k&&(d.ymn=k),ea(h,!1,l-3,
6,k))}}else{var x=a.x-4;if(c.dur>c.prev.dur){d=c.next;if(!d||d.time!=c.time+c.dur)for(d=c.ts_next;d&&!(d.seqst&&d.time>=c.time+c.dur);d=d.ts_next);var m=d?d.x-d.wl-5:pa-6}else m=c.x+4,l=0<=c.stem?0:c.nhd,0<c.notes[l].shhd&&(m+=c.notes[l].shhd),c.st==h&&0<c.stem&&(m+=3.5);if(e==n.SL_ABOVE){if(a.st==c.st)var r=g=B[h].topbar+2;else r=a.ymx,g=c.ymx;if(a.st==h){for(d=a;!d.dur;d=d.next);k=V(h,1,d.x-4,8);k>r&&(r=k);0<a.stem&&(x+=3)}if(c.st==h){for(d=c;!d.dur;d=d.prev);k=V(h,1,d.x-4,8);k>g&&(g=k)}l=.5*(x+
m);k=.5*(r+g);var u=(g-r)/(m-x);r=3*(c.notes[c.nhd].pit-a.notes[a.nhd].pit)/(m-x);0<r?0>u?u=0:u>r&&(u=r):0<u?u=0:u<r&&(u=r);u*u<.1*.1&&(u=0);g=0;for(d=a;;d=d.next){if(d.dur&&d.st==h){var p=k+(d.x-l)*u;r=V(h,1,d.x-4,8)+2;r-p>g&&(g=r-p)}if(d==c)break}k+=g;r=k+u*(x-l);g=k+u*(m-l);k+=6;for(d=a;d.st==h&&(p=k+(d.x-l)*u,d.ymx<p&&(d.ymx=p),ea(h,!0,d.x,d.next.x-d.x,p)),d!=c;d=d.next);}else{0>a.stem&&(x-=2);if(a.st==h){for(d=a;!d.dur;d=d.next);r=V(h,0,d.x-4,8)}else r=0;if(c.st==h){for(d=c;!d.dur;d=d.prev);
g=V(h,0,d.x-4,8)}else g=0;l=.5*(x+m);k=.5*(r+g);u=(g-r)/(m-x);r=3*(c.notes[0].pit-a.notes[0].pit)/(m-x);0<r?(0>u?u=0:u>r&&(u=r),.35<u&&(u=.35)):(0<u?u=0:u<r&&(u=r),-.35>u&&(u=-.35));u*u<.1*.1&&(u=0);g=0;for(d=a;d.dur&&d.st==h&&(p=k+(d.x-l)*u,r=V(h,0,d.x-4,8),r-p<g&&(g=r-p)),d!=c;d=d.next);k+=g-8;r=k+u*(x-l);g=k+u*(m-l);k-=2;for(d=a;d.st==h&&(p=k+(d.x-l)*u,d.ymn>p&&(d.ymn=p),ea(h,!1,d.x,d.next.x-d.x,p)),d!=c;d=d.next);}1==f.f[2]?(h=g-r,p=e==n.SL_ABOVE?-3:3,e=(m-x)/I.scale,G+='<path class="stroke" d="m',
Ra(x," ",r+4+p),G+="v"+p.toFixed(1)+"l"+e.toFixed(1)+" "+(-h).toFixed(1)+"v"+(-p).toFixed(1)+'"/>\n'):(a=x,c=r,x=m-x,m=g-r,r=e==n.SL_ABOVE,g=0==f.f[2]?f.p.toString():f.p+":"+f.q,f=10*g.length,d=r?-3:3,ba("tuplet"),la(a+x/2,c+m/2-.5*J.curfont.size+2,g,"c"),x/=I.scale,r||(c+=6),G+='<path class="stroke" d="m',Ra(a," ",c),r=x-f+1,f=0<m?f+m/8:f-m/8,G+="v"+d.toFixed(1)+"m"+x.toFixed(1)+" "+(-m).toFixed(1)+"v"+(-d).toFixed(1)+'"/>\n<path class="stroke" stroke-dasharray="'+(r/2).toFixed(1)+" "+f.toFixed(1)+
'" d="m',Ra(a," ",c-d),G+="l"+x.toFixed(1)+" "+(-m).toFixed(1)+'"/>\n',e==n.SL_ABOVE?ea(h,!0,l-3,6,p+2):ea(h,!1,l-3,6,p))}}else v(1,a,"No end of tuplet in this music line")}function sd(a,c){var d,e=a.tie_n;var g=2==c?a.pit:e.pit;var f=(a.tie_ty&7)==n.SL_ABOVE?1:-1,h=a.s,l=h.st,k=e.s;var x=k.x;var m=a.shhd;for(d=0;d<h.nhd&&h.notes[d]!=a;d++);0<f?d<h.nhd&&g+1==h.notes[d+1].pit&&h.notes[d+1].shhd>m&&(m=h.notes[d+1].shhd):0<d&&g==h.notes[d-1].pit+1&&h.notes[d-1].shhd>m&&(m=h.notes[d-1].shhd);var t=h.x+
m;if(2!=c){for(d=0;d<k.nhd&&k.notes[d]!=e;d++);m=k.notes[d].shhd;0<f?d<k.nhd&&g+1==k.notes[d+1].pit&&k.notes[d+1].shhd<m&&(m=k.notes[d+1].shhd):0<d&&g==k.notes[d-1].pit+1&&k.notes[d-1].shhd<m&&(m=k.notes[d-1].shhd);x+=m}switch(c){case 0:g=a.pit&1?a.pit:e.pit;break;case 3:f=-f;case 1:t=h.x;t>x-20&&(t=x-20);g=e.pit;l=k.st;break;default:if(h!=k)x-=k.wl,k.type==n.BAR&&(x+=5);else{c=h.time+h.dur;for(x=h.ts_next;x&&!(x.time>c);x=x.ts_next);x=x?x.x:pa}x<t+16&&(x=t+16)}20<x-t?(t+=3.5,x-=3.5):(t+=1.5,x-=1.5);
!h.dots||a.pit&1||!(0<f&&!h.dot_low||0>f&&h.dot_low)||(t+=5);g=B[l].y+3*(g-18)+f;qd(t,g,x,g,f,(.03*(x-t)+16)*f*r.tieheight,a.tie_ty&n.SL_DOTTED)}function gc(a,c,d){var e;var g=[];var f=a.nhd;if(2==d)for(e=0;e<=f;e++){var h=a.notes[e];h.tie_ty&&(g=h.tie_n,h.tie_n={s:c||a},sd(h,d),h.tie_n=g)}else{for(e=0;e<=f;e++)h=a.notes[e],h.tie_ty&&(h.s||(h.s=a),h.tie_n?sd(h,d):g.push(h));g.length&&v(1,a,"Bad tie")}}function Se(a){function c(a,c,d){if(a.type==n.GRACE)for(a=a.extra;a;a=a.next)a.tie_s&&gc(a,c,d);
else gc(a,c,d)}var d=a.sym;for(qa(d.color);;){for(a=d;a;a=a.next){if(a.ti2&&(a!=d||!d.prev)){var e=a.ti2;e.x=a.x;var g=e.next;e.next=a;e.st=a.st;var f=e.time;e.time=a.time-e.dur;gc(e,a,1);e.next=g;e.time=f}if(a.tie_s)break}if(!a)break;g=a.tie_s;e=a;if(g.v==a.v)for(d=g;;){if(!e.next){g=e;e=null;break}e=e.next;if(e==g)break}else{for(d=a.next;;){if(!e.ts_next){e=null;break}e=e.ts_next;if(e==g)break}if(!e)for(g=a;g.next;)g=g.next}if(!e){c(a,g,2);a.tie_s.ti2=a;break}f=a.time+e.dur;for(e=a.ts_next;e!=g;e=
e.ts_next)if(e.st==a.st){if(e.time>f)break;if(e.type==n.CLEF){var h=!0;break}}h||a.st!=g.st?(h=!1,f=.4*(g.x-a.x),e=g.x,g.x-=f,g.x>a.x+32&&(g.x=a.x+32),c(a,g,2),g.x=e,e=a.x,a.x+=f,a.x<g.x-24&&(a.x=g.x-24),gc(a,g,3),a.x=e):c(a,g,g.type==n.NOTE?0:2)}}function Te(){function a(a,c){var d=pa/256,e=a.x/d|0,f=c.x/d|0,g=(a.ys-c.ys)/(a.xs-c.xs);c=a.ys-a.xs*g;var h=B[a.st];d*=g;if(0<a.stem)for(;e<=f;)a=d*e+c,h.top[e]<a&&(h.top[e]=a),e++;else for(;e<=f;)a=d*e+c,h.bot[e]>a&&(h.bot[e]=a),e++}var c,d,e,g=G;G="";
for(c=0;c<=S;c++){var f=B[c];f.top||(f.top=new Float32Array(256),f.bot=new Float32Array(256));for(d=0;256>d;d++)f.top[d]=0,f.bot[d]=24}for(d=0;d<F.length;d++){var h={},l=!0;c=F[d];for(f=c.sym;f;f=f.next)switch(f.type){case n.GRACE:var k=0;for(e=f.extra;e;e=e.next)e.beam_st&&!e.beam_end&&(W.calculate_beam(h,e),h.s2&&a(e,h.s2)),(e.sls||e.sl1)&&k++;f.p_v.ckey.k_bagpipe||!r.graceslurs||k||f.tie_s||!f.next||f.next.type!=n.NOTE||Qe(f)}for(f=c.sym;f;f=f.next)switch(f.type){case n.NOTE:if(f.beam_st&&!f.beam_end||
l&&!f.beam_st)l=!1,W.calculate_beam(h,f),h.s2&&a(f,h.s2)}}Ue();Ie();for(f=P;f;f=f.ts_next)if(!f.invis){switch(f.type){case n.GRACE:for(e=f.extra;e;e=e.next)ea(f.st,!0,e.x-2,4,e.ymx+1),ea(f.st,!1,e.x-2,4,e.ymn-5);continue;case n.MREST:ea(f.st,!0,f.x+16,32,f.ymx+2);continue;default:ea(f.st,!0,f.x-f.wl,f.wl+f.wr,f.ymx+2);ea(f.st,!1,f.x-f.wl,f.wl+f.wr,f.ymn-2);continue;case n.NOTE:}0<f.stem?(f.stemless?(c=-5,d=10):f.beam_st?(c=3,d=f.beam_end?4:10):(c=-8,d=f.beam_end?11:16),ea(f.st,!0,f.x+c,d,f.ymx),d=
f.ymn,f.notes[0].acc&&d>3*(f.notes[0].pit-18)-9&&(d=3*(f.notes[0].pit-18)-9),ea(f.st,!1,f.x-f.wl,f.wl+f.wr,d)):(ea(f.st,!0,f.x-f.wl,f.wl+f.wr,f.ymx),f.stemless?(c=-5,d=10):f.beam_st?(c=-6,d=f.beam_end?4:10):(c=-8,d=f.beam_end?5:16),c+=f.notes[0].shhd,ea(f.st,!1,f.x+c,d,f.ymn));f.notes[f.nhd].acc&&(d=f.y+8,f.ymx<d&&(f.ymx=d),ea(f.st,!0,f.x,0,d));f.notes[0].acc&&(d=f.y,d=1==f.notes[0].acc||3==f.notes[0].acc?d-7:d-5,f.ymn>d&&(f.ymn=d),ea(f.st,!1,f.x,0,d))}Ke();for(d=0;d<F.length;d++)if(c=F[d],f=c.sym)for(qa(f.color),
c=c.st;f;f=f.next)f.play||(f.tp&&Ec(f),(f.sls||f.sl1)&&fc(f));qa();for(c=0;c<=S;c++)for(f=B[c],e=f.topbar+2,k=f.botbar-2,d=0;256>d;d++)e>f.top[d]&&(f.top[d]=e),k<f.bot[d]&&(f.bot[d]=k);0<=r.measurenb&&Oe();Me();Ma(-1);for(d=0;d<F.length;d++)if(c=F[d],c.have_ly){Ve();break}Ma(-1);G=g}function We(a,c){var d,e,g=[];for(d=c.length;0<=d&&!c[d];d--);if(!(0>d)){for(e=0;e<F.length;e++){var f=F[e];if(f.sym&&L.voices[e]&&(d=L.voices[e].st,c[d])){if(f.new_name){var h=2;break}f.snm&&(h=1)}}if(h){for(e=0;e<F.length;e++)f=
F[e],f.sym&&L.voices[e]&&(d=L.voices[e].st,c[d]&&(f.new_name&&delete f.new_name,(f=2==h?f.nm:f.snm)&&(g[d]=g[d]?g[d]+("\n"+f):f)));if(g.length){ba("voice");var l=J.curfont.size;var k=l/2;a=.5*-a;for(d=0;d<g.length;d++)if(g[d])for(e=g[d].split("\n"),h=B[d].y+.5*B[d].topbar*B[d].staffscale+k*(e.length-2),L.staves[d].flags&1&&L.staves[d+1].flags&2&&!g[d+1]&&(h-=.5*(B[d].y-B[d+1].y)),c=0;c<e.length;c++)f=e[c],la(a,h,f,"c"),h-=l}}}}function Xe(){var a,c,d,e;var g=L;for(c=0;c<F.length;c++){var f=F[c];1!=
f.scale&&(f.scale_str='transform="scale('+f.scale.toFixed(2)+')"')}for(c=0;c<=S&&!J.st_print[c];c++);var h=0;c>S&&c--;f=B[c];for(a=0;256>a;a++){var l=f.top[a];h<l&&(h=l)}a=h;l=c;var k=0,x=0,m=B[l].topbar+8,t=0,u=1,p=-100;for(e=P;e;e=e.ts_next)if(e.type==n.TEMPO&&!e.invis){d||(d=e);var C=e.tempo_wh[0];0==e.time&&40<e.x&&(e.x=40);var y=V(l,!0,e.x-16,C);y>m&&(m=y);p>=e.x-16&&!(t&u>>1)&&(t|=u);u<<=1;p=e.x-16+C}if(d){ra(-1);ba("tempo");x=J.curfont.size+8;y=2-x;var z=y-x;0!=t&&(x*=2);h<m+x&&(k=m+x-h);for(e=
d;e;e=e.ts_next)if(e.type==n.TEMPO&&!e.invis){if(q.anno_start||q.anno_stop)e.wl=16,e.wr=30,e.ymn=t&1?z:y,e.ymx=e.ymn+14,za(e);td(e,e.x-16,t&1?z:y);Oa(e);for(t>>=1;e.ts_next&&e.ts_next.type==n.TEMPO;)e=e.ts_next}}m=B[l].topbar+6;for(e=P;e;e=e.ts_next)if(e.type==n.PART&&!e.invis){if(!A){var A=e;ba("parts");z=J.curfont.size+2+2*J.curfont.pad}C=va(e.text)[0];y=V(l,!0,e.x-10,C+3);m<y&&(m=y)}if(A)for(ra(-1),h+k<m+z+x&&(k=m+z+x-h),e=A;e;e=e.ts_next)if(e.type==n.PART&&!e.invis){e.x-=10;if(q.anno_start||q.anno_stop)C=
va(e.text)[0],e.wl=0,e.wr=C,e.ymn=-x-z,e.ymx=e.ymn+z,za(e);la(e.x,2-x-z,e.text);for(Oa(e);e.ts_next&&e.ts_next.type==n.PART;)e=e.ts_next}h=a+k;if(!J.st_print[c])return f.y=-h,h;h*=f.staffscale;d=.5*r.staffsep+f.topbar*f.staffscale;h<d&&(h=d);h<f.ann_top&&(h=f.ann_top);f.y=-h;A=c;z=g.staves[A];for(c++;c<=S;c++)if(J.st_print[c]){f=B[c];d=z.sep||r.sysstaffsep;e=z.maxsep||r.maxsysstaffsep;z=0;if(f.staffscale==B[A].staffscale){for(a=0;256>a;a++)l=f.top[a]-B[A].bot[a],z<l&&(z=l);z*=f.staffscale}else for(a=
0;256>a;a++)l=f.top[a]*f.staffscale-B[A].bot[a]*B[A].staffscale,z<l&&(z=l);d+=f.topbar*f.staffscale;z<d&&(z=d);e+=f.topbar*f.staffscale;z>e&&(z=e);h+=z;f.y=-h;for(A=c;!(z=g.staves[A]);)g=g.next}for(a=g=0;256>a;a++)l=B[A].bot[a],g>l&&(g=l);g>f.ann_bot&&(g=f.ann_bot);g*=B[A].staffscale;for(c=0;c<=S;c++)f=B[c],z=f.y,1!=f.staffscale&&(f.scale_str='transform="translate(0,'+(fa-z).toFixed(1)+") scale("+f.staffscale.toFixed(2)+')"');if(0==g){for(c=S;0<=c&&!J.st_print[c];c--);if(0>c)return h}z=-g;d=.5*r.staffsep;
z<d&&(z=d);e=.5*r.maxstaffsep;z>e&&(z=e);return h+z}function Ye(a){function c(){var a,c=0;for(a=0;a<=L.nstaff;a++)if(0>l[a])x[a]=m[a]=0;else{var d=B[a].staffscale;var e=B[a].topbar*d;d*=B[a].botbar;0==c&&(c=B[a].y+e);x[a]=B[a].y+d;m[a]=c-x[a];c=L.staves[a].flags&64?0:x[a]}}function d(a,c,d){var e,f,g=0,h="",k=B[a].stafflines,l=k.length;if(/[\[|]/.test(k)){d-=c;ra(a);var n=d/I.scale;if(Vb&&Vb.st_l==k&&Vb.st_ws==(n|0))Z(c,B[a].y,"stdef"+r.fullsvg);else{for(e=0;e<l;e++,g-=6)if("."!=k[e]){for(f=0;e<l;e++,
g-=6,f-=6){switch(k[e]){case ".":case "-":continue;case x:h+="m-"+n.toFixed(1)+" "+f+"h"+n.toFixed(1);f=0;continue}void 0!=x&&(h+='"/>\n');var x=k[e];h+='<path class="'+("["==x?"slthW":"slW")+'" d="m0 '+g+"h"+n.toFixed(1);f=0}h+='"/>'}g=B[a].y;!Vb&&d>Wb()-10?(Vb={st_l:k,st_ws:n|0},e="stdef"+r.fullsvg,0>h.indexOf("<path",1)?bb[e]=h.replace("path",'path id="'+e+'"'):bb[e]='<g id="'+e+'">\n'+h+"\n</g>",Z(c,g,e)):da('<g transform="translate(X, Y)">\n'+h+"\n</g>\n",c,g)}}}var e,g,f,h,l=[],k=[],x=[],m=
[],t=[],u="",p="";for(f=0;f<=S;f++)l[f]=L.st_print[f]?0:-1,k[f]=L.st_print[f];c();md(0);for(e=P;e;e=e.ts_next){if(h&&e.time!=h){for(f=h=0;f<=S;f++)L.st_print[f]||(l[f]=-1);c()}switch(e.type){case n.STAVES:var C=e.ts_prev.type==n.BAR?e.ts_prev.x:0;if(!C){for(g=e.ts_next;g&&g.time==e.time;g=g.ts_next){switch(g.type){case n.BAR:case n.CLEF:case n.KEY:case n.METER:C=g.x;continue}break}g||(C=pa)}var q=e.sy;for(f=0;f<=S;f++){var z=l[f];0>z?q.st_print[f]&&(l[f]=C?C:e.x-e.wl-2,k[f]=!0):q.st_print[f]&&q.staves[f].stafflines==
L.staves[f].stafflines||(C?(g=C,h=e.time):(g=e.x-e.wl-2,l[f]=-1),d(f,z,g),q.st_print[f]&&(l[f]=g))}L=q;c();continue;case n.BAR:if(e.second||e.invis||!e.bar_type)break;t.push([e,x[e.st],m[e.st]]);break;case n.STBRK:if(L.voices[e.v]&&0==L.voices[e.v].range&&14<e.xmx){for(z=f=0;z<F.length;z++)L.voices[z]&&0<L.voices[z].range&&f++;for(g=e.ts_next;g&&g.type==n.STBRK;g=g.ts_next)f--;0==f&&md(e.x)}f=e.st;z=l[f];0<=z&&(g=e.prev)&&(g=g.type==n.BAR?g.x:e.x-e.xmx,z>=g||(d(f,z,g),l[f]=e.x))}}for(f=0;f<=S;f++)if(!h||
L.st_print[f])z=l[f],0>z||z>=pa||d(f,z,pa);(function(){var a,c,d=t.length;ba("annotation");if(c=J.curfont.box)J.curfont.box=0;for(a=0;a<d;a++){var e=t[a];var f,g,h=e[0],k=e[1],l=e[2],x=h.bar_type,m=h.st,r=B[m],E=h.x;0!=m&&h.ts_prev&&h.ts_prev.type!=n.BAR&&(l=r.topbar*r.staffscale);h.ymx=h.ymn+l;ra(-1);za(h);h.color&&qa(h.color);e=r.y+12;"|||||"!=r.stafflines&&(e+=(r.topbar+r.botbar)/2-12);if(h.bar_mrep){ra(m);if(1==h.bar_mrep){for(f=h.prev;f.type!=n.REST;f=f.prev);Z(f.x,e,"mrep")}else Z(E,e,"mrep2"),
h.v==L.top_voice&&pd(E,e+r.topbar,h.bar_mrep);ra(-1)}"||:"==x&&(x="[|:");for(g=x.length;0<=--g;){switch(x[g]){case "|":h.bar_dotted?(f=(5*r.staffscale).toFixed(1),da('<path class="bW" stroke-dasharray="A,A" d="MX Yv-G"/>\n',E,k,f,l)):h.color?da('<path class="bW" d="MX Yv-F"/>\n',E,k,l):u+="M"+pb(E).toFixed(1)+" "+W.sy(k).toFixed(1)+"v-"+l.toFixed(1);break;default:E-=3;h.color?da('<path class="bthW" d="MX Yv-F"/>\n',E+1.5,k,l):p+="M"+pb(E+1.5).toFixed(1)+" "+W.sy(k).toFixed(1)+"v-"+l.toFixed(1);break;
case ":":E-=2,ra(m),Z(E+1,e-12,"rdots"),ra(-1)}E-=3}qa();Oa(h)}c&&(J.curfont.box=c);ra(-1);u&&(G+='<path class="bW" d="'+u+'"/>\n');p&&(G+='<path class="bthW" d="'+p+'"/>\n')})();We(a,k)}function Ze(){var a,c=F.length;for(a=0;a<c;a++){var d=F[a];d.sym&&void 0!=d.sym.x&&(W.draw_symbols(d),Se(d),qa())}W.draw_all_deco();(function(){function a(a,c){var e,f,g,h=a.length;if(h)for(f=0;f<h;f++)if((e=a[f])&&e.length){var l=pb(e[0][0]);G+='<path class="stroke" stroke-width="1" d="M'+l.toFixed(1)+" "+Gb(d.y+
c*f).toFixed(1);for(g=0;;){var n=e.shift();if(!n)break;var m=pb(n[0]);G+="m"+(m-l+n[1]-g).toFixed(1)+" 0h"+(-n[1]+n[2]).toFixed(1);l=m;g=n[2]}G+='"/>\n'}}var c;for(c=0;c<=S;c++){var d=B[c];d.hlu&&(ra(c),a(d.hlu,6),a(d.hld,-6))}})();jb();$e();ra(-1)}function Ue(){var a,c,d,e;for(c=0;c<F.length;c++){var g=F[c];if(g=g.sym)if(g=g.next){for(e=g;e;e=e.next)if(e.tie_s)if(0!=e.multi){var f=0<e.multi?n.SL_ABOVE:n.SL_BELOW;for(d=0;d<=e.nhd;d++){var h=e.notes[d].tie_ty;(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&
n.SL_DOTTED|f)}}else{f=a=0;h=128;for(d=0;d<=e.nhd;d++)e.notes[d].tie_ty&&(a++,128>h&&e.notes[d].pit<=h+1&&f++,h=e.notes[d].pit);if(1>=a)for(f=0>e.stem?n.SL_ABOVE:n.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty){(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|f);break}}else if(0==f)if(a&1)for(a=(a-1)/2,f=n.SL_BELOW,d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty)0==a&&22<=e.notes[d].pit&&(f=n.SL_ABOVE),(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|f),0==a--&&(f=n.SL_ABOVE)}else for(a/=2,f=n.SL_BELOW,
d=0;d<=e.nhd;d++){if(h=e.notes[d].tie_ty)(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|f),0==--a&&(f=n.SL_ABOVE)}else{h=128;for(d=0;d<=e.nhd;d++)if(e.notes[d].tie_ty){if(128>h&&e.notes[d].pit<=h+1){a=d;break}h=e.notes[d].pit}f=n.SL_BELOW;for(d=0;d<=e.nhd;d++)if(h=e.notes[d].tie_ty)a==d&&(f=n.SL_ABOVE),(h&7)==n.SL_AUTO&&(e.notes[d].tie_ty=h&n.SL_DOTTED|f)}}for(;g;g=g.next)if(g.tie_s&&(20>g.notes[0].pit&&g.notes[0].tie_ty&&(g.notes[0].tie_ty&7)==n.SL_BELOW||24<g.notes[g.nhd].pit&&g.notes[g.nhd].tie_ty&&
(g.notes[g.nhd].tie_ty&7)==n.SL_ABOVE)){for(a=g.next;a&&a.type!=n.NOTE;)a=a.next;if(a){if(a.st!=g.st)continue;d=a.x-g.x-10}else d=pa-g.x-10;h=100>d?9:300>d?12:16;24<g.notes[g.nhd].pit&&(e=3*(g.notes[g.nhd].pit-18)+h,g.ymx<e&&(g.ymx=e),a&&a.ymx<e&&(a.ymx=e),ea(g.st,!0,g.x+5,d,e));20>g.notes[0].pit&&(e=3*(g.notes[0].pit-18)-h,g.ymn>e&&(g.ymn=e),a&&a.ymn>e&&(a.ymn=e),ea(g.st,!1,g.x+5,d,e))}}}}function cb(a){return!a||!/^(0|n|f)/i.test(a)}function ud(a){var c=vd[a.name];c||(c=1.1);a.swfac=a.size*c}function nb(a,
c){var d;if("-"==a[a.length-2]){a=a[a.length-1];if("1">a||"9"<a)return;a="u"+a+"font"}var e=(e=r[a])?{name:e.name,size:e.size,box:e.box,pad:e.pad||0}:{pad:0};r[a]=e;if(d=c.match(/\s+(no)?box(\s|$)/))d[1]?(e.box=!1,e.pad=0):(e.box=!0,e.pad=.4*e.size-3),c=c.replace(d[0],d[2]);if(d=c.match(/\s+padding=([\d.]+)(\s|$)/))e.pad=d[1]?Number(d[1]):0,c=c.replace(d[0],d[2]);if(d=c.match(/\s+class=(.*?)(\s|$)/))e.class=d[1],c=c.replace(d[0],d[2]);if(d=c.match(/\s+wadj=(.*?)(\s|$)/)){if("undefined"==typeof document)switch(d[1]){case "none":e.wadj=
"";break;case "space":e.wadj="spacing";break;case "glyph":e.wadj="spacingAndGlyphs";break;default:y(1,H.bad_val,"%%"+a)}c=c.replace(d[0],d[2])}if(d=c.match(/\s+([0-9.]+|\*)$/))"*"!=d[1]&&(e.size=Number(d[1])),c=c.replace(d[0],"");if(d=c.match(/[- ]?[nN]ormal/))e.normal=!0,c=c.replace(d[0],"");if(d=c.match(/[- ]?[bB]old/))e.weight="bold",c=c.replace(d[0],"");if(d=c.match(/[- ]?[iI]talic/))e.style="italic",c=c.replace(d[0],"");if(d=c.match(/[- ]?[oO]blique/))e.style="oblique",c=c.replace(d[0],"");e.size?
ud(e):e.swfac=0;switch(c){case "":case "*":return;case "Times-Roman":case "Times":c="serif";break;case "Helvetica":c="sans-serif";break;case "Courier":c="monospace";break;default:0<c.indexOf("Fig")&&(e.figb=!0)}"("==c[3]&&(e.src=c,e.fid=Ya.length,Ya.push(e),c="ft"+e.fid);e.name=c}function Aa(a){a=a.toLowerCase().match(/([\d.]+)(.*)/);if(!a)return NaN;a[1]=Number(a[1]);switch(a[2]){case "cm":return 37.8*a[1];case "in":return 96*a[1];case "pt":return.75*a[1];case "px":case "":return a[1]}return NaN}
function wd(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");Lb("pos",a+" "+c)}function Lb(a,c){a=[a+"=",c];m?hc(a):Fc("*",a)}function Ha(){ha.chg&&(ha.chg=!1,ha.lm=r.leftmargin-r.printmargin,0>ha.lm&&(ha.lm=0),ha.rm=r.rightmargin-r.printmargin,0>ha.rm&&(ha.rm=0),ha.width=r.pagewidth-2*r.printmargin,100>ha.width-ha.lm-ha.rm&&(v(0,void 0,"Bad staff width"),ha.width=ha.lm+ha.rm+150),Ub=ha.lm/r.scale)}function xd(a){var c=a.name,d="";a.weight&&(d+=a.weight+" ");a.style&&(d+=a.style+" ");0>c.indexOf('"')&&0<c.indexOf(" ")&&
(c='"'+c+'"');return d+a.size.toFixed(1)+"px "+c}function Gc(a){return"font:"+xd(a)}function qb(a){var c="f"+a.fid+r.fullsvg;a.class&&(c+=" "+a.class);a.box&&(c+=" box");return c}function kb(a){a.used||(a.used=!0,void 0==a.fid&&(a.fid=Ya.length,Ya.push(a),a.swfac||ud(a),a.pad||(a.pad=0)),yd(".f"+a.fid+(r.fullsvg||"")+"{"+Gc(a)+"}"),a.src&&yd("@font-face{\n font-family:"+a.name+";\n src:"+a.src+"}"))}function Ja(a){a+="font";var c=r[a];if(!c)return y(1,"Unknown font $1","$"+a[1]),J.curfont;if(!c.name||
!c.size){a=Object.create(J.curfont);c.name&&(a.name=c.name);c.normal?(a.weight&&(a.weight=null),a.style&&(a.style=null)):(c.weight&&(a.weight=c.weight),c.style&&(a.style=c.style));c.size&&(a.size=c.size);var d=xd(a);c.class&&(a.class=c.class,d+=" "+c.class);c=zd[d];if(void 0!=c)return Ya[c];zd[d]=Ya.length;a.fid=a.used=void 0;c=a}kb(c);return c}function Ad(a,c){var d,e,g="";for(d=0;;){var f=a.indexOf("\\",d);if(0>f)break;g+=a.slice(d,f);d=a[++f];if(!d)return g+"\\";switch(d){case "0":case "2":if("0"!=
a[f+1])break;if(e=af[a[f+2]]){g+=e;d=f+3;continue}break;case "u":d=Number("0x"+a.slice(f+1,f+5));if(isNaN(d)||32>d){g+=a[++f]+"\u0306";d=f+1;continue}d=String.fromCharCode(d);if("\\"==d){f+=4;break}g+=d;d=f+5;continue;case "t":g+=" ";d=f+1;continue;case "n":g+="\n";d=f+1;continue;default:if(e=bf[a.slice(f,f+2)]){g+=e;d=f+2;continue}e=a[f+1];if(/[A-Za-z]/.test(e))switch(d){case "`":g+=e+"\u0300";d=f+2;continue;case "'":g+=e+"\u0301";d=f+2;continue;case "^":g+=e+"\u0302";d=f+2;continue;case "~":g+=
e+"\u0303";d=f+2;continue;case "=":g+=e+"\u0304";d=f+2;continue;case "_":g+=e+"\u0305";d=f+2;continue;case ".":g+=e+"\u0307";d=f+2;continue;case '"':g+=e+"\u0308";d=f+2;continue;case "o":g+=e+"\u030a";d=f+2;continue;case "H":g+=e+"\u030b";d=f+2;continue;case "v":g+=e+"\u030c";d=f+2;continue;case "c":g+=e+"\u0327";d=f+2;continue;case ";":g+=e+"\u0328";d=f+2;continue}}"w"==c&&(g+="\\");g+=d;d=f+1}return g+a.slice(d)}function cf(a){var c;if(q.read_file)if(2<rb)y(1,"Too many include levels");else if(c=
q.read_file(a)){rb++;var d=A(t);Hc(a,c);d.state=t.state;t=d;rb--}else y(1,"Cannot read file '$1'",a);else y(1,"No read_file support")}function Hc(a,c,d,e){function g(){var a=c.indexOf("K:",d);if(0>a)return!1;a=c.indexOf("\n",a);if(t.select.test(c.slice(t.bol,a)))return!0;var f=/\n\w*\n/;f.lastIndex=a;Q=f.exec(c)?f.lastIndex:e;return!1}function f(a,c){if(!a)return a;var d=a.indexOf("%");if(0==d)return"";0<d&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));a=a.replace(/\s+$/,"");return c&&0<=a.indexOf("\\")?
Ad(a,c):a}function h(){var a;t.tp&&(y(1,"No end of tuplet"),(a=t.tps)&&delete a.tp,delete t.tp);sa&&(y(1,"No end of voice overlay"),Pb(sa.bar?"|":")"));if(F.length){Bd();var c,d,e,f,g,h=F.length,k=[],l=[],x=L;for(c=0;c<h;c++)k.push(F[c].sym);var m=h;var p=-1;for(c=0;c<h;c++)x.voices[c]&&(a=x.voices[c].range,a<m&&(m=a),l[a]=c,p++);c=l[m];if(P=e=k[c])for(k[c]=P.next,e.seqst=!0,g=!Na[e.type]||P.type==P.next;;){if(u&&g){x=u;var u=null;p=-1;l=[];for(c=0;c<h;c++)x.voices[c]&&(a=x.voices[c].range,l[a]=c,
p++)}var E=d=1E7;for(a=0;a<h;a++){c=l[a];if(void 0==c)break;!(p=k[c])||p.time>d||(c=Na[p.type],p.time<d?(d=p.time,E=c):c<E&&(E=c))}if(127<E)break;for(a=0;a<h;a++){c=l[a];if(void 0==c)break;if((p=k[c])&&p.time==d&&Na[p.type]==E){if(p.type==n.STAVES){u=p.sy;for(m=0;m<h&&void 0!=l[m];m++);for(f=0;f<h;f++)u.voices[f]&&!x.voices[f]&&(l[m++]=f)}g&&(g=0,p.seqst=!0);p.ts_prev=e;e=e.ts_next=p;k[c]=p.next}}g=E}if(P){W.set_bar_num();for(a=F.length;0<=--a;)if(e=F[a],void 0!=e.vtransp)for(e.key.k_transp?(u=e.key,
Cd(u)):u=null,g=e.sym;g;){if(!u)for(;g&&(g.type!=n.KEY||!g.k_transp);g=g.next);for(;g;g=g.next){switch(g.type){case n.GRACE:for(h=g.extra;h;h=h.next)for(e=0;e<=h.nhd;e++)Dd(h,u,h.notes[e]);continue;case n.NOTE:for(e=0;e<=g.nhd;e++)Dd(g,u,g.notes[e]);continue;case n.KEY:u&&(g.k_sf=u.k_sf);Cd(g);if(!g.k_transp)break;u=g;default:continue}break}u=null}M.P&&(P.parts=M.P);q.get_abcmodel&&q.get_abcmodel(P,F,abc2svg.sym_name,M);q.img_out&&W.output_music();P&&Ic.push([P,F,M,r])}}Ha();M.W&&df(M.W);a=r.infoname.split("\n");
e=a.length;for(u=0;u<e;u++)if(g=a[u][0],!(0>r.writefields.indexOf(g))&&(g=M[g])){if(!C){var C=!0;ba("history");ma(r.textspace);var z=J.curfont.size*r.lineskipfac}k=a[u].slice(2);'"'==k[0]&&(k=k.slice(1,-1));ma(z);h=va(k);la(0,0,k,null,null,h);k=h[0];g=g.split("\n");la(k,0,g[0]);for(h=1;h<g.length;h++)ma(z),la(k,0,g[h]);ma(.3*z);kb(J.curfont)}t.state=0;db();r=ta.cfmt;M=ta.info;Ia=ta.char_tb;na=ta.glovar;Sa=ta.maps;eb=ta.mac;ic=ta.maci;t.tune_v_opts=null;t.scores=null;Ed();ha.chg=!0;Ha()}function l(a,
d){if("end"!=a){d?(t.tune_v_opts||(t.tune_v_opts={}),d=t.tune_v_opts):(t.voice_opts||(t.voice_opts={}),d=t.voice_opts);for(d[a]=[];;){var e=++Q;if("%"!=c[e])break;Q=c.indexOf("\n",Q);if(c[e+1]==p){e+=2;v=0>Q?c.slice(e):c.slice(e,Q);x=v.match(/\S+/);switch(x[0]){default:d[a].push(f(v,!0));continue;case "score":case "staves":case "tune":case "voice":e-=2}break}}Q=t.eol=e-1}}function k(){var a,e=c.indexOf("K:",d);e=c.indexOf("\n",e);var f=c.slice(t.bol,e);for(e in t.tune_opts)if(t.tune_opts.hasOwnProperty(e)&&
(new RegExp(e)).test(f)){var g=t.tune_opts[e];for(a=0;a<g.t_opts.length;a++){var h=g.t_opts[a];switch(h.match(/\S+/)[0]){case "score":case "staves":t.scores||(t.scores=[]);t.scores.push(h);break;default:W.do_pscom(h)}}if(g=g.v_opts)for(a in g)g.hasOwnProperty(a)&&(t.tune_v_opts||(t.tune_v_opts={}),t.tune_v_opts[a]=t.tune_v_opts[a]?t.tune_v_opts[a].concat(g[a]):g[a])}}var x,m="\n";abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&ef();t.file=c;t.fname=a;void 0==d&&(d=
0);e||(e=c.length);for("%abc-"==c.slice(d,d+5)&&(r["abc-version"]=/[1-9.]+/.exec(c.slice(d+5,d+10)));d<e;d=t.eol+1){var Q=c.indexOf("\n",d);if(0>Q||Q>e)Q=e;for(t.eol=Q;;){Q--;switch(c[Q]){case " ":case "\t":continue}break}Q++;if(Q==d)1==t.state?(t.istart=d,y(1,"Empty line in tune header - ignored")):2<=t.state&&(h(),t.select&&(Q=c.indexOf("\nX:",t.eol),0>Q&&(Q=e),t.eol=Q));else{t.istart=t.bol=d;t.iend=Q;t.line.index=0;var u=c[d];var p=c[d+1];if("%"==u){if(0>t.prefix.indexOf(p))continue;if("a"==c[d+
2]&&"b"==c[d+3]&&"c"==c[d+4]&&" "==c[d+5])d+=6,u=c[d],p=c[d+1];else var C=!0}else"I"==u&&":"==p&&(C=!0);if(C){C=!1;d+=2;var v=c.slice(d,Q);if((x=v.match(/([^\s]+)\s*(.*)/))&&"%"!=x[1][0]){switch(x[1]){case "abcm2ps":case "ss-pref":t.prefix=x[2];continue;case "abc-include":cf(f(x[2]));continue}if("begin"==x[1].slice(0,5)){var z=x[1].substr(5);var B="\n"+u+p+"end"+z;a=c.indexOf(B,Q);0>a?(y(1,"No $1 after %%$2",B.slice(1),x[1]),t.eol=e):(W.do_begin_end(z,f(x[2]),c.slice(Q+1,a).replace(new RegExp("^"+
u+p,"gm"),"")),t.eol=c.indexOf("\n",a+6),0>t.eol&&(t.eol=e))}else{switch(x[1]){case "select":if(0!=t.state){y(1,H.not_in_tune,"%%select");continue}a=f(v.slice(7));'"'==a[0]&&(a=a.slice(1,-1));if(!a){delete t.select;continue}a=a.replace(/\(/g,"\\(");a=a.replace(/\)/g,"\\)");t.select=new RegExp(a,"m");continue;case "tune":if(0!=t.state){y(1,H.not_in_tune,"%%tune");continue}a=f(x[2]);if(!a){t.tune_opts={};continue}if("end"==a)continue;t.tune_opts||(t.tune_opts={});for(t.tune_opts[a]=a={t_opts:[]};;){d=
++Q;if("%"!=c[d])break;Q=c.indexOf("\n",Q);if(c[d+1]==p){d+=2;v=0>Q?c.slice(d):c.slice(d,Q);x=v.match(/([^\s]+)\s*(.*)/);switch(x[1]){case "tune":break;case "voice":l(f(x[2],!0),!0);continue;default:a.t_opts.push(f(v,!0));continue}break}}t.tune_v_opts&&(a.v_opts=t.tune_v_opts,t.tune_v_opts=null);t.eol=d-1;continue;case "voice":if(0!=t.state){y(1,H.not_in_tune,"%%voice");continue}a=f(x[2]);if(!a){t.voice_opts=null;continue}l(a);continue}W.do_pscom(f(v,!0))}}}else if(":"==p&&/[A-Za-z+]/.test(u)){for(d+=
2;;){switch(c[d]){case " ":case "\t":d++;continue}break}if("+"==u){if(!D){y(1,"+: without previous info field");continue}m=" ";u=D}v=f(c.slice(d,Q),u);switch(u){case "X":if(0!=t.state){y(1,H.ignored,u);continue}if(t.select&&!g()){Q=c.indexOf("\nX:",t.eol);0>Q&&(Q=e);t.eol=Q;continue}ta.cfmt=A(r);ta.info=A(M,2);ta.char_tb=A(Ia);ta.glovar=A(na);ta.maps=A(Sa,1);ta.mac=A(eb);ta.maci=A(ic);M.X=v;t.state=1;q.page_format&&1>Da&&(Da=1);t.tune_opts&&k();continue;case "T":switch(t.state){case 0:continue;case 1:case 2:M.T=
void 0==M.T?v:M.T+("\n"+v);continue}a=Ta("title");a.text=v;continue;case "K":switch(t.state){case 0:continue;case 1:M.K=v}Jc(u,v);continue;case "W":if(0==t.state||0>r.writefields.indexOf(u))break;M.W=void 0==M.W?v:M.W+(m+v);break;case "m":if(2<=t.state){y(1,H.ignored,u);continue}x=v.match(/(.*?)[= ]+(.*)/);if(!x||!x[2]){y(1,H.bad_val,"m:");continue}eb[x[1]]=x[2];ic[x[1][0]]=!0;break;case "s":if(3!=t.state||0>r.writefields.indexOf(u))break;ff(v," "==m);break;case "w":if(3!=t.state||0>r.writefields.indexOf(u))break;
gf(v," "==m);if("\\"==v.slice(-1)){m=" ";var D=u;continue}break;case "|":if(2>t.state)continue;t.line.buffer=v;Fd();continue;default:if(0<="ABCDFGHNOSZ".indexOf(u)){if(2<=t.state){y(1,H.ignored,u);continue}M[u]=M[u]?M[u]+(m+v):v}else{Jc(u,v);continue}}m="\n";D=u}else D=void 0,2>t.state||(t.line.buffer=f(c.slice(d,Q)),t.line.buffer&&Fd())}}rb||(2<=t.state&&h(),t.state=0)}function ec(a,c){var d,e=0,g=c;0!=g%12&&v(1,a,"Invalid note duration $1",g);(g/=12)||v(1,a,"Note too short");for(d=5;0!=g&&!(g&1);g>>=
1,d--);g>>=1;for(g+1&g&&(a.type!=n.REST||c!=a.p_v.wmeasure)&&v(0,a,"Non standard note duration $1",c);0<g>>e;)e++;d-=e;if(0<=d)a=n.FULL;else switch(d){default:v(1,a,"Note too long"),d=-4;case -4:a=n.SQUARE;break;case -3:a=r.squarebreve?n.SQUARE:n.OVALBARS;break;case -2:a=n.OVAL;break;case -1:a=n.EMPTY}return[a,e,d]}function Gd(a){var c,d=a.stem;if(c=a.nhd){var e=.78*Hd[a.head];a.grace&&(e*=.5);if(0<=d){var g=1;var f=c+1;c=a.notes[0].pit}else e=-e,g=c-1,f=-1,c=a.notes[c].pit;for(var h=!1,l=0;g!=f;g+=
d){var k=a.notes[g].pit-c;c=a.notes[g].pit;if(!k){if(h){k=a.notes[g].shhd=a.notes[g-d].shhd+e;l<k&&(l=k);continue}if(g+d!=f&&c+d==a.notes[g+d].pit){a.notes[g].shhd=-e;l<-e&&(l=-e);continue}}0>k&&(k=-k);if(3<k||2<=k&&a.head!=n.SQUARE)h=!1;else if(h=!h)a.notes[g].shhd=e,l<e&&(l=e)}a.xmx=l}}function Id(a,c){var d,e,g,f,h=a.length;for(d=h-1;0<=--d;)if((f=a[d].shhd)&&!(0<f)){f=c-f;var l=a[d].pit;for(e=h;0<=--e;)if(a[e].acc){var k=a[e].pit;if(k<l-3)break;!(k>l+3)&&a[e].shac<f&&(a[e].shac=f)}}for(e=h;0<=
--e;)if(a[e].acc){k=a[e].pit;var n=a[e].shac;n||(n=a[e].shhd,n=0>n?c-n:c);break}if(!(0>e)){for(g=0;g<e;g++)if(a[g].acc){l=a[g].pit;var m=a[g].shac;m||(m=a[g].shhd,m=0>m?c-m:c);break}if(e==g)a[e].shac=n;else for(k>l+4?(n>m&&(m=n),a[e].shac=a[g].shac=m):(a[e].shac=n,a[g].shac=m=n),m+=7,d=e;--d>g;)if(c=a[d].acc){f=a[d].shac;f<m&&(f=m);l=a[d].pit;for(e=h;--e>d;)a[e].acc&&(k=a[e].pit,!(k>=l+4&&(k>l+4||0>c||0>a[e].acc))&&f>a[e].shac-6&&(n=a[e].shac+7,n>f&&(f=n)));a[d].shac=f}}}function jc(a,c){a.next=c;
a.prev=c.prev;a.prev?a.prev.next=a:a.p_v.sym=a;c.prev=a}function Qb(a,c){(a.ts_next=c)?(a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=a),c.ts_prev=a):(v(2,a,"Bad linkage"),a.ts_prev=null);a.seqst=!a.ts_prev||a.time!=a.ts_prev.time||Na[a.ts_prev.type]!=Na[a.type]&&0!=Na[a.ts_prev.type]||a.ts_prev.v==a.v;c&&(c.seqst=c.time!=a.time||Na[a.type]!=Na[c.type]&&0!=Na[a.type],c.seqst&&(W.set_width(c),c.a_ly&&Kc(c),c.shrink=c.wl,c.prev&&(c.shrink+=c.prev.wr),c.space=0))}function ob(a){a.next&&(a.next.prev=
a.prev);a.prev?a.prev.next=a.next:a.p_v.sym=a.next;a.ts_next&&(a.seqst?a.ts_next.seqst?(a.ts_next.shrink+=a.shrink,a.ts_next.space+=a.space):(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space):a.ts_next.seqst&&a.ts_prev&&a.ts_prev.seqst&&!Na[a.ts_prev.type]&&(a.ts_next.seqst=!1,a.shrink=a.ts_next.shrink,a.space=a.ts_next.space),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&(a.ts_prev.ts_next=a.ts_next);P==a&&(P=a.ts_next);Pa==a&&(Pa=a.ts_next)}function Jd(a,c,d){var e=a.p_v,g=a.st;a.type==
n.BAR&&a.prev&&a.prev.type==n.BAR&&":"!=a.prev.bar_type[0]&&(a=a.prev);e.last_sym=a.prev;e.last_sym||(e.sym=null);e.time=a.time;e=Kd(e,n.CLEF);e.next=a;a.prev=e;e.clef_type=c;e.clef_line=d;e.st=g;e.clef_small=!0;delete e.second;e.notes=[];e.notes[0]={pit:a.notes[0].pit};for(e.nhd=0;!a.seqst;)a=a.ts_prev;Qb(e,a);return e}function Ld(a,c,d){var e,g=0;for(e=0;e<a.a_gch.length;e++){var f=a.a_gch[e];switch(f.type){case "<":f=f.text.wh[0]+c;f>d&&(d=f);break;case ">":f=f.text.wh[0]+a.wr,f>g&&(g=f)}}a.wr<
g&&(a.wr=g);return d}function Md(a,c){Lc>=n.BLEN/2?c=Lc>=n.BLEN?c/4:c/2:!a.next&&c>=n.BLEN&&(c/=2);a=c>=n.BLEN/4?c<n.BLEN/2?5:c<n.BLEN?6:c<2*n.BLEN?7:c<4*n.BLEN?8:9:c>=n.BLEN/8?4:c>=n.BLEN/16?3:c>=n.BLEN/32?2:c>=n.BLEN/64?1:0;var d=c-(n.BLEN/16/8<<a);var e=fb[a];d&&(0>d?e=fb[0]*c/(n.BLEN/16/8):(9<=a&&(a=8),e+=(fb[a+1]-fb[a])*d/(n.BLEN/16/8<<a)));return e}function Mc(a,c){var d;var e=a.time-c;if(!e){switch(a.type){case n.MREST:return a.wl}return 0}if(a.ts_prev.type==n.MREST)return 71;for(d=Md(a,e);!a.dur;){switch(a.type){case n.BAR:return.9*
d-7;case n.CLEF:return d-a.wl-a.wr;case n.BLOCK:case n.PART:case n.REMARK:case n.STAVES:case n.TEMPO:a=a.ts_next;if(!a)return d;continue}break}if(a.dur&&e<=n.BLEN/4)for(e=a;e;){if(!e.beam_st){d*=.9;break}e=e.ts_next;if(!e||e.seqst)break}if(a.type==n.NOTE&&-1<=a.nflags&&0<a.stem){var g=!0;for(e=a.ts_prev;e&&e.time==c;e=e.ts_prev)if(e.type==n.NOTE&&(-1>e.nflags||0<e.stem)){g=!1;break}if(g){for(e=a.ts_next;e&&e.time==a.time;e=e.ts_next)if(e.type==n.NOTE&&(-1>e.nflags||0>e.stem)){g=!1;break}g&&(d*=.9)}}return d}
function Nc(a){return{type:n.BAR,bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,p_v:a.p_v,st:a.st,dur:0,nhd:0,notes:[{pit:a.notes?a.notes[0].pit:22}],prev:a}}function kc(a){var c=A(a);c.prev.next=a.ts_prev=a.prev=c.ts_prev.ts_next=c;c.next=c.ts_next=a;a.seqst=!1;a.invis=a.play=!0;c.type=n.REST;delete c.in_tuplet;delete c.sl1;delete c.a_dd;delete c.a_gch;delete c.sls;return c}function hf(a){var c,d,e,g=a.repeat_n,f=a.repeat_k,h=a.st,l=a.v;a.repeat_n=0;if(0>g){var k=g=-g;for(d=a.prev;d;d=
d.prev)if(!d.dur){if(d.type==n.BAR){v(1,d,"Bar in repeat sequence");return}}else if(0>=--k)break;if(d){var m=a.time-d.time;k=f*g;for(c=a;c;c=c.next)if(!c.dur){if(c.type==n.BAR){v(1,c,"Bar in repeat sequence");return}}else if(0>=--k)break;if(c&&c.next){for(c=a.prev;c!=d;c=c.prev)if(c.type==n.NOTE){c.beam_end=!0;break}for(e=f;0<=--e;){k=g;a.dur&&k--;for(c=a.ts_next;0<k;)c.st==h&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1),c.v==l&&c.dur&&k--),c=c.ts_next;a=kc(a);a.dur=a.notes[0].dur=m;
a.rep_nb=-1;a.beam_st=!0;W.set_width(a);a.head=n.SQUARE;for(a=c;a&&(a.st!=h||a.v!=l||!a.dur);a=a.ts_next);}}else v(1,a,H.not_enough_n)}else v(1,a,H.not_enough_n)}else{k=g;for(c=a.prev.prev;c&&(c.type!=n.BAR&&c.time!=P.time||!(0>=--k));c=c.prev);if(c){m=a.time-c.time;k=1==g?f:g;for(c=a;c&&!(c.type==n.BAR&&0>=--k);c=c.next);if(c){k=f;if(2==g&&1<k){c=c.next;if(!c){v(1,a,H.not_enough_m);return}c.repeat_n=g;c.repeat_k=--k}m/=g;if(2==g){for(c=a.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==n.BAR){if(c.v==
l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=kc(a);d.dur=d.notes[0].dur=m;d.invis=!0;c.bar_mrep=2;d=c.next;for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==n.BAR){if(c.v==l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=kc(d);d.dur=d.notes[0].dur=m;d.invis=!0;W.set_width(d)}else for(d=a,e=f;0<=--e;){for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==n.BAR){if(c.v==l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=kc(d);d.dur=
d.notes[0].dur=m;d.beam_st=!0;if(1==f){d.rep_nb=1;break}d.rep_nb=f-e+1;d=c.next}}else v(1,a,H.not_enough_m)}else v(1,a,H.not_enough_m)}}function lc(a){function c(a){if(r.custos&&1==F.length)a:{for(var c=a,d,e,g=c;g.type!=n.NOTE;)if(g=g.next,!g)break a;d=c.p_v;d.last_sym=c.prev;d.time=c.time;d=Kd(d,n.CUSTOS);d.next=c;c.prev=d;Qb(d,c);d.shrink=c.shrink;12>d.shrink&&(d.shrink=12);d.space=g.space;d.wl=0;d.wr=4;d.nhd=g.nhd;d.notes=[];for(e=0;e<c.notes.length;e++)d.notes[e]={pit:g.notes[e].pit,shhd:0,dur:n.BLEN/
4};d.stemless=!0}a.nl=!0;a=a.ts_prev;a.type!=n.BAR&&(c=Nc(a),c.seqst=!0,c.invis=!0,c.time=a.time+a.dur/2,c.wl=0,c.wr=0,c.ts_prev=a,c.next=a.next,c.ts_next=a.ts_next,c.shrink=a.wr+3,a.next&&(a.next.prev=c),a.ts_next.ts_prev=c,a.next=a.ts_next=c,c.space=Mc(c,a.time))}var d;a=function(a){var c,d;for(c=a;c.ts_prev&&c.ts_prev.time==a.time;)c=c.ts_prev,c.bar_type&&(d=c);if(!d)return a;for(c=a;;c=c.ts_next){switch(c.type){default:if(Na[c.type])break;case n.KEY:case n.METER:case n.CLEF:continue}break}for(;d!=
a;){if(d.bar_type&&(":"==d.bar_type.slice(-1)||d.text)&&":"!=d.bar_type){var e=d.bar_type.match(/(:*)([^:]*)(:*)/);if(e[3])if(e[1]){var g=e[2].length/2|0;var m=e[1]+"|"+e[2].slice(0,g);e=e[2].slice(g)+"|"+e[3]}else m="["==e[2][0]?e[2].slice(1):e[2],e="[|"+e[3];else m=e[1]+e[2],e="[";g=A(d);d.bar_type=m;g.bar_type=e;for(jc(g,d.next);!(c.type!=n.BAR||c.v>g.v);)c=c.ts_next;Qb(g,c);c==a&&(a=g);d.text&&(g.invis=!0,delete d.text,delete d.rbstart);delete g.a_dd}d=d.ts_next}return a}(a);(function(a){var c,
d;for(d=a;d;d=d.ts_next){switch(d.type){case n.KEY:if(!r.keywarn||d.invis)continue;for(c=a.ts_prev;c&&c.type==n.METER;c=c.ts_prev);case n.METER:if(d.type==n.METER){if(!r.timewarn)continue;c=a.ts_prev}case n.CLEF:if(!d.prev)continue;if(d.type==n.CLEF)for(c=a.ts_prev;c;c=c.ts_prev){switch(c.type){case n.BAR:case n.KEY:case n.METER:continue}break}var e=A(d);Qb(e,c.ts_next);e.ts_next==a&&(a.seqst=!0);for(c=e;c=c.ts_next,c.v!=d.v;);jc(e,c);e.seqst&&(e.shrink=e.wl,e.prev&&(e.shrink+=e.prev.wr),e.space=
Mc(e,e.ts_prev.time),e.next.shrink=e.wr+e.next.wl);continue}if(Na[d.type])break}})(a);switch(a.ts_prev.type){case n.STAVES:break;case n.GRACE:if(a=a.next,!a)return a;default:return c(a),a}for(a=a.ts_prev;a&&(!a.seqst||a.type==n.CLEF);a=a.ts_prev);var e=0;for(d=a.type;;a=a.ts_next){if(!a)return a;if(a.type!=d){d=a.type;if(0>e)break;switch(a.type){case n.STAVES:if(!a.ts_prev)return;if(a.ts_prev.type==n.BAR)break;for(;a.ts_next&&(0==Na[a.ts_next.type]||a.ts_next.type==n.CLEF);)a=a.ts_next;if(!a.ts_next||
a.ts_next.type!=n.BAR)continue;a=a.ts_next;case n.BAR:if(e)break;e=1;continue;case n.STBRK:a.stbrk_forced?e=-1:ob(a);continue;case n.CLEF:if(e)break;continue;default:if(!e||a.prev&&a.prev.type==n.GRACE)continue}break}}c(a);return a}function Nd(){var a=F[0];W.set_width(a.clef);W.set_width(a.ckey);W.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.ckey.wl+a.ckey.wr,a.meter.wl+a.meter.wr]}function Od(a,c){for(var d,e,g=0,f=0,h=1-r.maxshrink;a!=c;)a.seqst&&(d=a.shrink,f+=d,g=(e=a.space)<d?g+d:g+(d*r.maxshrink+
e*h),a.x=g),a=a.ts_next;c&&(f+=c.wr);return[g,f]}function jf(a,c,d,e){var g,f=c?c.ts_prev:null;var h=Od(a,c);r.keywarn&&c&&c.type==n.KEY&&!f.dur&&(h[0]+=c.wr,h[1]+=c.wr);if(h[1]+e<d)return c&&(c=lc(c)),c||f;for(g=h[0]+e;;){var l=Math.ceil(g/d);if(1>=l)return c&&(c=lc(c)),c||f;var k=h=a;var m=a.x-a.shrink-e;var t=m+d;e=m+g/l;m+=g/l*r.breaklimit;for(a=a.ts_next;a!=c&&!(a.x&&(a.type==n.BAR&&(k=a),a.x>=m));a=a.ts_next);if(a==c)return c&&(c=lc(c)),c;for(l=null;a!=c;a=a.ts_next)if(m=a.x){if(m>t)break;if(a.type==
n.BAR)if(m<e)l=a;else{if(!l||m-e<e-l.x)l=a;break}}if(!l){var q=0,u=k.time;t-=8;for(a=k;a!=c;a=a.ts_next)if(a.beam_st&&q++,a.beam_end&&0<q&&q--,m=a.x){if(m+a.wr>=t)break;if(!q&&!a.in_tuplet)if(0==(a.time-u)%(n.BLEN/4))l=a;else if(!l||a.x<e)l=a;else{if(l>e)break;if(e-l.x<a.x-e)break;l=a;break}}}if(!l)for(l=a=k;a!=c;a=a.ts_next)if(m=a.x)if(a.x<e)l=a;else{if(l>e)break;if(e-l.x<a.x-e)break;l=a;break}for(a=l;a.ts_next&&(a=a.ts_next,!a.seqst););if(a.nl)for(v(0,a,"Line split problem - adjust maxshrink and/or breaklimit"),
l=2,a=a.ts_next;a!=c&&!(a.x&&0>=--l);a=a.ts_next);a=lc(a);if(!a||c&&a.time>=c.time)break;g-=a.x-h.x;e=0}return a}function Oc(a){switch(a.type){case n.CLEF:if(a.second||a.invis){a.ymx=a.ymn=12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=a.y+28;a.ymn=a.y-14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case n.KEY:a.ymx=
2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;default:a.ymx=24,a.ymn=0}}function kf(){function a(a,c,d){var e=["15mb(","8vb(",null,"8va(","15ma("],f=["15mb)","8vb)",null,"8va)","15ma)"];Db([(d?e:f)[2+c]],a)}var c,d,e,g,f=S+1,h=new Int16Array(Array(2*f)),l=new Int8Array(Array(f));for(d=0;d<=S;d++)h[d]=0,l[d]=0;for(c=P;c;c=c.ts_next){d=c.st;if(void 0!=c.ottava)for(;c.ottava.length;)(e=c.ottava.shift())?0==l[d]++&&(a(c,e,!0),h[d]=7*-e):0==--l[d]&&(a(c,-h[d]/7),h[d]=0);switch(c.type){case n.REST:if(1==F.length)break;
case n.NOTE:if((e=h[d])&&!c.p_v.ckey.k_drum)for(f=c.nhd;0<=f;f--){var k=c.notes[f];k.opit||(k.opit=k.pit);k.pit+=e}break;case n.GRACE:for(g=c.extra;g;g=g.next)if((e=h[d])&&!c.p_v.ckey.k_drum)for(f=0;f<=g.nhd;f++)k=g.notes[f],k.opit||(k.opit=k.pit),k.pit+=e}}}function Pc(a,c,d){var e;var g=12;var f=20;for(e=c;e&&(e.type!=n.STAVES||e==c);e=e.ts_next)if(e.st==a)if(e.type!=n.NOTE){if(e.type==n.CLEF){if("a"!=e.clef_type)break;ob(e)}}else e.notes[0].pit<f&&(f=e.notes[0].pit),e.notes[e.nhd].pit>g&&(g=e.notes[e.nhd].pit);
if(19<=f||13<=f&&"b"!=d)return"t";if(13>=g||19>=g&&"t"!=d)return"b";"a"==d&&(d=16<=(g+f)/2?"t":"b");g=d;var h=e,l=null;for(e=c;e!=h&&(e.type!=n.STAVES||e==c);e=e.ts_next)if(e.st==a&&e.type==n.NOTE){var k=e.time;if("t"==g){if(12<e.notes[0].pit||20<e.notes[e.nhd].pit){20<e.notes[0].pit&&(l=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==n.NOTE&&19<=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==n.NOTE&&19<=f.notes[0].pit)continue}else{if(12>e.notes[0].pit||20>e.notes[e.nhd].pit){12>
e.notes[e.nhd].pit&&(l=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==n.NOTE&&13>=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==n.NOTE&&13>=f.notes[0].pit)continue}if(l){k=e;for(f=e.ts_prev;f!=l;f=f.ts_prev)if(f.st==a){if(f.type==n.BAR&&f.v==e.v){k=":"!=f.bar_type[0]?f:f.next;break}f.type==n.NOTE&&f.beam_st&&!f.p_v.second&&(k=f)}k.time==l.time?l=e:(l=e,g="t"==g?"b":"t",f=Jd(k,g,"t"==g?2:4),f.clef_auto=!0)}else g=d="t"==g?"b":"t",l=e}return d}function mc(a,c,d){a.p_v=
c;a.v=c.v;a.st=c.st;a.time=d.time;c.last_sym&&(a.next=c.last_sym.next,a.next&&(a.next.prev=a),c.last_sym.next=a,a.prev=c.last_sym);c.last_sym=a;Qb(a,d)}function lf(){var a,c,d,e;var g=F.length;for(d=0;d<g;d++)if(L.voices[d]){var f=F[d];f.second=L.voices[d].second;f.last_sym=f.sym;for(c=L.voices[d].st;c<S&&!L.st_print[c];)c++;f.st=c;f.second||(B[c].key=f.ckey,B[c].meter=f.meter)}for(a=P;a;){switch(a.type){case n.CLEF:case n.KEY:case n.METER:switch(a.type){case n.CLEF:B[a.st].clef=a;break;case n.KEY:a.p_v.ckey=
a;break;case n.METER:a.p_v.meter=a,Yb|=1}ob(a);case n.PART:case n.TEMPO:case n.BLOCK:case n.REMARK:a=a.ts_next;continue}break}var h=P;for(d=0;d<g;d++)f=F[d],!L.voices[d]||L.voices[d].second&&!f.bar_start||(c=L.voices[d].st,B[c]&&B[c].clef&&(a=A(B[c].clef),a.v=d,a.p_v=f,a.st=c,a.time=P.time,a.prev=null,a.next=f.sym,a.next&&(a.next.prev=a),f.sym=f.last_sym=a,a.ts_next=h,a.ts_prev=h?h.ts_prev:null,a.ts_prev?(a.ts_prev.ts_next=a,delete a.seqst):P=a,h&&(h.ts_prev=a,h.type==n.CLEF&&delete h.seqst),delete a.clef_small,
a.second=L.voices[d].second,L.st_print[c]||(a.invis=!0)));for(d=0;d<g;d++)L.voices[d]&&!L.voices[d].second&&L.st_print[L.voices[d].st]&&(f=F[d],c=f.ckey,c.k_sf||c.k_a_acc)&&(a=A(c),mc(a,f,h),delete a.invis,a.k_old_sf=c.k_sf);if(Yb&1){for(d=0;d<g;d++)f=F[d],c=f.meter,L.voices[d]&&!L.voices[d].second&&L.st_print[L.voices[d].st]&&c.a_meter.length&&(a=A(c),mc(a,f,h));Yb&=-2}for(d=0;d<g;d++)f=F[d],f.sls.length&&(a={type:n.BAR,fname:h.fname,bar_type:"|",dur:0,multi:0,invis:!0,sls:f.sls},mc(a,f,h),f.sls=
[]);for(d=0;d<g;d++){f=F[d];c=f.bar_start;f.bar_start=null;if(h&&h.v==d)for(a=h;a&&a.v==d;a=a.ts_next){switch(a.type){case n.PART:case n.TEMPO:continue;case n.BAR:f.last_sym=a,h=a.ts_next}break}c&&L.voices[d]&&L.st_print[L.voices[d].st]&&(f.last_sym.type==n.BAR?f.last_sym.rbstop||(f.last_sym.rbstart=1):mc(c,f,h))}W.set_pitch(h);a=P;a.seqst=!0;for(e=0;;){c=a;g=d=0;do W.set_width(a),f=a.wl+e,f>d&&(d=f),a.wr>g&&(g=a.wr),a=a.ts_next;while(a!=h&&!a.seqst);c.shrink=d;c.space=0;if(a==h)break;e=g}f=0;do W.set_width(a),
a.a_ly&&Kc(a),f<a.wl&&(f=a.wl),a=a.ts_next;while(a&&!a.seqst);h.shrink=g+f;h.space=0}function Qc(a){var c,d,e=F.length,g=0;for(c=0;c<e;c++){var f=F[c];if(L.voices[c]&&(d=(a||f.new_name)&&f.nm?f.nm:f.snm)){if(!h){ba("voice");var h=J.curfont}for(f=0;;){var l=d.indexOf("\n",f);f=0>l?va(d.slice(f)):va(d.slice(f,l));f=f[0];f>g&&(g=f);if(0>l)break;f=l+1}}}h&&(g+=4*Tb(" "));f=.5;for(c=0;c<=L.nstaff;c++){if(L.staves[c].flags&1280){f=12;break}L.staves[c].flags&5&&(f=6)}g+=f;a&&(g+=r.indent);return g}function mf(a,
c){var d,e,g;if(a.shiftunison&&3<=a.shiftunison||(e=a.dur)>=n.BLEN||(g=c.dur)>=n.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(a.shiftunison&&a.shiftunison&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;var f=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<c.notes[0].pit){if(0>c.stem)return!1;for(;c.notes[0].pit!=a.notes[f].pit;)if(++f>a.nhd)return!1}if(c.notes[d].acc!=a.notes[f].acc)return!1;var h=f;var l=
d;var k=a.notes[f].shhd;var m=c.notes[d].shhd;do{f++;d++;if(f>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=a.notes[f].acc)return!1;k<a.notes[f].shhd&&(k=a.notes[f].shhd);m<c.notes[d].shhd&&(m=c.notes[d].shhd)}while(c.notes[d].pit==a.notes[f].pit);if(f<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;var r=f;f=d;d=0;if(e!=g)if(e<g&&(e=g,g=a.dur),e<n.BLEN/2)c.dots?d=2:a.dots&&(d=1);else if(g<n.BLEN/4){if(a.shiftunison&&a.shiftunison&2)return!1;d=c.dur>=n.BLEN/2?2:1}else return!1;
d||(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=l;d<f;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=k}else{for(f=h;f<r;f++)a.notes[f].invis=!0,delete a.notes[f].acc;for(f=0;f<=a.nhd;f++)a.notes[f].shhd+=m}return!0}function nf(a,c,d,e){var g;if(g=c.notes[e].acc){e=2*nc[a.head]+a.xmx+c.notes[e].shac+2;"object"==typeof g&&(e+=2);a.dots&&(e+=6);for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=e,c.notes[d].shac-=e;c.xmx+=e}else{e=2*nc[c.head]+c.xmx+a.notes[d].shac+2;g=a.notes[d].acc;
"object"==typeof g&&(e+=2);c.dots&&(e+=6);for(d=0;d<=a.nhd;d++)a.notes[d].shhd+=e,a.notes[d].shac-=e;a.xmx+=e}}function Rc(a){var c,d=nc[a.head],e=d,g=[];for(c=0;96>c;c++)g.push(-100);if(-2<a.nflags){if(0<a.stem){e=-e;c=2*a.notes[0].pit;var f=2*(Math.ceil((a.ymx-2)/3)+18)}else c=2*(Math.ceil((a.ymn+2)/3)+18),f=2*a.notes[a.nhd].pit;0>c&&(c=0);for(96<=f&&(f=95);c<=f;)g[c++]=e}var h=a.notes[0<a.stem?0:a.nhd].shhd;for(f=0;f<=a.nhd;f++)e=-a.notes[f].shhd+d+h,c=2*a.notes[f].pit,0>c?c=0:95<=c&&(c=94),e>
g[c]&&(g[c]=e),a.head!=n.SQUARE&&--e,e>g[c-1]&&(g[c-1]=e),e>g[c+1]&&(g[c+1]=e);return g}function Sc(a){var c,d=nc[a.head],e=d,g=0<a.nflags&&a.beam_st&&a.beam_end,f=[];for(c=0;96>c;c++)f.push(-100);if(-2<a.nflags){if(0>a.stem){e=-e;c=2*(Math.ceil((a.ymn+2)/3)+18);var h=2*a.notes[a.nhd].pit;var l=c+4}else c=2*a.notes[0].pit,h=2*(Math.ceil((a.ymx-2)/3)+18);0>c&&(c=0);for(96<h&&(h=96);c<h;)f[c++]=e}if(g)if(0<a.stem)for(c=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,c+=4,0>c&&(c=0);96>c&&c<=h-4;c++)f[c]=
11;else for(c=l,0>c&&(c=0);96>c&&c<=2*a.notes[0].pit-4;c++)f[c]=3.5;l=a.notes[0<a.stem?0:a.nhd].shhd;for(h=0;h<=a.nhd;h++)e=a.notes[h].shhd+d-l,c=2*a.notes[h].pit,0>c?c=0:95<=c&&(c=94),e>f[c]&&(f[c]=e),a.head!=n.SQUARE&&--e,e>f[c-1]&&(f[c-1]=e),e>f[c+1]&&(f[c+1]=e);return f}function of(){function a(){m=d;d=c;p=z;v=q;A=r;l=h}var c,d,e,g,f,h,l,k=L;for(c=P;c;c=c.ts_next)if(c.type!=n.NOTE||c.invis)c.type==n.STAVES&&(k=c.sy);else{if(c.xstem&&0>c.ts_prev.stem)for(e=0;e<=c.nhd;e++)c.notes[e].shhd-=7,c.notes[e].shac+=
16;for(d=c;;){d=d.ts_next;if(!d)break;if(d.time!=c.time){d=null;break}if(d.type==n.NOTE&&!d.invis&&d.st==c.st)break}if(d){var m=c;k.voices[m.v].range<k.voices[d.v].range?d.dot_low=!0:m.dot_low=!0;if(!(m.ymn>d.ymx||m.ymx<d.ymn||mf(m,d)))if(m.dots||d.dots||!(0<m.stem&&0>d.stem&&m.notes[0].pit==d.notes[d.nhd].pit+1||0>m.stem&&0<d.stem&&m.notes[m.nhd].pit+1==d.notes[0].pit)){var r=Sc(m);var t=Rc(d);if((e=m.ts_prev)&&e.time==m.time&&e.st==m.st&&e.type==n.NOTE&&!e.invis){var u=Sc(e);for(g=0;96>g;g++)u[g]>
r[g]&&(r[g]=u[g])}else e=null;var p=-10;for(g=0;96>g;g++)t[g]+r[g]>p&&(p=t[g]+r[g]);if(!(-3>p&&(d.notes[0].pit&1||!m.dots&&!d.dots||!(m.notes[m.nhd].pit==d.notes[0].pit+2&&m.dot_low||m.notes[m.nhd].pit+2==d.notes[0].pit&&d.dot_low)))){var C=Sc(d);var q=Rc(m);if(e)for(u=Rc(e),g=0;96>g;g++)u[g]>q[g]&&(q[g]=u[g]);var z=h=l=-100;for(g=0;96>g;g++)q[g]+C[g]>z&&(z=q[g]+C[g]),C[g]>l&&(l=C[g]),r[g]>h&&(h=r[g]);g=0;u=m.nhd;for(f=d.nhd;;){var y=m.notes[u].pit-d.notes[f].pit;switch(y){case 2:m.notes[u].pit&1||
(m.dot_low=!1);break;case 1:m.notes[u].pit&1?d.dot_low=!0:m.dot_low=!1;break;case 0:if(m.notes[u].acc!=d.notes[f].acc){g=-1;break}d.notes[f].acc&&(m.notes[u].acc||(m.notes[u].acc=d.notes[f].acc),d.notes[f].acc=0);m.dots&&d.dots&&m.notes[u].pit&1&&(g=1);break;case -1:m.notes[u].pit&1?d.dot_low=!1:m.dot_low=!0;break;case -2:m.notes[u].pit&1||(d.dot_low=!1)}if(0>g)break;if(0<=y&&0>--u)break;if(0>=y&&0>--f)break}if(0>g)nf(m,d,u,f);else{f=0;m.dots?d.dots?g||(f=1):a():d.dots&&z+h<p+l&&(f=1);var v=t;var A=
C;!e&&z+h<p+l&&a();p+=3;0>p&&(p=0);e=0<=m.stem?0:m.nhd;p+=m.notes[e].shhd;e=0<=d.stem?0:d.nhd;p-=d.notes[e].shhd;if(m.dots)if(e=7.7+m.xmx+3.5*m.dots-3.5+3,!f){z=-100;for(u=0;u<=m.nhd;u++)g=m.notes[u].pit,g&1||(m.dot_low?g--:g++),g*=2,1>g?g=1:95<=g&&(g=94),v[g]>z&&(z=v[g]),v[g-1]+1>z&&(z=v[g-1]+1),v[g+1]+1>z&&(z=v[g+1]+1);e+z+2>p&&(p=e+z+2)}else if(e<p+l+d.xmx){for(u=z=0;u<=m.nhd;u++)g=m.notes[u].pit,g&1||(m.dot_low?g--:g++),g*=2,1>g?g=1:95<=g&&(g=94),A[g]>z&&(z=A[g]),A[g-1]+1>z&&(z=A[g-1]=1),A[g+
1]+1>z&&(z=A[g+1]+1);4.5<z&&7.7+m.xmx+2<p+z+d.xmx&&(d.xmx=z+3-7.7)}for(e=d.nhd;0<=e;e--)d.notes[e].shhd+=p;d.xmx+=p;f&&(m.xmx=d.xmx)}}}else{0>m.stem&&(m=d,d=c);p=m.notes[0].shhd+7;for(e=0;e<=d.nhd;e++)d.notes[e].shhd+=p;d.xmx+=p;m.xmx=d.xmx}}}}function pf(a){for(var c=P;c&&!c.nl;c=c.ts_next)c.st==a&&c.type!=n.CLEF&&(c.st++,c.invis=!0)}function qf(){function a(a){var c=B[a],d=h.staves[a];c||(c=B[a]={});c.y=0;c.stafflines=d.stafflines;c.staffscale=d.staffscale;c.ann_top=c.ann_bot=0}function c(){var a,
c,d=h.staves.length;for(a=0;a<d;a++)if(h.staves[a].flags&257){var e=0;for(c=a;a<d;){e|=g[a]?1:2;if(h.staves[a].flags&514)break;a++}if(3==e)for(;c<=a;)g[c]=!0,f[c++]=!0}}var d,e,g=[],f=[],h=L;if(P.type==n.STAVES){var l=P;P=P.ts_next;P.ts_prev=null;l.seqst&&(P.seqst=!0);if(l.p_v.sym=l.next)l.next.prev=null}S=h.nstaff;for(d=0;d<=S;d++)a(d);for(l=P;l&&!l.nl;l=l.ts_next){switch(l.type){case n.STAVES:c();h.st_print=new Uint8Array(g);for(h=l.sy;S<h.nstaff;)a(++S);g=[];continue;case n.BLOCK:l.play?l.ts_next&&
l.ts_next.shrink&&(l.ts_next.shrink=0):(oc.push(l),ob(l));continue}d=l.st;if(d>S){switch(l.type){case n.CLEF:B[d].clef=l;break;case n.KEY:l.p_v.ckey=l;break;case n.METER:l.p_v.meter=l}ob(l)}else if(!g[d]){switch(l.type){default:continue;case n.BAR:if(l.bar_mrep||1<h.staves[d].staffnonote)break;continue;case n.GRACE:break;case n.NOTE:case n.REST:case n.SPACE:case n.MREST:if(!(1<h.staves[d].staffnonote)){if(l.invis)continue;if(!h.staves[d].staffnonote&&l.type!=n.NOTE)continue}}f[d]=g[d]=!0}}Pa=l;c();
h.st_print=new Uint8Array(g);(function(){var a,c,d;for(a=0;a<=S;a++){var e=B[a];e.hlu=[];e.hld=[];if(f[a]){var g=e.stafflines.length;e.topbar=6*(g-1);for(c=0;c<g-1;c++){switch(e.stafflines[c]){case ".":case "-":continue}break}e.botline=e.botbar=6*c;if(c>=g-2)if("."!=e.stafflines[c])e.botbar-=6,e.topbar+=6;else{e.botbar-=12;e.topbar+=12;continue}e.hll=17+2*c;e.hlmap=new Int8Array(Array(2*(g-c+1)));for(d=1;c<g;c++,d+=2)switch(e.stafflines[c]){case "|":case "[":e.hlmap[d-1]=1,e.hlmap[d]=1,e.hlmap[d+
1]=1}}else e.botbar=e.topbar=0}})();for(d=0;d<S;d++)f[d]||pf(d);f[S]||(B[S].topbar=0);lf();J.st_print=new Uint8Array(f);if(Pa){l=Pa;delete l.nl;l=l.ts_prev;l.ts_next=null;var k=F.length;for(e=0;e<k;e++){d=F[e];if(d.sym&&d.sym.time<=Pa.time){for(l=Pa.ts_prev;l;l=l.ts_prev)if(l.v==e){d.s_next=l.next;l.next=null;break}if(l)continue}d.s_next=d.sym;d.sym=null}}}function Pd(){for(var a=P,c=a.time;a;a=a.ts_next){if(a.time!=c){Ha();return}switch(a.type){case n.NOTE:case n.REST:case n.MREST:case n.SPACE:Ha();
return;default:continue;case n.STAVES:L=a.sy;continue;case n.BLOCK:if(a.play)continue;W.block_gen(a)}ob(a);a.p_v.s_next==a&&(a.p_v.s_next=a.next)}P=null}function $b(a){a.fname=t.fname;a.istart=t.istart;a.iend=t.iend}function Qd(a){var c={type:n.CLEF,clef_line:2,clef_type:"t",v:m.v,p_v:m,time:m.time,dur:0},d=1;$b(c);switch(a[0]){case '"':d=a.indexOf('"',1);c.clef_name=a.slice(1,d);d++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;d=4;break}d=4;case "C":c.clef_type="c";c.clef_line=3;break;
case "b":d=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":d=4;c.invis=!0;break;case "t":if("e"==a[1]){c.clef_type="c";c.clef_line=4;break}d=6;case "G":break;case "p":d=4;case "P":c.clef_type="p";c.clef_line=3;m.key.k_sf=0;m.ckey.k_sf=0;m.ckey.k_map=abc2svg.keys[7];m.ckey.k_b40=2;m.ckey.k_drum=!0;break;default:y(1,"Unknown clef '$1'",a);return}"1"<=a[d]&&"9">=a[d]&&(c.clef_line=Number(a[d]),d++);delete m.snd_oct;if("8"!=a[d+1])return c;switch(a[d]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave=
7;c.clef_oct_transp||(m.snd_oct=12);break;case "_":c.clef_oct_transp=!0;case "-":c.clef_octave=-7,c.clef_oct_transp||(m.snd_oct=-12)}return c}function lb(a,c){var d;var e=new O;e.buffer=a;var g=[];for(a=0;2>a;a++)if(d=e.buffer[e.index]?sb(e):null)g[a]=abc2svg.pab40(d.pit,d.acc);else{if(1!=a||!c){y(1,H.bad_transp);return}g[a]=242}return g[1]-g[0]}function Rd(a){var c;if(c=a.match(/(.)[=\s]*(\[I:.+\]|".+"|!.+!)$/)){a=c[1];var d=c[2];"\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" "));c=a.charCodeAt(0);if(128<=
c)y(1,H.not_ascii);else{switch(Ia[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":case "[":if(1<Ia[c].length)break;default:y(1,"Bad user character '$1'",a);return}switch(d){case "!beambreak!":d=" ";break;case "!ignore!":d="i";break;case "!nil!":case "!none!":d="d"}Ia[c]=d}}else y(1,'Lack of starting [, ! or " in U: / %%user')}function rf(a){if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,"[");a=parseInt(a);switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";
case 3:return".|||"}if(!(isNaN(a)||0>a||16<a))return"||||||||||||||||".slice(0,a)}}function Ta(a){var c={type:n.BLOCK,subtype:a,dur:0};2==t.state&&Ea();"midi"!=a.slice(0,4)&&(m=F[0]);Ba(c);return c}function hc(a){m.init||(m.init=!0,M.V&&(M.V["*"]&&(a=M.V["*"].concat(a)),M.V[m.id]&&(a=M.V[m.id].concat(a))));a.length&&W.set_vp(a)}function Fc(a,c){c.length&&(M.V||(M.V={}),M.V[a]?Array.prototype.push.apply(M.V[a],c):M.V[a]=c)}function sf(a){function c(a){var c;if((c=a.match(/(\d+)\/(\d+)/))&&(a=Number(c[2]))&&
!isNaN(a)&&!(a&a-1)&&(c=Number(c[1]),!isNaN(c)))return n.BLEN*c/a;y(1,"Invalid note duration $1",g)}var d=a,e={type:n.TEMPO,dur:0};$b(e);0>r.writefields.indexOf("Q")&&(e.invis=!0);if('"'==a[0]){var g=a.match(/"([^"]*)"/);if(!g){y(1,"Unterminated string in Q:");return}e.tempo_str1=g[1];a=a.slice(g[0].length).replace(/^\s+/,"")}if('"'==a.slice(-1)){var f=a.indexOf('"');e.tempo_str2=a.slice(f+1,-1);a=a.slice(0,f).replace(/\s+$/,"")}f=a.indexOf("=");if(0<f){var h=a.slice(0,f).split(/\s+/);for(a=a.slice(f+
1).replace(/^\s+/,"");;){g=h.shift();if(!g)break;f=c(g);if(!f)return;e.tempo_notes||(e.tempo_notes=[]);e.tempo_notes.push(f)}"ca. "==a.slice(0,4)&&(e.tempo_ca="ca. ",a=a.slice(4));f=a.indexOf("/");if(0<f){f=c(a);if(!f)return;e.new_beat=f}else if(e.tempo=Number(a),!e.tempo||isNaN(e.tempo)){y(1,"Bad tempo value");return}}if(3!=t.state){if(1==t.state){M.Q=d;na.tempo=e;return}Ea()}Ba(e);na.tempo&&0==m.time&&(na.tempo.invis=!0)}function Jc(a,c){var d;if(!m||!m.ignore||"V"==a)switch(a){case "I":W.do_pscom(c);
break;case "L":2==t.state&&Ea();if(d=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){var e=Number(d[1]);if(!e||0!=(e&e-1))break;e=n.BLEN/e;var g=d[2]?(g=Number(d[4]))?Number(d[3])/g*n.BLEN:0:e}else"auto"==c&&(e=g=-1);if(!g){y(1,"Bad L: value");break}2>t.state?na.ulen=e:(m.ulen=e,m.dur_fact=g/e);break;case "M":a:{d={type:n.METER,dur:0,a_meter:[]};var f={},h=0;var l=0;$b(d);if(0==c.indexOf("none"))l=4,a=1;else for(a=0;l<c.length&&"="!=c[l];){switch(c[l]){case "C":f.top=c[l++];if(!h)var k=h=4;break;case "c":case "o":f.top=
c[l++];if(!h)switch(h="c"==c[l-1]?2:3,k=4,c[l]){case "|":k/=2;break;case ".":h*=3,k*=2}break;case ".":case "|":h=0;f.top=c[l++];break;case "(":if("("==c[l+1]){var x=!0;f.top=c[l++];d.a_meter.push(f);f={}}for(e=l+1;e<c.length&&")"!=c[e]&&"/"!=c[e];)e++;if(")"==c[e]&&"/"==c[e+1]){l++;continue}case ")":x="("==c[l];f.top=c[l++];d.a_meter.push(f);f={};continue;default:if("0">=c[l]||"9"<c[l]){y(1,"Bad char '$1' in M:",c[l]);break a}k=2;for(f.top=c[l++];;){for(;"0"<=c[l]&&"9">=c[l];)f.top+=c[l++];if(")"==
c[l]){if("/"!=c[l+1])break;l++}if("/"==c[l]){l++;if("0">=c[l]||"9"<c[l]){y(1,"Bad char '$1' in M:",c[l]);break a}for(f.bot=c[l++];"0"<=c[l]&&"9">=c[l];)f.bot+=c[l++];break}if(" "!=c[l]&&"+"!=c[l])break;if(l>=c.length||"("==c[l+1])break;f.top+=c[l++]}h=parseInt(f.top)}x||(f.bot&&(k=parseInt(f.bot)),a+=h*n.BLEN/k);d.a_meter.push(f);for(f={};" "==c[l];)l++;"+"==c[l]&&(f.top=c[l++],d.a_meter.push(f),f={})}if("="==c[l]){k=c.substring(++l).match(/^(\d+)\/(\d+)$/);if(!k){y(1,"Bad duration '$1' in M:",c.substring(l));
break a}a=n.BLEN*k[1]/k[2]}d.wmeasure=a;0>r.writefields.indexOf("M")&&(d.a_meter=[]);if(3!=t.state){if(M.M=c,na.meter=d,1<=t.state)for(na.ulen||(na.ulen=1>=a||a>=3*n.BLEN/4?n.BLEN/8:n.BLEN/16),l=0;l<F.length;l++)F[l].meter=d,F[l].wmeasure=a}else m.wmeasure=a,pc()?(m.meter=d,Yb=0<=r.writefields.indexOf("M")?3:2):Ba(d)}break;case "U":Rd(c);break;case "P":if(0==t.state)break;if(1==t.state){M.P=c;break}2==t.state&&Ea();d={type:n.PART,text:c,dur:0};0>r.writefields.indexOf(a)&&(d.invis=!0);Ba(d);break;
case "Q":if(0==t.state)break;sf(c);break;case "V":Tc(c);3==t.state&&(m.ignore=!K.voices[m.v]);break;case "K":if(!t.state)break;a:{b:{k="FCGDAEB".indexOf(c[0])-1;x=0;a={type:n.KEY,dur:0};$b(a);e=1;if(-1>k)switch(c[0]){case "H":if("p"!=c[1].toLowerCase()){y(1,"Unknown bagpipe-like key");f=!0;break}a.k_bagpipe=c[1];k="P"==c[1]?0:2;e++;r.temper||(r.temper=new Float32Array([11.62,12.55,2.37,2.37,3.49,0,2.37,2.37,3.49,4.41,5.53,0,3.49,4.41,5.53,7.35,7.35,4.41,5.53,7.35,7.35,8.19,0,7.35,7.35,8.19,9.39,10.51,
0,8.19,9.39,10.51,11.62,12.55,0,10.51,11.62,12.55,2.37,2.37]));break;case "P":y(1,"K:P is deprecated");k=0;f=a.k_drum=!0;break;case "n":if(0==c.indexOf("none")){k=0;a.k_none=!0;e=4;break}default:a.k_map=[];a.k_mode=0;c=[a,ac(c)];break b}if(!f){switch(c[e]){case "#":k+=7;e++;break;case "b":k-=7,e++}c=c.slice(e).trim();switch(c.slice(0,3).toLowerCase()){default:if("m"!=c[0]||" "!=c[1]&&"\t"!=c[1]&&"\n"!=c[1]){f=!0;break}case "aeo":case "m":case "min":k-=3;x=5;break;case "dor":k-=2;x=1;break;case "ion":case "maj":break;
case "loc":k-=5;x=6;break;case "lyd":k+=1;x=3;break;case "mix":--k;x=4;break;case "phr":k-=4,x=2}f||(c=c.replace(/\w+\s*/,""));0==c.indexOf("exp ")&&((c=c.replace(/\w+\s*/,""))||y(1,"No accidental after 'exp'"),h=!0);e=c[0];if("^"==e||"_"==e||"="==e){a.k_a_acc=[];f=new O;f.buffer=c;do{g=sb(f);if(!g)break;a.k_a_acc.push(g);for(e=c[f.index];" "==e;)e=c[++f.index]}while("^"==e||"_"==e||"="==e);if(!h){var E=k,v;e=[];g=[];if(0<E)for(h=0;h<E;h++)e[h]=1,g[h]=[26,23,27,24,21,25,22][h];else for(h=0;h<-E;h++)e[h]=
-1,g[h]=[22,25,21,24,20,23,26][h];var u=a.k_a_acc.length;for(E=0;E<u;E++){var p=a.k_a_acc[E];for(v=0;v<h;v++)if(g[v]==p.pit){e[v]=p.acc;break}v==h&&(e[v]=p.acc,g[v]=p.pit,h++)}for(E=0;E<h;E++)(p=a.k_a_acc[E])||(p=a.k_a_acc[E]={}),p.acc=e[E],p.pit=g[E]}c=c.slice(f.index)}else h&&0==c.indexOf("none")&&(k=0,c=c.replace(/\w+\s*/,""))}a.k_sf=k;if(a.k_a_acc)for(a.k_map=[],e=a.k_a_acc.length;0<=--e;)g=a.k_a_acc[e],a.k_map[(g.pit+19)%7]=g.acc;else a.k_map=abc2svg.keys[k+7];a.k_mode=x;a.k_b40=[1,24,7,30,13,
36,19,2,25,8,31,14,37,20,3][k+7];c=[a,ac(c)]}k=c[0];c=c[1];switch(t.state){case 1:void 0!=k.k_sf||k.k_a_acc||(k.k_sf=0,k.k_none=!0,k.k_map=abc2svg.keys[7]);for(d=0;d<F.length;d++)l=F[d],l.key=A(k),l.okey=A(k),l.ckey=A(k);t.ckey=k;c.length&&Fc("*",c);na.ulen||(na.ulen=n.BLEN/8);t.state=2;break a;case 2:Ea(!0)}c.length&&hc(c);m.ckey.k_bagpipe||m.ckey.k_drum||void 0==r.transp&&void 0==m.transp&&void 0==m.shift||(d=(r.transp||0)+(m.transp||0)+(m.shift||0));if(void 0!=m.sndtran||void 0!=m.sndsh)l=(m.sndtran||
0)+(m.sndsh||0);if(void 0==k.k_sf){if(!k.k_a_acc&&void 0==d){if(void 0==l)break a;k.invis=!0}k.k_sf=m.okey.k_sf}m.okey=A(k);void 0!=d&&(m.vtransp=d,k.k_transp=d);void 0!=l&&(k.k_sndtran=l);k.k_old_sf=m.ckey.k_sf;k.k_a_acc&&k.k_a_acc.length||k.k_sf||k.k_old_sf||(k.invis=!0);k.k_b40||(k.k_b40=m.ckey.k_b40);m.ckey=k;pc()?(m.key=A(k),k.k_none&&(m.key.k_sf=0)):Ba(k)}break;case "N":case "R":M[a]=M[a]?M[a]+("\n"+c):c;break;case "r":if(!q.keep_remark||3!=t.state)break;d={type:n.REMARK,text:c,dur:0};Ba(d);
break;default:y(0,"'$1:' line ignored",a)}}function Sd(){var a,c=t.line,d={type:n.BAR,fname:t.fname,istart:t.bol+c.index,dur:0,multi:0};Y.length&&"dot"==Y[Y.length-1]&&(d.bar_dotted=!0,Y.pop());sa&&sa.bar&&Pb("|");na.new_nbar&&(d.bar_num=na.new_nbar,na.new_nbar=0);for(a=c.char();;){var e=c.next_char();switch(e){case "|":case "[":case "]":case ":":a+=e;continue}break}":"==a[0]&&(":"==a?(a="|",d.bar_dotted=!0):d.rbstop=2);Ua&&qc(d);Y.length&&(Db(Y,d),Y=[]);if(t.ottava.length){var g=d;m.cst!=m.st&&(g=
{type:n.SPACE,fname:t.fname,istart:t.bol+c.index,dur:0,multi:0,invis:!0,width:1},Ba(g));g.ottava=t.ottava;t.ottava=[]}"["!=a.slice(-1)||/[0-9" ]/.test(e)||(a=a.slice(0,-1),c.index--,e="[");":"==a.slice(-1)&&(d.rbstop=2);if("0"<e&&"9">=e){for(d.text=e;;){e=c.next_char();if(0>"0123456789,.-".indexOf(e))break;d.text+=e}d.rbstop=2;d.rbstart=2}else if('"'==e&&"["==a.slice(-1)){for(d.text="";;){e=c.next_char();if(!e){y(1,"No end of repeat string");return}if('"'==e){c.index++;break}d.text+=e}d.rbstop=2;
d.rbstart=2}"]"==a[0]&&(d.rbstop=2,1!=a.length?a=a.slice(1):d.invis=!0);d.iend=t.bol+c.index;d.rbstart&&m.norepbra&&!m.second&&(d.norepbra=!0);if(d.text)if("["==a.slice(-1)&&"["!=a&&(a=a.slice(0,-1)),"1"==d.text[0])m.tie_s&&(m.tie_s_rep=m.tie_s),m.acc_tie?m.acc_tie_rep=m.acc_tie.slice():m.acc_tie_rep&&(m.acc_tie_rep=null);else{if(m.tie_s_rep)for(m.tie_s=A(m.tie_s_rep),m.tie_s.notes=A(m.tie_s.notes),g=0;g<=m.tie_s.nhd;g++)m.tie_s.notes[g]=A(m.tie_s.notes[g]),m.tie_s.notes[g].s=m.tie_s;m.acc_tie_rep&&
(m.acc_tie=m.acc_tie_rep.slice())}if(0>m.ulen&&(g=m.last_sym)&&g.type!=n.MREST&&g.type!=n.BAR){for(;g.type!=n.BAR&&g.prev;)g=g.prev;e=g.time;var f=m.time-e;c=m.wmeasure/f;if(0==e){for(;g&&!g.dur;)g=g.next;g&&g.type==n.REST&&g.invis&&(e+=g.dur*c,g.prev?g.prev.next=g.next:m.sym=g.next,g.next&&(g.next.prev=g.prev),g=g.next)}if(m.wmeasure!=f){for(;g;g=g.next)if(g.time=e,g.dur&&!g.grace&&(g.dur*=c,g.dur_orig*=c,e+=g.dur,g.type==n.NOTE||g.type==n.REST))for(f=0;f<=g.nhd;f++)g.notes[f].dur*=c;m.time=d.time=
e}}if(("["==a||"|:"==a)&&!m.eoln&&(g=m.last_sym)&&g.time==m.time&&g&&g.type==n.BAR){if("["==a&&!g.text&&(0==m.st||K.staves[m.st-1].flags&64||d.norepbra)){d.text&&(g.text=d.text);d.a_gch&&(g.a_gch=d.a_gch);d.norepbra&&(g.norepbra=d.norepbra);d.rbstart&&(g.rbstart=d.rbstart);d.rbstop&&(g.rbstop=d.rbstop);return}if(g.st==m.st&&"|:"==a){if(":|"==g.bar_type){g.bar_type="::";g.rbstop=2;return}if("||"==g.bar_type){g.bar_type="||:";g.rbstop=2;return}}}switch(a){case "[":d.rbstop=2;case "[]":case "[|]":d.invis=
!0;a="[]";break;case ":|:":case ":||:":a="::";break;case "||":if("2.2"<=r["abc-version"])break;case "[|":case "|]":d.rbstop=2}d.bar_type=a;m.lyric_restart||(m.lyric_restart=d);m.sym_restart||(m.sym_restart=d);Ba(d);d.st=m.st;d.rbstart&&!m.norepbra&&0<m.st&&!(K.staves[m.st-1].flags&64)&&(g={type:n.BAR,fname:d.fname,istart:d.istart,iend:d.iend,bar_type:"[",multi:0,invis:!0,text:d.text,rbstart:2},Ba(g),g.st=m.st,delete d.text,d.rbstart=0);d.bar_dotted||d.invis||(m.acc=[])}function ac(a){if(!a)return[];
a=a.match(/[^\s"=]+=?|"[^"]+"/g);return a?a:(y(1,"Unterminated string"),[])}function rc(a){Uc.lastIndex=a.index;var c=Uc.exec(a.buffer);if(!c[0])return[1,1];var d=c[1]||1;var e=c[3]||1;c[3]||(e*=1<<c[2].length);a.index=Uc.lastIndex;return[d,e]}function sb(a){var c=a.char();switch(c){case "^":c=a.next_char();if("^"==c){var d=2;c=a.next_char()}else d=1;break;case "=":d=3;c=a.next_char();break;case "_":c=a.next_char(),"_"==c?(d=-2,c=a.next_char()):d=-1}if(1==d||-1==d)if("1"<=c&&"9">=c||"/"==c){var e=
rc(a);0>d&&(e[0]=-e[0]);r.nedo&&1==e[1]&&(e[0]*=12,e[1]*=r.nedo);d=e;c=a.char()}e=Mb.indexOf(c)+16;c=a.next_char();if(16>e)y(1,"'$1' is not a note",a.buffer[a.index-1]);else{for(;"'"==c;)e+=7,c=a.next_char();for(;","==c;)e-=7,c=a.next_char();a={pit:e,shhd:0,shac:0};d&&(a.acc=d);return a}}function sc(){var a=t.line,c=0;Y.length&&"dot"==Y[Y.length-1]&&(c=n.SL_DOTTED,Y.pop());switch(a.next_char()){case "'":return a.index++,c+n.SL_ABOVE;case ",":return a.index++,c+n.SL_BELOW}return c+n.SL_AUTO}function Vc(a,
c){var d;for(d=m.sls.length;0<=--d;){var e=m.sls[d];var g=e.note;var f=e.is_note;delete e.is_note;if(g.s!=a.s){e.note=a;c&&(e.is_note=c);var h=f?g:g.s;h.sls||(h.sls=[]);h.sls.push(e);m.sls.splice(d,1);f&&(g.s.sl1=!0);e.grace&&(e.grace.sl1=!0);a.s.grace&&(a.s.sl2=!0);return}}if(a.grace)v(1,a.s,H.bad_slur_end);else{for(h=a.s.prev;h;h=h.prev)if(h.type==n.BAR&&":"==h.bar_type[0]&&h.text){h.sls||(h.sls=[]);h.sls.push({note:a,ty:n.SL_AUTO});c&&(h.sls[h.sls.length-1].is_note=c);return}y(1,"End of slur without start")}}
function Td(a,c){var d=[0,2,4,5,7,9,11][a%7],e=12*(a/7|0);m.snd_oct&&(e+=m.snd_oct);3==c&&(c=0);if(c)if("object"==typeof c){var g=c[0]/c[1];if(100==c[1])return d+e+g}else g=c;else return r.temper?r.temper[abc2svg.p_b40[a%7]]+e:d+e;if(r.nedo){if("object"!=typeof c)return a=abc2svg.p_b40[a%7]+c,r.temper[a]+e;if(c[1]==r.nedo)return a=abc2svg.p_b40[a%7],r.temper[a]+e+g}else if(!r.temper)return d+(e+g);c=r.temper[abc2svg.p_b40[a%7]];0<g?(a=r.temper[(abc2svg.p_b40[a%7]+1)%40],a<c&&(a+=12)):(a=r.temper[(abc2svg.p_b40[a%
7]+39)%40],a>c&&(a-=12),g=-g);return c+e+(a-c)*g}function jd(a,c){var d,e;for(e=0;e<=a.nhd;e++){var g=a.notes[e];var f=g.midi;if(c.type!=n.GRACE)for(d=0;d<=c.nhd;d++){if(c.notes[d].tie_ty&&c.notes[d].midi==f){c.notes[d].tie_n=g;g.s=a;c.tie_s=a;break}}else for(d=c.extra;d;d=d.next)if(d.notes[0].tie_ty&&d.notes[0].midi==f){d.tie_s=a;d.notes[0].tie_n=g;g.s=a;d.notes[0].s=d;c.tie_s=a;break}}c.tie_s?c.time+c.dur!=(a.time||m.time)&&(a.ti2=c):v(1,c,"Bad tie")}function Fd(){function a(a){for(var c=Mb[a];0>
a;)a+=7,c+=",";for(;14<a;)a-=7,c+="'";return c}function c(c,d){var e,f="",g=c.length;for(e=0;e<g;e++){var h=c[e];f="h"<=h&&"z">=h?f+a(d+h.charCodeAt(0)-110):f+h}return f}function d(u){for(var p,C,v,z;;){p=E.char();if(!p)break;if(m.ignore)for(;"["!=p||"V"!=E.buffer[E.index+1]||":"!=E.buffer[E.index+2];)if(p=E.next_char(),!p)return;if(!u&&ic[p]){z=0;for(v in eb)if(eb.hasOwnProperty(v)&&v[0]==p){if(0>v.indexOf("n")){if(E.buffer.indexOf(v,E.index)!=E.index)continue;E.index+=v.length}else{a:{C=void 0;
var A=v;var Q=1;for(z=E.index+1;Q<A.length;Q++,z++)if(A[Q]!=E.buffer[z]){if("n"!=A[Q]){z=void 0;break a}C=Mb.indexOf(E.buffer[z]);if(0>C){z=void 0;break a}for(;"'"==E.buffer[z+1];)C+=7,z++;for(;","==E.buffer[z+1];)C-=7,z++}E.index=z;z=C}if(!z)continue}var B=v;C=eb[v];Q=E;A=t.istart;t.line=E=new O;t.istart+=Q.index;if(0>r.writefields.indexOf("m")){E.buffer=B.replace("n",a(z));B=m.last_sym;var F=m.time;d(!0);B||(B=m.sym);for(B=B.next;B;B=B.next)B.noplay=!0;var D=m.time;var G=m;m=Ud(G.id+"-p");K.voices[m.v]||
(m.second=!0,K.voices[m.v]={st:G.st,second:!0,range:m.v});m.time=F;B=m.last_sym;t.line=E=new O;t.istart+=Q.index;E.buffer=z?c(C,z):C;d(!0);m.time!=D&&y(1,"Bad length of the macro sequence");B||(B=m.sym);for(;B;B=B.next)B.invis=B.play=!0;m=G}else E.buffer=z?c(C,z):C,d(!0);t.line=E=Q;t.istart=A;z=1;break}if(z)continue}C=p.charCodeAt(0);if(128<=C){y(1,H.not_ascii);E.index++;break}C=Ia[C];switch(C[0]){case " ":if(z=m.last_note)z.beam_end=!0,e&&(e.gr_shift=!0);break;case "\n":if(r.barsperstaff)break;m.eoln=
!0;break;case "&":if(e){y(1,H.bad_grace);break}p=E.next_char();if(")"==p){Pb(")");break}Pb("&");continue;case "(":p=E.next_char();if("0"<p&&"9">=p){if(e){y(1,H.bad_grace);break}C=E.get_int();z=tf[C];Q=C;p=E.char();if(":"==p&&(p=E.next_char(),"0"<p&&"9">=p&&(z=E.get_int(),p=E.char()),":"==p))if(p=E.next_char(),"0"<p&&"9">=p)Q=E.get_int(),E.char();else{y(1,"Invalid 'r' in tuplet");continue}if(0==z||void 0==z)z=0==m.wmeasure%9?3:2;0>k&&(k=l.length);p=r.tuplets;if(m.pos.tup)switch(p=Object.create(p),
m.pos.tup){case n.SL_ABOVE:p[3]=1;break;case n.SL_BELOW:p[3]=2;break;case n.SL_HIDDEN:p[2]=1}l.push({p:C,q:z,r:Q,ro:Q,f:p});continue}if("&"==p){if(e){y(1,H.bad_grace);break}Pb("(");break}E.index--;x.push(sc());continue;case ")":if(z=m.last_sym)switch(z.type){case n.SPACE:z.notes||(z.notes=[],z.notes[0]={});case n.NOTE:case n.REST:break;case n.GRACE:for(z=z.extra;z.next;z=z.next);break;default:z=null}if(!z){y(1,H.bad_char,p);break}z.notes[0].s=z;Vc(z.notes[0]);break;case "!":if(1<C.length)z=C.slice(1,
-1);else{z="";for(C=E.index;;){p=E.next_char();if(!p)break;if("!"==p)break;z+=p}if(!p){E.index=C;y(1,"No end of decoration");break}}void 0!=Vd[z]?(na.ottava=!0,t.ottava.push(Vd[z])):Y.push(z);break;case '"':if(e){y(1,H.bad_grace);break}Wd(C);break;case "[":if(1<C.length){W.do_pscom(C.slice(3,-1));break}z=E.buffer[E.index+1];if(0<='|[]: "'.indexOf(z)||"1"<=z&&"9">=z){if(e){y(1,H.bar_grace);break}Sd();continue}if(":"==E.buffer[E.index+2]){if(e){y(1,H.bad_grace);break}C=E.buffer.indexOf("]",E.index+
1);if(0>C){y(1,"Lack of ']'");break}p=E.buffer.slice(E.index+3,C).trim();t.istart=t.bol+E.index;t.iend=t.bol+ ++C;E.index=0;Jc(z,p);E.index=C;continue}case "n":z=W.new_note(e,x);if(!z)continue;if(e||!z.notes)continue;if(0<=k)z.tp=l.slice(k),k=-1,q&&(z.tp[0].s=q),q=z;else if(!q)continue;v=l[l.length-1];if(0<--v.r)continue;for(;;){p=q;C=v.q/v.p;z=p.time;for(m.time=z+(m.time-z)*C;;){p.in_tuplet=!0;p.grace||(p.time=z,p.dur&&(p.dur*=C,z+=p.dur));if(!p.next){p.tpe?p.tpe++:p.tpe=1;break}p=p.next}C=v.ro;
v.s&&(q=v.s);l.pop();if(!l.length){q=null;break}v=l[l.length-1];v.r-=C;if(0<v.r)break}continue;case "<":if(!m.last_note){y(1,"No note before '<'");break}if(e){y(1,"Cannot have a broken rhythm in grace notes");break}for(z="<"==p?1:-1;"<"==p||">"==p;)z*=2,p=E.next_char();m.brk_rhythm=z;continue;case "i":break;case "{":if(e){y(1,"'{' in grace note");break}g=m.last_note;m.last_note=null;f=Y;Y=[];e={type:n.GRACE,fname:t.fname,istart:t.bol+E.index,dur:0,multi:0};switch(m.pos.gst){case n.SL_ABOVE:e.stem=
1;break;case n.SL_BELOW:e.stem=-1;break;case n.SL_HIDDEN:e.stem=2}Ba(e);p=E.next_char();if("/"==p){e.sappo=!0;break}continue;case "|":if(e){y(1,H.bar_grace);break}Sd();continue;case "}":z=m.last_note;if(!e||!z){y(1,H.bad_char,p);break}Y.length&&y(1,"Decoration ignored");e.extra=e.next;e.extra.prev=null;e.next=null;m.last_sym=e;e=null;if(!z.prev&&!m.ckey.k_bagpipe){for(C=0;C<=z.nhd;C++)z.notes[C].dur*=2;z.dur*=2;z.dur_orig*=2}m.last_note=g;Y=f;break;case "\\":if(!E.buffer[E.index+1]){h=!0;break}default:y(1,
H.bad_char,p)}E.index++}}var e,g,f,h,l=[],k=-1,x=[],E=t.line;if(3!=t.state){if(2!=t.state)return;Ea()}if(t.tp){l=t.tp;k=t.tpn;var q=t.tps;t.tp=null}d();l.length&&(t.tp=l,t.tps=q,t.tpn=k);x.length&&y(1,"Start of slur without note");e&&(y(1,"No end of grace note sequence"),m.last_sym=e.prev,m.last_note=g,e.prev&&(e.prev.next=null));r.breakoneoln&&m.last_note&&(m.last_note.beam_end=!0);h||r.barsperstaff||"\n"!=Ia[10]||(m.eoln=!0)}function Wc(a){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;
a=97}return Xd[a]}function Tb(a){return Wc(a)*J.curfont.swfac}function tb(a){if("object"==typeof a)return a;var c,d=J.curfont,e=d;var g=a.replace(/<|>|&[^&]*?;|&|  |\$./g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case "  ":return" \u00a0";default:if("$"==a[0]){if("0"==a[1])c=J.deffont;else if("1"<=a[1]&&"9">=a[1])c=Ja("u"+a[1]);else break;a="";if(c!=e&&(e!=d&&(a="</tspan>"),e=c,e!=d)){var f=e.class&&e.name==d.name&&e.size==d.size&&e.weight==d.weight&&
e.style==d.style?e.class:qb(e);return a+('<tspan\n\tclass="'+f+'">')}}}return a});e!=d&&(g+="</tspan>",J.curfont=e);g=new String(g);"undefined"!=typeof document?va(g):g.wh=va(a);return g}function ba(a){"string"==typeof a&&(a=Ja(a));Xd="sans"==a.name.slice(0,4)?uf:Yd;J.curfont=J.deffont=a}function la(a,c,d,e,g,f){f||(f=d.wh||va(d));G+='<text class="'+qb(J.curfont);"j"!=e&&5<d.length&&J.curfont.wadj&&(G+='" lengthAdjust="'+J.curfont.wadj+'" textLength="'+f[0].toFixed(1));G+='" x="';Ra(a,'" y="',c+.2*
f[1]);switch(e){case "c":G+='" text-anchor="middle">';break;case "j":G+='" textLength="'+g.toFixed(1)+'">';break;case "r":G+='" text-anchor="end">';break;default:G+='">'}G+=tb(d);G+="</text>\n"}function Zd(a,c){if(r.titletrim){var d=a.lastIndexOf(", ");if(0>d||"A">a[d+2]||"Z"<a[d+2])d=0;else if(1==r.titletrim){if(d<a.length-7||0<=a.indexOf(" ",d+3))d=0}else d<a.length-r.titletrim-2&&(d=0);d&&(a=a.slice(d+2).trim()+" "+a.slice(0,d))}!c&&0<=r.writefields.indexOf("X")&&(a=M.X+".  "+a);return r.titlecaps?
a.toUpperCase():a}function Wb(){return(ha.width-ha.lm-ha.rm-2)/r.scale}function Xc(a,c){if(a){Ha();a=Zd(a,c);c?(ba("subtitle"),c=r.subtitlespace):(ba("title"),c=r.titlespace);var d=va(a);d[1]+=2*J.curfont.pad;ma(d[1]+c+J.curfont.pad);c=J.curfont.pad;r.titleleft?la(0,c,a,null,null,d):la(Wb()/2,c,a,"c",null,d)}}function $d(a,c,d,e,g){if(!d){if(!e)return;d=e;e=null}e?la(a,c,d+" ("+e+")",g):la(a,c,d,g)}function tc(a,c){if("s"!=c){Ha();var d=Wb(),e=J.curfont.size,g=e*r.lineskipfac;e*=r.parskipfac;var f,
h;switch(c){default:var l=J.curfont;switch(c){case "c":d/=2;break;case "r":d-=l.pad;break;default:d=l.pad}for(f=0;;){var k=a.indexOf("\n",f);if(0>k){var n=tb(a.slice(f));ma(n.wh[1]*r.lineskipfac+2*l.pad);la(d,l.pad,n,c);break}if(k==f){ma(e);db();for(kb(J.curfont);"\n"==a[k+1];)ma(g),k++;if(k==a.length)break}else n=tb(a.slice(f,k)),ma(n.wh[1]*r.lineskipfac+2*l.pad),la(d,l.pad,n,c);f=k+1}ma(e);db();break;case "f":case "j":for(f=0;;){k=a.indexOf("\n\n",f);l=0>k?a.slice(f):a.slice(f,k);l=l.split(/\s+/);
for(f=n=h=0;f<l.length;f++){var m=va(l[f])[0];n+=m;n>=d&&(n=tb(l.slice(h,f).join(" ")),ma(n.wh[1]*r.lineskipfac),la(0,0,n,c,d),h=f,n=m);n+=Tb(" ")}0!=n&&(n=tb(l.slice(h).join(" ")),ma(n.wh[1]*r.lineskipfac),la(0,0,n));ma(e);db();if(0>k)break;for(;"\n"==a[k+2];)ma(g),k++;if(k==a.length)break;kb(J.curfont);f=k+2}}}}function df(a){function c(a,c){var d=0;"$"==a[d]&&"0"<=a[d+1]&&"9">=a[d+1]&&(d+=2);var e=0;var f=d;if("0"<=a[d]&&"9">=a[d]||"."==a[d+1]){for(;d<a.length&&(d++," "!=a[d]&&":"!=a[d-1]&&"."!=
a[d-1]););for(e=d;" "==a[d];)d++}0!=e&&la(c,0,a.slice(f,e),"r");d<a.length&&la(c+5,0,a.slice(d),"l")}var d,e;var g=0;var f=1;ba("words");ma(r.wordsspace);ub();a=a.split("\n");var h=a.length;for(d=0;d<h;d++){var l=a[d];if(!l){for(;d+1<h&&!a[d+1];)d++;f++}else if(l.length>g){g=l.length;var k=d}}g=Wb()/2;var n=va(a[k])[0];k=e=0;if(n<g){var m=f>>1;for(d=0;d<h;d++)if(l=a[d],!l){for(0>=--m&&(k=d);d+1<h&&!a[d+1];)d++;if(0>=m){e=d+1;break}}f>>=1}if(e){var t=(g-n)/2+10;m=t+g}else m=g-n/2+10;var u=!0;for(d=
0;d<k||e<h;d++,e++)ma(r.lineskipfac*J.curfont.size),d<k&&((l=a[d])?c(l,t):kb(J.curfont)),e<h&&((l=a[e])?c(l,m):0==--f&&(d<k?f++:e<h-1&&(m=g-n/2+10,ub()))),a[d+1]||a[e+1]?u=!0:u&&(ub(),u=!1)}function Bc(a){return a.replace(/[Cco]\||[co]\.|./g,function(a){return Ac["mtr"+a].c})}function ae(a){var c,d;if(!Yc[a])if(Yc[a]=!0,d=bb[a]){for(c=0;;){a=d.indexOf('xlink:href="#',c);if(0>a)break;a+=13;c=d.indexOf('"',a);ae(d.slice(a,c))}uc+="\n"+d}else v(1,null,"Unknown glyph: '$1'",a)}function be(a){var c=0;
for(a=a.replace(/\x3c!--.*?--\x3e/g,"");;){var d=a.indexOf("<",c);if(0>d)break;var e=a.indexOf('id="',d);if(0>e)break;e+=4;c=a.indexOf('"',e);if(0>c)break;var g=a.slice(e,c);c=a.indexOf(">",c);if(0>c)break;if("/"==a[c-1])c++;else{e=a.indexOf(" ",d);if(0>e)break;e=a.slice(d+1,e);c=a.indexOf("</"+e+">",c);if(0>c)break;c+=3+e.length}"<filter"==a.substr(d,7)?Zc+=a.slice(d,c)+"\n":bb[g]=a.slice(d,c)}}function $c(){I.started&&(I.started=!1,jb(),G+="</g>\n");if(1!=I.scale||I.color)jb(),G+="<g ",1!=I.scale&&
(G=0>I.st?G+F[I.v].scale_str:0>I.v?G+B[I.st].scale_str:G+('transform="translate(0,'+(fa-I.dy).toFixed(1)+") scale("+I.scale.toFixed(2)+')"')),I.color&&(1!=I.scale&&(G+=" "),G+='color="'+I.color+'" fill="'+I.color+'"'),G+=">\n",I.started=!0}function qa(a){if(a!=I.color){var c=I.color;I.color=a;$c();return c}}function ra(a){a!=I.st&&1!=I.scale&&(I.scale=0);var c=0<=a?B[a].staffscale:1;var d=0<=a&&1!=c?B[a].y:fa;if(c!=I.scale||d!=I.dy)I.scale=c,I.dy=d,I.st=a,I.v=-1,$c()}function Qa(a){var c=a.p_v.scale;
if(1==c)ra(a.st);else{var d=fa;1!=B[a.st].staffscale&&(c*=B[a.st].staffscale,d=B[a.st].y);if(c!=I.scale||I.dy!=fa)I.scale=c,I.dy=d,I.st=1==B[a.st].staffscale?-1:a.st,I.v=a.v,$c()}}function Ma(a,c){G&&(0>I.st?B[0].output+=G:1==I.scale?B[I.st].output+=G:B[I.st].sc_out+=G,G="");I.scale=0>a?1:c?1:B[a].staffscale;I.st=a;I.dy=0}function ce(a,c,d){if(void 0!=a.istart){var e=a.type,g=a.ymx-a.ymn+4,f=a.wl||2,h=a.wr||2;a.grace&&(e=n.GRACE);d(c||abc2svg.sym_name[e],a.istart,a.iend,a.x-f-2,B[a.st].y+a.ymn+g-
2,f+h+4,g,a)}}function vf(a,c){ce(a,c,q.anno_start)}function wf(a,c){ce(a,c,q.anno_stop)}function vc(){}function $e(){for(var a;;){a=mb.shift();if(!a)break;switch(a.type){case n.CLEF:case n.METER:case n.KEY:case n.REST:if(a.type!=n.REST||a.rep_nb){ra(a.st);break}case n.GRACE:case n.NOTE:case n.MREST:Qa(a)}Oa(a)}}function da(a,c,d,e,g){c=pb(c);d=Gb(d);G+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(1);case "Y":return d.toFixed(1);case "A":return e;case "B":return g;case "F":return e.toFixed(1);
default:return g.toFixed(1)}})}function Kb(a,c,d,e,g){jb();da('<g transform="translate(X,Y',a,c);d&&(G+=") rotate("+d.toFixed(2));e&&(G=g?G+(") scale("+e.toFixed(2)+", "+g.toFixed(2)):G+(") scale("+e.toFixed(2)));G+=')">\n';I.g++}function Fb(){jb();I.g--;G+="</g>\n"}function pb(a){return I.g?a:(a+Ub)/I.scale}function Gb(a){return I.g?-a:1==I.scale?fa-a:0<=I.v?(I.dy-a)/F[I.v].scale:I.dy-a}function Ra(a,c,d){a=pb(a);d=Gb(d);G+=a.toFixed(1)+c+d.toFixed(1)}function Eb(a,c,d){d?da('<path d="mX Y',a,c):
da('<path class="stroke" d="mX Y',a,c)}function jb(){var a=[];if(Fa[0].length){for(;;){var c=Fa[0].shift();if(void 0==c)break;a.push(c.toFixed(1))}G+='<text x="'+a.join(",");for(a=[];;){c=Fa[1].shift();if(void 0==c)break;a.push(c.toFixed(1))}G+='"\ny="'+a.join(",");G+='"\n>'+Fa[2]+"</text>\n";Fa[2]=""}if(Fa[3].length){for(G+='<path class="sW" d="';;){c=Fa[3].shift();if(void 0==c)break;G+="M"+c.toFixed(1)+" "+Fa[3].shift().toFixed(1)+"v"+Fa[3].shift().toFixed(1)}G+='"/>\n'}}function Z(a,c,d){if(bb[d])ae(d),
da('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,d);else{var e=Ac[d];e?(a+=e.x*I.scale,c-=e.y,e.sc?da('<text transform="translate(X,Y) scale(A)">B</text>\n',a,c,e.sc,e.c):(Fa[0].push(pb(a)),Fa[1].push(Gb(c)),Fa[2]+=e.c)):v(1,null,"no definition of $1",d)}}function de(a,c,d){var e=25+3*(d/20|0);var g=15<d?(d-15)/e|0:0;da('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',a+(d-e*g-5)/2,c+6,Math.round((e-5)/I.scale),e*g+5)}function Dc(a,c,d,e,g,f){var h=e?2.3:3.5,l=-d;
0>d&&(h=-h);a+=h*I.scale;0<=I.v&&(l/=F[I.v].scale);Fa[3].push(pb(a));Fa[3].push(Gb(c));Fa[3].push(l);if(g){c+=d;if(0<d)if(f)if(G+='<path d="',e)for(;0<=--g;)da("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(;0<=--g;)da("MX Yl7 3.2 0 3.2 -7 -3.2z\n",a,c),c-=5.4;else if(e)if(G+='<path d="',1==g)da("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",a,c);else for(;0<=--g;)da("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",a,c),c-=3.5;else{Z(a,c,"flu"+g);return}else if(f){if(G+='<path d="',
!e)for(;0<=--g;)da("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4}else if(e)if(G+='<path d="',1==g)da("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--g;)da("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",a,c),c+=3.5;else{Z(a,c,"fld"+g);return}G+='"/>\n'}}function ad(a,c,d){da('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',a,c+3,d)}function ee(a,c,d,e){var g=xf[d];g?(a+=g.dx,c+=g.dy,g.def||(vb+="\n."+d+" {"+g.style+"}",g.def=!0),da('<text x="X" y="Y" class="A"B>',
a,c,d,g.anchor||""),ba("annotation"),G+=tb(e),G+="</text>\n"):Z(a,c,d)}function fe(a,c,d){Kb(a,c,270);a=0;for(d=Math.ceil(d/6);0<=--d;)Z(a,6,"ltr"),a+=6;Fb()}function ge(a,c,d){c+=4;for(d=Math.ceil(d/6);0<=--d;)Z(a,c,"ltr"),a+=6}function bd(a,c,d,e,g){if(he[d])he[d](a,c,e,g);else v(1,null,"No function for decoration '$1'",d)}function ie(a,c){c=ec(a,c);switch(c[0]){case n.OVAL:a="\ueca2";break;case n.EMPTY:a="\ueca3";break;default:switch(c[2]){case 2:a="\ueca9";break;case 1:a="\ueca7";break;default:a=
"\ueca5"}}c[1]&&(a+='<tspan dx=".1em">\uecb7</tspan>');return a}function je(a){var c,d=0,e=[];if(!a.tempo_str){r.musicfont.used||Ja("music");ba("tempo");a.tempo_str1&&(e.push(a.tempo_str1),d+=va(a.tempo_str1)[0]);if(a.tempo_notes){var g=' dy="-.05em"';for(c=0;c<a.tempo_notes.length;c++){var f=ie(a,a.tempo_notes[c]);e.push('<tspan\nclass="'+qb(r.musicfont)+'" style="font-size:'+(1.3*J.curfont.size).toFixed(1)+'px"'+g+">"+f+"</tspan>");f=1<f.length?2:1;d+=f*J.curfont.swfac;g=""}e.push('<tspan dy=".065em">=</tspan>');
d+=Tb("=");a.tempo_ca&&(e.push(a.tempo_ca),d+=va(a.tempo_ca)[0]);a.tempo?(e.push(a.tempo),d+=va(a.tempo.toString())[0]):(f=ie(a,a.new_beat),e.push('<tspan\nclass="'+qb(r.musicfont)+'" style="font-size:'+(1.3*J.curfont.size).toFixed(1)+'px" dy="-.05em">'+f+"</tspan>"),f=1<f.length?2:1,d+=f*J.curfont.swfac,g="y")}a.tempo_str2&&(g?e.push('<tspan\n\tdy=".065em">'+a.tempo_str2+"</tspan>"):e.push(a.tempo_str2),d+=va(a.tempo_str2)[0]);a.tempo_str=e.join(" ");d+=Tb(" ")*(e.length-1);a.tempo_wh=[d,13];g&&
(a.tempo_dy=g)}}function td(a,c,d){ba("tempo");if(J.curfont.box){J.curfont.box=!1;var e=c}G+='<text class="'+qb(J.curfont)+'" x="';Ra(c,'" y="',d+.2*J.curfont.size);G+='">'+a.tempo_str+"</text>\n";e&&(J.curfont.box=!0,bh=J.curfont.size+4,G+='<rect class="stroke" x="',Ra(e-2,'" y="',d+bh-1),G+='" width="'+(a.tempo_wh[0]+2).toFixed(1)+'" height="'+bh.toFixed(1)+'"/>\n');a.invis=!0}function ma(a){fa+=a}function ub(){if(!T&&G&&q.img_out&&0!=fa){var a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="',
c="";jb();a=r.fgcolor?a+(r.fgcolor+'" fill="'+r.fgcolor+'"'):a+'black"';a+=' stroke-width=".7"';r.bgcolor&&(a+=' style="background-color: '+r.bgcolor+'"');var d=Ja("music");a+=' class="'+qb(d)+" tune"+Ic.length+'"\n';fa*=r.scale;a=q.imagesize?a+(q.imagesize+' viewBox="0 0 '+ha.width.toFixed(0)+" "+fa.toFixed(0)+'">\n'):a+(' viewBox="0 0 '+ha.width.toFixed(0)+" "+fa.toFixed(0)+'" width="'+ha.width.toFixed(0)+'px" height="'+fa.toFixed(0)+'px">\n');a+=Zc;if(vb||wb)a+="<style>\n."+qb(d)+" text,tspan{fill:currentColor}"+
wb+vb+"\n</style>\n";uc&&(a+="<defs>"+uc+"\n</defs>\n");1!=r.scale&&(a+='<g class="g" transform="scale('+r.scale.toFixed(2)+')">\n',c="</g>\n");ke&&ke.ps_flush(!0);0<Da&&(q.img_out(1==Da?'<div class="nobrk">':'<div class="nobrk newpage">'),Da=-1);q.img_out(a+G+c+"</svg>");wb=G="";if(r.fullsvg&&"undefined"==typeof document)for(Yc={},d=0;d<Ya.length;d++)Ya[d].used=!1;else Zc=vb="";uc="";fa=0}}function db(){ub();0>Da&&(!t.state||r.splittune)&&(q.img_out("</div>"),Da=0)}function yf(){function a(a,c){c=
new RegExp(c);if(c.test(m.id)||c.test(m.nm))for(c=0;c<a.length;c++)W.do_pscom(a[c])}var c;if(t.voice_opts)for(c in t.voice_opts)t.voice_opts.hasOwnProperty(c)&&a(t.voice_opts[c],c);if(t.tune_v_opts)for(c in t.tune_v_opts)t.tune_v_opts.hasOwnProperty(c)&&a(t.tune_v_opts[c],c)}function Ba(a){a.fname||$b(a);t.last_sym=a;(a.prev=m.last_sym)?m.last_sym.next=a:m.sym=a;m.last_sym=a;a.v=m.v;a.p_v=m;a.st=m.cst;a.time=m.time;a.dur&&!a.grace&&(m.time+=a.dur);a.pos=m.pos;m.second&&(a.second=!0);m.floating&&(a.floating=
!0);m.eoln&&(a.soln=!0,m.eoln=!1)}function Kd(a,c){c={type:c,dur:0};var d=m;m=a;Ba(c);m=d;a=c.prev;a||(a=c.next);a&&(c.fname=a.fname,c.istart=a.istart,c.iend=a.iend);return c}function Bd(a){var c,d;m&&m.clone&&(t.istart=t.eol,le());if((c=na.tempo)&&0>=Hb){var e=K.top_voice;var g=F[e];!g.sym||g.sym.type==n.TEMPO||g.sym.next&&g.sym.next.type==n.TEMPO||(c=A(c),c.v=e,c.p_v=g,c.st=g.st,c.time=0,c.prev=g.sym,c.next=g.sym.next,c.next&&(c.next.prev=c),g.sym.next=c)}for(e=0;e<F.length;e++){g=F[e];if(!a)for(delete g.eoln;;){var f=
g.sls.shift();if(!f)break;c=f.note.s;for(d=c.next;d&&(!d.bar_type||":"!=d.bar_type[0]);d=d.next);d?(c.sls||(c.sls=[]),c.sls.push({ty:f.ty,note:{s:d}})):y(1,"Lack of ending slur(s)")}for(c=g.sym;c&&!(c.time>=Hb);c=c.next);for(;c;c=c.next){switch(c.type){case n.GRACE:c.next&&c.next.type==n.BAR&&c.time--;if(!r.graceword)continue;for(d=c.next;d;d=d.next){switch(d.type){case n.SPACE:continue;case n.NOTE:d.a_ly&&(c.a_ly=d.a_ly,d.a_ly=null)}break}continue;case n.MREST:c.next&&c.next.type!=n.BAR&&(y(1,"Lack of bar after multi-measure rest"),
d=A(c),d.type=n.BAR,d.bar_type="|",d.dur=0,d.time=c.next.time,d.prev=c,d.next=c.next,d.next.prev=d,c.next=d);continue}if(c.feathered_beam){var h;var l=c;f=l.dur;var k=1;for(h=l;h&&!h.beam_end&&h.next;h=h.next)k++;if(1>=k)delete l.feathered_beam;else{var x=h;d=f/2;g=f/(k-1);var q=l.time;if(0<l.feathered_beam)for(h=l,l=k-1;h!=x;h=h.next,l--)f=(g*l|0)+d,h.dur=f,h.time=q,q+=f;else for(h=l,l=0;h!=x;h=h.next,l++)f=(g*l|0)+d,h.dur=f,h.time=q,q+=f;h.dur=h.time+h.dur-q;h.time=q}}}}}function me(a){var c={voices:[],
staves:[],top_voice:0};if(a)L=K=c;else{for(a=0;a<F.length;a++)if(K.voices[a]){var d=K.voices[a].st;d=K.staves[d];var e=F[a];d.staffnonote=e.staffnonote;e.staffscale&&(d.staffscale=e.staffscale)}for(d=0;d<K.staves.length;d++)c.staves[d]=A(K.staves[d]),c.staves[d].flags=0;K=K.next=c}}function ne(a,c){var d="";if(c&&3!=c)if("object"!=typeof c)d=["__","_","","^","^^"][c+2];else{var e=c[0];0<e?d+="^":(d+="_",e=-e);d+=e+"/"+c[1]}d+=Mb[(a+75)%7];for(e=a;21<=e;e-=7)d+="'";for(e=a;14>e;e+=7)d+=",";return d}
function wc(){var a;if(!m.ckey.k_bagpipe&&!m.ckey.k_drum){r.transp&&m.shift&&y(0,"Mix of old and new transposition syntaxes");if(void 0!=r.transp||void 0!=m.transp||void 0!=m.shift)var c=(r.transp||0)+(m.transp||0)+(m.shift||0);if(void 0!=m.sndtran||void 0!=m.sndsh)var d=(m.sndtran||0)+(m.sndsh||0);if(void 0==c){if(void 0==d)return}else m.vtransp=c;if(pc())m.key=a=A(m.okey);else for(a=m.last_sym;a.type!=n.KEY;)if(a=a.prev,!a){a=m.key;break}void 0!=c&&(a.k_transp=c);void 0!=d&&(a.k_sndtran=d);m.ckey=
A(a);m.key.k_none&&(a.k_sf=0)}}function Dd(a,c,d){var e=d.pit;var g=d.acc;!g&&c.k_a_acc&&(g=c.k_map[(e+19)%7]);e=abc2svg.pab40(e,g)+c.k_transp;d.pit=abc2svg.b40p(e);if(g||c.k_a_acc||c.k_none){e=abc2svg.b40a(e);if(g)c.k_a_acc&&(a=c.k_map[(d.pit+19)%7],a==e&&(e=0)),e||(e=3);else if(c.k_none){if(oe(a,d.pit))return}else if(c.k_a_acc){if(oe(a,d.pit))return;(a=c.k_map[(d.pit+19)%7])&&(e=3)}else return;d.acc=e}}function pe(a){if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){var c=parseInt(a);if(isNaN(c)||
-36>c||36<c)y(1,H.bad_transp);else return c+=36,40*((c/12|0)-3)+("b"==a.slice(-1)?abc2svg.ifb40:abc2svg.isb40)[c%12]}}function Cd(a){if(!a.k_a_acc&&!a.k_none){var c,d=(a.k_b40+200+a.k_transp)%40;if(c=abc2svg.b40k[d]-d)a.k_transp=0<a.k_transp?a.k_transp+c:a.k_transp-c,d+=c;a.k_b40=d;c=abc2svg.b40sf[d];a.k_old_sf=a.k_sf;a.k_sf=c;a.k_map=abc2svg.keys[c+7]}}function oe(a,c){var d,e=a.time;for(a=a.prev;a;a=a.prev)switch(a.type){case n.BAR:if(a.time<e)return;for(;;){a=a.prev;if(!a)return;if(a.type==n.NOTE){if(a.time+
a.dur==e)break;return}if(a.time<e)return}for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c&&a.notes[d].tie_ty)return a.notes[d].acc;return;case n.NOTE:for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c)return a.notes[d].acc}}function qe(a,c){var d,e,g;var f={};var h=[];var l=!1;var k=d=g=e=0,x=0,r=c.match(/[^[\]|{}()*+\s]+|[^\s]/g);if(r){for(;;){var q=r.shift();if(!q)break;switch(q){case "[":if(k||2<=g+d){y(1,H.misplaced,"[");l=!0;break}e|=0==g+d?4:1024;d++;x<<=8;x|=4;break;case "{":if(k||g||2<=d){y(1,H.misplaced,
"{");l=!0;break}e|=d?256:1;g++;x<<=8;x|=1;break;case "(":if(k){y(1,H.misplaced,"(");l=!0;break}e|=16;k++;x<<=8;x|=16;break;case "*":!g||k||e&257||(e|=128);break;case "+":e|=4096;break;case "]":case "}":case ")":y(1,"Bad voice ID in %%score");l=!0;break;default:for(c=q;;){q=r.shift();if(!q)break;switch(q){case "]":if(!(x&4)){y(1,H.misplaced,"]");l=!0;break}d--;e|=0==g+d?8:2048;x>>=8;continue;case "}":if(!(x&1)){y(1,H.misplaced,"}");l=!0;break}g--;e|=d?512:2;e&=-129;x>>=8;continue;case ")":if(!(x&16)){y(1,
H.misplaced,")");l=!0;break}k--;e|=32;x>>=8;continue;case "|":e|=64;continue}break}f[c]?y(1,"Double voice in %%score"):(f[c]=!0,h.push([c,e]));e=0;q&&r.unshift(q)}}0!=x&&(y(1,"'}', ')' or ']' missing in %%score"),l=!0);f=l||!h.length?void 0:h}else y(1,H.bad_val,"%%score"),f=void 0;if(f){F.length&&Bd(!0);g=0;l=!0;for(e=0;e<F.length;e++)h=F[e],h.time>g&&(g=h.time),h.sym&&(l=!1);if(l||0==g&&0>Hb)K.staves=[],K.voices=[];else{for(e=0;e<K.voices.length;e++)if(K.voices[e]){m=F[e];break}m.time=g;h={type:n.STAVES,
dur:0};Ba(h);K.nstaff=S;me();h.sy=K}Hb=g;for(e=0;e<F.length;e++)h=F[e],delete h.second,delete h.ignore,delete h.floating;for(l=d=0;l<f.length;l++)for(h=f[l][0],h=cd(h),h.time=g,e=h.v,f[l][0]=h;;){K.voices[e]={};K.voices[e].range=d++;h=h.voice_down;if(!h)break;e=h.v}K.top_voice=f[0][0].v;if("t"==a[1])for(l=0;l<f.length;l++)d=f[l][1],d&257&&3!=(d&3)&&768!=(d&768)&&0==f[l+1][1]&&!(d&16||f[l+2][1]&16)&&(f[l+2][1]&514?f[l+1][1]|=128:0==f[l+2][1]&&f[l+3][1]&514&&(f[l][1]|=16,f[l+1][1]|=32,f[l+2][1]|=16,
f[l+3][1]|=32));g=-1;for(l=0;l<f.length;l++)if(d=f[l][1],48==(d&48)&&(d&=-49,f[l][1]=d),h=f[l][0],d&128?(h.floating=!0,h.second=!0):(g++,K.staves[g]||(K.staves[g]={stafflines:h.stafflines||"|||||",staffscale:1}),K.staves[g].flags=0),e=h.v,h.st=h.cst=K.voices[e].st=g,K.staves[g].flags|=d,d&16){for(d=h;l<f.length-1&&!(h=f[++l][0],e=h.v,f[l][1]&4096?(d.second=!0,d=h):h.second=!0,h.st=h.cst=K.voices[e].st=g,f[l][1]&32););K.staves[g].flags|=f[l][1]}0>g&&(g=0);K.nstaff=S=g;if("c"==a[1])for(g=0;g<S;g++)K.staves[g].flags^=
64;for(e=0;e<F.length;e++)if(h=F[e],K.voices[e]){for(d=h.voice_down;d;)l=d.v,d.st=d.cst=K.voices[l].st=g,d=d.voice_down;K.voices[e].second=h.second;g=h.st;!(0<g)||h.norepbra||K.staves[g-1].flags&64||(h.norepbra=!0)}m=2<=t.state?F[K.top_voice]:null}}function Ud(a){var c;for(c=0;c<F.length;c++){var d=F[c];if(d.id==a)return d}d=A(m);d.v=F.length;d.id=a;d.sym=d.last_sym=null;d.key=A(m.key);d.sls=[];delete d.nm;delete d.snm;delete d.new_name;delete d.lyric_restart;delete d.lyric_cont;delete d.sym_restart;
delete d.sym_cont;delete d.have_ly;delete d.tie_s;F.push(d);return d}function Pb(a){var c;if("|"==a||")"==a)m.last_note?(m.last_note.beam_end=!0,sa?(m.time!=sa.p_voice.time&&(y(1,"Wrong duration in voice overlay"),m.time>sa.p_voice.time&&(sa.p_voice.time=m.time)),m.acc=[],m=sa.p_voice,sa=null):y(1,"Erroneous end of voice overlay")):y(1,H.nonote_vo);else if("("==a)sa?y(1,"Voice overlay already started"):sa={p_voice:m,time:m.time};else if(m.last_note){m.last_note.beam_end=!0;var d=m.voice_down;if(!d){d=
Ud(m.id+"o");m.voice_down=d;d.time=0;d.second=!0;var e=d.v;K.voices[e]={st:m.st,second:!0};var g=K.voices[m.v].range;for(c=0;c<K.voices.length;c++)K.voices[c]&&K.voices[c].range>g&&K.voices[c].range++;K.voices[e].range=g+1}d.ulen=m.ulen;d.dur_fact=m.dur_fact;d.acc=[];if(sa)m!=sa.p_voice&&m.time!=sa.p_voice.time&&(y(1,"Wrong duration in voice overlay"),m.time>sa.p_voice.time&&(sa.p_voice.time=m.time));else{sa={bar:!0,p_voice:m};c=d.time;for(g=m.last_sym;!(g.type==n.BAR||g.time<=c);g=g.prev);sa.time=
g.time}d.time=sa.time;m=d;sa.bar&&Ba({type:n.BAR,bar_type:a,dur:0,multi:0})}else y(1,H.nonote_vo)}function pc(){var a;if(0!=m.time)return!1;for(a=m.last_sym;a;a=a.prev)if(0!=Na[a.type])return!1;return!0}function re(a){if(pc())m.clef=a;else{Ba(a);a.clef_small=!0;var c=a.prev;c&&c.type==n.BAR&&":"!=c.bar_type[0]&&(a.next=c,a.prev=c.prev,a.prev&&(a.prev.next=a),c.prev=a,c.next=null,m.last_sym=c,a.soln&&(delete a.soln,m.eoln=!0))}}function cd(a){var c,d=F.length;if(1==d&&F[0].default&&(delete F[0].default,
0==F[0].time)){var e=F[0];e.id=a;r.transp&&2<=t.state&&(a=m,m=e,wc(),m=a);return e}for(c=0;c<d;c++)if(e=F[c],e.id==a)return e;e={v:c,id:a,time:0,new:!0,pos:{},scale:1,ulen:na.ulen,dur_fact:1,key:A(t.ckey),ckey:A(t.ckey),okey:A(t.ckey),meter:A(na.meter),wmeasure:na.meter.wmeasure,staffnonote:1,clef:{type:n.CLEF,clef_auto:!0,clef_type:"a",time:0},acc:[],sls:[],hy_st:0};F.push(e);return e}function Ed(){S=-1;F=[];m=null;me(!0);Hb=-1;J={};U=[];hb={}}function le(){var a=m.clone;var c=a.vs,d=a.a,e=a.bol,
g=t.istart,f=t,h=t.file;delete m.clone;"["==h[g-1]&&g--;rb++;for(a=0;a<c.length;a++)t=Object.create(f),t.line=Object.create(f.line),Tc(c[a],d),Hc(t.fname,h,e,g);rb--;t=f}function Tc(a){var c=ac(a),d=c.shift();if(d)if(m&&m.clone&&le(),a=0<d.indexOf(",")?d.split(","):[d],2>t.state)for(;;){d=a.shift();if(!d)break;c.length&&Fc(d,c);"*"!=d&&1==t.state&&(m=cd(d))}else"*"==d?y(1,"Cannot have V:* in tune body"):(m=cd(a[0]),1<a.length&&(a.shift(),m.clone={vs:a,a:c,bol:t.iend},"]"!=t.file[m.clone.bol-1]&&m.clone.bol++),
hc(c),2==t.state&&Ea(),wc(),a=m.v,m.new&&(delete m.new,0>Hb&&(m.st=m.cst=++S,K.nstaff=S,K.voices[a]={st:S,range:a},K.staves[S]={stafflines:m.stafflines||"|||||",staffscale:1})),!m.filtered&&K.voices[a]&&(t.voice_opts||t.tune_v_opts)&&(m.filtered=!0,yf()))}function Ea(a){var c={type:n.STAVES,dur:0,sy:K};Ha();var d;var e=Wb();ma(r.topspace);if(r.titleformat){var g,f,h;var l={};var k=A(zf);var x={A:r.infospace,C:r.composerspace,O:r.composerspace,R:r.infospace};var q={};var v="";var u=r.titleformat;for(d=
0;;){for(;" "==u[d];)d++;var p=u[d++];if(!p)break;if("A">p||"Z"<p)switch(p){case "+":var C="+";p=u[d++];break;case ",":v+="\n";default:continue;case "<":C="l";p=u[d++];break;case ">":C="r",p=u[d++]}else switch(u[d]){case "-":C="l";d++;break;case "1":C="r";d++;break;case "0":d++;default:C="c"}if(l[p])q[p]++;else{if(!M[p])continue;l[p]=M[p].split("\n");q[p]=1}v+=C+p}var y={l:r.titlespace,c:r.titlespace,r:r.titlespace};e={l:0,c:.5*e,r:e};var z={},B;u=v+"\n";for(d=0;;){z.l=z.c=z.r=h=0;for(f=d;;){C=u[f++];
if("\n"==C)break;p=u[f++];if("+"!=C&&!z[C]&&(B=l[p])){(g=k[p])||(g="history");v=Ja(g);var D=1.1*v.size;x[p]&&(D+=x[p]);h<D&&(h=D);z[C]=D}}y.l+=h-z.l;y.c+=h-z.c;for(y.r+=h-z.r;;){C=u[d++];if("\n"==C)break;p=u[d++];if(l[p].length){B=l[p].shift();"+"==u[d]&&(q[p]--,d++,p=u[d++],l[p].length&&(B=B?B+(" "+l[p].shift()):" "+l[p].shift()));(g=k[p])||(g="history");v=Ja(g);D=1.1*v.size;x[p]&&(D+=x[p]);ba(v);f=e[C];h=y[C]+D;"Q"==p?(W.set_width(na.tempo),na.tempo.invis||("l"!=C&&(je(na.tempo),w=na.tempo.tempo_wh[0],
"c"==C&&(w*=.5),f-=w),td(na.tempo,f,-h))):B&&("T"==p&&(B=Zd(B,"s"==k.T[0])),la(f,-h,B,C));"T"==p&&(g=k.T="subtitle",x.T=r.subtitlespace);if(1>=q[p])for("T"==p&&(v=Ja(g),D=1.1*v.size,x[p]&&(D+=x[p]),ba(v));0<l[p].length;)h+=D,B=l[p].shift(),la(f,-h,B,C);q[p]--;y[C]=h}}y.c>y.l&&(y.l=y.c);y.r>y.l&&(y.l=y.r);if(d>=u.length)break;y.c=y.r=y.l}ma(y.l);ma(r.musicspace)}else{if(M.T&&0<=r.writefields.indexOf("T"))for(p=0;;){C=M.T.indexOf("\n",p);if(0>C){Xc(M.T.substring(p),0!=p);break}Xc(M.T.slice(p,C),0!=
p);p=C+1}u=0;t.ckey.k_bagpipe&&!r.infoline&&0<=r.writefields.indexOf("R")&&(q=M.R);q&&(ba("composer"),la(0,-r.composerspace,q),u=r.composerspace);l=M.A;0<=r.writefields.indexOf("C")&&(k=M.C);0<=r.writefields.indexOf("O")&&(x=M.O);if(k||x||r.infoline){ba("composer");ma(r.composerspace);0>r.aligncomposer?(y=0,z=" "):0==r.aligncomposer?(y=.5*e,z="c"):(y=e,z="r");d=u;if(k||x){0<=r.aligncomposer&&u!=d&&ma(u-d);for(p=0;;){ma(J.curfont.size);C=k?k.indexOf("\n",p):-1;if(0>C){$d(y,0,k?k.substring(p):null,
x,z);break}la(y,0,k.slice(p,C),z);u+=J.curfont.size;p=C+1}d>u&&ma(d-u)}((q=q?null:M.R)||l)&&r.infoline&&(ba("info"),ma(J.curfont.size+r.infospace),$d(e,0,q,l,"r"),u+=J.curfont.size+r.infospace)}else d=r.composerspace;M.P&&0<=r.writefields.indexOf("P")&&(ba("parts"),u=r.partsspace+J.curfont.size-u,0<u&&(d+=u),.01<d&&ma(d),la(0,0,M.P),d=0);ma(d+r.musicspace)}Yb=0<=r.writefields.indexOf("M")?3:2;na.new_nbar?(J.nbar=na.new_nbar,na.new_nbar=0):J.nbar=1;t.state=3;F.length?m||(m=F[0>Hb?0:K.top_voice]):(Tc("1"),
m.clef.istart=m.key.istart,m.clef.iend=m.key.iend,m.default=!0);m.init||a||(hc([]),wc());for(a=0;a<F.length;a++)e=F[a],e.ulen=na.ulen,e.ckey.k_bagpipe&&!e.pos.stm&&(e.pos=A(e.pos),e.pos.stm=n.SL_BELOW);if(0>Hb){S=F.length-1;for(a=0;a<=S;a++)e=F[a],delete e.new,e.st=e.cst=a,K.voices[a]={st:a,range:a},K.staves[a]={stafflines:e.stafflines||"|||||",staffscale:1};K.nstaff=S}e=m;m=F[K.top_voice];Ba(c);m=e}function ff(a,c){var d;if(!m.ignore){if(c){if(c=m.sym_cont,!c){y(1,"+: symbol line without music");
return}}else if(m.sym_restart?(m.sym_start=c=m.sym_restart,m.sym_restart=null):c=m.sym_start,c||(c=m.sym),!c){y(1,"s: without music");return}for(d=0;;){for(;" "==a[d]||"\t"==a[d];)d++;var e=a[d];if(!e)break;switch(e){case "|":for(;c&&c.type!=n.BAR;)c=c.next;if(!c){y(1,"Not enough measure bars for symbol line");return}c=c.next;d++;continue;case "!":case '"':var g=++d;d=a.indexOf(e,g);if(0>d){y(1,"!"==e?"No end of decoration":"No end of guitar chord");d=a.length;continue}var f=a.slice(g-1,d+1);break;
case "*":break;default:f=e.charCodeAt(0);if(128>f&&(f=Ia[f],1<f.length&&("!"==f[0]||'"'==f[0]))){e=f[0];break}y(1,H.bad_char,e)}for(;c&&(c.type!=n.NOTE||c.grace);)c=c.next;if(!c){y(1,"Too many elements in symbol line");return}switch(e){case "!":Db([f.slice(1,-1)],c,c.prev);break;case '"':Wd(f),Ua&&qc(c)}c=c.next;d++}m.sym_cont=c}}function gf(a,c){if(!m.ignore){m.pos.voc!=n.SL_HIDDEN&&(m.have_ly=!0);if(c){c=m.lyric_cont;if(!c){y(1,"+: lyric without music");return}var d=Ja("vocal");J.deffont!=d&&(J.curfont==
J.deffont&&(J.curfont=d),J.deffont=d)}else if(ba("vocal"),m.lyric_restart?(m.lyric_start=c=m.lyric_restart,m.lyric_restart=null,m.lyric_line=0):(m.lyric_line++,c=m.lyric_start),c||(c=m.sym),!c){y(1,"w: without music");return}for(d=0;;){for(;" "==a[d]||"\t"==a[d];)d++;if(!a[d])break;var e=0;var g=t.istart+d+2;switch(a[d]){case "|":for(;c&&c.type!=n.BAR;)c=c.next;if(!c){y(1,"Not enough measure bars for lyric line");return}c=c.next;d++;continue;case "-":case "_":var f=a[d];e=2;break;case "*":f="";break;
default:if("\\"==a[d]&&d==a.length-1){m.lyric_cont=c;return}for(f="";a[d];){switch(a[d]){case "_":case "*":case "|":d--;case " ":case "\t":break;case "~":f+="\u00a0";d++;continue;case "-":e=1;break;case "\\":f+=a[++d];d++;continue;default:f+=a[d++];continue}break}}for(;c&&(c.type!=n.NOTE||c.grace);)c=c.next;if(!c){y(1,"Too many words in lyric line");return}f&&c.pos.voc!=n.SL_HIDDEN&&(f={t:f,font:J.curfont,istart:g,iend:g+f.length},e&&(f.ln=e),c.a_ly||(c.a_ly=[]),c.a_ly[m.lyric_line]=f);c=c.next;d++}m.lyric_cont=
c}}function Kc(a){var c,d,e,g,f=a,h=0,l=0,k=0,m=0,r=a.a_ly,t=0;for(e=a.ts_next;e;e=e.ts_next){e.shrink&&(m+=e.shrink,k++);if(e.bar_type){m+=3;break}if(e.a_ly){for(c=e.a_ly.length;0<=--c&&(!(d=e.a_ly[c])||2==d.ln););if(0<=c)break}}for(c=0;c<r.length;c++)if(d=r[c])if(d.t=g=tb(d.t),2==d.ln)d.shift=0;else{var u=Wc(" ")*d.font.swfac;var p=g.wh[0]+1.5*u;if(a.type==n.GRACE)var q=a.wl;else"0"<=g[0]&&"9">=g[0]&&2<g.length||":"==g[1]||"("==g[0]||")"==g[0]?("("!=g[0]&&(u=g.indexOf("\u00a0"),ba(d.font),u=0<u?
va(g.slice(0,u))[0]:.2*p),p-=u,q=.4*p,14<q&&(q=14),q+=u,"0"<=g[0]&&"9">=g[0]&&q>t&&(t=q)):(q=.4*p,14<q&&(q=14));d.shift=q;q>l&&(l=q);p-=q;p>h&&(h=p)}for(;!f.seqst;)f=f.ts_prev;f.ts_prev.bar_type&&(l-=4);f.wl<l&&(f.shrink+=l-f.wl,f.wl=l);m-=6;if(m<h)for(m=(h-m)/k,a=a.ts_next;;){a.shrink&&(a.shrink+=m,f.wr+=m,f=a);if(a==e)break;a=a.ts_next}if(0<t)for(c=0;c<r.length;c++)(d=r[c])&&"0"<=d.t[0]&&"9">=d.t[0]&&(d.shift=t)}function se(a,c,d){var e,g,f;if(a.hy_st&1<<c){var h=!0;a.hy_st&=~(1<<c)}for(e=a.sym;e.type==
n.CLEF||e.type==n.KEY||e.type==n.METER;e=e.next);var l=e.prev?e.prev.x:P.x;for(f=0;e;e=e.next)if(g=e.a_ly?e.a_ly[c]:null){g.font!=J.curfont&&(J.curfont=g.font);var k=g.t;var m=k.wh[0];var t=g.shift;h&&(2==g.ln&&"_"==k?k="-":2!=g.ln&&(de(l,d,e.x-t-l),h=!1,l=e.x+e.wr));if(v&&(2!=g.ln||"_"!=k)){ad(l+3,d,f-l+3);var v=!1;l=e.x+e.wr}if(2==g.ln)0==f&&l>e.x-18&&(l=e.x-18),"-"==k?h=!0:v=!0,f=e.x-t;else{f=e.x-t;g.ln&&(h=!0);if(q.anno_start||q.anno_stop){var u={st:e.st,istart:g.istart,iend:g.iend,x:f,y:d,ymn:d,
ymx:d+J.curfont.size,wl:0,wr:m};za(u,"lyrics")}la(f,d,k);Oa(u,"lyrics");l=f+m}}else switch(e.type){case n.REST:case n.MREST:v&&(ad(l+3,d,f-l),v=!1,l=e.x+e.wr)}h&&(f=pa-10,f<l+10&&(f=l+10),de(l,d,f-l),r.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;e;e=e.next)if(e.type==n.NOTE){if(!e.a_ly)break;(g=e.a_ly[c])&&g.ln&&"_"==g.t&&(v=!0,f=pa-15,f<l+12&&(f=l+12));break}v&&ad(l+3,d,f-l+3)}function te(a,c,d,e,g){var f=B[a.st].staffscale;ba("vocal");if(0<g){e>-r.vocalspace&&(e=-r.vocalspace);e*=f;for(g=0;g<c;g++)e-=
1.1*d[g],se(a,g,e);return(e-d[g-1]/6)/f}g=B[a.st].topbar+r.vocalspace;e<g&&(e=g);e*=f;for(g=c;0<=--g;)se(a,g,e),e+=1.1*d[g];return e/f}function Ve(){var a,c,d,e,g,f=Array(S+1),h=F.length,l=Array(h),k=Array(h),m=Array(h),r=Array(h),t=0,u=0,p=-1;for(c=0;c<h;c++){var q=F[c];if(q.sym){q.st!=p&&(u=t=0,p=q.st);var v=0;if(q.have_ly)for(l[c]||(l[c]=[]),a=q.sym;a;a=a.next){if(e=a.a_ly){var z=a.x;var y=10;for(d=0;d<e.length;d++)if(g=e[d]){z-=g.shift;y=g.t.wh[0];break}d=V(q.st,1,z,y);t<d&&(t=d);d=V(q.st,0,z,
y);for(u>d&&(u=d);v<e.length;)l[c][v++]=0;for(d=0;d<e.length;d++)(g=e[d])&&(!l[c][d]||g.t.wh[1]>l[c][d])&&(l[c][d]=g.t.wh[1])}}else d=V(q.st,1,0,pa),t<d&&(t=d),d=V(q.st,0,0,pa),u>d&&(u=d);f[p]||(f[p]={});f[p].top=t;f[p].bot=u;k[c]=v;0!=v&&(m[c]=q.pos.voc?q.pos.voc==n.SL_ABOVE:F[c+1]&&F[c+1].st==p&&F[c+1].have_ly?!0:!1,m[c]?f[p].a=!0:f[p].b=!0)}}for(c=d=0;c<h;c++)q=F[c],q.sym&&q.have_ly&&(m[c]?r[d++]=c:(p=q.st,Ma(p,!0),0<k[c]&&(f[p].bot=te(q,k[c],l[c],f[p].bot,1))));for(;0<=--d;)c=r[d],q=F[c],p=q.st,
Ma(p,!0),f[p].top=te(q,k[c],l[c],f[p].top,-1);for(c=0;c<h;c++)if(q=F[c],q.sym){p=q.st;if(f[p].a)for(t=f[p].top+2,a=q.sym.next;a;a=a.next)a.a_ly&&ea(p,1,a.x-2,10,t);if(f[p].b)if(u=f[p].bot-2,0<k[q.v])for(a=q.sym.next;a;a=a.next)a.a_ly&&ea(p,0,a.x-2,10,u);else ea(p,0,0,pa,u)}}function Wd(a){function c(){for(var a="";;){x=l[d++];if(0>"1234567890.-".indexOf(x))return parseFloat(a);a+=x}}var d,e=Ja("annotation"),g=e.size;var f=t.line;var h=t.bol+f.index;if(1<a.length){var l=a.slice(1,-1);var k=h+1}else{for(d=
++f.index;;){a=f.buffer.indexOf('"',d);if(0>a){y(1,"No end of guitar chord");return}if("\\"!=f.buffer[a-1])break;d=a+1}l=Ad(f.buffer.slice(f.index,a));f.index=a;k=t.bol+f.index+1}e.pad&&(g+=e.pad);d=0;for(a="g";;){var x=l[d];if(!x)break;f={text:"",istart:h,iend:k,font:e};switch(x){case "@":a=x;d++;var r=c();if(","!=x){y(1,"',' lacking in annotation '@x,y'");var q=0}else q=c()," "!=x&&d--;f.x=r;f.y=q-g/2;break;case "^":f.pos=n.SL_ABOVE;case "_":"_"==x&&(f.pos=n.SL_BELOW);case "<":case ">":d++;a=x;
break;default:switch(a){case "g":f.font=Ja("gchord");f.pos=m.pos.gch||n.SL_ABOVE;break;case "@":f.x=r,q-=g,f.y=q-g/2}}for(f.type=a;;){x=l[d];if(!x)break;switch(x){case "\\":x=l[++d];if(!x||"n"==x)break;f.text+="\\";default:f.text+=x;d++;continue;case "&":for(;;){f.text+=x;x=l[++d];switch(x){default:continue;case ";":case void 0:case "\\":}break}if(";"==x){d++;f.text+=x;continue}case ";":}d++;break}f.otext=f.text;Ua||(Ua=[]);Ua.push(f)}}function ue(a,c){var d,e,g=a.split("/");for(d=0;d<g.length;d++){a=
g[d];var f=a.search(/[A-G]/);if(!(0>f)){var h=f+1;for(e=0;"#"==a[h]||"\u266f"==a[h];)e++,h++;for(;"b"==a[h]||"\u266d"==a[h];)e--,h++;var l=ve.indexOf(a[f])+16;l=(abc2svg.pab40(l,e)+c+200)%40;l=abc2svg.b40k[l];g[d]=a.slice(0,f)+ve[abc2svg.b40_p[l]]+Af[abc2svg.b40_a[l]+2]+a.slice(h)}}return g.join("/")}function qc(a){a.a_gch=a.a_gch?a.a_gch.concat(Ua):Ua;Ua=null;if(m.vtransp)for(var c,d=a.a_gch.length;0<=--d;)c=a.a_gch[d],"g"==c.type&&(c.text=ue(c.text,m.vtransp))}function Ne(){function a(a){var c,
d,f;for(d=e;d;d=d.ts_next)if(c=d.a_gch){var g=c.length-a-1;if(c=c[g]){if(c.pos==n.SL_ABOVE){var h=d.x+c.x;(f=c.text.wh[0])&&h+f>pa&&(h=pa-f);f=V(d.st,1,h,f);"g"==c.type&&f<l[d.st].yup&&(f=l[d.st].yup)}else if(c.pos==n.SL_BELOW)continue;else h=d.x+c.x,f=c.y;W.draw_gchord(g,d,h,f)}}}function c(a){for(var c,d,f,g=e;g;g=g.ts_next)(c=g.a_gch)&&(c=c[a])&&c.pos==n.SL_BELOW&&(d=g.x+c.x,(f=c.text.wh[0])&&d+f>pa&&(d=pa-f),f=V(g.st,0,d,f),"g"==c.type&&f>l[g.st].ydn&&(f=l[g.st].ydn),W.draw_gchord(a,g,d,f))}var d,
e,g,f,h=0,l=Array(S+1);for(f=0;f<=S;f++)l[f]={ydn:B[f].botbar-3,yup:B[f].topbar+4};for(d=P;d;d=d.ts_next)if(g=d.a_gch)for(e||(e=d),f=g.length,f>h&&(h=f);0<=--f;)if("g"==g[f].type){g=g[f];f=g.text.wh[0];g.pos==n.SL_ABOVE?(g=V(d.st,!0,d.x,f),g>l[d.st].yup&&(l[d.st].yup=g)):g.pos==n.SL_BELOW&&(g=V(d.st,!1,d.x,f),g<l[d.st].ydn&&(l[d.st].ydn=g));break}if(e)for(Ma(-1),f=0;f<h;f++)a(f),c(f)}function ef(){function a(a){for(var c=0;c<a.length;c++)a[c](W)}var c=abc2svg.modules.hooks,d=abc2svg.modules.g_hooks;
we?c.length&&(a(c),d.push.apply(d,c),abc2svg.modules.hooks=[]):(c.length&&(d.push.apply(d,c),abc2svg.modules.hooks=[]),a(d),we=!0)}var n=abc2svg.C,H={bad_char:"Bad character '$1'",bad_grace:"Bad character in grace note sequence",bad_transp:"Bad transpose value",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%score",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",
not_ascii:"Not an ASCII character",not_enough_n:"Not enough notes/rests for %%repeat",not_enough_m:"Not enough measures for %%repeat",not_enough_p:"Not enough parameters in %%map",not_in_tune:"Cannot have '$1' inside a tune",notransp:"Cannot transpose with a temperament"},W=this,na={meter:{type:n.METER,wmeasure:1,a_meter:[]}},M={},t={ctx:{},prefix:"%",state:0,ottava:[],line:new O},Ic=[],ke,Cb={},U,hb,xc={dot:"0 stc 5 1 1",tenuto:"0 emb 5 3 3",slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 0",roll:"3 roll 7 6 6",
fermata:"3 hld 10 7 7",emphasis:"3 accent 7 4 4",lowermordent:"3 lmrd 10 5 5",coda:"3 coda 24 10 10",uppermordent:"3 umrd 10 5 5",segno:"3 sgno 22 8 8",trill:"3 trl 14 5 5",upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"0 wedge 7 3 3",turnx:"3 turnx 10 0 5",breath:"3 brth 0 1 20",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",invertedfermata:"3 hld 10 7 7",invertedturn:"3 turn 10 0 5",invertedturnx:"3 turnx 10 0 5",0:"3 fng 8 3 3 0",1:"3 fng 8 3 3 1",
2:"3 fng 8 3 3 2",3:"3 fng 8 3 3 3",4:"3 fng 8 3 3 4",5:"3 fng 8 3 3 5",plus:"3 dplus 7 3 3","+":"3 dplus 7 3 3",accent:"3 accent 7 4 4",">":"3 accent 7 4 4",marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 10 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",dacapo:"3 dacs 16 20 20 Da Capo",dacoda:"3 dacs 16 20 20 Da Coda","D.C.":"3 dcap 16 10 10","D.S.":"3 dsgn 16 10 10","D.C.alcoda":"3 dacs 16 38 38 D.C. al Coda","D.S.alcoda":"3 dacs 16 38 38 D.S. al Coda","D.C.alfine":"3 dacs 16 38 38 D.C. al Fine",
"D.S.alfine":"3 dacs 16 38 38 D.S. al Fine",fine:"3 dacs 16 10 10 Fine",turn:"3 turn 10 0 5","trill(":"3 ltr 8 4 0","trill)":"3 ltr 8 4 0",f:"6 f 18 1 7",ff:"6 ff 18 2 10",fff:"6 fff 18 4 13",ffff:"6 ffff 18 6 16",mf:"6 mf 18 6 13",mp:"6 mp 18 6 16",p:"6 p 18 2 8",pp:"6 pp 18 5 14",ppp:"6 ppp 18 8 20",pppp:"6 pppp 18 10 25",pralltriller:"3 umrd 10 5 5",sfz:"6 sfz 18 4 10",ped:"4 ped 18 6 10","ped-up":"4 pedoff 12 4 4","ped(":"4 lped 20 5 5","ped)":"4 lped 20 5 5","crescendo(":"6 cresc 18 0 0","crescendo)":"6 cresc 18 0 0",
"<(":"6 cresc 18 0 0","<)":"6 cresc 18 0 0","diminuendo(":"6 dim 18 0 0","diminuendo)":"6 dim 18 0 0",">(":"6 dim 18 0 0",">)":"6 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0","8va(":"3 8va 10 0 0","8va)":"3 8va 10 0 0","8vb(":"4 8vb 10 0 0","8vb)":"4 8vb 10 0 0","15ma(":"3 15ma 10 0 0","15ma)":"3 15ma 10 0 0","15mb(":"4 15mb 10 0 0","15mb)":"4 15mb 10 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",
trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0",editorial:"42 0 0 0 0","sacc-1":"3 sacc-1 6,4 4 4",sacc3:"3 sacc3 6,5 4 4",sacc1:"3 sacc1 6,4 4 4",courtesy:"43 0 0 0 0","cacc-1":"3 cacc-1 0 0 0",cacc3:"3 cacc3 0 0 0",cacc1:"3 cacc1 0 0 0","tie(":"44 0 0 0 0","tie)":"44 0 0 0 0"},Je=[!0,!0,!0],Le=[!1,!1,
!1,!0,!0,!0,!1,!1,!0],ab=[!1,!1,!1,!1,!1,!1,!0,!0],zc=[function(a){var c,d=a.s,e=a.dd;if(!e.str){if(c=d.multi?0<d.multi:0>d.stem)var g=d.ymx|0;else"w"==e.name[0]?(a.inv=!0,g=d.ymn):g=d.ymn-e.h;-6<g&&24>g&&(c&&(g+=3),g=6*((g+6)/6|0)-6);c?d.ymx=g+e.h:d.ymn="w"==e.name[0]?g-e.h:g;a.y=g;d.type==n.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd);"d"==e.name[0]&&-1<=d.nflags&&(c?0<d.stem&&(a.x+=3.5):0>d.stem&&(a.x-=3.5))}},function(a){var c,d=a.s,e=d.notes[0].pit,g=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var f=
4+d.notes[c].shac;else switch(f=5-d.notes[c].shhd,d.head){case n.SQUARE:f+=3.5;break;case n.OVALBARS:case n.OVAL:f+=2}d.notes[c].pit<=e+3&&f>g&&(g=f)}a.x-=g;a.y=3*(e-18)},function(a){var c,d=a.s,e=a.dd,g=5;if(d.type==n.NOTE)for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var f=5+d.notes[c].shac;else switch(f=6-d.notes[c].shhd,d.head){case n.SQUARE:f+=3.5;break;case n.OVALBARS:case n.OVAL:f+=2}f>g&&(g=f)}f=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;f<c&&(f=c);a.has_val=!0;a.val=f;a.x-=g;a.y=3*(d.notes[0].pit-
18)-3},id,id,hd,function(a){var c,d=a.s,e=a.dd;if(!a.ldst)if(a.start)gd(a);else{a.val=e.wl+e.wr;if(c=fd(d,d.pos.vol))a.up=!0;var g=d.x-e.wl;if(0<a.ix){var f=U[a.ix-1];if(f.s==d&&(a.up&&!f.up||!a.up&&f.up)){var h=f.dd;ab[h.func]&&(h=f.x+f.val+4,h>g&&(g=h))}}a.x=g;a.y=V(d.st,c,g,a.val);c||(a.y-=e.h)}},gd];Abc.prototype.draw_all_deco=function(){if(U.length){var a,c,d=[],e=[];if(!r.dynalign){var g=S;for(c=B[g].y;0<=--g;){var f=B[g].y;e[g]=.5*(c+24+f);c=f}}for(;;){var h=U.shift();if(!h)break;if((a=h.dd)&&
!a.dd_en){var l=h.s;var k=a.glyph;var n=k.indexOf("/");0<n&&(k=0<=l.stem?k.slice(0,n):k.slice(n+1));ab[a.func]?ra(l.st):Qa(l);g=h.st;if(B[g].topbar){n=h.x;c=h.y+B[g].y;if(void 0!=h.m)g=l.notes[h.m],g.shhd&&(n+=g.shhd*I.scale);else if(ab[a.func]&&!r.dynalign&&(h.up&&0<g||!h.up&&g<S)){var m=h.up?e[--g]:e[g++];m-=.5*a.h;if(h.up&&c<m||!h.up&&c>m)if(f=V(g,!h.up,h.x,h.val)+B[g].y,h.up&&(f-=a.h),h.up&&f>m||!h.up&&f<m)c=m}if((g=q[k])&&"function"==typeof g)g(n,c,h);else if(!W.psdeco(k,n,c,h)){za(l,"deco");
h.inv&&(Kb(n,c,0,1,-1),n=c=0);if(h.has_val)2!=a.func||0>I.st?bd(n,c,k,h.val/I.scale,h.defl):bd(n,c,k,h.val,h.defl),h.cont&&d.push(h.start);else if(void 0!=a.str)h=a.str,"@"==h[0]&&(a=h.match(/^@([0-9.-]+),([0-9.-]+);?/),n+=Number(a[1]),c+=Number(a[2]),h=h.replace(a[0],"")),ee(n,c,k,h);else if(h.lden)if(k=h.dd.glyph,xe[k])xe[k](n,c,h);else v(1,null,"No function for decoration '$1'",k);else Z(n,c,k);I.g&&Fb();Oa(l,"deco")}}}}U=d}};var Vb,mb=[],Bf=[[16,16,14,12,10,10],[14,14,10,9,9,9]];Abc.prototype.calculate_beam=
function(a,c){var d,e,g,f,h,l;if(!c.beam_st){var k=kd(c);jc(k,c);Qb(k,c);k.x-=12;k.x>c.prev.x+12&&(k.x=c.prev.x+12);k.beam_st=!0;delete k.beam_end;k.tmp=!0;delete k.sls;c=k}var m=e=0;var t=g=!1;var q=c.st;var u=c.v;var p=c.grace?2.3:3.5;for(d=c;d.type!=n.NOTE||(d.nflags>e&&(e=d.nflags),m++,d.st!=q&&(t=!0),d.stem!=c.stem&&(g=!0),f||d.invis||d.stemless&&!d.trem2||(f=!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=n.NOTE;d=d.prev);k=kd(d);k.next=d.next;k.next&&(k.next.prev=k);d.next=k;k.prev=d;k.ts_next=
d.ts_next;k.ts_next&&(k.ts_next.ts_prev=k);d.ts_next=k;k.ts_prev=d;delete k.beam_st;k.beam_end=!0;k.tmp=!0;delete k.sls;k.x+=12;k.x<pa-12&&(k.x=pa-12);d=k;m++;break}if(!f)return!1;a.s2=d;if(0==B[q].y){if(t)return!1}else if(!t)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*a.a+B[q].y,a.nflags=e,!0;var v=c;var y=100;var z=0;for(k=c;k.type!=n.NOTE||(1==(l=k.p_v.scale)&&(l=B[k.st].staffscale),0<=k.stem?(f=p+k.notes[0].shhd,k.notes[k.nhd].pit>z&&(z=k.notes[k.nhd].pit,v=k)):(f=-p+k.notes[k.nhd].shhd,
k.notes[0].pit<y&&(y=k.notes[0].pit,v=k)),k.xs=k.x+f*l,k!=d);k=k.next);k.grace&&r.flatbeams?h=0:!g&&3<=m&&v!=c&&v!=d&&(h=0);f=c.ys+B[q].y;void 0==h&&(h=(d.ys+B[d.st].y-f)/(d.xs-c.xs));0!=h&&(h=r.beamslope*h/(r.beamslope+Math.abs(h)));m=(f+d.ys+B[d.st].y)/2-h*(d.xs+c.xs)/2;p=0;k=c;if(g)f=.5*((c.grace?3.5:5)*(e-1)+3.2),m=c.stem!=d.stem&&c.nflags<d.nflags?m+f*d.stem:m+f*c.stem;else if(c.grace)for(;f=h*k.xs+m-B[k.st].y,z=13,z=0<k.stem?z-(f-3*(k.notes[k.nhd].pit-18)):z+(f-3*(k.notes[0].pit-18)),z+=3*(k.nflags-
1),z>p&&(p=z),k!=d;k=k.next);else{for(y=3.2+5*(e-1);k.ts_prev&&k.ts_prev.type==n.NOTE&&k.ts_prev.time==k.time&&k.ts_prev.x>c.xs;)k=k.ts_prev;for(;k&&k.time<=d.time;k=k.ts_next)if(!(k.type!=n.NOTE||k.invis||k.st!=q&&k.v!=u)){f=k.v==u?k.xs:k.x;f=h*f+m-B[k.st].y;if(k.v==u)z=Bf[0==k.nhd?0:1][k.nflags],0<k.stem?(26<k.notes[k.nhd].pit&&(z-=2,28<k.notes[k.nhd].pit&&(z-=2)),z-=f-3*(k.notes[k.nhd].pit-18)):(18>k.notes[0].pit&&(z-=2,16>k.notes[0].pit&&(z-=2)),z-=3*(k.notes[0].pit-18)-f),z+=3.2+5*(k.nflags-
1);else{if(0<c.stem)if(0<k.stem){if(k.ymn>f+4||k.ymx<f-y-2)continue;z=k.v>u?k.ymx-f:k.ymn+8-f}else z=k.ymx-f;else if(0>k.stem){if(k.ymx<f-4||k.ymn>f-y-2)continue;z=k.v<u?f-k.ymn:f-k.ymx+8}else z=f-k.ymn;z+=2+y}z>p&&(p=z)}}0<p&&(m+=c.stem*p);if(!t&&!g)for(k=c.next;;k=k.next){switch(k.type){case n.REST:if(u=k.ts_next,!u||u.st!=q||u.type!=n.NOTE&&u.type!=n.REST)break;case n.BAR:if(k.invis)break;case n.CLEF:f=h*k.x+m;0<c.stem?(f=k.ymx-f+3.2+5*(e-1)+2,0<f&&(m+=f)):(f=k.ymn-f-3.2-5*(e-1)-2,0>f&&(m+=f));
break;case n.GRACE:for(u=k.extra;u;u=u.next)f=h*u.x+m,0<c.stem?(f=u.ymx-f+3.2+5*(e-1)+2,0<f&&(m+=f)):(f=u.ymn-f-3.2-5*(e-1)-2,0>f&&(m+=f))}if(k==d)break}0==h&&(m+=Pe(c.grace,c.stem,e,m-B[q].y));for(k=c;;k=k.next){switch(k.type){case n.NOTE:k.ys=h*k.xs+m-B[k.st].y;0<k.stem?(k.ymx=k.ys+2.5,k.ts_prev&&0<k.ts_prev.stem&&k.ts_prev.st==k.st&&k.ts_prev.ymn<k.ymx&&k.ts_prev.x==k.x&&0==k.notes[0].shhd&&(k.ts_prev.x-=3,k.ts_prev.xs-=3)):k.ymn=k.ys-2.5;break;case n.REST:f=h*k.x+m-B[k.st].y;u=3.2+5*(e-1)+(k.head!=
n.FULL?4:9);if(0<c.stem){if(f-=u,0==c.multi&&12<f&&(f=12),k.y<=f)break}else if(f+=u,0==c.multi&&12>f&&(f=12),k.y>=f)break;k.head!=n.FULL&&(f=6*((f+3+12)/6|0)-12);k.y=f}if(k==d)break}if(0==B[q].y)return!1;a.s1=c;a.a=h;a.b=m;a.nflags=e;return!0};var od={};Abc.prototype.draw_hl=function(a){var c,d,e=[],g=B[a.st];if(g.hll){for(c=0;c<=a.nhd;c++){var f=a.notes[c];g.hlmap[f.pit-g.hll]||e.push([f.pit-18,f.shhd*I.scale])}if(d=e.length){var h=g.stafflines,l=h.length-1,k=l,m=g.botline/6,n=m,r=a.grace?4:1.3*
ye[a.head];f=a.notes[0>a.stem?a.nhd:0];var t=f.shhd;for(c=0;c<e.length;c++){var p=e[c][0];f=(e[c][1]<t?e[c][1]:t)-r;var q=(e[c][1]>t?e[c][1]:t)+r;p<2*m?(p<2*n&&(n=++p>>1),d--):p>2*l&&(k=p>>1,d--);ib(g,p>>1,a.x,f,q)}f=t-r;for(q=t+r;++n<m;)ib(g,n,a.x,f,q);for(;--k>l;)ib(g,k,a.x,f,q);if(d){c=n;for(d=k;c>m&&"-"==h[c];)c--;for(;d<l&&"-"==h[d];)d++;for(;c<d;c++)"-"==h[c]&&ib(g,c,a.x,f,q)}}}};var ze=new Int8Array([24,9,15,21,6,12,18]),Ae=new Int8Array([12,18,24,9,15,21,6]),Be=new Int8Array([-9,12,-9,-9,
12,-9]),Ce=new Int8Array([12,-9,12,-9,12,-9]),De=new Int8Array([9,-12,9,-12,9,-12]),Ee=new Int8Array([-12,9,-12,9,-12,9]);Abc.prototype.draw_keysig=function(a,c){var d=c.k_old_sf,e=B[c.st].y,g,f=c.k_y_clef;f&1&&(f+=7);for(f/=2;0>f;)f+=7;f%=7;if(!c.k_a_acc){if(r.cancelkey||0==c.k_sf)if(0==c.k_sf||0>d*c.k_sf){var h=ze[f];var l=9<h?Be:Ce;for(g=0;g<d;g++)Z(a,e+h,"acc3"),h+=l[g],a+=5.5;h=Ae[f];l=18>h?De:Ee;for(g=0;g>d;g--)Z(a,e+h,"acc3"),h+=l[-g],a+=5.5;0!=c.k_sf&&(a+=3)}if(0<c.k_sf){h=ze[f];l=9<h?Be:
Ce;for(g=0;g<c.k_sf;g++)Z(a,e+h,"acc1"),h+=l[g],a+=5.5;if(r.cancelkey&&g<d)for(a+=2;g<d;g++)Z(a,e+h,"acc3"),h+=l[g],a+=5.5}if(0>c.k_sf){h=Ae[f];l=18>h?De:Ee;for(g=0;g>c.k_sf;g--)Z(a,e+h,"acc-1"),h+=l[-g],a+=5.5;if(r.cancelkey&&g>d)for(a+=2;g>d;g--)Z(a,e+h,"acc3"),h+=l[-g],a+=5.5}}else if(c.k_a_acc.length){l=c.k_a_acc[0].acc;f=100;var k=[{}];for(g=0;g<c.k_a_acc.length;g++){d=c.k_a_acc[g];for(h=3*(c.k_y_clef+d.pit-18);-3>h;)h+=21;for(;27<h;)h-=21;0!=g&&(h>f+18||h<f-18)?a-=5.5:d.acc!=l&&(a+=3);l=d.acc;
k[0].pit=h/3+18;f=h;Cc(a,e+h,d.acc);a+=5.5}}};var Cf="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" ");Abc.prototype.draw_symbols=function(a){var c={},d;for(d=a.sym;d;d=d.next){if(d.invis)switch(d.type){case n.KEY:a.ckey=d;default:continue;case n.NOTE:}var e=d.st;var g=d.x;qa(d.color);switch(d.type){case n.NOTE:Qa(d);d.beam_st&&!d.beam_end&&W.calculate_beam(c,d)&&ld(c);d.invis||(za(d),dc(d,!c.s2),mb.push(d));d==c.s2&&(c.s2=null);break;case n.REST:if(!B[e].topbar)break;var f,h;e=d;var l=B[e.st];if(e.dur_orig==
e.p_v.meter.wmeasure||e.rep_nb&&0<=e.rep_nb){e.nflags=e.dur<2*n.BLEN?-2:e.dur<4*n.BLEN?-3:-4;e.dots=0;for(f=e.ts_next;f.time!=e.time+e.dur&&f.ts_next;)f=f.ts_next;g=f.x-f.wl;for(f=e;!f.seqst;)f=f.ts_prev;f=f.ts_prev;g=(g+f.x+f.wr)/2;if(e.a_dd){var k=e;var m=g-e.x;var t=U.length;for(h=0;h<t;h++)f=U[h],f.s==k&&(f.x+=m)}e.x=g}else g=e.x,e.notes[0].shhd&&(g+=e.notes[0].shhd*I.scale);if(!e.invis){f=l.y;if(e.rep_nb)ra(e.st),za(e),f="|||||"==l.stafflines?f+12:f+(l.topbar+l.botbar)/2,0>e.rep_nb?Z(g,f,"srep"):
(Z(g,f,"mrep"),2<e.rep_nb&&e.v==L.top_voice&&0<r.measrepnb&&!(e.rep_nb%r.measrepnb)&&pd(g,f+l.topbar,e.rep_nb));else{Qa(e);za(e);e.notes[0].color&&qa(e.notes[0].color);h=e.y;m=5-e.nflags;7==m&&12==h&&2>=l.stafflines.length&&(h-=6);e.notes[0].invis||Z(g,h+f,Cf[m]);if(6<=m){k=h/6;switch(m){default:switch(l.stafflines[k+1]){case "|":case "[":break;default:ib(l,k+1,g,-7,7)}9==m&&(h-=6,k--);break;case 7:h+=6,k++;case 6:}switch(l.stafflines[k]){case "|":case "[":break;default:ib(l,k,g,-7,7)}}if(e.dots)for(g+=
8,h+=f+3,k=e.dots,m=e.dur_orig/12>>5-e.nflags-k;0<k--;)Z(g,h,m&1<<k?"dot":"dot+"),g+=3.5;qa()}mb.push(e)}break;case n.BAR:break;case n.CLEF:d.time>=B[e].clef.time&&(B[e].clef=d);if(d.second||!B[e].topbar)break;qa();ra(e);za(d);e=B[e].y;d.clef_name?Z(g,e+d.y,d.clef_name):d.clef_small?Z(g,e+d.y,"s"+d.clef_type+"clef"):Z(g,e+d.y,d.clef_type+"clef");d.clef_octave&&(0<d.clef_octave?(e+=d.ymx-10,d.clef_small&&--e):(e+=d.ymn+6,d.clef_small&&(e+=1)),Z(g-2,e,"oct"));mb.push(d);break;case n.METER:a.meter=d;
if(d.second||!B[d.st].topbar)break;qa();ra(d.st);za(d);nd(d);mb.push(d);break;case n.KEY:a.ckey=d;if(d.second||!B[d.st].topbar)break;qa();ra(d.st);za(d);W.draw_keysig(g,d);mb.push(d);break;case n.MREST:Qa(d);g+=32;za(d);Z(g,B[d.st].y+12,"mrest");da('<text style="font:bold 15px serif"\n\tx ="X" y="Y" text-anchor="middle">A</text>\n',g,B[d.st].y+28,d.nmes);mb.push(d);break;case n.GRACE:Qa(d);g=d;l={};for(e=g.extra;;){e.beam_st&&!e.beam_end&&W.calculate_beam(l,e)&&ld(l);za(e);dc(e,!l.s2);e==l.s2&&(l.s2=
null);mb.push(g);if(!e.next)break;e=e.next}g.sappo&&(e=g.extra,e.next?(f=.5*(e.next.x-e.x)+4,l=.5*(e.ys+e.next.ys)-e.y,l=0<e.stem?l-1:l+1):(f=9,l=0<e.stem?5:-5),k=e.notes[0>e.stem?0:e.nhd],h=e.x+k.shhd*I.scale,k=B[e.st].y+3*(k.pit-18),0<e.stem?(--h,k+=4):(h-=5,k-=4),da('<path class="stroke" d="mX YlF G"/>\n',h,k,f,-l));if(e=g.slur)za(g,"slur"),Eb(e.x0,e.y0+B[g.st].y),G+="c"+e.x1.toFixed(1)+" "+e.y1.toFixed(1)+" "+e.x2.toFixed(1)+" "+e.y2.toFixed(1)+" "+e.x3.toFixed(1)+" "+e.y3.toFixed(1)+'"/>\n',
Oa(g,"slur");break;case n.SPACE:case n.STBRK:break;case n.CUSTOS:Qa(d);dc(d,0);break;case n.BLOCK:case n.PART:case n.REMARK:case n.STAVES:case n.TEMPO:break;default:v(2,d,"draw_symbols - Cannot draw symbol "+d.type)}}Qa(a.sym)};var Ya=[],zd={},vd={serif:1,serifBold:1,"sans-serif":1,"sans-serifBold":1,Palatino:1.1,monospace:1.35},Fe={},r={"abc-version":"1",annotationfont:{name:"sans-serif",size:12},aligncomposer:1,beamslope:.4,bardef:{"[":"","[]":"","|:":"[|:","|::":"[|::","|:::":"[|:::",":|":":|]",
"::|":"::|]",":::|":":::|]","::":":][:"},breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerfont:{name:"serif",style:"italic",size:14},composerspace:6,decoerr:!0,dynalign:!0,footerfont:{name:"serif",size:16},fullsvg:"",gchordfont:{name:"sans-serif",size:12},gracespace:new Float32Array([4,8,11]),graceslurs:!0,headerfont:{name:"serif",size:16},historyfont:{name:"serif",size:16},hyphencont:!0,indent:0,infofont:{name:"serif",style:"italic",size:14},infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',
infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,measrepnb:1,measurefont:{name:"serif",style:"italic",size:10},measurenb:-1,musicfont:{name:"music",src:'url("data:application/octet-stream;base64,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NQd1bmlFMDg2B3VuaUUwODcHdW5pRTA4OAd1bmlFMDg5B3VuaUUwOEEHdW5pRTA4Qgd1bmlFMDhDB3VuaUUwOTQHdW5pRTA5NQd1bmlFMEEwB3VuaUUwQTEHdW5pRTBBMgd1bmlFMEEzB3VuaUUwQTQHdW5pRTBBOQd1bmlFMEIzB3VuaUUxMDEHdW5pRTFCOQd1bmlFMUJCB3VuaUUxRTcHdW5pRTFGMgd1bmlFMUY0B3VuaUUxRjcHdW5pRTFGOQd1bmlFMUZDB3VuaUUxRkUHdW5pRTFGRgd1bmlFMjAwB3VuaUUyNDAHdW5pRTI0MQd1bmlFMjQyB3VuaUUyNDMHdW5pRTI0NAd1bmlFMjQ1B3VuaUUyNDYHdW5pRTI0Nwd1bmlFMjQ4B3VuaUUyNDkHdW5pRTI2MAd1bmlFMjYxB3VuaUUyNjIHdW5pRTI2Mwd1bmlFMjY0B3VuaUUyODAHdW5pRTI4MQd1bmlFMjgyB3VuaUUyODMHdW5pRTRBMAd1bmlFNEEyB3VuaUU0QTQHdW5pRTRBOAd1bmlFNEFDB3VuaUU0QzAHdW5pRTRDRQd1bmlFNEUxB3VuaUU0RTIHdW5pRTRFMwd1bmlFNEU0B3VuaUU0RTUHdW5pRTRFNgd1bmlFNEU3B3VuaUU0RTgHdW5pRTRFOQd1bmlFNEVBB3VuaUU0RUUHdW5pRTUwMAd1bmlFNTAxB3VuaUU1MjAHdW5pRTUyMQd1bmlFNTIyB3VuaUU1MjMHdW5pRTUyNAd1bmlFNTI1B3VuaUU1MjkHdW5pRTUyQQd1bmlFNTJCB3VuaUU1MkMHdW5pRTUyRAd1bmlFNTJGB3VuaUU1MzAHdW5pRTUzMQd1bmlFNTM5B3VuaUU1NjYHdW5pRTU2Nwd1bmlFNTY5B3VuaUU1NkMHdW5pRTU2RAd1bmlFNTgyB3VuaUU1RDAHdW5pRTVFMgd1bmlFNjEwB3VuaUU2MTIHdW5pRTYxNAd1bmlFNjE4B3VuaUU2MjQHdW5pRTYzMAd1bmlFNjUwB3VuaUU2NTUHdW5pRTkxMAd1bmlFOTExB3VuaUU5MTIHdW5pRTkxNAd1bmlFOTE1B3VuaUU5MTgHdW5pRTkyMAd1bmlFOTI1B3VuaUU5NUQHdW5pRUEwMgd1bmlFQUE0B3VuaUVDQTIHdW5pRUNBMwd1bmlFQ0E1B3VuaUVDQTcHdW5pRUNBOQd1bmlFQ0I3AAAAAAAAAf//AAIAAQAAAAAAAAAMABQABAAAAAIAAAABAAAAAQAAAAAAAQAAAADZahNDAAAAANGXIhcAAAAA2dy6gQ==") format("truetype")',
size:24},musicspace:6,partsfont:{name:"serif",size:15},parskipfac:.4,partsspace:8,pagewidth:793.8,printmargin:0,rightmargin:1.4*37.8,rbmax:4,rbmin:2,repeatfont:{name:"serif",size:13},scale:1,slurheight:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlefont:{name:"serif",size:16},subtitlespace:3,sysstaffsep:34,tempofont:{name:"serif",weight:"bold",size:12},textfont:{name:"serif",size:16},textspace:14,tieheight:1,titlefont:{name:"serif",size:20},titlespace:6,titletrim:!0,topspace:22,
tuplets:[0,0,0,0],tupletfont:{name:"serif",style:"italic",size:12},vocalfont:{name:"serif",weight:"bold",size:13},vocalspace:10,voicefont:{name:"serif",weight:"bold",size:13},writefields:"CMOPQsTWw",wordsfont:{name:"serif",size:16},wordsspace:5},Ge={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},dd={above:n.SL_ABOVE,auto:0,below:n.SL_BELOW,down:n.SL_BELOW,hidden:n.SL_HIDDEN,opposite:n.SL_HIDDEN,under:n.SL_BELOW,up:n.SL_ABOVE};Abc.prototype.set_format=function(a,c){if(/.+font(-[\d])?$/.test(a))"soundfont"==
a?r.soundfont=c:nb(a,c);else switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurenb":case "rbmax":case "rbmin":case "measrepnb":case "shiftunison":var d=parseInt(c);if(isNaN(d)){y(1,"Bad integer value");break}r[a]=d;break;case "abc-version":case "bgcolor":case "fgcolor":case "titleformat":r[a]=c;break;case "beamslope":case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "stretchlast":case "tieheight":d=
parseFloat(c);if(isNaN(d)){y(1,H.bad_val,"%%"+a);break}switch(a){case "scale":d/=.75;case "pagescale":a="scale",ha.chg=!0}r[a]=d;break;case "annotationbox":case "gchordbox":case "measurebox":case "partsbox":nb(a.replace("box","font"),"* * "+(cb(c)?"box":"nobox"));break;case "bstemdown":case "breakoneoln":case "cancelkey":case "checkbars":case "contbarnb":case "custos":case "decoerr":case "dynalign":case "flatbeams":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "quiet":case "singleline":case "squarebreve":case "splittune":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":r[a]=
cb(c);break;case "dblrepbar":c=":: "+c;case "bardef":d=c.split(/\s+/);2!=d.length?y(1,H.bad_val,"%%bardef"):r.bardef[d[0]]=d[1];break;case "chordalias":d=c.split(/\s+/);d.length?abc2svg.ch_alias[d[0]]=d[1]||"":y(1,H.bad_val,"%%chordalias");break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":d=
Aa(c);isNaN(d)?y(1,H.bad_val,"%%"+a):r[a]=d;break;case "page-format":q.page_format=cb(c);break;case "print-leftmargin":y(0,"$1 is deprecated - use %%printmargin instead","%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":d=Aa(c);if(isNaN(d)){y(1,H.bad_val,"%%"+a);break}r[a]=d;ha.chg=!0;break;case "concert-score":"play"!=r.sound&&(r.sound="concert");break;case "writefields":d=c.split(/\s+/);if(cb(d[1]))for(c=0;c<d[0].length;c++)a=d[0][c],0>r.writefields.indexOf(a)&&
(r.writefields+=a);else for(c=0;c<d[0].length;c++)a=d[0][c],0<=r.writefields.indexOf(a)&&(r.writefields=r.writefields.replace(a,""));break;case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":case "volume":wd(a,c);break;case "font":a=ac(c);1>=a.length||(c=parseFloat(a[a.length-1]),isNaN(c)||.5>=c?y(1,"Bad scale value in %%font"):vd[a[0]]=c);break;case "fullsvg":if(0!=t.state){y(1,H.not_in_tune,"%%fullsvg");break}r[a]=c;break;case "gracespace":d=c.split(/\s+/);for(c=
0;3>c;c++)if(isNaN(Number(d[c]))){y(1,H.bad_val,"%%gracespace");break}for(c=0;3>c;c++)r[a][c]=Number(d[c]);break;case "tuplets":r[a]=c.split(/\s+/);(d=r[a][3])&&dd[d]&&(r[a][3]=dd[d]);break;case "infoname":a:{a=c;c=r.infoname.split("\n");d=a[0];for(var e=0;e<c.length;e++)if(c[e][0]==d){1==a.length?c.splice(e,1):c[e]=a;r.infoname=c.join("\n");break a}r.infoname+="\n"+a}break;case "notespacingfactor":d=parseFloat(c);if(isNaN(d)||1>d||2<d){y(1,H.bad_val,"%%"+a);break}c=5;for(a=fb[c];0<=--c;)a/=d,fb[c]=
a;c=5;for(a=fb[c];++c<fb.length;)a*=d,fb[c]=a;break;case "play":r.sound="play";break;case "pos":a=c.split(/\s+/);wd(a[0],a[1]);break;case "sounding-score":"play"!=r.sound&&(r.sound="sounding");break;case "staffwidth":d=Aa(c);if(isNaN(d)){y(1,H.bad_val,"%%"+a);break}if(100>d){y(1,"%%staffwidth too small");break}d=r.pagewidth-d-r.leftmargin;if(2>d){y(1,"%%staffwidth too big");break}r.rightmargin=d;ha.chg=!0;break;case "textoption":r[a]=Ge[c];break;case "titletrim":d=Number(c);isNaN(d)?r[a]=cb(c):r[a]=
d;break;case "combinevoices":y(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case "voicemap":Lb("map",c);break;case "voicescale":Lb("scale",c);break;case "rbdbstop":(d=cb(c))&&"2.2"<=r["abc-version"]?r["abc-version"]="1":!d&&"2.2">r["abc-version"]&&(r["abc-version"]="2.2");break;default:0==t.state&&(r[a]=c)}};Abc.prototype.style_font=Gc;var ta={},eb={},ic={},bf={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111","=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8",
"/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},af={1:"\u266f",2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},rb=0;Abc.prototype.tosvg=Hc;var J,B,S,Pa,pa,Yb,bc,fb=new Float32Array([8.4,11.2,14.9,19.8,26.3,35,46.6,61.9,82.3,109.5]),Lc,Hd=new Float32Array([10,10,11,13,15]),ye=new Float32Array([4.7,5,6,7.2,7.5]),nc=new Float32Array([3.5,
3.7,5,6,7]);Abc.prototype.set_width=function(a){var c,d,e,g;if(!a.play)switch(a.type){case n.NOTE:case n.REST:a.wr=e=ye[a.head];0<a.xmx&&(a.wr+=a.xmx+4);for(c=a.prev;c&&0==Na[c.type];c=c.prev);if(c)switch(c.type){case n.BAR:case n.CLEF:case n.KEY:case n.METER:e+=3}for(d=0;d<=a.nhd;d++){var f=a.notes[d].shhd;0>f&&e<-f+5&&(e=-f+5);if(f=a.notes[d].acc)f=a.notes[d].shac+("object"==typeof f?5.5:3.5),e<f&&(e=f)}if(c)switch(c.type){case n.BAR:case n.CLEF:case n.KEY:case n.METER:e-=3}a.a_dd&&(e+=yc(a));a.beam_st&&
a.beam_end&&0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+9);if(a.dots){if(void 0==a.wl)switch(a.head){case n.SQUARE:case n.OVALBARS:a.xmx+=3;break;case n.OVAL:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);f=e;if(c)switch(c.type){case n.NOTE:0<c.stem&&0>a.stem&&7>f&&(f=7);(27<a.y&&27<c.y||-3>a.y&&-3>c.y)&&6>f&&(f=6);c.tie&&14>f&&(f=14);break;case n.CLEF:if(c.second||c.clef_small)break;f+=8;break;case n.KEY:f+=4}a.a_gch&&(f=Ld(a,e,f));a.wl=
c&&c.type==n.GRACE?e-4.5:f;return;case n.SPACE:f=a.width/2;a.wr=f;a.a_gch&&(f=Ld(a,f,f));a.a_dd&&(f+=yc(a));a.wl=f;return;case n.BAR:f=a.bar_type;switch(f){case "|":e=5;break;default:for(e=2+2.8*f.length,c=0;c<f.length;c++)switch(f[c]){case "[":case "]":e+=3;break;case ":":e+=2}}a.wl=e;a.wr=a.next&&a.next.type!=n.METER?7:5;for(c=a.prev;c;c=c.prev)if(0!=Na[c.type]){c.type==n.GRACE&&(a.wl-=8);break}a.a_dd&&(a.wl+=yc(a));a.text&&4>a.text.length&&a.next&&a.next.a_gch&&(ba("repeat"),a.wr+=va(a.text)[0]+
2,0<r.measurenb&a.bar_num&&a.bar_num%r.measurenb&&(a.wr+=4));return;case n.CLEF:if(a.invis){a.wl=a.wr=1;return}a.wl=a.clef_small?11:12;a.wr=a.clef_small?10:12;a.next&&a.next.type==n.BAR&&(a.wr-=4);return;case n.KEY:if(a.invis){a.wl=a.wr=0;return}a.wl=3;var h=4;if(a.k_a_acc){if(e=g=a.k_a_acc.length)d=a.k_a_acc[0].acc;for(c=1;c<g;c++)f=a.k_a_acc[c],f.pit>a.k_a_acc[c-1].pit+6||f.pit<a.k_a_acc[c-1].pit-6?e--:f.acc!=d&&(h+=3),d=f.acc}else e=a.k_sf,g=a.k_old_sf&&(r.cancelkey||0==e)?a.k_old_sf:0,0<=e*g?
(0>e&&(e=-e),0>g&&(g=-g),g>e&&(e=g)):(e-=g,0>e&&(e=-e),h+=3);a.wr=5.5*e+h;return;case n.METER:f=0;a.x_meter=[];for(c=0;c<a.a_meter.length;c++)switch(g=a.a_meter[c],g.top[0]){case "C":case "c":case "o":a.x_meter[c]=f+6;f+=12;break;case ".":case "|":a.x_meter[c]=a.x_meter[c-1];break;default:e=0;g=!g.bot||g.top.length>g.bot.length?g.top:g.bot;for(d=0;d<g.length;d++)switch(g[d]){case "(":f+=4;case ")":case "1":e+=4;break;default:e+=12}a.x_meter[c]=f+e/2;f+=e}a.wl=0;a.wr=f+6;return;case n.MREST:a.wl=6;
a.wr=66;return;case n.GRACE:if(a.invis)break;g=r.gracespace[0];c=r.gracespace[1];d=r.gracespace[2];e=a.extra;a.prev&&a.prev.type==n.BAR&&(g-=3);for(e.beam_st=!0;;e=e.next){Gd(e);Id(e.notes,7);var l=0;for(h=e.nhd;0<=h;h--)e.notes[h].shac>l&&(l=e.notes[h].shac);g+=l;e.x=g;0>=e.nflags&&(e.beam_st=!0,e.beam_end=!0);h=e.next;if(!h){e.beam_end=!0;break}0>=h.nflags&&(e.beam_end=!0);e.beam_end&&(h.beam_st=!0,g+=c/4);0>=e.nflags&&(g+=c/4);e.y>h.y+8&&(g-=1.5);g+=c}(h=a.next)&&h.type==n.NOTE&&(e.y>=3*(h.notes[h.nhd].pit-
18)?--d:e.beam_st&&e.y<3*(h.notes[h.nhd].pit-18)-4&&(d+=2));a.wl=g+d;a.wr=0;a.a_ly&&ly_width(a,f);return;case n.STBRK:a.wl=a.xmx;a.next&&a.next.type==n.CLEF?(a.wr=2,delete a.next.clef_small):a.wr=8;return;case n.CUSTOS:a.wl=a.wr=4;return;case n.TEMPO:je(a);break;case n.BLOCK:case n.PART:case n.REMARK:case n.STAVES:break;default:v(2,a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0};var ed={t:-4,c:0,b:4,p:-6},He=[[18,18],[12,18],[12,12],[0,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,
10]];Abc.prototype.set_pitch=function(a){var c,d,e=n.BLEN,g=S+1,f=new Int16Array(Array(2*g));for(c=0;c<=S;c++){var h=B[c].clef;f[c]=ed[h.clef_type]+2*h.clef_line;h.clefpit&&(f[c]+=h.clefpit);r.sound?h.clef_octave&&!h.clef_oct_transp&&(f[c]+=h.clef_octave):h.clef_oct_transp&&(f[c]-=h.clef_octave)}for(h=P;h!=a;h=h.ts_next)switch(c=h.st,h.type){case n.CLEF:f[c]=ed[h.clef_type]+2*h.clef_line;h.clefpit&&(f[c]+=h.clefpit);r.sound?h.clef_octave&&!h.clef_oct_transp&&(f[c]+=h.clef_octave):h.clef_oct_transp&&
(f[c]-=h.clef_octave);Oc(h);break;case n.GRACE:for(c=h.extra;c;c=c.next){if((d=f[c.st])&&!h.p_v.ckey.k_drum)for(g=0;g<=c.nhd;g++){var l=c.notes[g];l.opit=l.pit;l.pit+=d}c.ymn=3*(c.notes[0].pit-18)-2;c.ymx=3*(c.notes[c.nhd].pit-18)+2}Oc(h);break;case n.KEY:h.k_y_clef=f[c];default:Oc(h);break;case n.MREST:if(h.invis)break;h.y=12;h.ymx=39;h.ymn=-2;break;case n.REST:if(1==F.length){h.y=12;h.ymx=24;h.ymn=0;break}case n.NOTE:if((d=f[c])&&!h.p_v.ckey.k_drum)for(g=h.nhd;0<=g;g--)l=h.notes[g],l.opit=l.pit,
l.pit+=d;h.type==n.REST&&(h.y=6*((h.notes[0].pit-18)/2|0),h.ymx=h.y+He[5-h.nflags][0],h.ymn=h.y-He[5-h.nflags][1]);h.dur<e&&(e=h.dur)}a||(Lc=e)};Abc.prototype.set_stem_dir=function(){for(var a,c,d,e,g,f,h,l=[],k=P,m=L,t=m.nstaff;k;){for(a=0;a<=t;a++)l[a]=[];h=[];for(c=k;c&&c.type!=n.BAR;c=c.ts_next)if(c.type==n.STAVES){if(c!=k)break;m=k.sy;for(a=t;a<=m.nstaff;a++)l[a]=[];t=m.nstaff}else if(!(c.type!=n.NOTE&&c.type!=n.REST||c.invis)){a=c.st;if(a>t)throw c="*** fatal set_stem_dir(): bad staff number "+
a+" max "+t,v(2,null,c),Error(c);d=c.v;e=h[d];e||(e={st1:-1,st2:-1},h[d]=e);0>e.st1?e.st1=a:e.st1!=a&&(a>e.st1?a>e.st2&&(e.st2=a):(e.st1>e.st2&&(e.st2=e.st1),e.st1=a));g=l[a];e=m.voices[d].range;for(d=g.length;0<=--d&&(f=g[d],f.v!=e););if(0>d){f={v:e,ymx:0,ymn:24};for(d=0;d<g.length;d++)if(e<g[d].v){g.splice(d,0,f);break}d==g.length&&g.push(f)}c.type==n.NOTE&&(c.ymx>f.ymx&&(f.ymx=c.ymx),c.ymn<f.ymn&&(f.ymn=c.ymn),c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=n.NOTE?(v(1,k,"Bad !xstem!"),c.xstem=!1):
(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;k!=c;k=k.ts_next)if(!k.multi){switch(k.type){default:continue;case n.REST:if(void 0!=k.combine&&0>k.combine||!k.ts_next||k.ts_next.type!=n.REST||k.ts_next.st!=k.st||k.time!=k.ts_next.time||k.dur!=k.ts_next.dur||k.a_dd&&k.ts_next.a_dd||k.a_gch&&k.ts_next.a_gch||k.invis)break;k.ts_next.a_dd&&(k.a_dd=k.ts_next.a_dd);k.ts_next.a_gch&&(k.a_gch=k.ts_next.a_gch);ob(k.ts_next);case n.NOTE:case n.GRACE:}a=k.st;d=k.v;e=h[d];g=l[a];if(e&&0<=e.st2)a==e.st1?k.multi=
-1:a==e.st2&&(k.multi=1);else if(1>=g.length)k.floating&&(k.multi=a==F[d].st?-1:1);else{e=m.voices[d].range;for(d=g.length;0<=--d&&g[d].v!=e;);0>d||(d==g.length-1?k.multi=-1:(k.multi=1,0!=d&&d+2==g.length&&(g[d].ymn-r.stemheight>=g[d+1].ymx&&(k.multi=-1),a=k.ts_next,k.ts_prev&&k.ts_prev.time==k.time&&k.ts_prev.st==k.st&&k.notes[k.nhd].pit==k.ts_prev.notes[0].pit&&k.beam_st&&k.beam_end&&(!a||a.st!=k.st||a.time!=k.time)&&(k.multi=-1))))}}for(;k&&k.type==n.BAR;)k=k.ts_next}};Abc.prototype.set_stems=
function(){var a,c,d,e;for(a=P;a;a=a.ts_next)if(a.type!=n.NOTE){if(a.type==n.GRACE){var g=e=a.mid;for(c=a.extra;c;c=c.next){var f=ec(a,c.dur);c.head=f[0];c.dots=f[1];c.nflags=f[2];f=15;1<c.nflags&&(f+=1.2*(c.nflags-1));var h=3*(c.notes[0].pit-18);var l=3*(c.notes[c.nhd].pit-18);0<=a.stem?(c.y=h,c.ys=l+f,l=Math.round(c.ys)):(c.y=l,c.ys=h-f,h=Math.round(c.ys));l+=2;h-=2;h<g?g=h:l>e&&(e=l);c.ymx=l;c.ymn=h}a.ymx=e;a.ymn=g}}else{Gd(a);c=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(c=++a.nflags);
for(f=a.next;f.type!=n.NOTE||(a.feathered_beam&&f.nflags++,!f.beam_end);f=f.next);f.nflags>c&&(c=f.nflags)}else if(!a.beam_st&&a.beam_end){for(f=a.prev;!f.beam_st;f=f.prev);f.nflags>c&&(c=f.nflags)}f=r.stemheight;switch(c){case 2:f+=0;break;case 3:f+=4;break;case 4:f+=8;break;case 5:f+=12}1!=(d=a.p_v.scale)&&(f*=.5*(d+1));h=3*(a.notes[0].pit-18);0<a.nhd?(f-=2,l=3*(a.notes[a.nhd].pit-18)):l=h;a.ntrem&&(f+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=h,a.ys=l):(a.ys=h,a.y=l),a.ymx=l+4,a.ymn=h-4):0<=a.stem?
(26<a.notes[a.nhd].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(f-=2,28<a.notes[a.nhd].pit&&(f-=2)),a.y=h,a.notes[0].tie&&(h-=3),a.ymn=h-4,a.ys=l+f,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(f-=2,16>a.notes[0].pit&&(f-=2)),a.ys=h-f,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=l,a.notes[a.nhd].tie&&(l+=3),a.ymx=l+4)}};var oc=[];Abc.prototype.block_gen=function(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":db();
W.set_format(a.subtype,a.param);break;case "mc_start":T={posy:fa,maxy:fa,lmarg:r.leftmargin,rmarg:r.rightmargin};break;case "mc_new":if(!T){v(1,a,"%%multicol new without start");break}fa>T.maxy&&(T.maxy=fa);r.leftmargin=T.lmarg;r.rightmargin=T.rmarg;ha.chg=!0;Ha();fa=T.posy;break;case "mc_end":if(!T){v(1,a,"%%multicol new without start");break}fa<T.maxy&&(fa=T.maxy);r.leftmargin=T.lmarg;r.rightmargin=T.rmarg;T=void 0;db();ha.chg=!0;Ha();break;case "ml":db();q.img_out(a.text);break;case "newpage":ub();
if(!q.page_format)break;0>Da&&q.img_out("</div>");Da=2;break;case "sep":Ha();ma(a.sk1);G+='<path class="stroke"\n\td="M';Ra((ha.width-a.l)/2-ha.lm," ",0);G+="h"+a.l.toFixed(1)+'"/>\n';ma(a.sk2);break;case "text":ba(a.font);tc(a.text,a.opt);break;case "title":Xc(a.text,!0);break;case "vskip":ma(a.sk)}};Abc.prototype.set_sym_glue=function(a){var c,d,e=0,g=0,f=0,h=0,l=0;for(c=P;c;c=c.ts_next)c.type!=n.GRACE||d||(d=c),c.seqst&&(e+=c.shrink,c.space?c.space<c.shrink?(l+=c.shrink,g+=c.shrink):g+=c.space:
h+=c.shrink);if(g){var k=!Pa||Pa.type==n.BLOCK&&!Pa.play||oc.length;if(e>=a){e>a&&v(1,c,"Line too much shrunk $1 $2 $3",e.toFixed(1),g.toFixed(1),a.toFixed(1));f=0;for(c=P;c;c=c.ts_next)c.seqst&&(f+=c.shrink),c.x=f;bc=0}else if(k&&g+h>a*(1-r.stretchlast)||!k&&(g+h>a||r.stretchstaff)){g==l&&(g+=5);for(k=4;0<=--k;){var m=(a-h-l)/(g-l);f=l=g=0;for(c=P;c;c=c.ts_next)c.seqst&&(c.space?c.space*m<=c.shrink?(l+=c.shrink,g+=c.shrink,f+=c.shrink):(g+=c.space,f+=c.space*m):f+=c.shrink),c.x=f;if(.1>Math.abs(f-
a))break}bc=m}else for(m=(a-h-l)/g,bc<m&&(m=bc),c=P;c;c=c.ts_next)c.seqst&&(f+=c.space*m<=c.shrink?c.shrink:c.space*m),c.x=f;pa=f;for(c=d;c;c=c.ts_next)if(c.type==n.GRACE)for(f=c.gr_shift?c.prev.x+c.prev.wr:c.x-c.wl,a=c.extra;a;a=a.next)a.x+=f}else pa=0};Abc.prototype.output_music=function(){var a,c=F.length;Pd();if(P){for(var d,e,g=F.length,f=L,h=f.nstaff;;){f=f.next;if(!f)break;f.nstaff>h&&(h=f.nstaff)}S=h;for(var l,k=P;k.ts_next;)k=k.ts_next;k.type!=n.BAR&&(l=Nc(k),l.seqst=!0,l.invis=!0,l.time=
k.time+(k.dur||0),l.ts_prev=k,k.next=k.ts_next=l);for(e=0;e<g;e++){d=F[e];var m=void 0,t=void 0,q=void 0,u=void 0,p=void 0,v=!0,y=127;for(p=d.sym;p;p=p.next)if(p.type==n.NOTE){y=p.notes[0].pit;break}for(p=d.sym;p;p=p.next){p.a_gch&&W.gch_build(p);switch(p.type){case n.MREST:v=!0;break;case n.BAR:var z=p,D=p.bar_type;z.bar_type=r.bardef[D]||D;p.beam_on||(v=!0);p.next||!p.prev||p.invis||p.prev.head!=n.OVALBARS||(p.prev.head=n.SQUARE);break;case n.GRACE:for(u=p.extra;u;u=u.next)u.notes.sort(abc2svg.pitcmp);
break;case n.NOTE:case n.REST:if(m=ec(p,p.dur_orig),p.head=m[0],p.dots=m[1],p.nflags=m[2],-2>=p.nflags&&(p.stemless=!0),p.xstem&&(p.nflags=0),p.trem1&&(p.nflags=0<p.nflags?p.nflags+p.ntrem:p.ntrem),!p.next||!p.next.trem2)if(p.trem2)p.prev.trem2=!0,p.prev.nflags=--p.nflags,p.prev.head=++p.head,0<p.nflags?p.nflags+=p.ntrem:(-2>=p.nflags&&(p.stemless=!0,p.prev.stemless=!0),p.nflags=p.ntrem),p.prev.nflags=p.nflags;else{q=p.nflags;p.ntrem&&(q+=p.ntrem);p.type==n.REST&&p.beam_end&&!p.beam_on&&(p.beam_end=
!1,v=!0);if(v||0>=q)if(t&&(t.beam_end=!0,t=null),0>=q)p.beam_st=!0,p.beam_end=!0;else if(p.type==n.NOTE||p.beam_on)p.beam_st=!0,v=!1;p.beam_end&&(v=!0);if(p.type==n.NOTE||p.beam_on)t=p}}if(p.type==n.NOTE)for(p.nhd&&p.notes.sort(abc2svg.pitcmp),y=p.notes[0].pit,u=p.prev;u&&u.type==n.REST;u=u.prev)u.notes[0].pit=y;else p.notes||(p.notes=[],p.notes[0]={},p.nhd=0),p.notes[0].pit=y}t&&(t.beam_end=!0);d.ckey=d.key;for(var I=void 0,J=void 0,H=d.sym;H;)if(H.type!=n.BAR||!H.rbstart||H.norepbra)H=H.next;else for(I=
0,J=null,H=H.next;H;H=H.next)if(H.type==n.BAR){I++;if(H.rbstop)break;if(!H.next){H.rbstop=2;break}I==r.rbmin&&(J=H);if(I==r.rbmax){J&&(H=J);H.rbstop=1;break}}}if(1<g){var O,K,M;for(O=0;O<F.length;O++){var da=F[O];var V=!1;var ea=da.st;for(K=da.sym;K;K=K.next){if(!K.floating){for(;K&&!K.floating;)K=K.next;if(!K)break;V=!1}if(K.dur)if(19<=K.notes[0].pit)V=!1;else if(12>=K.notes[K.nhd].pit)V=!0,K.st++;else{var Z=127;for(M=K.ts_prev;M&&M.st==ea&&M.v!=K.v;M=M.ts_prev)M.type==n.NOTE&&M.notes[0].pit<Z&&
(Z=M.notes[0].pit);if(127==Z)V&&K.st++;else if(K.notes[K.nhd].pit>Z-3)V=!1;else{var ba=-127;for(M=K.ts_next;M&&M.st==ea+1&&M.v!=K.v;M=M.ts_next)M.type==n.NOTE&&M.notes[M.nhd].pit>ba&&(ba=M.notes[M.nhd].pit);if(-127==ba)V&&K.st++;else{if(K.notes[0].pit<ba+3)V=!0;else if(Z-=K.notes[K.nhd].pit,ba=K.notes[0].pit-ba,!V){if(Z<ba+3)continue;V=!0}else if(Z<ba-3){V=!1;continue}K.st++}}}else V&&K.st++}}if(na.mrest_p){var U;for(U=P;U;U=U.ts_next)if(U.type==n.MREST){if(!U.seqst&&Na[U.ts_prev.type])var fa=U;else for(fa=
U.ts_next;!fa.seqst&&fa.type==n.MREST&&fa.nmes==U.nmes;)fa=fa.ts_next;if(fa.seqst)U=fa.ts_prev;else for(;U.type==n.MREST;){var la,ia,T,Y=U,sa=Y.nmes,va=Y.dur/sa;Y.type=n.REST;Y.dur=Y.dur_orig=va;Y.nflags=-2;Y.head=n.FULL;var ra=Y.time+va;for(T=la=Y.next;!T.bar_num;)T=T.ts_prev;var Ba=T.bar_num-Y.nmes;for(ia=Y;0<--sa;){la?(T=A(la),delete T.soln,delete T.a_gch,delete T.a_dd,jc(T,la)):(T=Nc(Y),Y.next=T);for(T.time=ra;ia.time<ra;)ia=ia.ts_next;for(;ia&&ia.v<Y.v&&ia.type==n.BAR;)ia=ia.ts_next;if(ia)Qb(T,
ia),ia.type==n.BAR&&delete ia.bar_num;else{for(ia=Y;ia.ts_next;)ia=ia.ts_next;ia.ts_next=T;T.ts_prev=ia;T.ts_next=null}Ba++;if(T.seqst){T.bar_num=Ba;var Ga=T.ts_next}else delete T.bar_num,Ga=T.ts_prev;T.bar_type=Ga.bar_type||"|";Ga.bar_num&&!Ga.seqst&&delete Ga.bar_num;Ga=A(Y);delete Ga.a_dd;delete Ga.soln;T.next?(Ga.next=T.next,Ga.next.prev=Ga):Ga.next=null;T.next=Ga;Ga.prev=T;for(Ga.time=ra;ia&&!ia.dur&&ia.time==ra;)ia=ia.ts_next;for(;ia&&ia.v<Y.v&&(!(ia=ia.ts_next)||!ia.seqst););if(ia)Qb(Ga,ia);
else{for(ia=Y;ia.ts_next;)ia=ia.ts_next;ia.ts_next=Ga;Ga.ts_prev=ia;Ga.ts_next=null}ra+=va;Y=ia=Ga}U=U.ts_next}}}}na.ottava&&"play"!=r.sound&&kf();var R,aa,wa,Ka=Array(S+1),ka=L,Fa=[];B=Array(S+1);for(R=0;R<=S;R++)Ka[R]={autoclef:!0},B[R]={output:"",sc_out:""};for(aa=0;aa<F.length;aa++){var Ca=F[aa];ka.voices[aa]&&(R=ka.voices[aa].st,ka.voices[aa].second||(ka.staves[R].staffnonote=Ca.staffnonote,Ca.staffscale&&(ka.staves[R].staffscale=Ca.staffscale),ka.voices[aa].sep&&(ka.staves[R].sep=ka.voices[aa].sep),
ka.voices[aa].maxsep&&(ka.staves[R].maxsep=ka.voices[aa].maxsep),Ca.clef.clef_auto||(Ka[R].autoclef=!1)))}for(aa=0;aa<F.length;aa++)if(Ca=F[aa],ka.voices[aa]&&!ka.voices[aa].second){R=ka.voices[aa].st;var ca=Ca.clef;Ka[R].autoclef&&(ca.clef_type=Pc(R,P,ca.clef_type),ca.clef_line="t"==ca.clef_type?2:4);Ka[R].clef=B[R].clef=ca}for(R=0;R<=ka.nstaff;R++)Fa[R]=3*(ka.staves[R].stafflines.length-1);for(ca=P;ca;ca=ca.ts_next){ca.repeat_n&&hf(ca);switch(ca.type){case n.STAVES:ka=ca.sy;for(R=0;R<=S;R++)Ka[R].autoclef=
!0;for(aa=0;aa<F.length;aa++)if(ka.voices[aa]){Ca=F[aa];R=ka.voices[aa].st;ka.voices[aa].second||(ka.staves[R].staffnonote=Ca.staffnonote,Ca.staffscale&&(ka.staves[R].staffscale=Ca.staffscale),ka.voices[aa].sep&&(ka.staves[R].sep=ka.voices[aa].sep),ka.voices[aa].maxsep&&(ka.staves[R].maxsep=ka.voices[aa].maxsep));var ua=Ca.clef;ua.clef_auto||(Ka[R].autoclef=!1)}for(R=0;R<=ka.nstaff;R++)Fa[R]=3*(ka.staves[R].stafflines.length-1);for(aa=0;aa<F.length;aa++)if(ka.voices[aa]&&!ka.voices[aa].second){Ca=
F[aa];R=ka.voices[aa].st;ua=Ca.clef;if(ua.clef_auto){var za=Pc(R,ca,Ka[R].clef?Ka[R].clef.clef_type:"a");var Ea="t"==za?2:4}else za=ua.clef_type,Ea=ua.clef_line;if(!Ka[R].clef)ua.clef_auto&&("a"!=ua.type&&(Ca.clef=A(Ca.clef)),Ca.clef.clef_type=za,Ca.clef.clef_line=Ea),B[R].clef=Ka[R].clef=Ca.clef;else if(za!=Ka[R].clef.clef_type||Ea!=Ka[R].clef.clef_line){for(wa=ca.ts_prev;wa&&wa.time==ca.time&&(wa.v!=aa||wa.st!=R);)wa=wa.ts_prev;if(!wa||wa.time!=ca.time){for(wa=ca.ts_next;wa&&(wa.v!=aa||wa.st!=R);)wa=
wa.ts_next;wa&&wa.time==ca.time||(wa=ca)}wa.type!=n.CLEF&&(wa=Jd(wa,za,Ea),ua.clef_auto&&(wa.clef_auto=!0));Ka[R].clef=Ca.clef=wa}}continue;default:ca.mid=Fa[ca.st];continue;case n.CLEF:}"a"==ca.clef_type&&(ca.clef_type=Pc(ca.st,ca.ts_next,Ka[ca.st].clef.clef_type),ca.clef_line="t"==ca.clef_type?2:4);Ca=ca.p_v;Ca.clef=ca;if(ca.second)ob(ca);else{R=ca.st;if(Ka[R].clef){if(ca.clef_type==Ka[R].clef.clef_type&&ca.clef_line==Ka[R].clef.clef_line)continue}else B[R].clef=ca;Ka[R].clef=ca}}ka=L;for(aa=0;aa<
F.length;aa++)if(ka.voices[aa]&&(ua=F[aa].sym)&&127==ua.notes[0].pit){R=ka.voices[aa].st;switch(B[R].clef.clef_type){default:var Ja=22;break;case "c":Ja=16;break;case "b":Ja=10}for(ca=ua;ca;ca=ca.next)ca.notes[0].pit=Ja}W.set_pitch(null);1<c&&W.set_stem_dir();for(a=0;a<c;a++){var qa,ta,Ha=void 0,Ma=void 0,X,Ia=-1;for(X=F[a].sym;X;X=X.next)if(X.type!=n.NOTE){if(X.type==n.GRACE){var ja=X.extra;if(2==ja.stem)Ha=X;else for(X.stem||0!=(X.stem=X.multi)||(X.stem=1);ja;ja=ja.next)ja.stem=X.stem,ja.multi=
X.multi}}else{if(X.stem||0!=(X.stem=X.multi))X.beam_st&&!X.beam_end&&(Ma=!0);else{var Aa=X.mid/3+18;if(Ma)X.stem=Ia;else if(X.beam_st&&!X.beam_end){Ma=!0;var Da=qa=0;for(ja=X;ja;ja=ja.next)if(ja.type==n.NOTE){if(ja.stem||ja.multi){X.stem=ja.stem||ja.multi;break}Da+=ja.nhd+1;for(ta=0;ta<=ja.nhd;ta++)ja.notes[ta].pit>=Aa&&qa++;if(ja.beam_end)break}if(!X.stem)if(qa*=2,qa>Da)X.stem=-1;else if(qa<Da)X.stem=1;else{qa=X.notes[X.nhd].pit;var Ra=X.notes[0].pit;for(ja=X.next;ja&&(ja.type!=n.NOTE||(ja.notes[ja.nhd].pit>
qa&&(qa=ja.notes[ja.nhd].pit),ja.notes[0].pit<Ra&&(Ra=ja.notes[0].pit),!ja.beam_end));ja=ja.next);ja.beam_end&&(qa+Ra<2*Aa?X.stem=1:qa+Ra>2*Aa?X.stem=-1:r.bstemdown&&(X.stem=-1))}X.stem||(X.stem=Ia)}else{Da=(X.notes[X.nhd].pit+X.notes[0].pit)/2;if(Da==Aa){for(ta=0;ta<=X.nhd&&!(X.notes[ta].pit>=Aa);ta++);Da=2*ta<X.nhd?Aa-1:Aa+1}X.stem=Da<Aa?1:Da>Aa?-1:r.bstemdown?-1:Ia}}X.beam_end&&(Ma=!1);Ia=X.stem;if(Ha){for(ja=Ha.extra;ja;ja=ja.next)ja.stem=-Ia;Ha.stem=-Ia;Ha=null}}}W.set_stems();var Va,xb,Ta,Ua;
for(Va=P;Va;)if(Va.type!=n.NOTE||Va.invis)Va=Va.ts_next;else{var pb=Va.st;var qb=Va.time;var fb=!1;for(xb=Va;xb&&xb.time==qb&&xb.type==n.NOTE&&xb.st==pb;xb=xb.ts_next)if(!fb)for(Ta=0;Ta<=xb.nhd;Ta++)if(xb.notes[Ta].acc){fb=!0;break}if(fb){var tb=Hd[Va.head];for(Ua=[];Va!=xb;Va=Va.ts_next)Array.prototype.push.apply(Ua,Va.notes);Ua.sort(abc2svg.pitcmp);Id(Ua,tb)}else Va=xb}if(1<c){var N,Qa,Oa,cb=[],Ya=L;for(N=P;N;N=N.ts_next)if(!N.invis&&(N.type==n.STAVES&&(Ya=N.sy),N.dur)){var yb=cb[N.v];yb||(yb={},
cb[N.v]=yb);yb.s=N;yb.st=N.st;yb.end_time=N.time+N.dur;if(N.type==n.REST){var zb=-127;var Ab=127;var mb=Oa=!1;for(Qa=0;Qa<=cb.length;Qa++)if((yb=cb[Qa])&&yb.s&&yb.st==N.st&&Qa!=N.v&&!(yb.end_time<=N.time)){mb=!0;var oa=yb.s;Ya.voices[Qa].range<Ya.voices[N.v].range?oa.time==N.time?oa.ymn<Ab&&(Ab=oa.ymn,oa.dots&&(Oa=!0)):oa.y<Ab&&(Ab=oa.y):oa.time==N.time?oa.ymx>zb&&(zb=oa.ymx,oa.dots&&(Oa=!0)):oa.y>zb&&(zb=oa.y)}var Hb=N.time+N.dur;for(oa=N.ts_next;oa&&!(oa.time>=Hb);oa=oa.ts_next)oa.st==N.st&&oa.dur&&
!oa.invis&&(mb=!0,Ya.voices[oa.v].range<Ya.voices[N.v].range?oa.time==N.time?oa.ymn<Ab&&(Ab=oa.ymn,oa.dots&&(Oa=!0)):oa.y<Ab&&(Ab=oa.y):oa.time==N.time?oa.ymx>zb&&(zb=oa.ymx,oa.dots&&(Oa=!0)):oa.y>zb&&(zb=oa.y));if(mb){if(127==Ab&&12>N.y){var xa=12-N.y;N.y+=xa;N.ymx+=xa;N.ymn+=xa}-127==zb&&12<N.y&&(xa=N.y-12,N.y-=xa,N.ymx-=xa,N.ymn-=xa);xa=Ab-N.ymx;if(0>xa)if(xa=6*Math.ceil(-xa/6),N.ymn-xa>=zb)N.y-=xa,N.ymx-=xa,N.ymn-=xa;else{var ab=Oa?15:10;N.notes[0].shhd=ab;N.xmx=ab}else xa=zb-N.ymn,0<xa&&(xa=
6*Math.ceil(xa/6),N.ymx+xa<=Ab?(N.y+=xa,N.ymx+=xa,N.ymn+=xa):(ab=Oa?15:10,N.notes[0].shhd=ab,N.xmx=ab))}else N.y=12,N.ymx=24,N.ymn=0}}of()}var hb,ib,Wa,gb=P,ya=gb,jb=0,kb=[],Sa=[];var lb=jb;for(ib=gb.time;;){do{!gb.a_gch&&!gb.a_ly||hb||(hb=gb);W.set_width(gb);var Za=gb.st;void 0==kb[Za]&&(kb[Za]=0);void 0==Sa[Za]&&(Sa[Za]=0);var Jb=kb[Za]+Sa[Za]+gb.wl;Jb>lb&&(lb=Jb);gb=gb.ts_next}while(gb&&!gb.seqst);ya.shrink=lb-jb;ya.space=ya.ts_prev?Mc(ya,ib):0;if(ya.dur&&ya.dur!=ya.notes[0].dur){if(!Wa){for(Wa=
ya;Wa.prev&&Wa.prev.dur&&Wa.prev.dur!=Wa.prev.notes[0].dur;)Wa=Wa.prev;for(;!Wa.seqst;)Wa=Wa.ts_prev}}else if(Wa&&Wa.v==ya.v){for(var Ib=Wa,Cb=ya,Eb=Ib.time,Kb=Cb.time-Eb,Fb=Md(Ib,Kb),bb=Ib,Gb=0;bb=bb.ts_next,bb.seqst&&(Gb+=bb.space,bb.bar_type&&(Gb+=10)),bb!=Cb;);for(Fb=(Fb+Gb)/2/Kb;Ib=Ib.ts_next,Ib.seqst&&(Ib.space=Fb*(Ib.time-Eb),Eb=Ib.time),Ib!=Cb;);Wa=null}ya.shrink||ya.space||ya.type!=n.CLEF||(delete ya.seqst,ya.time=ib);ib=ya.time;if(!gb)break;for(Za=0;Za<Sa.length;Za++)Sa[Za]=0;jb=lb;do Za=
ya.st,kb[Za]=jb,ya.wr>Sa[Za]&&(Sa[Za]=ya.wr),ya=ya.ts_next;while(!ya.seqst)}if(hb)for(var $a=hb,rb,eb,sb,Rb,Mb,ub=0,vb=0;$a;$a=$a.ts_next)if($a.shrink&&(ub+=$a.shrink,vb++),$a.a_ly&&Kc($a),$a.a_gch)for(rb=0;rb<$a.a_gch.length;rb++)if(eb=$a.a_gch[rb],!("g"!=eb.type||0>eb.y)){if(sb&&sb>ub+eb.x)for($a.prev&&$a.prev.type==n.BAR&&vb--,Mb=(sb-ub-eb.x)/vb;Rb=Rb.ts_next,Rb.shrink&&(Rb.shrink+=Mb),Rb!=$a&&Rb.type!=n.BAR;);Rb=$a;sb=eb.text.wh[0];ub=vb=0;break}var Nb=Qc(!0);if(r.singleline){a=Nd();var wb=Nb+
a[0]+a[1]+Od(P,null)[0];ha.width=wb*r.scale+ha.lm+ha.rm+2}else{var Db=wb=Wb(),nb=Nb,La,Xa=P;if(nb){var Sb=Qc();Db-=Sb;nb-=Sb}Sb=Nd();Db-=Sb[0];nb+=Sb[1];r.custos&&1==F.length&&(Db-=12);if(r.barsperstaff)for(Sb=r.barsperstaff,La=Xa;La;La=La.ts_next)if(La.type==n.BAR&&La.bar_num&&!(0<--Sb)){for(;La.ts_next&&La.ts_next.type==n.BAR;)La=La.ts_next;La.ts_next&&(La.ts_next.soln=!0);Sb=r.barsperstaff}for(La=Xa;Xa;Xa=Xa.ts_next){if(Xa.ts_next)if(Xa.soln){Xa.soln=!1;if(Xa.time==La.time)continue;for(;!Xa.seqst;)Xa=
Xa.ts_prev}else continue;else Xa=null;La=jf(La,Xa,Db,nb);if(!La)break;Xa=La;nb=0}}var Tb=P;for(a=c;0<=--a;)F[a].osym=F[a].sym;for(bc=1.2;;){qf();W.set_sym_glue(wb-Nb);if(pa){Nb&&(Ub+=Nb);Te();var Vb=Xe();Ye(Nb);Ze();var Bb;for(Bb=0;Bb<=S;Bb++)B[Bb].sc_out&&(G+="<g "+B[Bb].scale_str+">\n"+B[Bb].sc_out+"</g>\n",B[Bb].sc_out=""),B[Bb].output&&(G+='<g transform="translate(0,'+(-B[Bb].y).toFixed(1)+')">\n'+B[Bb].output+"</g>\n",B[Bb].output="");ma(Vb);Nb&&(Ub-=Nb,Yb&=-3);for(;oc.length;)W.block_gen(oc.shift())}db();
Lb&&(Lb.ts_next.ts_prev=Lb);if(!Pa)break;Pa.ts_prev.ts_next=P=Pa;Pd();if(!P)break;var Lb=P.ts_prev;P.ts_prev=null;for(var Xb,Ob,Pb=F.length;0<=--Pb;)Ob=F[Pb],Ob.sym&&Ob.s_prev&&(Ob.sym.prev=Ob.s_prev),Xb=Ob.s_next,(Ob.sym=Xb)?(Xb.prev&&(Xb.prev.next=Xb),Ob.s_prev=Xb.prev,Xb.prev=null):Ob.s_prev=null;wb=Wb();Nb=Qc()}P=Tb;for(a=c;0<=--a;){var Zb=F[a];Zb.sym&&Zb.s_prev&&(Zb.sym.prev=Zb.s_prev);Zb.sym=Zb.osym}}};var Ua,Y=[],T,Sa={},tf=new Int8Array([0,1,3,2,3,0,2,0,3,0]),Mb="CDEFGABcdefgab";Abc.prototype.set_vp=
function(a){for(var c,d,e,g,f;;){d=a.shift();if(!d)break;if("="==d.slice(-1)&&!a.length){y(1,H.bad_val,d);break}switch(d){case "clef=":c=a.shift();break;case "clefpitch=":if(d=a.shift())if(g=Mb.indexOf(d[0]),0<=g){switch(d[1]){case "'":g+=7;break;case ",":g-=7,","==d[2]&&(g-=7)}f=4-g;break}y(1,H.bad_val,d);break;case "octave=":g=parseInt(a.shift());isNaN(g)?y(1,H.bad_val,d):m.octave=g;break;case "cue=":m.scale="on"==a.shift()?.7:1;break;case "instrument=":d=a.shift();g=d.indexOf("/");0>g?(g=0,m.sndtran=
lb("c"+d)):(m.sndtran=lb("c"+d.slice(g+1)),g=lb(d.replace("/","")));m.transp=r.sound?m.sndtran:g;break;case "map=":m.map=a.shift();break;case "name=":case "nm=":m.nm=a.shift();'"'==m.nm[0]&&(m.nm=m.nm.slice(1,-1));m.new_name=!0;break;case "stem=":case "pos=":d="pos="==d?a.shift().split(" "):["stm",a.shift()];g=dd[d[1]];if(void 0==g){y(1,H.bad_val,d[0]);break}e||(e={});e[d[0]]=g;break;case "scale=":g=parseFloat(a.shift());isNaN(g)||.5>g||2<g?y(1,H.bad_val,"%%voicescale"):m.scale=g;break;case "score=":if(r.nedo){y(1,
H.notransp);break}d=a.shift();if(r.sound)break;m.transp=lb(d,!0);break;case "shift=":if(r.nedo){y(1,H.notransp);break}m.shift=m.sndsh=lb(a.shift());break;case "sound=":if(r.nedo){y(1,H.notransp);break}m.sndtran=lb(a.shift());r.sound&&(m.transp=m.sndtran);break;case "subname=":case "sname=":case "snm=":m.snm=a.shift();'"'==m.snm[0]&&(m.snm=m.snm.slice(1,-1));break;case "stafflines=":g=rf(a.shift());void 0==g?y(1,"Bad %%stafflines value"):void 0!=m.st?K.staves[m.st].stafflines=g:m.stafflines=g;break;
case "staffnonote=":g=parseInt(a.shift());isNaN(g)?y(1,"Bad %%staffnonote value"):m.staffnonote=g;break;case "staffscale=":g=parseFloat(a.shift());isNaN(g)||.3>g||2<g?y(1,"Bad %%staffscale value"):m.staffscale=g;break;case "transpose=":if(r.nedo){y(1,H.notransp);break}g=pe(a.shift());void 0==g?y(1,H.bad_transp):(m.sndtran=g,r.sound&&(m.transp=g));break;default:switch(d.slice(0,4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=d;break;default:0<="GFC".indexOf(d[0])?c=d:"="==d.slice(-1)&&
a.shift()}}}if(e)for(d in m.pos=A(m.pos),e)e.hasOwnProperty(d)&&(m.pos[d]=e[d]);c&&(c=Qd(c))&&(f&&(c.clefpit=f),re(c))};var Uc=/(\d*)(\/*)(\d*)/g;Abc.prototype.new_note=function(a,c){var d;var e=[];var g=t.line,f=Y;Y=[];t.stemless=!1;var h={type:n.NOTE,fname:t.fname,stem:0,multi:0,nhd:0,xmx:0};h.istart=t.bol+g.index;m.color&&(h.color=m.color);if(m.tie_s){var l=m.tie_s;m.tie_s=null}a?h.grace=!0:(Ua&&qc(h),t.repeat_n&&(h.repeat_n=t.repeat_n,h.repeat_k=t.repeat_k,t.repeat_n=0));var k=g.char();switch(k){case "X":h.invis=
!0;case "Z":h.type=n.MREST;k=g.next_char();h.nmes="0"<k&&"9">=k?g.get_int():1;h.dur=m.wmeasure*h.nmes;if(m.second){delete m.eoln;m.time+=h.dur;return}1==h.nmes?(h.type=n.REST,h.dur_orig=h.dur,h.notes=[{pit:18,dur:h.dur}]):na.mrest_p=!0;break;case "y":h.type=n.SPACE;h.invis=!0;h.dur=0;k=g.next_char();h.width="0"<=k&&"9">=k?g.get_int():10;l&&(m.tie_s=l,l=null);break;case "x":h.invis=!0;case "z":h.type=n.REST;g.index++;var q=rc(g);h.dur_orig=(0>m.ulen?n.BLEN:m.ulen)*q[0]/q[1];h.dur=h.dur_orig*m.dur_fact;
h.notes=[{pit:18,dur:h.dur_orig}];break;case "[":q=!0,k=g.next_char();default:if(m.acc_tie){var v=m.acc_tie;m.acc_tie=null}for(h.notes=[];;){if(q)for(;k;){k=k.charCodeAt(0);if(128<=k){y(1,H.not_ascii);return}k=Ia[k];switch(k[0]){case "(":e.push(sc());k=g.char();continue;case "!":if(1<k.length)Y.push(k.slice(1,-1));else{for(d="";;){k=g.next_char();if(!k){y(1,"No end of decoration");return}if("!"==k)break;d+=k}Y.push(d)}k=g.next_char();continue}break}var A=g;k=h.grace?n.BLEN/4:0>m.ulen?n.BLEN:m.ulen;
(d=sb(A))?("0"==A.char()&&(t.stemless=!0,A.index++),A=rc(A),d.dur=k*A[0]/A[1]):d=void 0;if(!d)return;m.octave&&(d.pit+=7*m.octave);A=d.pit+19;(k=d.acc)?m.acc[A]=k:(k=m.acc[A],!k&&v&&(k=v[A]),k||(k=m.ckey.k_map[A%7]||0));if(m.map&&Sa[m.map])a:{var u=d,p=u.pit,B=ne(p,k),D=Sa[m.map];if(!(D[B]||(B="o"+B.replace(/[',]+/,""),D[B]||(B="k"+Mb[(p+75-11*m.ckey.k_sf)%7],D[B]||(B="all",D[B])))))break a;u.map=D=D[B];D[1]&&(u.pit=D[1].pit,u.acc=D[1].acc);D[2]&&(u.color=D[2]);if(B=D[3])u.midi=Td(B.pit+19,B.acc)}d.midi||
(d.midi=Td(A,k));m.ckey.k_sndtran&&(d.midi+=abc2svg.b40m(m.ckey.k_sndtran+122)-36);if(e.length){for(;;){k=e.shift();if(!k)break;m.sls.push({is_note:!0,note:d,ty:k})}d.s=h}Y.length&&(d.a_dcn=Y,Y=[]);h.notes.push(d);if(!q)break;for(k=g.char();;){switch(k){case ")":d.s=h;Vc(d,!0);k=g.next_char();continue;case "-":d.tie_ty=sc();d.s=h;m.tie_s=h;if(m.acc[A]||v&&v[A])m.acc_tie||(m.acc_tie=[]),m.acc_tie[A]=m.acc[A]||v[A];k=g.char();continue;case ".":k=g.next_char();switch(k){case "-":case "(":Y.push("dot");
continue}y(1,"Misplaced dot")}break}if("]"==k){g.index++;q=rc(g);h.nhd=h.notes.length-1;for(k=0;k<=h.nhd;k++)d=h.notes[k],d.dur=d.dur*q[0]/q[1];break}}if(c.length)for(;;){k=c.shift();if(!k)break;h.notes[0].s=h;m.sls.push({note:h.notes[0],ty:k});a&&(m.sls[m.sls.length-1].grace=a)}h.dur_orig=h.notes[0].dur;h.dur=h.notes[0].dur*m.dur_fact}if(h.grace&&h.type!=n.NOTE)y(1,H.bad_grace);else{if(h.notes){if(a){c=m.ckey.k_bagpipe?8:4;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=c;h.dur/=c;h.dur_orig/=c;a.stem&&(h.stem=
a.stem)}else{switch(m.pos.stm){case n.SL_ABOVE:h.stem=1;break;case n.SL_BELOW:h.stem=-1;break;case n.SL_HIDDEN:h.stemless=!0}if(e=m.brk_rhythm){m.brk_rhythm=0;q=m.last_note;if(0<e){c=2*e-1;h.dur=h.dur*c/e;h.dur_orig=h.dur_orig*c/e;for(k=0;k<=h.nhd;k++)h.notes[k].dur=h.notes[k].dur*c/e;q.dur/=e;q.dur_orig/=e;for(k=0;k<=q.nhd;k++)q.notes[k].dur/=e}else{e=-e;c=2*e-1;h.dur/=e;h.dur_orig/=e;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=e;q.dur=q.dur*c/e;q.dur_orig=q.dur_orig*c/e;for(k=0;k<=q.nhd;k++)q.notes[k].dur=
q.notes[k].dur*c/e}m.time=q.time+q.dur;for(q=q.next;q;q=q.next)q.time=m.time}}m.last_note=h;for(k=g.char();;){switch(k){case "-":c=sc();for(k=0;k<=h.nhd;k++)h.notes[k].tie_ty=c,h.notes[k].s=h;a?a.tie_s=m.tie_s=a:m.tie_s=h;for(k=0;k<=h.nhd;k++)if(d=h.notes[k],A=d.pit+19,m.acc[A]||v&&v[A])m.acc_tie||(m.acc_tie=[]),m.acc_tie[A]=m.acc[A]||v[A];k=g.char();continue;case ")":h.notes[0].s=h;Vc(h.notes[0]);k=g.next_char();continue;case ".":Y.push("dot");k=g.next_char();continue}break}l&&jd(h,l)}Ba(h);r.shiftunison&&
(h.shiftunison=r.shiftunison);a||(m.lyric_restart||(m.lyric_restart=h),m.sym_restart||(m.sym_restart=h));f.length&&Db(f,h,h.prev);t.ottava.length&&(a?a.ottava=t.ottava:h.ottava=t.ottava,t.ottava=[]);t.stemless&&(h.stemless=!0);h.iend=t.bol+g.index;return h}};var Ia='0;0;0;0;0;0;0;0;0; ;\n;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0; ;!;";i;\n;0;&;0;(;);i;0;0;-;!dot!;0;0;0;0;0;0;0;0;0;0;0;|;i;<;n;<;i;i;n;n;n;n;n;n;n;!fermata!;d;d;d;!emphasis!;!lowermordent!;d;!coda!;!uppermordent!;d;d;!segno!;!trill!;d;d;d;n;d;n;[;\\;|;n;n;i;n;n;n;n;n;n;n;d;d;d;d;d;d;d;d;d;d;d;d;d;!upbow!;!downbow!;d;n;n;n;{;|;};!gmark!;0'.split(";"),
Vd={"8va(":1,"8va)":0,"15ma(":2,"15ma)":0,"8vb(":-1,"8vb)":0,"15mb(":-2,"15mb)":0},Jb,yd="undefined"!=typeof document?function(a){var c;r.fullsvg&&(wb+="\n"+a);if(!Jb)if(abc2svg.sheet)for(Jb=abc2svg.sheet,c=Jb.cssRules.length;0<=--c;)Jb.deleteRule(c);else c=document.createElement("style"),document.head.appendChild(c),abc2svg.sheet=Jb=c.sheet;for(a=a.match(/[^{]+{[^}]+}/g);;){c=a.shift();if(!c)break;Jb.insertRule(c,Jb.cssRules.length)}}:function(a){wb+="\n"+a},Yd=new Float32Array([0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),uf=new Float32Array([0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278,.278,.355,.556,.556,.889,.667,.191,.333,.333,.389,.584,.278,.333,.278,.278,.556,.556,.556,.556,.556,.556,.556,.556,.556,.556,.278,.278,.584,.584,.584,.556,1.015,.667,.667,.722,.722,.667,.611,.778,.722,.278,.5,.667,.556,.833,.722,.778,.667,.778,.722,.667,.611,.722,.667,.944,.667,.667,.611,.278,.278,.278,.469,.556,.333,.556,.556,.5,.556,.556,.278,.556,.556,.222,.222,.5,.222,.833,.556,.556,.556,.556,.333,.5,.278,.556,.5,.722,.5,.5,.5,.334,.26,.334,
.584,.512]),Xd=Yd,va="undefined"!=typeof document?function(){var a=document.createElement("text");a.style.position="absolute";a.style.top="-1000px";a.style.padding="0";document.body.appendChild(a);return function(c){if(c.wh)return c.wh;var d=J.curfont,e=d.size,g=0,f=0,h=0;a.className=qb(d);a.style.lineHeight=1;if("object"==typeof c)return a.innerHTML=c,c.wh=[a.clientWidth,a.clientHeight],c.wh;for(c=c.replace(/<|>|&[^&]*?;|&|  /g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";
case "  ":return" \u00a0"}return a});;){h=c.indexOf("$",h);if(0>h)break;var l=c[h+1];if("0"==l)d=J.deffont;else if("1"<=l&&"9">=l)d=Ja("u"+l);else{h++;continue}a.innerHTML=c.slice(f,h);g+=a.clientWidth;d.size>e&&(e=d.size);a.style.font=Gc(d).slice(5);f=h+=2}a.innerHTML=c.slice(f);g+=a.clientWidth;J.curfont=d;return[g,e]}}():function(a){var c=J.curfont,d=c.swfac,e=c.size,g=0,f,h=a.length;for(f=0;f<h;f++){var l=a[f];switch(l){case "$":l=a[f+1];if("0"==l)c=J.deffont;else if("1"<=l&&"9">=l)c=Ja("u"+l);
else{l="$";break}f++;d=c.swfac;c.size>e&&(e=c.size);continue;case "&":var k=a.indexOf(";",f);0<k&&10>k-f&&(f=k,l="a")}g+=Wc(l)*d}J.curfont=c;return[g,e]},zf={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},G="",vb="\n.stroke{stroke:currentColor;fill:none}\n.bW{stroke:currentColor;fill:none;stroke-width:1}\n.bthW{stroke:currentColor;fill:none;stroke-width:3}\n.slW{stroke:currentColor;fill:none;stroke-width:.7}\n.slthW{stroke:currentColor;fill:none;stroke-width:1.5}\n.sW{stroke:currentColor;fill:none;stroke-width:.7}\n.box{outline: 1px solid black;outline-offset: 1px}",
wb="",Ub=r.leftmargin/r.scale,fa=0,ha={width:r.pagewidth,lm:r.leftmargin,rm:r.rightmargin},Yc={},uc="",Zc="",I={scale:1,dy:0,st:-1,v:-1,g:0},Da=0,Ac={"mtr ":{x:0,y:0,c:" "},brace:{x:0,y:0,c:"\ue000"},lphr:{x:0,y:24,c:"\ue030"},mphr:{x:0,y:24,c:"\ue038"},sphr:{x:0,y:27,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-4,y:-4,c:"\ue045"},dcap:{x:-4,y:-4,c:"\ue046"},sgno:{x:-6,y:0,c:"\ue047"},coda:{x:-12,y:-6,c:"\ue048"},tclef:{x:-8,y:0,c:"\ue050"},cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},
pclef:{x:-6,y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},mtr0:{x:0,y:0,c:"\ue080"},mtr1:{x:0,y:0,c:"\ue081"},mtr2:{x:0,y:0,c:"\ue082"},mtr3:{x:0,y:0,c:"\ue083"},mtr4:{x:0,y:0,c:"\ue084"},mtr5:{x:0,y:0,c:"\ue085"},mtr6:{x:0,y:0,c:"\ue086"},mtr7:{x:0,y:0,c:"\ue087"},mtr8:{x:0,y:0,c:"\ue088"},mtr9:{x:0,y:0,c:"\ue089"},mtrC:{x:0,y:0,c:"\ue08a"},"mtr+":{x:0,y:0,c:"\ue08c"},"mtr(":{x:0,y:0,c:"\ue094"},
"mtr)":{x:0,y:0,c:"\ue095"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-7,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},"dot+":{x:-5,y:0,sc:.7,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,y:0,c:"\ue1bb"},dot:{x:-1,y:0,c:"\ue1e7"},flu1:{x:-.3,y:0,c:"\ue240"},fld1:{x:-.3,
y:0,c:"\ue241"},flu2:{x:-.3,y:0,c:"\ue242"},fld2:{x:-.3,y:0,c:"\ue243"},flu3:{x:-.3,y:3.5,c:"\ue244"},fld3:{x:-.3,y:-4,c:"\ue245"},flu4:{x:-.3,y:8,c:"\ue246"},fld4:{x:-.3,y:-9,c:"\ue247"},flu5:{x:-.3,y:12.5,c:"\ue248"},fld5:{x:-.3,y:-14,c:"\ue249"},"acc-1":{x:-1,y:0,c:"\ue260"},"cacc-1":{x:-18,y:0,c:"\ue26a\ue260\ue26b"},"sacc-1":{x:-1,y:0,sc:.7,c:"\ue260"},acc3:{x:-1,y:0,c:"\ue261"},cacc3:{x:-18,y:0,c:"\ue26a\ue261\ue26b"},sacc3:{x:-1,y:0,sc:.7,c:"\ue261"},acc1:{x:-2,y:0,c:"\ue262"},cacc1:{x:-18,
y:0,c:"\ue26a\ue262\ue26b"},sacc1:{x:-2,y:0,sc:.7,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_2":{x:-2,y:0,c:"\ue280"},"acc-3_2":{x:-3,y:0,c:"\ue281"},acc1_2:{x:-1,y:0,c:"\ue282"},acc3_2:{x:-3,y:0,c:"\ue283"},accent:{x:-3,y:0,c:"\ue4a0"},stc:{x:-1,y:-2,c:"\ue4a2"},emb:{x:-4,y:-2,c:"\ue4a4"},wedge:{x:-1,y:0,c:"\ue4a8"},marcato:{x:-3,y:0,c:"\ue4ac"},hld:{x:-7,y:0,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,y:0,c:"\ue4e2"},r1:{x:-3.5,y:-6,
c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,y:0,c:"\ue4ea"},mrest:{x:-10,y:0,c:"\ue4ee"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-4,y:-6,c:"\ue520"},f:{x:-4,y:-6,c:"\ue522"},pppp:{x:-4,y:-6,c:"\ue529"},ppp:{x:-4,y:-6,c:"\ue52a"},pp:{x:-4,y:-6,c:"\ue52b"},mp:{x:-4,y:-6,c:"\ue52c"},mf:{x:-4,y:-6,c:"\ue52d"},ff:{x:-4,y:-6,c:"\ue52f"},fff:{x:-4,y:-6,
c:"\ue530"},ffff:{x:-4,y:-6,c:"\ue531"},sfz:{x:-4,y:-6,c:"\ue539"},trl:{x:-4,y:-4,c:"\ue566"},turn:{x:-5,y:-4,c:"\ue567"},turnx:{x:-5,y:-4,c:"\ue569"},umrd:{x:-7,y:-2,c:"\ue56c"},lmrd:{x:-7,y:-2,c:"\ue56d"},dplus:{x:-4,y:10,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d0"},grm:{x:-2,y:0,c:"\ue5e2"},dnb:{x:-4,y:0,c:"\ue610"},upb:{x:-3,y:0,c:"\ue612"},opend:{x:-2,y:0,c:"\ue614"},roll:{x:0,y:0,c:"\ue618"},thumb:{x:0,y:0,c:"\ue624"},snap:{x:-2,y:0,c:"\ue630"},ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},
mtro:{x:0,y:0,c:"\ue911"},mtrc:{x:0,y:0,c:"\ue915"},"mtr.":{x:0,y:0,c:"\ue920"},"mtr|":{x:0,y:0,c:"\ue925"},longa:{x:-4.7,y:0,c:"\ue95d"},custos:{x:-4,y:3,c:"\uea02"},ltr:{x:2,y:6,c:"\ueaa4"}},bb={},za=q.anno_start?vf:vc,Oa=q.anno_stop?wf:vc;Abc.prototype.out_svg=function(a){G+=a};Abc.prototype.sx=pb;Abc.prototype.sy=Gb;Abc.prototype.sh=function(a){return 0>I.st?a/I.scale:a};Abc.prototype.ax=function(a){return a+Ub};Abc.prototype.ay=function(a){return 0>I.st?fa-a:fa+(I.dy-a)*I.scale-I.dy};Abc.prototype.ah=
function(a){return 0>I.st?a:a*I.scale};Abc.prototype.out_sxsy=Ra;Abc.prototype.xypath=Eb;var Fa=[[],[],"",[],[],[]],xf={crdc:{dx:0,dy:5,style:"font:italic 14px serif"},dacs:{dx:0,dy:3,style:"font:16px serif",anchor:' text-anchor="middle"'},fng:{dx:0,dy:1,style:"font-family:Bookman; font-size:8px",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px serif"},"@":{dx:0,dy:5,style:"font: 12px sans-serif"}};Abc.prototype.out_lped=function(a,c,d,e){c+=4;e.nost||Z(a,c,"ped");e.noen||
Z(a+d+6,c,"pedoff")};var he={arp:fe,cresc:function(a,c,d,e){a+=d;d=-d;da('<path class="stroke"\n\td="mX YlA ',a,c+5,d);G=e.nost?G+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):G+("-4l"+(-d).toFixed(1)+' -4"/>\n')},dim:function(a,c,d,e){da('<path class="stroke"\n\td="mX YlA ',a,c+5,d);G=e.noen?G+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):G+("-4l"+(-d).toFixed(1)+' -4"/>\n')},ltr:ge,lped:function(a,c,d,e){W.out_lped(a,c,d,e)},"8va":function(a,c,d,e){e.nost?d-=5:(da('<text x="X" y="Y" style="font:italic bold 12px serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',
a-8,c),a+=12,d-=12);c+=6;da('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||da('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"8vb":function(a,c,d,e){e.nost?d-=5:(da('<text x="X" y="Y" style="font:italic bold 12px serif">8<tspan dy="-4" style="font-size:10px">vb</tspan></text>\n',a-8,c),a+=4,d-=4);da('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||da('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)},"15ma":function(a,c,d,e){e.nost?d-=5:(da('<text x="X" y="Y" style="font:italic bold 12px serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',
a-10,c),a+=20,d-=20);c+=6;da('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||da('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"15mb":function(a,c,d,e){e.nost?d-=5:(da('<text x="X" y="Y" style="font:italic bold 12px serif">15<tspan dy="-4" style="font-size:10px">mb</tspan></text>\n',a-10,c),a+=7,d-=7);da('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||da('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)}},xe={glisq:function(a,c,d){d=d.start;var e=
d.x,g=d.y+B[d.st].y;c=Math.atan2(g-c,a-e);a=(a-e)/Math.cos(c);Kb(e,g,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a=(a-e-6)/6|0;for(1>a&&(a=1);0<=--a;)Z(e,0,"ltr"),e+=6;Fb()},gliss:function(a,c,d){d=d.start;var e=d.x,g=d.y+B[d.st].y;c=-Math.atan2(c-g,a-e);a=(a-e)/Math.cos(c);Kb(e,g,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a-=e+8;Eb(e,0);G+="h"+a.toFixed(1)+'" stroke-width="1"/>\n';Fb()}};Abc.prototype.blk_flush=db;var K,L,F,m,Hb,sa,P,Na=new Uint8Array([4,1,8,0,3,5,6,9,9,0,9,3,0,7,0,0,0,0]);Abc.prototype.set_bar_num=
function(){var a,c,d,e=J.nbar,g=0,f=0,h=F[L.top_voice].meter.wmeasure;for(a=P;;a=a.ts_next){if(!a)return;switch(a.type){case n.METER:h=a.wmeasure;case n.CLEF:case n.KEY:case n.STBRK:continue;case n.BAR:a.bar_num&&(e=a.bar_num)}break}for(c=a.ts_next;c;c=c.ts_next)if(c.type==n.BAR&&c.time){c.time<h&&(a=c,g=a.time);break}for(;a;a=a.ts_next)if(a.seqst)switch(a.type){case n.METER:e+=(a.time-g)/h;g=a.time;h=a.wmeasure;break;case n.BAR:if(!a.invis)if(c=a.time,a.bar_num)e=a.bar_num,f=g=c;else if(1==h)a.bar_dotted||
(a.text&&(r.contbarnb||("1"==a.text[0]?d=e:e=d)),a.bar_num=++e);else{var l=e+(c-g)/h;var k=l-(l|0);r.checkbars&&(k&&!a.bar_dotted&&a.next||c>f+h&&a.prev.type!=n.MREST)&&v(0,a,"Bad measure duration");c>f+h&&(l|=0,k=0,g=c,e=l);a.text?"1"==a.text[0]?(d=r.contbarnb?g+k*h:c,k||(a.bar_num=l)):(g=r.contbarnb?d:g+(c-d),l=e+(c-g)/h,l==(l|0)&&(a.bar_num=l)):(k&&(l-=k),a.bar_num=l);k||(f=c)}}};Abc.prototype.do_pscom=function(a){var c;if(c=a.match(/(\w|-)+/)){c=c[0];if(m&&m.ignore)switch(c){case "staves":case "score":break;
default:return}a=a.replace(c,"").trim();if(" lock"==a.slice(-5))Fe[c]=!0,a=a.slice(0,-5).trim();else if(Fe[c])return;"title"==c.slice(0,5)&&2==t.state&&Ea();switch(c){case "center":ba("text");if(2<=t.state){c=Ta("text");c.text=a;c.opt="c";c.font=r.textfont;return}tc(a,"c");return;case "clef":2<=t.state&&(2==t.state&&Ea(),(c=Qd(a))&&re(c));return;case "deco":a=a.match(/(\S*)\s+(.*)/);xc[a[1]]=a[2];return;case "linebreak":for(c=0;128>c;c++)"\n"==Ia[c]&&(Ia[c]="0");a=a.split(/\s+/);for(c=0;c<a.length;c++){var d=
a[c];switch(d){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;case "<EOL>":d="\n";break;default:y(1,"Bad value '$1' in %%linebreak - ignored",d);continue}Ia[d.charCodeAt(0)]="\n"}return;case "map":a:if(a)if(c="",a=a.split(/\s+/),3>a.length)y(1,not_enough_p);else{var e=a[1];if("*"==e[0]||0==e.indexOf("all"))e="all";else{if(0==e.indexOf("octave,")||0==e.indexOf("key,"))c=e[0],e=e.split(",")[1],e=e.replace(/[,']+/,"").toUpperCase(),0==e.indexOf("key,")&&(e=e.replace(/[=^_]+/,
""));d=new O;d.buffer=e;d=sb(d);if(!d){y(1,"Bad note in %%map");break a}e=c+ne(d.pit,d.acc)}(d=Sa[a[0]])||(Sa[a[0]]=d={});(c=d[e])||(d[e]=c=[]);a.shift();a.shift();if(a.length){a=ac(a.join(" "));e=0;if(0>a[0].indexOf("=")){"*"!=a[0][0]&&(d=new O,d.buffer=a[0],c[1]=sb(d));if(!a[1])break a;e++;0>a[1].indexOf("=")&&(c[0]=a[1].split(","),e++)}for(;e<a.length;e++)switch(a[e]){case "heads=":if(!a[++e]){y(1,not_enough_p);break}c[0]=a[e].split(",");break;case "print=":case "play=":if(!a[++e]){y(1,not_enough_p);
break}d=new O;d.buffer=a[e];d=sb(d);"r"==a[e-1][1]?c[1]=d:c[3]=d;break;case "color=":a[++e]?c[2]=a[e]:y(1,not_enough_p)}}}return;case "maxsysstaffsep":if(3==t.state){d=Aa(a);if(isNaN(d)){y(1,H.bad_val,"%%maxsysstaffsep");return}K.voices[m.v].maxsep=d;return}break;case "multicol":if(2<=t.state){2==t.state&&Ea();m=F[0];Ta("mc_"+a);break}switch(a){case "start":T={maxy:0,lmarg:r.leftmargin,rmarg:r.rightmargin};break;case "new":if(!T){y(1,"%%multicol new without start");break}fa>T.maxy&&(T.maxy=fa);r.leftmargin=
T.lmarg;r.rightmargin=T.rmarg;ha.chg=!0;Ha();fa=0;break;case "end":if(!T){y(1,"%%multicol end without start");break}fa<T.maxy&&(fa=T.maxy);r.leftmargin=T.lmarg;r.rightmargin=T.rmarg;T=void 0;db();ha.chg=!0;Ha();break;default:y(1,"Unknown keyword '$1' in %%multicol",a)}return;case "ottava":if(3!=t.state){if(2!=t.state)return;Ea()}a=parseInt(a);if(isNaN(a)||-2>a||2<a){y(1,H.bad_val,"%%ottava");return}na.ottava=!0;t.ottava.push(a);return;case "repbra":m&&(m.norepbra=!cb(a));return;case "repeat":if(3!=
t.state)return;if(!m.last_sym){y(1,"%%repeat cannot start a tune");return}if(a.length){c=a.split(/\s+/);a=parseInt(c[0]);c=parseInt(c[1]);if(isNaN(a)||1>a||m.last_sym.type==n.BAR&&2<a){y(1,"Incorrect 1st value in %%repeat");return}if(isNaN(c))c=1;else if(1>c){y(1,"Incorrect 2nd value in %%repeat");return}}else c=a=1;t.repeat_n=m.last_sym.type==n.BAR?a:-a;t.repeat_k=c;return;case "sep":var g;Ha();var f=ha.width-ha.lm-ha.rm;d=e=g=0;if(a&&(a=a.split(/\s+/),d=Aa(a[0]),a[1]&&(e=Aa(a[1]),a[2]&&(g=Aa(a[2]))),
isNaN(d)||isNaN(e)||isNaN(g))){y(1,H.bad_val,"%%sep");return}1>d&&(d=14);1>e&&(e=d);1>g&&(g=90);if(2<=t.state){c=Ta(c);c.x=(f-g)/2/r.scale;c.l=g/r.scale;c.sk1=d;c.sk2=e;return}ma(d);G+='<path class="stroke"\n\td="M';Ra((f-g)/2/r.scale," ",0);G+="h"+(g/r.scale).toFixed(1)+'"/>\n';ma(e);db();return;case "setbarnb":d=parseInt(a);if(isNaN(d)||1>d){y(1,"Bad %%setbarnb value");break}2==t.state&&Ea();na.new_nbar=d;return;case "staff":if(3!=t.state){if(2!=t.state)return;Ea()}d=parseInt(a);if(isNaN(d)){y(1,
"Bad %%staff value '$1'",a);return}a="+"==a[0]||"-"==a[0]?m.cst+d:d-1;if(0>a||a>S){y(1,"Bad %%staff number $1 (cur $2, max $3)",a,m.cst,S);return}delete m.floating;m.cst=a;return;case "staffbreak":if(3!=t.state){if(2!=t.state)return;Ea()}c={type:n.STBRK,dur:0};"f"==a.slice(-1)&&(c.stbrk_forced=!0,a=a.replace(/\sf$/,""));if(a){d=Aa(a);if(isNaN(d)){y(1,H.bad_val,"%%staffbreak");return}c.xmx=d}else c.xmx=14;Ba(c);return;case "stafflines":case "staffscale":case "staffnonote":Lb(c,a);return;case "staves":case "score":if(0==
t.state)return;t.scores&&0<t.scores.length?(a=t.scores.shift(),c=a.match(/([^\s]+)\s*(.*)/),qe(c[1],c[2])):qe(c,a);return;case "sysstaffsep":if(3==t.state){d=Aa(a);if(isNaN(d)){y(1,H.bad_val,"%%sysstaffsep");return}K.voices[m.v].sep=d;return}break;case "text":ba("text");if(2<=t.state){c=Ta(c);c.text=a;c.opt=r.textoption;c.font=r.textfont;return}tc(a,r.textoption);return;case "transpose":if(r.sound)return;d=pe(a);if(void 0==d&&(d=lb(a),void 0==d)){y(1,H.bad_transp);return}switch(t.state){case 0:r.transp=
0;case 1:case 2:r.transp=(r.transp||0)+d;return}for(c=m.last_sym;c;c=c.prev){switch(c.type){case n.NOTE:c=A(m.okey);c.k_old_sf=m.ckey.k_sf;Ba(c);break;case n.KEY:break;default:continue}break}m.transp=d;wc();return;case "tune":return;case "user":Rd(a);return;case "voicecolor":m&&(m.color=a);return;case "vskip":d=Aa(a);if(isNaN(d)){y(1,H.bad_val,"%%vskip");return}if(0>d){y(1,"%%vskip cannot be negative");return}if(2<=t.state){c=Ta(c);c.sk=d;return}ma(d);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(2<=
t.state){c=Ta(c);c.param=a;return}if("newpage"==c){db();q.page_format&&(Da=2);return}}W.set_format(c,a)}};Abc.prototype.do_begin_end=function(a,c,d){switch(a){case "js":ua(d);break;case "ml":2<=t.state?(a=Ta(a),a.text=d):(db(),q.img_out&&q.img_out(d));break;case "svg":for(c=0;;){a=d.indexOf("<style",c);if(0>a)break;a=d.indexOf(">",a);c=d.indexOf("</style>",a);if(0>c){y(1,"No </style> in %%beginsvg sequence");break}vb+=d.slice(a+1,c).replace(/\s+$/,"")}for(c=0;;){a=d.indexOf("<defs>\n",c);if(0>a)break;
c=d.indexOf("</defs>",a);if(0>c){y(1,"No </defs> in %%beginsvg sequence");break}be(d.slice(a+6,c))}break;case "text":c=Ge[c],c||(c=r.textoption),ba("text"),2<=t.state?(a=Ta(a),a.text=d,a.opt=c,a.font=r.textfont):tc(d,c)}};var ve="CDEFGAB",Af=["bb","b","","#","##"];Abc.prototype.gch_build=function(a){var c,d=0,e=0;for(c=0;c<a.a_gch.length;c++){var g=a.a_gch[c];if("g"==g.type)g.text=g.text.replace(/##|#|=|bb|b|  /g,function(a){switch(a){case "##":return"&#x1d12a;";case "#":return"\u266f";case "=":return"\u266e";
case "b":return"\u266d";case "  ":return" \u00a0"}return"&#x1d12b;"});else if("@"==g.type&&!q.anno_start&&!q.anno_stop){ba(g.font);g.text=tb(g.text);g.text.wh=[0,0];continue}ba(g.font);g.text=tb(g.text);var f=g.text.wh;f[1]+=2*g.font.pad;switch(g.type){case "@":break;case "^":f=.4*f[0];8<f&&(f=8);g.x=-f;break;case "_":f=.4*f[0];8<f&&(f=8);g.x=-f;break;case "<":g.x=-(f[0]+6);d-=f[1];g.y=d+f[1]/2;break;case ">":g.x=6;e-=f[1];g.y=e+f[1]/2;break;default:f=.4*f[0],8<f&&(f=8),g.x=-f}}d/=2;e/=2;for(c=0;c<
a.a_gch.length;c++)switch(g=a.a_gch[c],g.type){case "<":g.y-=d;break;case ">":g.y-=e}};Abc.prototype.draw_gchord=function(a,c,d,e){a=c.a_gch[a];var g=a.text.wh[1];var f=a.font.pad;var h=a.text.wh[0]+2*f,l=0;a.font.figb&&(g*=2.4,l=1.3*a.font.size);switch(a.type){case "_":e-=g+f;ea(c.st,0,d,h,e-f);break;case "^":e=V(c.st,1,d,h);e+=f;ea(c.st,1,d,h,e+g+f);break;case "<":case ">":"<"==a.type?(c.notes[0].acc&&(d-=c.notes[0].shac),d-=f):(c.xmx&&(d+=c.xmx),c.dots&&(d+=1.5+3.5*c.dots),d+=f);e+=(c.type==n.NOTE?
3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)-g/2;break;default:0<=e?(e+=f,ea(c.st,1,d,h,e+g+f)):(e-=g+f,ea(c.st,0,d,h,e-f));break;case "@":e+=(c.type==n.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)+.2*g,0<e?(f=e+.8*g,f>B[c.st].ann_top&&(B[c.st].ann_top=f)):(f=e,f<B[c.st].ann_bot&&(B[c.st].ann_bot=f))}kb(a.font);ba(a.font);Ma(c.st);q.anno_start&&q.anno_start("annot",a.istart,a.iend,d-2,e+g+2,h+4,g+4,c);la(d,e+l,a.text);q.anno_stop&&q.anno_stop("annot",a.istart,a.iend,d-2,e+g+2,h+4,g+
4,c)};Ed();Abc.prototype.a_de=function(){return U};Abc.prototype.add_style=function(a){vb+=a};Abc.prototype.cfmt=function(){return r};Abc.prototype.clone=A;Abc.prototype.deco_cnv=Db;Abc.prototype.defs_add=be;Abc.prototype.draw_meter=nd;Abc.prototype.draw_note=dc;Abc.prototype.errs=H;Abc.prototype.font_class=qb;Abc.prototype.gch_tr1=ue;Abc.prototype.get_bool=cb;Abc.prototype.get_cur_sy=function(){return L};Abc.prototype.get_curvoice=function(){return m};Abc.prototype.get_delta_tb=function(){return ed};
Abc.prototype.get_decos=function(){return xc};Abc.prototype.get_font=Ja;Abc.prototype.get_font_style=function(){return wb};Abc.prototype.get_glyphs=function(){return bb};Abc.prototype.get_img=function(){return ha};Abc.prototype.get_maps=function(){return Sa};Abc.prototype.get_multi=function(){return T};Abc.prototype.get_newpage=function(){if(block.newpage)return block.newpage=!1,!0};Abc.prototype.get_posy=function(){var a=fa;fa=0;return a};Abc.prototype.get_staff_tb=function(){return B};Abc.prototype.get_top_v=
function(){return K.top_voice};Abc.prototype.get_tsfirst=function(){return P};Abc.prototype.get_unit=Aa;Abc.prototype.get_voice_tb=function(){return F};Abc.prototype.glout=jb;Abc.prototype.goto_tune=Ea;Abc.prototype.info=function(){return M};Abc.prototype.new_block=Ta;Abc.prototype.out_arp=fe;Abc.prototype.out_deco_str=ee;Abc.prototype.out_deco_val=bd;Abc.prototype.out_ltr=ge;Abc.prototype.param_set_font=nb;Abc.prototype.parse=t;Abc.prototype.psdeco=vc;Abc.prototype.psxygl=vc;Abc.prototype.set_cur_sy=
function(a){L=a};Abc.prototype.set_dscale=Ma;Abc.prototype.set_font=ba;Abc.prototype.set_a_gch=function(a,c){Ua=c;qc(a)};Abc.prototype.set_hl=ib;Abc.prototype.set_pagef=function(){Da=1};Abc.prototype.set_scale=Qa;Abc.prototype.set_tsfirst=function(a){P=a};Abc.prototype.set_v_param=Lb;Abc.prototype.strwh=va;Abc.prototype.stv_g=function(){return I};Abc.prototype.svg_flush=ub;Abc.prototype.syntax=y;Abc.prototype.tunes=Ic;Abc.prototype.unlksym=ob;Abc.prototype.use_font=kb;Abc.prototype.vskip=ma;Abc.prototype.xy_str=
la;Abc.prototype.xygl=Z;var we};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);abc2svg.loadjs||(abc2svg.loadjs=function(q,A,D){D&&D()});
abc2svg.modules={ambitus:{},begingrid:{fn:"grid3"},beginps:{fn:"psvg"},break:{},capo:{},chordnames:{},clip:{},clairnote:{fn:"clair"},voicecombine:{fn:"combine"},diagram:{fn:"diag"},equalbars:{},gamelan:{},grid:{},grid2:{},jazzchord:{},jianpu:{},mdnn:{},MIDI:{},pageheight:{fn:"page"},pedline:{},percmap:{fn:"perc"},soloffs:{},sth:{},strtab:{},temperament:{fn:"temper"},nreq:0,hooks:[],g_hooks:[],load:function(q,A,D){function v(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==typeof abc2svg.printErr?
abc2svg.printErr:"function"==typeof alert?function(q){alert(q)}:"object"==typeof console?console.log:function(){}}function O(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}var y=this.nreq;q=q.match(/(^|\n)(%%|I:).+?\b/g);if(!q)return!0;this.cbf=A||function(){};this.errmsg=D||v();for(D=0;D<q.length;D++){var ua=q[D].replace(/\n?(%%|I:)/,"");(A=abc2svg.modules[ua])&&!A.loaded&&(A.loaded=!0,A.fn&&(ua=A.fn),this.nreq++,abc2svg.loadjs(ua+"-1.js",O,function(){abc2svg.modules.errmsg("Error loading the module "+
ua);O()}))}return this.nreq==y}};abc2svg.version="1.20.18";abc2svg.vdate="2021-04-03";
abc2svg.MIDI={do_midi:function(q){var A,D=q.split(/\s+/);q=this.cfmt();if(A=this.get_curvoice()){if(A.ignore)return;void 0==A.chn&&(A.chn=9>A.v?A.v:A.v+1)}switch(D[1]){case "chordname":q.chord||(q.chord={});q.chord.names||(q.chord.names={});q.chord.names[D[2]]=D.slice(3);break;case "chordprog":q.chord||(q.chord={});q.chord.prog=D[2];D[3]&&"octave="==D[3].slice(0,7)&&(q.chord.trans=Number(D[3].slice(7)));break;case "chordvol":var v=Number(D[2]);if(isNaN(v)||0>v||127<v){this.syntax(1,this.errs.bad_val,
"%%MIDI chordvol");break}q.chord||(q.chord={});q.chord.vol=v/127;break;case "gchordon":case "gchordoff":q.chord||(q.chord={});2==this.parse.state&&this.goto_tune();if(2<=this.parse.state&&this.get_curvoice()){var O=this.new_block("midigch");O.play=!0;O.on="n"==D[1][7]}else q.chord.gchon="n"==D[1][7];break;case "channel":v=parseInt(D[2]);if(isNaN(v)||0>=v||16<v){this.syntax(1,this.errs.bad_val,"%%MIDI channel");break}if(9!=--v){3==this.parse.state?(O=this.new_block("midichn"),O.play=!0,O.chn=v):this.set_v_param("channel",
v);break}abc2svg.MIDI.do_midi.call(this,"MIDI control 0 1");abc2svg.MIDI.do_midi.call(this,"MIDI control 32 0");break;case "drummap":v=Number(D[3]);if(isNaN(v)){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}for(A="C ^C D _E E F ^F G ^G A _B B".split(" ")[v%12];60>v;)A+=",",v+=12;for(;72<v;)A+="'",v-=12;this.do_pscom("map MIDIdrum "+D[2]+" play="+A);this.set_v_param("mididrum","MIDIdrum");break;case "program":void 0!=D[3]?(abc2svg.MIDI.do_midi.call(this,"MIDI channel "+D[2]),v=D[3]):v=D[2];
v=parseInt(v);if(isNaN(v)||0>v||127<v){this.syntax(1,this.errs.bad_val,"%%MIDI program");break}3==this.parse.state?(O=this.new_block("midiprog"),O.play=!0,O.instr=v):this.set_v_param("instr",v);break;case "control":A=parseInt(D[2]);if(isNaN(A)||0>A||127<A){this.syntax(1,"Bad controller number in %%MIDI");break}v=parseInt(D[3]);if(isNaN(v)||0>v||127<v){this.syntax(1,"Bad controller value in %%MIDI");break}3==this.parse.state?(O=this.new_block("midictl"),O.play=!0,O.ctrl=A,O.val=v):this.set_v_param("midictl",
D[2]+" "+D[3]);break;case "temperamentequal":if(A=parseInt(D[2]),isNaN(A)||5>A||255<A)this.syntax(1,this.errs.bad_val,"%%MIDI "+D[1]);else{53==A&&(O=this.get_glyphs(),O.acc12_53='<text id="acc12_53" x="-1">&#xe282;</text>',O.acc24_53='<text id="acc24_53" x="-1">&#xe282;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',O.acc36_53='<text id="acc36_53" x="-1">&#xe262;\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>',O.acc48_53='<text id="acc48_53" x="-1">&#xe262;</text>',O.acc60_53=
'<g id="acc60_53">\n\t<text style="font-size:1.2em" x="-1">&#xe282;</text>\n\t<path class="stroke" stroke-width="1.6" d="M-2 1.5l7 -3"/>\n</g>',O["acc-60_53"]='<text id="acc-60_53" x="-1">&#xe260;</text>',O["acc-48_53"]='<g id="acc-48_53">\n\t<text x="-1">&#xe260;</text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',O["acc-36_53"]='<g id="acc-36_53">\n\t<text x="-1">&#xe260;\t\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',
O["acc-24_53"]='<text id="acc-24_53" x="-2">&#xe280;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',O["acc-12_53"]='<text id="acc-12_53" x="-2">&#xe280;</text>');q.nedo=A;A=12*(7.019550008653874*A/12+.5|0)/A;(6.85>A||7.2<A)&&this.syntax(0,this.errs.bad_val,"%%MIDI "+D[1]);v=[2,25,8,31,14,37,20,3,26,9,32,15,38,21,4,27,10,33,16,39];O=[0,19,36,13,30,7,24,1,18,35,12,29,6,23,0,17];var y=21-3*A;b=new Float32Array(40);for(D=0;D<v.length;D++)b[v[D]]=(A*D+y)%12;for(D=1;D<=O.length;D++)b[O[D]]=
12-(A*D-y)%12;q.temper=b}}},set_vp:function(q,A){var D,v=this.get_curvoice();for(D=0;D<A.length;D++)switch(A[D]){case "channel=":v.chn=A[++D];break;case "instr=":v.instr=A[++D];break;case "midictl=":v.midictl||(v.midictl=[]);var O=A[++D].split(" ");v.midictl[O[0]]=Number(O[1]);break;case "mididrum=":v.map||(v.map={}),v.map=A[++D]}q(A)},do_pscom:function(q,A){"MIDI "==A.slice(0,5)?abc2svg.MIDI.do_midi.call(this,A):q(A)},set_hooks:function(q){q.do_pscom=abc2svg.MIDI.do_pscom.bind(q,q.do_pscom);q.set_vp=
abc2svg.MIDI.set_vp.bind(q,q.set_vp)}};abc2svg.modules.hooks.push(abc2svg.MIDI.set_hooks);abc2svg.modules.MIDI.loaded=!0;
abc2svg.perc={do_perc:function(q){new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]);new Int8Array([3,1,3,-1,3,3,1,3,-1,3,-1,3]);var A={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,
"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58};q=q.split(/\s+/);var D=q[1].replace(/[=_^]/,"");this.do_pscom("map MIDIdrum "+q[1]+" play="+function(q){var v;if(/^[^_]*[A-Ga-g][,']*$/.test(q))return q;var y=Number(q);if(isNaN(y)){q=q.toLowerCase(q);var D=q[0];for(v=0;;){v=q.indexOf("-",v);if(0>v)break;v+=1;D+="-"+q[v]}y=A[D];if(!y){switch(q[0]){case "c":switch(q[1]){case "a":y=A.ca;break;case "l":y=A.cl;break;case "o":y=A.co}break;case "h":case "l":if(v=q.indexOf("-"),"t"==q[v+1])switch(q[1]){case "i":case "o":y=
A[D+q[1]]}}if(!y)return}}for(q="C ^C D _E E F ^F G ^G A _B B".split(" ")[y%12];60>y;)q+=",",y+=12;for(;72<y;)q+="'",y-=12;return q}(q[2])+" print="+D+(q[3]?" heads="+q[3]:""));this.set_v_param("perc","MIDIdrum")},set_perc:function(q){var A,D=this.get_curvoice();for(A=0;A<q.length;A++)switch(q[A]){case "perc=":D.map||(D.map={}),D.map=q[A+1],D.midictl||(D.midictl=[]),D.midictl[0]=1}},do_pscom:function(q,A){"percmap "==A.slice(0,8)?abc2svg.perc.do_perc.call(this,A):q(A)},set_vp:function(q,A){abc2svg.perc.set_perc.call(this,
A);q(A)},set_hooks:function(q){q.do_pscom=abc2svg.perc.do_pscom.bind(q,q.do_pscom);q.set_vp=abc2svg.perc.set_vp.bind(q,q.set_vp)}};abc2svg.modules.hooks.push(abc2svg.perc.set_hooks);abc2svg.modules.percmap.loaded=!0;
abc2svg.pedline={draw_all_deco:function(q){var A,D=this.a_de();if(D.length){if(this.cfmt().pedline)for(A=0;A<D.length;A++){var v=D[A];"ped)"==v.dd.name&&(v.prev&&"ped)"==v.prev.dd.name?(v.defl.nost=!0,v.prev.defl.noen=!0,v.x=v.prev.s.x-5,v.val=v.s.x-v.x-5,v.prev.prev||(v.prev.val=v.x-v.prev.x)):(v.x-=3,v.val+=10))}q()}},out_lped:function(q,A,D,v,O){this.cfmt().pedline?(this.xypath(A,D+16),O.nost?(this.out_svg("l2.5 6"),v-=2.5):this.out_svg("v6"),O.noen?this.out_svg("h"+(v-2.5).toFixed(1)+'l2.5 -6"/>\n'):
this.out_svg("h"+v.toFixed(1)+'v-6"/>\n')):q(A,D,v,O)},set_fmt:function(q,A,D){"pedline"==A?this.cfmt().pedline=D:q(A,D)},set_hooks:function(q){q.draw_all_deco=abc2svg.pedline.draw_all_deco.bind(q,q.draw_all_deco);q.out_lped=abc2svg.pedline.out_lped.bind(q,q.out_lped);q.set_format=abc2svg.pedline.set_fmt.bind(q,q.set_format)}};abc2svg.modules.hooks.push(abc2svg.pedline.set_hooks);abc2svg.modules.pedline.loaded=!0;
