// abc2svg - ABC to SVG translator
// @source: https://chiselapp.com/user/moinejf/repository/abc2svg
// Copyright (C) 2014-2021 Jean-Francois Moine - LGPL3+
// commit [98dc159837]
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(u){var x=0;return function(){return x<u.length?{done:!1,value:u[x++]}:{done:!0}}};$jscomp.arrayIterator=function(u){return{next:$jscomp.arrayIteratorImpl(u)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(u,x,E){u!=Array.prototype&&u!=Object.prototype&&(u[x]=E.value)};$jscomp.getGlobal=function(u){u=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,u];for(var x=0;x<u.length;++x){var E=u[x];if(E&&E.Math==Math)return E}return globalThis};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(u,x){this.$jscomp$symbol$id_=u;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:x})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function u(E){if(this instanceof u)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(E||"")+"_"+x++,E)}var x=0;return u}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var u=$jscomp.global.Symbol.iterator;u||(u=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[u]&&$jscomp.defineProperty(Array.prototype,u,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var u=$jscomp.global.Symbol.asyncIterator;u||(u=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(u){$jscomp.initSymbolIterator();u={next:u};u[$jscomp.global.Symbol.iterator]=function(){return this};return u};
$jscomp.iteratorFromArray=function(u,x){$jscomp.initSymbolIterator();u instanceof String&&(u+="");var E=0,v={next:function(){if(E<u.length){var I=E++;return{value:x(I,u[I]),done:!1}}v.next=function(){return{done:!0,value:void 0}};return v.next()}};v[Symbol.iterator]=function(){return v};return v};
$jscomp.polyfill=function(u,x,E,v){if(x){E=$jscomp.global;u=u.split(".");for(v=0;v<u.length-1;v++){var I=u[v];I in E||(E[I]={});E=E[I]}u=u[u.length-1];v=E[u];x=x(v);x!=v&&null!=x&&$jscomp.defineProperty(E,u,{configurable:!0,writable:!0,value:x})}};$jscomp.polyfill("Array.prototype.keys",function(u){return u?u:function(){return $jscomp.iteratorFromArray(this,function(u){return u})}},"es6","es3");if("undefined"==typeof abc2svg)var abc2svg={};
abc2svg.C={BLEN:1536,BAR:0,CLEF:1,CUSTOS:2,GRACE:4,KEY:5,METER:6,MREST:7,NOTE:8,PART:9,REST:10,SPACE:11,STAVES:12,STBRK:13,TEMPO:14,BLOCK:16,REMARK:17,FULL:0,EMPTY:1,OVAL:2,OVALBARS:3,SQUARE:4,SL_ABOVE:1,SL_BELOW:2,SL_AUTO:3,SL_HIDDEN:4,SL_DOTTED:8,SL_ALI_MSK:112,SL_ALIGN:16,SL_CENTER:32,SL_CLOSE:64};abc2svg.sym_name="bar clef custos  grace key meter Zrest note part rest yspace staves Break tempo  block remark".split(" ");
abc2svg.keys=[new Int8Array([-1,-1,-1,-1,-1,-1,-1]),new Int8Array([-1,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,-1,-1,-1]),new Int8Array([0,-1,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,-1,-1]),new Int8Array([0,0,-1,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,-1]),new Int8Array([0,0,0,0,0,0,0]),new Int8Array([0,0,0,1,0,0,0]),new Int8Array([1,0,0,1,0,0,0]),new Int8Array([1,0,0,1,1,0,0]),new Int8Array([1,1,0,1,1,0,0]),new Int8Array([1,1,0,1,1,1,0]),new Int8Array([1,1,1,1,1,1,0]),new Int8Array([1,1,1,1,1,
1,1])];abc2svg.p_b40=new Int8Array([2,8,14,19,25,31,37]);abc2svg.b40_p=new Int8Array([0,0,0,0,0,0,1,1,1,1,1,1,2,2,2,2,2,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,5,6,6,6,6,6]);abc2svg.b40_a=new Int8Array([-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2,0,-2,-1,0,1,2]);abc2svg.b40_m=new Int8Array([-2,-1,0,1,2,0,0,1,2,3,4,0,2,3,4,5,6,3,4,5,6,7,0,5,6,7,8,9,0,7,8,9,10,11,0,9,10,11,12,13]);
abc2svg.b40k=new Int8Array([36,1,2,3,8,2,2,7,8,13,14,2,8,13,14,19,20,13,14,19,20,25,2,19,24,25,30,31,2,25,30,31,36,37,2,31,36,37,38,3]);abc2svg.b40sf=new Int8Array([-2,-7,0,7,2,88,0,-5,2,-3,4,88,2,-3,4,-1,6,-3,4,-1,6,1,88,-1,-6,1,-4,3,88,1,-4,3,-2,5,88,3,-2,5,0,7]);abc2svg.isb40=new Int8Array([0,1,6,11,12,17,18,23,28,29,34,35]);abc2svg.ifb40=new Int8Array([0,5,6,11,12,17,22,23,28,29,34,39]);abc2svg.pab40=function(u,x){u+=19;u=40*(u/7|0)+abc2svg.p_b40[u%7];x&&3!=x&&(u+=x);return u};
abc2svg.b40p=function(u){return 7*(u/40|0)+abc2svg.b40_p[u%40]-19};abc2svg.b40a=function(u){return abc2svg.b40_a[u%40]};abc2svg.b40m=function(u){return 12*(u/40|0)+abc2svg.b40_m[u%40]};abc2svg.ch_alias={maj:"",min:"m","-":"m","\u00b0":"dim","+":"aug","+5":"aug",maj7:"M7","\u03947":"M7","\u0394":"M7",min7:"m7","-7":"m7","\u00f87":"m7b5","\u00b07":"dim7","min+7":"m+7",aug7:"+7","7+5":"+7","7#5":"+7",sus:"sus4","7sus":"7sus4"};
abc2svg.rat=function(u,x){for(var E,v,I=0,B=0,Ka=1,ea=1;0!=x;)v=x,E=u/x|0,x=u%x,u=v,v=I+E*Ka,I=Ka,Ka=v,v=ea+E*B,ea=B,B=v;return[Ka,B]};abc2svg.pitcmp=function(u,x){return u.pit-x.pit};
abc2svg.Abc=function(u){function x(a,c){if(!a)return a;var d=new a.constructor,e;for(e in a)a.hasOwnProperty(e)&&(d[e]=c&&"object"==typeof a[e]?x(a[e],c-1):a[e]);return d}function E(a,c,d,e){var f,g;if(u.errbld){switch(a){case 0:a="warn";break;case 1:a="error";break;default:a="fatal"}u.errbld(a,c,d,e)}else{if(void 0!=e&&0<=e){for(f=g=0;;){var h=p.file.indexOf("\n",f);if(0>h||h>e)break;g++;f=h+1}f=e-f}e="";d&&(e=d,g&&(e+=":"+(g+1)+":"+(f+1)),e+=" ");switch(a){case 0:e+="Warning: ";break;case 1:e+=
"Error: ";break;default:e+="Internal bug: "}u.errmsg(e+c,g,f)}}function v(a,c,d,e,f,g,h){var l;if(a||!t.quiet){if(c){if(c.err)return;c.err=!0}u.textrans&&(l=u.textrans[d])&&(d=l);3<arguments.length&&(d=d.replace(/\$./g,function(a){switch(a){case "$1":return e;case "$2":return f;case "$3":return g;default:return h}}));c&&c.fname?E(a,d,c.fname,c.istart):E(a,d)}}function I(){this.index=0;I.prototype.char=function(){return this.buffer[this.index]};I.prototype.next_char=function(){return this.buffer[++this.index]};
I.prototype.get_int=function(){for(var a=0,c=this.buffer[this.index];"0"<=c&&"9">=c;)a=10*a+Number(c),c=this.next_char();return a}}function B(a,c,d,e,f,g){v(a,{fname:p.fname,istart:p.istart+p.line.index},c,d,e,f,g)}function Ka(a){/eval *\(|Function|setTimeout|setInterval/.test(a)?B(1,"Unsecure code"):eval('"use strict";\n'+a)}function ea(a,c,d,e){a=C[a];var f=d/2|0;d=(d+e)/2|0;0>f&&(f=0);d>=ta&&(d=ta-1,f>d&&(f=d));if(c)for(c=a.top[f++];f<=d;)c<a.top[f]&&(c=a.top[f]),f++;else for(c=a.bot[f++];f<=d;)c>
a.bot[f]&&(c=a.bot[f]),f++;return c}function X(a,c,d,e,f){a=C[a];var g=d/2|0;d=(d+e)/2|0;0>g&&(g=0);d>=ta&&(d=ta-1,g>d&&(g=d));if(c)for(;g<=d;)a.top[g]<f&&(a.top[g]=f),g++;else for(;g<=d;)a.bot[g]>f&&(a.bot[g]=f),g++}function gd(a,c){switch(c&7){case m.SL_ABOVE:return 1;case m.SL_BELOW:return 0}return a.multi?0<a.multi:1}function bc(a,c){switch(c&7){case m.SL_ABOVE:return!0;case m.SL_BELOW:return!1}return a.multi?0<a.multi:a.p_v.have_ly?(a.pos.voc&7)!=m.SL_ABOVE:!1}function hd(a){if(!a.ldst){var c,
d=a.s;var e=a.start;var f=e.s;var g=f.x+3;e=e.ix;0<e&&(c=ba[e-1]);a.st=d.st;a.lden=!1;a.has_val=!0;if(e=bc(d,d.pos.dyn))a.up=!0;if(c&&c.s==f&&(a.up&&!c.up||!a.up&&c.up)){var h=c.dd;$a[h.func]&&(c=c.x+c.val+4,c>g&&(g=c))}a.defl.noen?(f=a.x-g,20>f&&(g=a.x-20-3,f=20)):(c=d.x,(d=ba[a.ix+1])&&d.s==f&&(a.up&&!d.up||!a.up&&d.up)&&(h=d.dd,$a[h.func]&&(c-=5)),f=c-g-4,20>f&&(g-=.5*(20-f),f=20));a.val=f;a.x=g;a.y=ea(a.st,e,g,f);e||(g=a.dd,a.y-=g.h)}}function id(a){if(!a.ldst){var c=a.dd,d=a.prev,e=a.s,f=e.st,
g=a.start.s,h=g.x;d&&(h=d.s.x+a.dd.wl+2,d.val-=d.dd.wr,8>d.val&&(d.val=8));a.st=f;if(4!=c.func)switch(c.glyph){case "8va":case "15ma":var l=1;break;default:l=6==c.func?bc(g,a.pos):gd(g,a.pos)}if(a.defl.noen){var k=a.x-h;20>k&&(h=a.x-20-3,k=20)}else k=e.x-h-6,e.type==m.NOTE&&(k-=6),10>k&&(h-=10-k,k=10);var r=ea(f,l,h-c.wl-5,k);if(l){var A=C[g.st].topbar+2;r<A&&(r=A)}else A=C[g.st].botbar-2,r>A&&(r=A),r-=c.h;if(d)if(l)r<d.y&&(r=d.y);else if(r>=d.y)r=d.y;else{do d.y=r,d=d.prev;while(d)}a.lden=!1;a.has_val=
!0;a.val=k;a.x=h;a.y=r;l&&(r+=c.h);X(f,l,h,k,r);l?g.ymx=e.ymx=r:g.ymn=e.ymn=r}}function Ac(a){if(!a.ldst)if(a.start)id(a);else{var c=a.s,d=a.dd,e=a.x,f=d.wl+d.wr,g=C[c.st].topbar+2+d.hd,h=C[c.st].botbar-2-d.h;switch(d.glyph){case "brth":case "lphr":case "mphr":case "sphr":var l=g+1;"brth"==d.glyph&&l<c.ymx&&(l=c.ymx);for(c=c.ts_next;c&&!c.seqst;c=c.ts_next);e+=.45*((c?c.x:ua)-e);a.x=e;a.y=l;return}c.nhd&&(e+=c.notes[0<=c.stem?0:c.nhd].shhd);var k=4==d.func?0:6==d.func?bc(c,a.pos):gd(c,a.pos);0==d.name.indexOf("invert")&&
(a.inv=1);switch(d.ty){case "@":case "<":case ">":l=a.y}if(void 0==l)if(k&&"invertedfermata"!=d.name)l=ea(c.st,!0,e-d.wl,f)+d.hd,l<g&&(l=g),a.y>l&&(l=a.y),c.ymx=l+d.h;else{l=ea(c.st,!1,e-d.wl,f)-d.h;l>h&&(l=h);a.y<l&&(l=a.y);if("fermata"==d.name||"accent"==d.glyph||"roll"==d.glyph)a.inv=1;c.ymn=l-d.hd}l>=g?X(c.st,1,e-d.wl,f,l+d.h):l<=h&&X(c.st,0,e-d.wl,f,l-d.hd);a.x=e;a.y=l}}function cc(a){var c,d=Bc[a];if(d)if(c=d.match(/(\d+)\s+(.+?)\s+([0-9.,]+)\s+([0-9.]+)\s+([0-9.]+)/)){var e=Number(c[1]),f=
c[3],g=parseFloat(c[4]),h=parseFloat(c[5]);if(isNaN(e))v(1,null,"%%deco: bad C function value '$1'",c[1]);else if(10<e&&(32>e||44<e))v(1,null,"%%deco: bad C function index '$1'",e);else{5==e&&(e=3);7==e&&(e=6);if(0<f.indexOf(",")){f=f.split(",");var l=f[1];f=f[0]}else l=0;if(50<f||80<g||80<h)v(1,null,"%%deco: abnormal h/wl/wr value '$1'",d);else{var k=Cb[a];k||(k={name:a},Cb[a]=k);k.func=0==a.indexOf("head-")?9:e;k.glyph=c[2];k.h=Number(f);k.hd=Number(l);k.wl=g;k.wr=h;if(c=d.replace(c[0],"").trim()){'"'==
c[0]&&(c=c.slice(1,-1));if("@"==c[0]&&!c.match(/^@([0-9.-]+),([0-9.-]+);?/)){v(1,null,"%%deco: bad position '$1'",c);return}k.str=c}6==k.func&&void 0==k.str&&(k.str=a);c=a.slice(-1);if("("==c||")"==c&&0>a.indexOf("("))if(k.str=null,l=a.slice(0,-1)+("("==c?")":"("),a=Cb[l])"("==c?(k.dd_en=a,a.dd_st=k):(k.dd_st=a,a.dd_en=k);else if(a=cc(l),!a)return;return k}}}else v(1,null,"Invalid decoration '$1'",a);else t.decoerr&&v(1,null,"Unknown decoration '$1'",a)}function jd(a,c,d){var e=Db[a],f=a.slice(0,
-1)+("("==a.slice(-1)?")":"(");e?v(1,c,"Conflict on !$1!",a):(d.s=c,(e=Db[f])?(")"==a.slice(-1)&&(e=d,d=Db[f]),Db[f]=null,d.tie_ty=m.SL_AUTO,d.tie_n=e,d.s.tie_s=e.s):Db[a]=d)}function kd(a){var c=Cb[a];if(c)return c;if(0<="<>^_@".indexOf(a[0])&&!/^(\^|>|<\(|<\)|>\(|>\))$/.test(a)){var d=a[0];if("@"==d){var e=a.match(/@([-\d]+),([-\d]+)/);if(!e){v(1,s,"Bad position in !$1!",a);return}d=e[0]}c=cc(a.replace(d,""))}else c=cc(a);if(c)return d&&(c=Object.create(c),Cb[a]=c,"@"==d[0]&&(c.x=Number(e[1]),c.y=
Number(e[2]),d="@"),c.ty=d),c}function Eb(a,c){for(var d,e,f,g;;){f=la.shift();if(!f)break;if(e=kd(f)){switch(e.func){case 0:if(a.type==m.BAR&&"dot"==f){a.bar_dotted=!0;break}case 1:case 2:if(!a.notes){v(1,a,K.must_note_rest,f);continue}break;case 8:if(a.type!=m.NOTE){v(1,a,K.must_note,f);continue}f=a.notes[a.nhd];f.a_dd||(f.a_dd=[]);f.a_dd.push(e);continue;case 9:if(!a.notes){v(1,a,K.must_note_rest,f);continue}for(d=0;d<=a.nhd;d++)f=a.notes[d],f.invis=!0,f.a_dd||(f.a_dd=[]),f.a_dd.push(e);continue;
case 10:if(a.notes)for(d=0;d<=a.nhd;d++)a.notes[d].color=f;else a.color=f;break;case 32:a.invis=!0;break;case 33:if(a.type!=m.BAR){v(1,a,"!beamon! must be on a bar");continue}a.beam_on=!0;break;case 34:if(a.type!=m.NOTE||!c||c.type!=m.NOTE||a.dur!=c.dur){v(1,a,"!$1! must be on the last of a couple of notes",f);continue}a.trem2=!0;a.beam_end=!0;a.beam_st=!1;c.beam_st=!0;c.beam_end=!1;a.ntrem=c.ntrem=Number(f[4]);for(d=0;d<=a.nhd;d++)a.notes[d].dur*=2;for(d=0;d<=c.nhd;d++)c.notes[d].dur*=2;break;case 35:if(a.type!=
m.NOTE){v(1,a,K.must_note,f);continue}a.xstem=!0;break;case 36:if(a.type!=m.NOTE){v(1,a,K.must_note,f);continue}"1"==f[6]?a.beam_br1=!0:a.beam_br2=!0;break;case 37:a.rbstop=1;break;case 38:if(a.type!=m.NOTE){v(1,a,K.must_note,f);continue}a.trem1=!0;a.ntrem=f.length;break;case 39:if(a.type!=m.NOTE){v(1,a,K.must_note,f);continue}a.feathered_beam="a"==f[5]?1:-1;break;case 40:a.stemless=!0;break;case 41:a.rbstop=2;break;case 42:if(!a.notes[0].acc)continue;f="sacc"+a.notes[0].acc.toString();e=Cb[f];if(!e&&
(e=cc(f),!e)){v(1,a,K.bad_val,"!editorial!");continue}delete a.notes[0].acc;n.acc[a.notes[0].pit+19]=0;break;case 43:d=n.acc[a.notes[0].pit+19];if(a.notes[0].acc||!d)continue;g=1;break;case 44:jd(f,a,a.notes[0]);continue}a.a_dd||(a.a_dd=[]);a.a_dd.push(e)}}g&&(la.push("cacc"+d),Cc(a,a.notes[0]))}function Cc(a,c){for(var d,e;;){d=la.shift();if(!d)break;if(e=kd(d)){switch(e.func){case 0:case 1:case 3:case 4:case 8:break;default:v(1,a,"Cannot have !$1! on a head",d);continue;case 9:case 32:c.invis=!0;
break;case 10:c.color=d;continue;case 40:a.stemless=!0;continue;case 44:jd(d,a,c);continue}c.a_dd||(c.a_dd=[]);c.a_dd.push(e)}}}function Dc(a){var c,d=0,e=a.a_dd,f=e.length;for(c=0;c<f;c++){var g=e[c];switch(g.func){case 1:7>d&&(d=7);break;case 2:14>d&&(d=14);break;case 3:switch(g.glyph){case "brth":case "lphr":case "mphr":case "sphr":20>a.wr&&(a.wr=20)}default:switch(g.ty){case "<":g=g.wl+g.wr+6;d<g&&(d=g);break;case ">":g=g.wl+g.wr+8,a.wr<g&&(a.wr=g)}}}d&&a.prev&&a.prev.type==m.BAR&&(d-=3);return d}
function Ne(){function a(a){var c=a.x-a.wl,d=ba.length;for(a=0;a<d;a++){var e=ba[a];e.ix=a;e.s.x=e.x=c;e.defl.nost=!0}}function c(a){if(a.a_dd){var c,d=a.a_dd.length;void 0==a.y&&(a.y=0);for(c=0;c<d;c++){var e=a.a_dd[c];var f=a.x;var r=a.y;switch(e.func){default:if(10<=e.func)continue;var A=0;break;case 3:case 4:A=a.pos.orn;break;case 6:A=a.pos.vol;break;case 7:A=a.pos.dyn}switch(e.ty){case "^":A=A&-8|m.SL_ABOVE;break;case "_":A=A&-8|m.SL_BELOW;break;case "<":case ">":A=A&7|m.SL_CLOSE;"<"==e.ty?(f-=
e.wr+8,a.notes[0].acc&&(f-=5.5)):f+=e.wl+8;r=3*(a.notes[0].pit-18)-(e.h-e.hd)/2;break;case "@":f+=e.x,r+=e.y}if((A&7)!=m.SL_HIDDEN&&(A={s:a,dd:e,st:a.st,ix:ba.length,defl:{},x:f,y:r,pos:A},a.type!=m.BAR||e.ty||(A.x-=a.wl/2-2),ba.push(A),e.dd_en?A.ldst=!0:e.dd_st&&(A.lden=!0,A.defl.nost=!0),ld[e.func]))ld[e.func](A)}}if(a.notes)for(e=0;e<a.notes.length;e++)if(a.notes[e].a_dd){f=a;r=e;var n=f.notes[r],z=n.a_dd.length,q=f.x;for(d=0;d<z;d++)c=n.a_dd[d],A={s:f,dd:c,st:f.st,m:r,ix:0,defl:{},x:q,y:3*(n.pit-
18)},c.ty&&("@"==c.ty?(A.x+=c.x,A.y+=c.y):(A.y-=(c.h-c.hd)/2,"<"==c.ty?A.x-=c.wr+8:">"==c.ty&&(A.x+=c.wr+8))),ba.push(A),c.dd_en?A.ldst=!0:c.dd_st&&(A.lden=!0,A.defl.nost=!0)}}var d,e;for(d=N;d;d=d.ts_next){switch(d.type){case m.CLEF:case m.KEY:case m.METER:continue}break}for(ba.length&&a(d);d;d=d.ts_next){switch(d.type){case m.BAR:case m.MREST:case m.NOTE:case m.REST:case m.SPACE:break;case m.GRACE:for(e=d.extra;e;e=e.next)c(e);break;default:continue}c(d)}(function(){var a,c,d=ba.length;for(a=0;a<
d;a++){var e=ba[a];if(e.ldst){var k=e.dd;var r=k.dd_en;var A=e.s;var n=A.v;for(c=a+1;c<d;c++){var z=ba[c];if(!z.start&&z.dd==r&&z.s.v==n)break}if(c==d)for(n=A.st,c=a+1;c<d&&(z=ba[c],z.start||z.dd!=r||z.s.st!=n);c++);c==d&&(z={s:A,st:e.st,dd:r,ix:ba.length-1,x:ua-6,y:A.y,cont:!0,lden:!0,defl:{noen:!0}},z.x<A.x+10&&(z.x=A.x+10),void 0!=e.m&&(z.m=e.m),ba.push(z));z.start=e;z.defl.nost=e.defl.nost;0<a&&ba[a-1].s.time==e.s.time&&ba[a-1].dd.name.slice(0,k.name.length-1)==k.name.slice(0,k.name.length-1)&&
(z.prev=ba[a-1])}}for(a=0;a<d;a++)if(z=ba[a],z.lden&&!z.start){A=z.s;a:{for(c=A;c.prev;)if(c=c.prev,c.rbstart)break a;for(c=c.p_v.sym;c.type!=m.CLEF;)c=c.ts_prev;c.next&&c.next.type==m.KEY&&(c=c.next);c=c.next&&c.next.type==m.METER?c.next:c}e={s:c,st:z.st,dd:z.dd.dd_st,ix:ba.length-1,y:A.y,ldst:!0};e.x=e.s.x;void 0!=z.m&&(e.m=z.m);ba.push(e);z.start=e}})()}function Oe(){var a,c=ba.length;for(a=0;a<c;a++){var d=ba[a];var e=d.dd;e=e.func;if(md[e]&&void 0==d.m)md[e](d)}}function Pe(){var a,c,d=Array(P+
1),e=ba.length;for(a=0;a<=P;a++)d[a]={ymin:0,ymax:0};for(a=0;a<e;a++){var f=ba[a];(c=f.dd)&&$a[c.func]&&void 0==f.m&&($a[c.func](f),!c.dd_en&&((f.pos&m.SL_ALI_MSK)==m.SL_ALIGN||0==(f.pos&m.SL_ALI_MSK)&&0<f.s.fmt.dynalign)&&(f.up?f.y>d[f.st].ymax&&(d[f.st].ymax=f.y):f.y<d[f.st].ymin&&(d[f.st].ymin=f.y)))}for(a=0;a<e;a++)if(f=ba[a],(c=f.dd)&&!c.dd_en&&$a[c.func]){if((f.pos&m.SL_ALI_MSK)==m.SL_ALIGN||0==(f.pos&m.SL_ALI_MSK)&&0<f.s.fmt.dynalign){var g=f.up?d[f.st].ymax:d[f.st].ymin;f.y=g}else g=f.y;f.up&&
(g+=c.h);X(f.st,f.up,f.x,f.val,g)}Qe();for(g=0;g<D.length;g++)if(a=D[g],!a.second&&a.sym){e=void 0;d=a;a=C[d.st].topbar+25;for(c=d.sym;c;c=c.next)if(c.type==m.BAR&&c.rbstart&&!c.norepbra){if(!c.next)break;e||(e=c,T("repeat"));for(f=c;c.next&&(c=c.next,!c.rbstop););var h=ea(d.st,!0,f.x,c.x-f.x)+2;a<h&&(a=h);2==f.rbstart&&(h=ea(d.st,!0,f.x,3)+20,a<h&&(a=h));2==c.rbstop&&(h=ea(d.st,!0,c.x-3,3)+20,a<h&&(a=h));f.text&&(h=ya(f.text),h=ea(d.st,!0,f.x+4,h[0])+h[1],a<h&&(a=h));c.rbstart&&(c=c.prev)}if(c=e)for(Ga(d.st,
!0),h=a*C[d.st].staffscale;c;c=c.next)if(c.rbstart&&!c.norepbra){for(f=c;c.next&&(c=c.next,!c.rbstop););if(f==c)break;var l=f.x;0<t.measurenb&c.bar_num&&c.bar_num%t.measurenb&&(l+=6);e=c.type!=m.BAR?c.rbstop?0:c.x-ua+4:1<c.bar_type.length&&"[]"!=c.bar_type||"]"==c.bar_type?0<f.st&&!(L.staves[f.st-1].flags&64)?c.wl:":"==c.bar_type.slice(-1)?12:":"!=c.bar_type[0]?0:8:c.rbstop?0:8;e=c.x-l-e;c.next||c.rbstop||d.bar_start||(d.bar_start=x(c),d.bar_start.type=m.BAR,d.bar_start.bar_type="",delete d.bar_start.text,
d.bar_start.rbstart=1,delete d.bar_start.a_gch);f.text&&R(l+4,h-G.curfont.size-3,f.text);Jb(l,h);2==f.rbstart&&(H+="m0 20v-20");H+="h"+e.toFixed(1);2==c.rbstop&&(H+="v20");H+='"/>\n';X(f.st,!0,l,e,a+2);c.rbstart&&(c=c.prev)}}}function Re(){var a;var c=L;for(a=0;a<=P&&!c.st_print[a];a++);if(!(a>P)){Ga(a);if(1!=C[a].staffscale){var d=Ca("measure").size;mb("measurefont","* "+(d/C[a].staffscale).toString())}T("measure");var e=Sb("0");var f=N;var g=G.nbar;if(1<g)if(0==t.measurenb){var h=!0;var l=ea(a,
!0,0,20);l<C[a].topbar+14&&(l=C[a].topbar+14);R(0,l,g.toString());X(a,!0,0,20,l+G.curfont.size+2)}else if(0==g%t.measurenb){for(;;f=f.ts_next){switch(f.type){case m.CLEF:case m.KEY:case m.METER:case m.STBRK:continue}break}if(f.type!=m.BAR||!f.bar_num){h=!0;var k=e;10<=g&&(k*=100<=g?3:2);G.curfont.pad&&(k+=2*G.curfont.pad);c=f.x-f.wl+2;l=ea(a,!0,c,k);l<C[a].topbar+6&&(l=C[a].topbar+6);l+=2+G.curfont.pad;R(c,l,g.toString());l+=G.curfont.size+G.curfont.pad;X(a,!0,c,k,l)}}for(;f;f=f.ts_next){switch(f.type){case m.STAVES:c=
f.sy;for(a=0;a<P&&!c.st_print[a];a++);Ga(a);continue;default:continue;case m.BAR:if(!f.bar_num||1>=f.bar_num)continue}g=f.bar_num;0!=t.measurenb&&0==g%t.measurenb&&f.next&&!f.bar_mrep&&(h||(h=!0),k=e,10<=g&&(k*=100<=g?3:2),G.curfont.pad&&(k+=2*G.curfont.pad),c=f.x,l=ea(a,!0,c,k),l<C[a].topbar+6&&(l=C[a].topbar+6),f.next.type==m.NOTE&&(0<f.next.stem?l<f.next.ys-G.curfont.size&&(l=f.next.ys-G.curfont.size):l<f.next.y&&(l=f.next.y)),l+=2+G.curfont.pad,R(c,l,g.toString()),l+=G.curfont.size+G.curfont.pad,
X(a,!0,c,k,l))}G.nbar=g;d&&mb("measurefont","* "+d.toString())}}function Se(a,c,d,e){function f(a){return 6*Math.round((a+12)/6)-12-a}var g=a?3.5:5;a=a?1.8:3.2;if(0<c){c=e-(d-1)*g-a;if(26<c)return 0;d=e}else{d=e+(d-1)*g+a;if(-2>d)return 0;c=e}e=f(d-.25);c=f(c+.25);return e*e>c*c?c:e}function nd(a){var c;a=x(a);a.invis=!0;delete a.extra;delete a.text;delete a.a_gch;delete a.a_ly;delete a.a_dd;delete a.tp;a.notes=x(a.notes);for(c=0;c<=a.nhd;c++){var d=a.notes[c]=x(a.notes[c]);delete d.a_dd}return a}
function od(a){function c(a,c,d,e,f,g){var h=f.s1,k=h.nflags;h.ntrem&&(k-=h.ntrem);h.trem2&&g>k&&(h.dur>=m.BLEN/2?(a=h.x+6,c=f.s2.x-6):h.dur<m.BLEN/4&&(a+=5,c-=6));d=f.a*a+f.b-d;c=(c-a)/F.scale;f=f.a*c;Jb(a,d,!0);H+="l"+c.toFixed(1)+" "+(-f).toFixed(1)+"v"+e.toFixed(1)+"l"+(-c).toFixed(1)+" "+f.toFixed(1)+'z"/>\n'}var d,e,f,g,h=a.s1,l=a.s2;Ha(h,"beam");if(h.grace){var k=3.5;var r=3.2;var A=.29;var n=1.8}else k=5,r=8,A=.34,n=3.2;var z=h.stem;h.stem!=l.stem&&h.nflags<l.nflags&&(z=l.stem);0>z&&(n=-n);
c(h.xs-A,l.xs+A,0,n,a,1);var q=0;for(d=h;d.type==m.NOTE&&d.stem!=z&&(d.ys=a.a*d.xs+a.b-C[d.st].y+k*(d.nflags-1)*d.stem-n),d!=l;d=d.next);h.feathered_beam&&(q=k/(l.xs-h.xs),0<h.feathered_beam?(q=-q,k=q*h.xs):k=q*l.xs,q*=z);A=0;for(e=2;e<=a.nflags;e++)for(A+=k,0!=q&&(a.a+=q),d=h;;d=d.next){if(!(d.type!=m.NOTE||d.nflags<e))if(d.trem1&&e>d.nflags-d.ntrem){var y=d.dur>=m.BLEN/2?d.x:d.xs;c(y-5,y+5,(A+2.5)*z,n,a,e)}else{for(f=d;d!=l;){var p=d.next;if(p.type==m.NOTE||p.type==m.REST)if(p.trem1){if(p.nflags-
p.ntrem<e)break}else if(p.nflags<e)break;if(p.beam_br1||p.beam_br2&&2<e)break;d=p}for(g=d;g.type!=m.NOTE;)g=g.prev;y=f.xs;if(f==g)if(f==h)y+=r;else if(f==l)y-=r;else if(f.beam_br1||f.beam_br2&&2<e)y+=r;else{for(p=f.next;p.type!=m.NOTE;)p=p.next;if(p.beam_br1||p.beam_br2&&2<e)y-=r;else{for(f=f.prev;f.type!=m.NOTE;)f=f.prev;y=f.nflags<p.nflags||f.nflags==p.nflags&&f.dots<p.dots?y+r:y-r}}c(y,g.xs,A*z,n,a,e)}if(d==l)break}h.tmp?nb(h):l.tmp&&nb(l);Xa(h,"beam")}function pd(a){function c(a,c,d){for(var e,
f;!L.st_print[c];){if(L.staves[c].flags&d)return;c++}for(e=f=c;;){L.st_print[e]&&(f=e);if(L.staves[e].flags&d)break;e++}c=C[c].y+C[c].topbar*C[c].staffscale;f=C[f].y+C[f].botbar*C[f].staffscale;d&514?(a+=Tb-6,d=fa-f,c=(c-f)/24,H+='<text transform="translate('+a.toFixed(1)+","+d.toFixed(1)+") scale(2.5,"+c.toFixed(2)+')">'+Ec.brace.c+"</text>\n"):(a+=Tb-5,d=fa-c-3,c=c-f+2,H+='<path d="m'+a.toFixed(1)+" "+d.toFixed(1)+"\n\tc10.5 1 12 -4.5 12 -3.5c0 1 -3.5 5.5 -8.5 5.5\n\tv"+c.toFixed(1)+'\n\tc5 0 8.5 4.5 8.5 5.5c0 1 -1.5 -4.5 -12 -3.5"/>\n')}
var d,e,f=L.nstaff;for(d=e=0;;d++){var g=L.staves[d].flags;g&5&&e++;if(L.st_print[d])break;g&10&&e--;if(d==f)break}for(g=f;g>d&&!L.st_print[g];g--);if(d!=g||0!=e)for(e=C[g].y+C[g].botbar*C[g].staffscale,d=C[d].y+C[d].topbar*C[d].staffscale-e,Jb(a,e),H+="v"+(-d).toFixed(1)+'"/>\n',d=0;d<=f;d++)g=L.staves[d].flags,g&1&&c(a,d,2),g&4&&c(a,d,8),g&256&&c(a-6,d,512),g&1024&&c(a-6,d,2048)}function qd(a){if(a.a_meter){var c=C[a.st];var d=c.y;"|||||"!=c.stafflines&&(d+=(c.topbar+c.botbar)/2-12);for(c=0;c<a.a_meter.length;c++){var e=
a.a_meter[c];var f=a.x+a.x_meter[c];e.bot?S('<g transform="translate(X,Y)" text-anchor="middle">\n\t<text y="-12">A</text>\n\t<text>B</text>\n</g>\n',f,d+6,dc(e.top),dc(e.bot)):S('<text x="X" y="Y" text-anchor="middle">A</text>\n',f,d+12,dc(e.top))}}}function Fc(a,c,d){if("object"==typeof d){var e=d[0],f=d[1];var g=e+"_"+f;d=rd[g];d||(d=abc2svg.rat(Math.abs(e),f),f=d[1],d=(0>e?-d[0]:d[0]).toString(),1!=f&&(d+="_"+f),rd[g]=d)}Y(a,c,"acc"+d)}function fb(a,c,d,e,f){var g;0<=c?(g=a.hlu[c])||(g=a.hlu[c]=
[]):(g=a.hld[-c])||(g=a.hld[-c]=[]);for(a=0;a<g.length&&!(d>=g[a][0]);a++);a==g.length?g.push([d,e,f]):d>g[a][0]?g.splice(++a,0,[d,e,f]):(e<g[a][1]&&(g[a][1]=e),f>g[a][2]&&(g[a][2]=f))}function sd(a,c,d){c-=3;10>d?Y(a-4,c,"mtr"+d):(Y(a-10,c,"mtr"+(d/10|0)),Y(a-2,c,"mtr"+d%10))}function Te(a){var c,d,e=a;for(c=a.extra;c.next;)c=c.next;var f=c;if(d=(0<=c.stem||0>a.multi)&&28>=c.notes[0].pit||16>c.notes[0].pit){var g=127;for(c=a.extra;c;c=c.next)c.y<g&&(g=c.y,f=c);c=f.x;g=f.y-5;a.extra!=f&&(c-=4,g+=
1);a=a.next;var h=a.x-1;0>a.stem&&-2<a.nflags&&(h-=4);var l=3*(a.notes[0].pit-18)-5;var k=.4*(h-c);3<k&&(k=3);var m=k;var A=.2;var n=.8;g>l+7?(c=f.x-1,g+=.5,l+=6.5,h=a.x-5.5,k=.8*(g-l),m=.2*(g-l),A=0):l>g+4&&(l=g+4,c=f.x+2,g=f.y-4)}else{g=-127;for(c=a.extra;c;c=c.next)c.y>g&&(g=c.y,f=c);c=f.x;g=f.y+5;a.extra!=f&&(c-=4,--g);a=a.next;h=a.x-1;0<=a.stem&&-2<a.nflags&&(h-=2);l=3*(a.notes[a.nhd].pit-18)+5;k=.4*(c-h);-3>k&&(k=-3);m=k;A=.2;n=.8;g<l-7?(c=f.x-1,g-=.5,l-=6.5,h=a.x-5.5,k=.8*(g-l),m=.2*(g-l),
A=0):l<g-4&&(l=g-4,c=f.x+2,g=f.y+4)}e.slur={x0:c,y0:g,x1:A*h+(1-A)*c-c,y1:g-A*l-(1-A)*g+k,x2:n*h+(1-n)*c-c,y2:g-n*l-(1-n)*g+m,x3:h-c,y3:g-l};g-=e.slur.y1;c=e.extra;d?g<c.ymn&&(c.ymn=g):g>c.ymx&&(c.ymx=g)}function ec(a,c){var d,e=Array(a.nhd+1);var f=a.notes[0>a.stem?a.nhd:0];var g=a.x+f.shhd*F.scale;var h=C[a.st].y+3*(f.pit-18);f=C[a.st].y;if(a.dots){for(d=0;d<=a.nhd;d++){var l=3*(a.notes[d].pit-18);0==l%6&&(l=a.dot_low?l-3:l+3);e[d]=l}for(d=0;d<a.nhd;d++)if(!(e[d+1]>e[d])){for(l=d;0<l&&!(e[l]>e[l-
1]+6);)l--;if(3*(a.notes[l].pit-18)-e[l]<e[d+1]-3*(a.notes[d+1].pit-18))for(;l<=d;)e[l++]-=6;else e[d+1]=e[d]+6}}W.draw_hl(a);a.stemless?a.xstem&&(l=a.ts_prev,d=(0<l.stem?l.y:l.ys)-a.y,d+=C[l.st].y-f,Gc(g,h,d)):(d=a.ys-a.y,l=a.nflags,a.ntrem&&(l-=a.ntrem),!c||0>=l?(0<a.nflags&&(d=0<=a.stem?d-1:d+1),Gc(g,h,d,a.grace)):Gc(g,h,d,a.grace,l,a.fmt.straightflags));if(c&&a.trem1){c=a.ntrem||0;d=3*(a.notes[0<a.stem?a.nhd:0].pit-18);a.head==m.FULL||a.head==m.EMPTY?(g+=(a.grace?2.3:3.5)*a.stem,d=0<a.stem?d+
(6+5.4*c):d-11.4):d=0<a.stem?d+(5+5.4*c):d-10.4;d/=a.p_v.scale;for(S('<path d="mX Y\n\t',g-4.5,f+d);;){H+="l9 -3v3l-9 3z";if(0>=--c)break;H+="m0 5.4"}H+='"/>\n'}for(f=0;f<=a.nhd;f++){var k=void 0,r=void 0;g=a;var A=f;var n=e;c=!1;h=g.notes[A];d=C[g.st].y;l=g.x;var z=3*(h.pit-18),q=l+h.shhd*F.scale,y=z+d,p=fc(g,h.dur);var t=p[0];var u=p[1];p=p[2];if(!h.invis)if(g.grace)r="ghd",q-=4.5*F.scale;else if(h.map&&h.map[0])t=g.head,(r=h.map[0][t])||(r=h.map[0][h.map[0].length-1]),t=r.indexOf("/"),0<=t&&(r=
0<=g.stem?r.slice(0,t):r.slice(t+1));else if(g.type==m.CUSTOS)r="custos";else switch(t){case m.OVAL:r="HD";break;case m.OVALBARS:if(g.head!=m.SQUARE){r="HDD";break}case m.SQUARE:-4<p?r="breve":(r="longa",k=0<g.stem);Oa||!g.next||g.next.type!=m.BAR||g.next.next||(u=0);q+=1;break;case m.EMPTY:r="Hd";break;default:r="hd"}void 0!=h.color&&(c=va(h.color));r&&(k&&(Fb(q,y,0,1,-1),q=y=0),W.psxygl(q,y,r)||Y(q,y,r),k&&bb());if(u)for(k=l+(7.7+g.xmx)*F.scale,void 0==n[A]&&(n[A]=3*(g.notes[A].pit-18),0==(g.notes[A].pit&
1)&&(n[A]+=3)),A=n[A]+d,t=h.dur/12>>5-p-u;0<u--;)Y(k,A,t&1<<u?"dot":"dot+"),k+=3.5;h.acc&&(l-=h.shac*F.scale,g.grace?(Fb(l,z+d,0,.75),Fc(0,0,h.acc),bb()):Fc(l,z+d,h.acc));0!=c&&va(c)}}function Ue(a,c){var d;if(a.grace&&0<a.stem)return-1;var e=a.multi?a.multi:c.multi?c.multi:0;if(e)return e;for(;;a=a.next){if(a.type==m.NOTE){if(!a.stemless){if(0>a.stem)return 1;var f=!0}22>a.notes[0].pit&&(d=!0)}if(a.time==c.time)break}return f||d?-1:1}function td(a,c,d,e,f,g,h){var l=.3;var k=e-c;0>k&&(k=-k);var m=
d-a;40<m&&.7>k/m&&(l=.3+.002*(m-40),.7<l&&(l=.7));var A=.5*(a+d);k=.5*(c+e);var n=a+.45*(A+l*(a-A)-a);var z=c+.45*(k+l*(c-k)+g-c);A=d+.45*(A+l*(d-A)-d);l=e+.45*(k+l*(e-k)+g-e);k=2*f;g=.2+.001*m;.6<g&&(g=.6);g*=f;m*=.03;H=h?H+'<path class="stroke" stroke-dasharray="5,5" d="M':H+'<path d="M';Qa(a," ",c);H+="c"+((n-a)/F.scale).toFixed(1)+" "+(c-z).toFixed(1)+" "+((A-a)/F.scale).toFixed(1)+" "+(c-l).toFixed(1)+" "+((d-a)/F.scale).toFixed(1)+" "+(c-e).toFixed(1);h||(H+="\n\tv"+(-g).toFixed(1)+"c"+((A-
m-d)/F.scale).toFixed(1)+" "+(e+g-l-k).toFixed(1)+" "+((n+m-d)/F.scale).toFixed(1)+" "+(e+g-z-k).toFixed(1)+" "+((a-d)/F.scale).toFixed(1)+" "+(e-c).toFixed(1));H+='"/>\n'}function ud(a,c,d){var e,f=d.ty,g=(f&7)==m.SL_ABOVE?1:-1;var h=a.length;var l=h-1,k=a[0],r=a[l];var A=1;var n=k.st;var z=!1;Ga(k.st);for(e=1;e<h;e++){var q=a[e];if(q.type==m.NOTE||q.type==m.REST)A++,q.st!=n&&(z=!0,q.st<n&&(n=q.st))}z&&v(2,k,"*** multi-staves slurs not treated yet");h=k.x;k.notes&&k.notes[0].shhd&&(h+=k.notes[0].shhd);
z=r.x;r.notes&&(z+=r.notes[0].shhd);c?(c=3*(c.pit-18)+2*g,h+=3):(c=0<g?k.ymx+2:k.ymn-2,k.type==m.NOTE&&(0<g?0<k.stem?(h+=5,k.beam_end&&-1<=k.nflags&&!k.in_tuplet?0<k.nflags?(h+=2,c=k.ys-3):c=k.ys-6:c=k.ys+3):c=k.y+8:0>k.stem?(--h,r.grace?c=k.y-8:k.beam_end&&-1<=k.nflags&&(!k.in_tuplet||k.ys<c+3)?0<k.nflags?(h+=2,c=k.ys+3):c=k.ys+6:c=k.ys-3):c=k.y-8));d.is_note?(d=3*(d.note.pit-18)+2*g,z-=3):(d=0<g?r.ymx+2:r.ymn-2,r.type==m.NOTE&&(0<g?0<r.stem?(z+=1,d=r.beam_st&&-1<=r.nflags&&!r.in_tuplet?r.ys-6:r.ys+
3):d=r.y+8:0>r.stem?(z-=5,d=r.beam_st&&-1<=r.nflags&&!r.in_tuplet?r.ys+6:r.ys-3):d=r.y-8));k.type!=m.NOTE&&(c=d+1.2*g,h=k.x+.5*k.wr,h>z-12&&(h=z-12));r.type!=m.NOTE&&(d=k.type==m.NOTE?c+1.2*g:c,k!=r&&(z=r.x-.3*r.wl));if(3<=A){q=a[1];if(q.type!=m.BAR&&q.x<h+48)if(0<g){var y=q.ymx-2;c<y&&(c=y)}else y=q.ymn+2,c>y&&(c=y);q=a[l-1];q.type!=m.BAR&&q.x>z-48&&(0<g?(y=q.ymx-2,d<y&&(d=y)):(y=q.ymn+2,d>y&&(d=y)))}var p=(d-c)/(z-h);if(.5<p||-.5>p)p=.5<p?.5:-.5,0<p*g?c=d-p*(z-h):d=c+p*(z-h);y=d-c;8<y?y=8:-8>y&&
(y=-8);e=y;0>e&&(e=-e);var t=.5*e;e=.3*y;0<y*g?(z-=t,d-=e):(h+=t,c+=e);k.grace&&(h=k.x-1.15);r.grace&&(z=r.x+2.3*1.5);t=0;p=(d-c)/(z-h);if(k!=r&&k.v==r.v){var u=c-p*h;for(e=1;e<l;e++)if(q=a[e],q.st==n)switch(q.type){case m.NOTE:case m.REST:0<g?(y=3*(q.notes[q.nhd].pit-18)+6,y<q.ymx&&(y=q.ymx),y-=p*q.x+u,y>t&&(t=y)):(y=3*(q.notes[0].pit-18)-6,y>q.ymn&&(y=q.ymn),y-=p*q.x+u,y<t&&(t=y));break;case m.GRACE:for(q=q.extra;q;q=q.next)0<g?(y=3*(q.notes[q.nhd].pit-18)+6,y<q.ymx&&(y=q.ymx),y-=p*q.x+u,y>t&&(t=
y)):(y=3*(q.notes[0].pit-18)-6,y>q.ymn&&(y=q.ymn),y-=p*q.x+u,y<t&&(t=y))}c+=.45*t;d+=.45*t;t*=.65}A=3<A?(.08*(z-h)+12)*g:(.03*(z-h)+8)*g;0<g?(A<3*t&&(A=3*t),40<A&&(A=40)):(A>3*t&&(A=3*t),-40>A&&(A=-40));y=d-c;0>y&&(y=-y);0<g?A<.8*y&&(A=.8*y):A>-.8*y&&(A=-.8*y);A*=k.fmt.slurheight;td(h,c,z,d,g,A,f&m.SL_DOTTED);p=(d-c)/(z-h);u=c-p*h;u=0<A?u+(4*Math.sqrt(A)-2):u-(4*Math.sqrt(-A)-2);for(e=0;e<l;e++)q=a[e],q.st==n&&q.type!=m.BAR&&(y=p*q.x+u,q.ymx<y?q.ymx=y:q.ymn>y&&(q.ymn=y),e==l-1?(t=z,r.sl1&&(t-=5),
e&&(y-=A/3)):t=a[e+1].x,0!=e?h=q.x:y-=A/3,t-=h,X(n,0<g,h,t,y))}function gc(a,c){function d(a,d,f){var g=[];var h=d.note.s;if(!(c&&h.time>c.time)){if(Oa&&h.time>=Oa.time){a.p_v.sls.push(d);for(h=a.p_v.s_next.prev;h.next;)h=h.next;d=Object.create(d);d.note={s:h}}switch(d.ty&7){case m.SL_ABOVE:var k=1;break;case m.SL_BELOW:k=-1;break;default:k=a.v!=h.v?1:Ue(a,h),d.ty&=-8,d.ty|=0<k?m.SL_ABOVE:m.SL_BELOW}var l=L.voices[a.v]&&L.voices[h.v]?0<k*(L.voices[a.v].range<=L.voices[h.v].range?1:-1)?a.v:h.v:a.v>
h.v?a.v:h.v;if(!e||h.grace&&a.v==h.v&&a.time==h.time)g.push(a),a=a.grace?a.next:a.ts_next;else{do g.push(a),a=a.next;while(a);a=e.next}if(h.grace){if(!a.grace){for(k=h;k.prev;)k=k.prev;for(;;){a.v==l&&g.push(a);if(a.extra==k)break;a=a.ts_next}a=k}for(;;){g.push(a);if(a==h)break;a=a.next}}else for(;a;){a.v==l&&g.push(a);if(a==h)break;a=a.ts_next}for(h=1;h<g.length-1;h++)a=g[h],(a.sls||a.sl1)&&gc(a,c),a.tp&&Hc(a);ud(g,f,d);return 1}}for(var e,f,g,h,l,k;;){if(!a||a==c){if(!e||!(a=e.next)||a==c)break;
e=null}if(a.type==m.GRACE)e=a,a=a.extra;else{if(a.sls){l=a.sls;a.sls=null;k=[];for(f=0;f<l.length;f++)d(a,l[f])||k.push(l[f]);k.length&&(a.sls=k)}if(a.sl1)for(g=0;g<=a.nhd;g++)if(h=a.notes[g],h.sls){l=h.sls;h.sls=null;k=[];for(f=0;f<l.length;f++)d(a,l[f],h)||k.push(l[f]);k.length&&(h.sls=k)}a=a.next}}}function Hc(a){var c,d,e,f,g=a.tp.shift();a.tp.length||delete a.tp;var h=a.st;Ga(a.st);for(c=a;c;c=c.next){switch(c.type){case m.GRACE:for(e=c.extra;e;e=e.next)(e.sls||e.sl1)&&gc(e);default:continue;
case m.NOTE:case m.REST:}(c.sls||c.sl1)&&gc(c);c.st<h&&(h=c.st);c.tp&&Hc(c);if(c.tpe)break}c&&c.tpe--;if(1!=g.f[0])if(c){e=g.f[3];if(!e){for(d=a;d.type!=m.NOTE;)d=d.next;e=0<d.stem?m.SL_ABOVE:m.SL_BELOW}if(a==c||2==g.f[1])var l=!0;else if(1==g.f[1])l=!0,ud([a,c],null,{ty:e});else if(2!=g.f[0]&&a.type==m.NOTE&&c.type==m.NOTE){l=!0;for(d=a;;d=d.next){if(d.type!=m.NOTE&&d.type!=m.REST){if(d.type==m.GRACE||d.type==m.SPACE)continue;l=!1;break}if(d==c)break;if(d.beam_end){l=!1;break}}if(l&&!a.beam_st&&
!a.beam_br1&&!a.beam_br2)for(d=a.prev;d;d=d.prev)if(d.type==m.NOTE||d.type==m.REST){d.nflags>=a.nflags&&(l=!1);break}if(l&&!c.beam_end)for(d=c.next;d;d=d.next)if(d.type==m.NOTE||d.type==m.REST){!d.beam_br1&&!d.beam_br2&&d.nflags>=c.nflags&&(l=!1);break}}if(l){if(1!=g.f[2]){T("tuplet");l=(c.x+a.x)/2;var k=e==m.SL_ABOVE?ea(h,1,l-4,8):ea(h,0,l-4,8)-G.curfont.size;0<a.stem*c.stem&&(l=0<a.stem?l+1.5:l-1.5);0==g.f[2]?R(l,k,g.p.toString(),"c"):R(l,k,g.p+":"+g.q,"c");for(d=a;!(d.x>=l);d=d.next);e==m.SL_ABOVE?
(k+=G.curfont.size,d.ymx<k&&(d.ymx=k),X(h,!0,l-3,6,k)):(d.ymn>k&&(d.ymn=k),X(h,!1,l-3,6,k))}}else{var r=a.x-4;if(c.dur>c.prev.dur){d=c.next;if(!d||d.time!=c.time+c.dur)for(d=c.ts_next;d&&!(d.seqst&&d.time>=c.time+c.dur);d=d.ts_next);var n=d?d.x-d.wl-5:ua-6}else n=c.x+4,l=0<=c.stem?0:c.nhd,0<c.notes[l].shhd&&(n+=c.notes[l].shhd),c.st==h&&0<c.stem&&(n+=3.5);if(e==m.SL_ABOVE){if(a.st==c.st)var p=f=C[h].topbar+2;else p=a.ymx,f=c.ymx;if(a.st==h){for(d=a;!d.dur;d=d.next);k=ea(h,1,d.x-4,8);k>p&&(p=k);0<
a.stem&&(r+=3)}if(c.st==h){for(d=c;!d.dur;d=d.prev);k=ea(h,1,d.x-4,8);k>f&&(f=k)}l=.5*(r+n);k=.5*(p+f);var z=(f-p)/(n-r);p=3*(c.notes[c.nhd].pit-a.notes[a.nhd].pit)/(n-r);0<p?0>z?z=0:z>p&&(z=p):0<z?z=0:z<p&&(z=p);z*z<.1*.1&&(z=0);f=0;for(d=a;;d=d.next){if(d.dur&&d.st==h){var q=k+(d.x-l)*z;p=ea(h,1,d.x-4,8)+2;p-q>f&&(f=p-q)}if(d==c)break}k+=f;p=k+z*(r-l);f=k+z*(n-l);k+=6;for(d=a;d.st==h&&(q=k+(d.x-l)*z,d.ymx<q&&(d.ymx=q),X(h,!0,d.x,d.next.x-d.x,q)),d!=c;d=d.next);}else{0>a.stem&&(r-=2);if(a.st==h){for(d=
a;!d.dur;d=d.next);p=ea(h,0,d.x-4,8)}else p=0;if(c.st==h){for(d=c;!d.dur;d=d.prev);f=ea(h,0,d.x-4,8)}else f=0;l=.5*(r+n);k=.5*(p+f);z=(f-p)/(n-r);p=3*(c.notes[0].pit-a.notes[0].pit)/(n-r);0<p?(0>z?z=0:z>p&&(z=p),.35<z&&(z=.35)):(0<z?z=0:z<p&&(z=p),-.35>z&&(z=-.35));z*z<.1*.1&&(z=0);f=0;for(d=a;d.dur&&d.st==h&&(q=k+(d.x-l)*z,p=ea(h,0,d.x-4,8),p-q<f&&(f=p-q)),d!=c;d=d.next);k+=f-8;p=k+z*(r-l);f=k+z*(n-l);k-=2;for(d=a;d.st==h&&(q=k+(d.x-l)*z,d.ymn>q&&(d.ymn=q),d.next&&X(h,!1,d.x,d.next.x-d.x,q)),d!=
c;d=d.next);}1==g.f[2]?(h=f-p,q=e==m.SL_ABOVE?-3:3,e=(n-r)/F.scale,H+='<path class="stroke" d="m',Qa(r," ",p+4+q),H+="v"+q.toFixed(1)+"l"+e.toFixed(1)+" "+(-h).toFixed(1)+"v"+(-q).toFixed(1)+'"/>\n'):(a=r,c=p,r=n-r,n=f-p,p=e==m.SL_ABOVE,f=0==g.f[2]?g.p.toString():g.p+":"+g.q,g=10*f.length,d=p?-3:3,T("tuplet"),R(a+r/2,c+n/2-.5*G.curfont.size+2,f,"c"),r/=F.scale,p||(c+=6),H+='<path class="stroke" d="m',Qa(a," ",c),p=r-g+1,g=0<n?g+n/8:g-n/8,H+="v"+d.toFixed(1)+"m"+r.toFixed(1)+" "+(-n).toFixed(1)+"v"+
(-d).toFixed(1)+'"/>\n<path class="stroke" stroke-dasharray="'+(p/2).toFixed(1)+" "+g.toFixed(1)+'" d="m',Qa(a," ",c-d),H+="l"+r.toFixed(1)+" "+(-n).toFixed(1)+'"/>\n',e==m.SL_ABOVE?X(h,!0,l-3,6,q+2):X(h,!1,l-3,6,q))}}else v(1,a,"No end of tuplet in this music line")}function vd(a,c){var d,e=a.tie_n;var f=2==c?a.pit:e.pit;var g=(a.tie_ty&7)==m.SL_ABOVE?1:-1,h=a.s,l=h.st,k=e.s;var r=k.x;var n=a.shhd;for(d=0;d<h.nhd&&h.notes[d]!=a;d++);0<g?d<h.nhd&&f+1==h.notes[d+1].pit&&h.notes[d+1].shhd>n&&(n=h.notes[d+
1].shhd):0<d&&f==h.notes[d-1].pit+1&&h.notes[d-1].shhd>n&&(n=h.notes[d-1].shhd);var p=h.x+n;if(2!=c){for(d=0;d<k.nhd&&k.notes[d]!=e;d++);n=k.notes[d].shhd;0<g?d<k.nhd&&f+1==k.notes[d+1].pit&&k.notes[d+1].shhd<n&&(n=k.notes[d+1].shhd):0<d&&f==k.notes[d-1].pit+1&&k.notes[d-1].shhd<n&&(n=k.notes[d-1].shhd);r+=n}switch(c){case 0:f=a.pit&1?a.pit:e.pit;break;case 3:g=-g;case 1:p=h.x;p>r-20&&(p=r-20);f=e.pit;l=k.st;break;default:if(h!=k)r-=k.wl,k.type==m.BAR&&(r+=5);else{c=h.time+h.dur;for(r=h.ts_next;r&&
!(r.time>c);r=r.ts_next);r=r?r.x:ua}r<p+16&&(r=p+16)}20<r-p?(p+=3.5,r-=3.5):(p+=1.5,r-=1.5);!h.dots||a.pit&1||!(0<g&&!h.dot_low||0>g&&h.dot_low)||(p+=5);f=C[l].y+3*(f-18)+g;td(p,f,r,f,g,(.03*(r-p)+16)*g*h.fmt.tieheight,a.tie_ty&m.SL_DOTTED)}function hc(a,c,d){var e;var f=[];var g=a.nhd;if(2==d)for(e=0;e<=g;e++){var h=a.notes[e];h.tie_ty&&(f=h.tie_n,h.tie_n={s:c||a},vd(h,d),h.tie_n=f)}else{for(e=0;e<=g;e++)h=a.notes[e],h.tie_ty&&(h.s||(h.s=a),h.tie_n?vd(h,d):f.push(h));f.length&&v(1,a,"Bad tie")}}
function Ve(a){function c(a,c,d){if(a.type==m.GRACE)for(a=a.extra;a;a=a.next)a.tie_s&&hc(a,c,d);else hc(a,c,d)}var d=a.sym;for(va(d.color);;){for(a=d;a;a=a.next){if(a.ti2&&(a!=d||!d.prev)){var e=a.ti2;e.x=a.x;var f=e.next;e.next=a;e.st=a.st;var g=e.time;e.time=a.time-e.dur;hc(e,a,1);e.next=f;e.time=g}if(a.tie_s)break}if(!a)break;f=a.tie_s;e=a;if(f.v==a.v)for(d=f;;){if(!e.next){f=e;e=null;break}e=e.next;if(e==f)break}else{for(d=a.next;;){if(!e.ts_next){e=null;break}e=e.ts_next;if(e==f)break}if(!e)for(f=
a;f.next;)f=f.next}if(!e){c(a,f,2);a.tie_s.ti2=a;break}g=a.time+e.dur;for(e=a.ts_next;e!=f;e=e.ts_next)if(e.st==a.st){if(e.time>g)break;if(e.type==m.CLEF){var h=!0;break}}h||a.st!=f.st?(h=!1,g=.4*(f.x-a.x),e=f.x,f.x-=g,f.x>a.x+32&&(f.x=a.x+32),c(a,f,2),f.x=e,e=a.x,a.x+=g,a.x<f.x-24&&(a.x=f.x-24),hc(a,f,3),a.x=e):c(a,f,f.type==m.NOTE?0:2)}}function We(){function a(a,c){var d=ua/ta,e=a.x/d|0,f=c.x/d|0,g=(a.ys-c.ys)/(a.xs-c.xs);c=a.ys-a.xs*g;var h=C[a.st];d*=g;if(0<a.stem)for(;e<=f;)a=d*e+c,h.top[e]<
a&&(h.top[e]=a),e++;else for(;e<=f;)a=d*e+c,h.bot[e]>a&&(h.bot[e]=a),e++}var c,d,e,f=H;H="";ta=Math.ceil(ua/2);for(c=0;c<=P;c++){var g=C[c];g.top=new Float32Array(ta);g.bot=new Float32Array(ta);for(d=0;d<ta;d++)g.top[d]=0,g.bot[d]=24}for(d=0;d<D.length;d++){var h={},l=!0;c=D[d];for(g=c.sym;g;g=g.next)switch(g.type){case m.GRACE:var k=0;for(e=g.extra;e;e=e.next)e.beam_st&&!e.beam_end&&(W.calculate_beam(h,e),h.s2&&a(e,h.s2)),(e.sls||e.sl1)&&k++;g.p_v.ckey.k_bagpipe||!g.fmt.graceslurs||g.gr_shift||k||
g.tie_s||!g.next||g.next.type!=m.NOTE||Te(g)}for(g=c.sym;g;g=g.next)switch(g.type){case m.NOTE:if(g.beam_st&&!g.beam_end||l&&!g.beam_st)l=!1,W.calculate_beam(h,g),h.s2&&a(g,h.s2)}}Xe();Ne();for(g=N;g;g=g.ts_next)if(!g.invis){switch(g.type){case m.GRACE:for(e=g.extra;e;e=e.next)X(g.st,!0,e.x-2,4,e.ymx+1),X(g.st,!1,e.x-2,4,e.ymn-5);continue;case m.MREST:X(g.st,!0,g.x+16,32,g.ymx+2);continue;default:X(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx+2);X(g.st,!1,g.x-g.wl,g.wl+g.wr,g.ymn-2);continue;case m.NOTE:}0<g.stem?
(g.stemless?(c=-5,d=10):g.beam_st?(c=3,d=g.beam_end?4:10):(c=-8,d=g.beam_end?11:16),X(g.st,!0,g.x+c,d,g.ymx),d=g.ymn,g.notes[0].acc&&d>3*(g.notes[0].pit-18)-9&&(d=3*(g.notes[0].pit-18)-9),X(g.st,!1,g.x-g.wl,g.wl+g.wr,d)):(X(g.st,!0,g.x-g.wl,g.wl+g.wr,g.ymx),g.stemless?(c=-5,d=10):g.beam_st?(c=-6,d=g.beam_end?4:10):(c=-8,d=g.beam_end?5:16),c+=g.notes[0].shhd,X(g.st,!1,g.x+c,d,g.ymn));g.notes[g.nhd].acc&&(d=g.y+8,g.ymx<d&&(g.ymx=d),X(g.st,!0,g.x,0,d));g.notes[0].acc&&(d=g.y,d=1==g.notes[0].acc||3==
g.notes[0].acc?d-7:d-5,g.ymn>d&&(g.ymn=d),X(g.st,!1,g.x,0,d))}Oe();for(d=0;d<D.length;d++)if(c=D[d],g=c.sym)for(va(g.color),c=c.st;g;g=g.next)g.play||(g.tp&&Hc(g),(g.sls||g.sl1)&&gc(g));va();for(c=0;c<=P;c++)for(g=C[c],e=g.topbar+2,k=g.botbar-2,d=0;d<ta;d++)e>g.top[d]&&(g.top[d]=e),k<g.bot[d]&&(g.bot[d]=k);Pe();0<=t.measurenb&&Re();Ga(-1);for(d=0;d<D.length;d++)if(c=D[d],c.have_ly){Ye();break}Ga(-1);H=f}function Ze(a,c){var d,e,f=[];for(d=c.length;0<=d&&!c[d];d--);if(!(0>d)){for(e=0;e<D.length;e++){var g=
D[e];if(g.sym&&L.voices[e]&&(d=L.voices[e].st,c[d])){if(g.new_name){var h=2;break}g.snm&&(h=1)}}if(h){for(e=0;e<D.length;e++)g=D[e],g.sym&&L.voices[e]&&(d=L.voices[e].st,c[d]&&(g.new_name&&delete g.new_name,(g=2==h?g.nm:g.snm)&&(f[d]=f[d]?f[d]+("\n"+g):g)));if(f.length){T("voice");var l=G.curfont.size;var k=l/2;a=.5*-a;for(d=0;d<f.length;d++)if(f[d])for(e=f[d].split("\n"),h=C[d].y+.5*C[d].topbar*C[d].staffscale+k*(e.length-2),L.staves[d].flags&1&&d+1<C.length&&L.staves[d+1].flags&2&&!f[d+1]&&(h-=
.5*(C[d].y-C[d+1].y)),c=0;c<e.length;c++)g=e[c],R(a,h,g,"c"),h-=l}}}}function $e(){var a,c,d,e,f=N.fmt;var g=L;for(c=0;c<D.length;c++){var h=D[c];1!=h.scale&&(h.scale_str='transform="scale('+h.scale.toFixed(2)+')"')}for(c=0;c<=P&&!G.st_print[c];c++);var l=0;c>P&&c--;h=C[c];for(a=0;a<ta;a++){var k=h.top[a];l<k&&(l=k)}a=l;k=c;var r=0,n=0,p=C[k].topbar+8,z=0,q=1,y=-100;for(e=N;e;e=e.ts_next)if(e.type==m.TEMPO&&!e.invis){d||(d=e);var B=e.tempo_wh[0];0==e.time&&40<e.x&&(e.x=40);var v=ea(k,!0,e.x-16,B);
v>p&&(p=v);y>=e.x-16&&!(z&q>>1)&&(z|=q);q<<=1;y=e.x-16+B}if(d){za(-1);T("tempo");n=G.curfont.size+8;v=2-n;var x=v-n;0!=z&&(n*=2);l<p+n&&(r=p+n-l);for(e=d;e;e=e.ts_next)if(e.type==m.TEMPO&&!e.invis){if(u.anno_start||u.anno_stop)e.wl=16,e.wr=30,e.ymn=z&1?x:v,e.ymx=e.ymn+14,Ha(e);wd(e,e.x-16,z&1?x:v);Xa(e);for(z>>=1;e.ts_next&&e.ts_next.type==m.TEMPO;)e=e.ts_next}}p=C[k].topbar+6;for(e=N;e;e=e.ts_next)if(e.type==m.PART&&!e.invis){if(!ab){var ab=e;T("parts");x=G.curfont.size+2+2*G.curfont.pad}B=ya(e.text)[0];
v=ea(k,!0,e.x-10,B+3);p<v&&(p=v)}if(ab)for(za(-1),l+r<p+x+n&&(r=p+x+n-l),e=ab;e;e=e.ts_next)if(e.type==m.PART&&!e.invis){e.x-=10;if(u.anno_start||u.anno_stop)B=ya(e.text)[0],e.wl=0,e.wr=B,e.ymn=-n-x,e.ymx=e.ymn+x,Ha(e);R(e.x,2-n-x,e.text);for(Xa(e);e.ts_next&&e.ts_next.type==m.PART;)e=e.ts_next}l=a+r;if(!G.st_print[c])return h.y=-l,l;l*=h.staffscale;d=.5*f.staffsep+h.topbar*h.staffscale;l<d&&(l=d);l<h.ann_top&&(l=h.ann_top);h.y=-l;ab=c;x=g.staves[ab];for(c++;c<=P;c++)if(G.st_print[c]){h=C[c];d=x.sep||
t.sysstaffsep;e=x.maxsep||t.maxsysstaffsep;x=0;if(h.staffscale==C[ab].staffscale){for(a=0;a<ta;a++)k=h.top[a]-C[ab].bot[a],x<k&&(x=k);x*=h.staffscale}else for(a=0;a<ta;a++)k=h.top[a]*h.staffscale-C[ab].bot[a]*C[ab].staffscale,x<k&&(x=k);d+=h.topbar*h.staffscale;x<d&&(x=d);e+=h.topbar*h.staffscale;x>e&&(x=e);l+=x;h.y=-l;for(ab=c;!(x=g.staves[ab]);)g=g.next}for(a=g=0;a<ta;a++)k=C[ab].bot[a],g>k&&(g=k);g>h.ann_bot&&(g=h.ann_bot);g*=C[ab].staffscale;for(c=0;c<=P;c++)h=C[c],x=h.y,1!=h.staffscale&&(h.scale_str=
'transform="translate(0,'+(fa-x).toFixed(1)+") scale("+h.staffscale.toFixed(2)+')"');if(0==g){for(c=P;0<=c&&!G.st_print[c];c--);if(0>c)return l}x=-g;d=.5*f.staffsep;x<d&&(x=d);e=.5*f.maxstaffsep;x>e&&(x=e);return l+x}function af(a){function c(){var a,c=0;for(a=0;a<=L.nstaff;a++)if(0>l[a])r[a]=n[a]=0;else{var d=C[a].staffscale;var e=C[a].topbar*d;d*=C[a].botbar;0==c&&(c=C[a].y+e);r[a]=C[a].y+d;n[a]=c-r[a];c=L.staves[a].flags&64?0:r[a]}}function d(a,c,d){var e,f,g=0,h="",k=C[a].stafflines,l=k.length;
if(/[\[|]/.test(k)){d-=c;za(a);var m=d/F.scale;if(Ub&&Ub.st_l==k&&Ub.st_ws==(m|0))Y(c,C[a].y,"stdef"+t.fullsvg);else{for(e=0;e<l;e++,g-=6)if("."!=k[e]){for(f=0;e<l;e++,g-=6,f-=6){switch(k[e]){case ".":case "-":continue;case r:h+="m-"+m.toFixed(1)+" "+f+"h"+m.toFixed(1);f=0;continue}void 0!=r&&(h+='"/>\n');var r=k[e];h+='<path class="'+("["==r?"slthW":"slW")+'" d="m0 '+g+"h"+m.toFixed(1);f=0}h+='"/>'}g=C[a].y;!Ub&&d>Vb()-10?(Ub={st_l:k,st_ws:m|0},e="stdef"+t.fullsvg,0>h.indexOf("<path",1)?Gb[e]=h.replace("path",
'path id="'+e+'"'):Gb[e]='<g id="'+e+'">\n'+h+"\n</g>",Y(c,g,e)):S('<g transform="translate(X, Y)">\n'+h+"\n</g>\n",c,g)}}}var e,f,g,h,l=[],k=[],r=[],n=[],p=[],z="",q="";for(g=0;g<=P;g++)l[g]=L.st_print[g]?0:-1,k[g]=L.st_print[g];c();pd(0);for(e=N;e;e=e.ts_next){if(h&&e.time!=h){for(g=h=0;g<=P;g++)L.st_print[g]||(l[g]=-1);c()}switch(e.type){case m.STAVES:var y=e.ts_prev.type==m.BAR?e.ts_prev.x:0;if(!y){for(f=e.ts_next;f&&f.time==e.time;f=f.ts_next){switch(f.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:y=
f.x;continue}break}f||(y=ua)}var u=e.sy;for(g=0;g<=P;g++){var x=l[g];0>x?u.st_print[g]&&(l[g]=y?y:e.x-e.wl-2,k[g]=!0):u.st_print[g]&&u.staves[g].stafflines==L.staves[g].stafflines||(y?(f=y,h=e.time):(f=e.x-e.wl-2,l[g]=-1),d(g,x,f),u.st_print[g]&&(l[g]=f))}L=u;c();continue;case m.BAR:if(e.invis||!e.bar_type)break;if(e.second&&(!e.ts_prev||e.ts_prev.type==m.BAR&&e.ts_prev.st==e.st))break;p.push([e,r[e.st],n[e.st]]);break;case m.STBRK:if(L.voices[e.v]&&0==L.voices[e.v].range&&14<e.xmx){for(x=g=0;x<D.length;x++)L.voices[x]&&
0<L.voices[x].range&&g++;for(f=e.ts_next;f&&f.type==m.STBRK;f=f.ts_next)g--;0==g&&pd(e.x)}g=e.st;x=l[g];0<=x&&(f=e.prev)&&(f=f.type==m.BAR?f.x:e.x-e.xmx,x>=f||(d(g,x,f),l[g]=e.x))}}for(g=0;g<=P;g++)if(!h||L.st_print[g])x=l[g],0>x||x>=ua||d(g,x,ua);(function(){var a,c,d=p.length;T("annotation");if(c=G.curfont.box)G.curfont.box=0;for(a=0;a<d;a++){var e=p[a];var f,g,h=e[0],k=e[1],l=e[2],r=h.bar_type,n=h.st,A=C[n],y=h.x;0!=n&&h.ts_prev&&h.ts_prev.type!=m.BAR&&(l=A.topbar*A.staffscale);h.ymx=h.ymn+l;za(-1);
Ha(h);h.color&&va(h.color);e=A.y+12;"|||||"!=A.stafflines&&(e+=(A.topbar+A.botbar)/2-12);if(h.bar_mrep){za(n);if(1==h.bar_mrep){for(f=h.prev;f.type!=m.REST;f=f.prev);Y(f.x,e,"mrep")}else Y(y,e,"mrep2"),h.v==L.top_voice&&sd(y,e+A.topbar,h.bar_mrep);za(-1)}"||:"==r&&(r="[|:");for(g=r.length;0<=--g;){switch(r[g]){case "|":h.bar_dotted?(f=(5*A.staffscale).toFixed(1),S('<path class="bW" stroke-dasharray="A,A" d="MX Yv-G"/>\n',y,k,f,l)):h.color?S('<path class="bW" d="MX Yv-F"/>\n',y,k,l):z+="M"+ob(y).toFixed(1)+
" "+W.sy(k).toFixed(1)+"v-"+l.toFixed(1);break;default:y-=3;h.color?S('<path class="bthW" d="MX Yv-F"/>\n',y+1.5,k,l):q+="M"+ob(y+1.5).toFixed(1)+" "+W.sy(k).toFixed(1)+"v-"+l.toFixed(1);break;case ":":y-=2,za(n),Y(y+1,e-12,"rdots"),za(-1)}y-=3}va();Xa(h)}c&&(G.curfont.box=c);za(-1);z&&(H+='<path class="bW" d="'+z+'"/>\n');q&&(H+='<path class="bthW" d="'+q+'"/>\n')})();Ze(a,k)}function bf(){var a,c=D.length;for(a=0;a<c;a++){var d=D[a];d.sym&&void 0!=d.sym.x&&(W.draw_symbols(d),Ve(d),va())}W.draw_all_deco();
(function(){function a(a,c){var e,f,g,h=a.length;if(h)for(f=0;f<h;f++)if((e=a[f])&&e.length){var l=ob(e[0][0]);H+='<path class="stroke" stroke-width="1" d="M'+l.toFixed(1)+" "+pb(d.y+c*f).toFixed(1);for(g=0;;){var m=e.shift();if(!m)break;var n=ob(m[0]);H+="m"+(n-l+m[1]-g).toFixed(2)+" 0h"+(-m[1]+m[2]).toFixed(2);l=n;g=m[2]}H+='"/>\n'}}var c;for(c=0;c<=P;c++){var d=C[c];d.hlu&&(za(c),a(d.hlu,6),a(d.hld,-6))}})();gb();cf();za(-1)}function Xe(){var a,c,d,e;for(c=0;c<D.length;c++){var f=D[c];if(f=f.sym)if(f=
f.next){for(e=f;e;e=e.next)if(e.tie_s){var g=a=0;var h=128;for(d=0;d<=e.nhd;d++)e.notes[d].tie_ty&&(a++,128>h&&e.notes[d].pit<=h+1&&g++,h=e.notes[d].pit);h=0>e.stem*e.tie_s.stem?22<=h?m.SL_ABOVE:m.SL_BELOW:e.multi?0<e.multi?m.SL_ABOVE:m.SL_BELOW:0>e.stem?m.SL_ABOVE:m.SL_BELOW;if(e.multi)for(d=0;d<=e.nhd;d++)g=e.notes[d].tie_ty,(g&7)==m.SL_AUTO&&(e.notes[d].tie_ty=g&m.SL_DOTTED|h);else if(1>=a)for(d=0;d<=e.nhd;d++){if(g=e.notes[d].tie_ty){(g&7)==m.SL_AUTO&&(e.notes[d].tie_ty=g&m.SL_DOTTED|h);break}}else if(g){h=
128;for(d=0;d<=e.nhd;d++)if(e.notes[d].tie_ty){if(128>h&&e.notes[d].pit<=h+1){a=d;break}h=e.notes[d].pit}h=m.SL_BELOW;for(d=0;d<=e.nhd;d++)if(g=e.notes[d].tie_ty)a==d&&(h=m.SL_ABOVE),(g&7)==m.SL_AUTO&&(e.notes[d].tie_ty=g&m.SL_DOTTED|h)}else if(a&1)for(a=(a-1)/2,h=m.SL_BELOW,d=0;d<=e.nhd;d++){if(g=e.notes[d].tie_ty)0==a&&22<=e.notes[d].pit&&(h=m.SL_ABOVE),(g&7)==m.SL_AUTO&&(e.notes[d].tie_ty=g&m.SL_DOTTED|h),0==a--&&(h=m.SL_ABOVE)}else for(a/=2,h=m.SL_BELOW,d=0;d<=e.nhd;d++)if(g=e.notes[d].tie_ty)(g&
7)==m.SL_AUTO&&(e.notes[d].tie_ty=g&m.SL_DOTTED|h),0==--a&&(h=m.SL_ABOVE)}for(;f;f=f.next)if(f.tie_s&&(20>f.notes[0].pit&&f.notes[0].tie_ty&&(f.notes[0].tie_ty&7)==m.SL_BELOW||24<f.notes[f.nhd].pit&&f.notes[f.nhd].tie_ty&&(f.notes[f.nhd].tie_ty&7)==m.SL_ABOVE)){for(a=f.next;a&&a.type!=m.NOTE;)a=a.next;if(a){if(a.st!=f.st)continue;d=a.x-f.x-10}else d=ua-f.x-10;g=100>d?9:300>d?12:16;24<f.notes[f.nhd].pit&&(e=3*(f.notes[f.nhd].pit-18)+g,f.ymx<e&&(f.ymx=e),a&&a.ymx<e&&(a.ymx=e),X(f.st,!0,f.x+5,d,e));
20>f.notes[0].pit&&(e=3*(f.notes[0].pit-18)-g,f.ymn>e&&(f.ymn=e),a&&a.ymn>e&&(a.ymn=e),X(f.st,!1,f.x+5,d,e))}}}}function hb(a){return!a||!/^(0|n|f)/i.test(a)}function xd(a){var c=yd[a.name];c||(c=1.1);a.swfac=a.size*c}function mb(a,c){var d;if("-"==a[a.length-2]){a=a[a.length-1];if("1">a||"9"<a)return;a="u"+a+"font"}var e=(e=t[a])?{name:e.name,size:e.size,box:e.box,pad:e.pad||0}:{pad:0};t[a]=e;if(d=c.match(/\s+(no)?box(\s|$)/))d[1]?(e.box=!1,e.pad=0):(e.box=!0,e.pad=.4*e.size-3),c=c.replace(d[0],
d[2]);if(d=c.match(/\s+padding=([\d.]+)(\s|$)/))e.pad=d[1]?Number(d[1]):0,c=c.replace(d[0],d[2]);if(d=c.match(/\s+class=(.*?)(\s|$)/))e.class=d[1],c=c.replace(d[0],d[2]);if(d=c.match(/\s+wadj=(.*?)(\s|$)/)){if("undefined"==typeof document)switch(d[1]){case "none":e.wadj="";break;case "space":e.wadj="spacing";break;case "glyph":e.wadj="spacingAndGlyphs";break;default:B(1,K.bad_val,"%%"+a)}c=c.replace(d[0],d[2])}if(d=c.match(/\s+([0-9.]+|\*)$/))"*"!=d[1]&&(e.size=Number(d[1])),c=c.replace(d[0],"");
if(d=c.match(/[- ]?[nN]ormal/))e.normal=!0,c=c.replace(d[0],"");if(d=c.match(/[- ]?[bB]old/))e.weight="bold",c=c.replace(d[0],"");if(d=c.match(/[- ]?[iI]talic/))e.style="italic",c=c.replace(d[0],"");if(d=c.match(/[- ]?[oO]blique/))e.style="oblique",c=c.replace(d[0],"");e.size?xd(e):e.swfac=0;if("u"==c[0]&&"url("==c.slice(0,4)){a=c.indexOf(")",1);if(0>a){B(1,"No end of url in font family");return}c=c.slice(0,a+1)}else if('"'==c[0]){a=c.indexOf('"',1);if(0>a){B(1,"No end of string in font family");
return}c=c.slice(1,a)}else a=c.indexOf(" ",1),0<=a&&(c=c.slice(0,a));switch(c){case "":case "*":return;case "Times-Roman":case "Times":c="serif";break;case "Helvetica":c="sans-serif";break;case "Courier":c="monospace";break;case "music":c=t.musicfont.name;break;default:0<c.indexOf("Fig")&&(e.figb=!0)}"("==c[3]&&(e.src=c,e.fid=Hb.length,Hb.push(e),c="ft"+e.fid);e.name=c}function Ra(a){a=a.toLowerCase().match(/([\d.]+)(.*)/);if(!a)return NaN;a[1]=Number(a[1]);switch(a[2]){case "cm":return 37.8*a[1];
case "in":return 96*a[1];case "pt":return.75*a[1];case "px":case "":return a[1]}return NaN}function zd(a,c){a=a.slice(0,3);"ste"==a&&(a="stm");Kb("pos",'"'+a+" "+c+'"')}function Kb(a,c){a=[a+"=",c];n?ic(a):Ic("*",a)}function Ia(){da.chg&&(da.chg=!1,da.lm=t.leftmargin-t.printmargin,0>da.lm&&(da.lm=0),da.rm=t.rightmargin-t.printmargin,0>da.rm&&(da.rm=0),da.width=t.pagewidth-2*t.printmargin,100>da.width-da.lm-da.rm&&(v(0,void 0,"Bad staff width"),da.width=da.lm+da.rm+150),Tb=da.lm/t.scale)}function Ad(a){var c=
a.name,d="";a.weight&&(d+=a.weight+" ");a.style&&(d+=a.style+" ");0>c.indexOf('"')&&0<c.indexOf(" ")&&(c='"'+c+'"');return d+a.size.toFixed(1)+"px "+c}function Jc(a){return"font:"+Ad(a)}function cb(a){var c="f"+a.fid+t.fullsvg;a.class&&(c+=" "+a.class);a.box&&(c+=" box");return c}function ib(a){a.used||(a.used=!0,void 0==a.fid&&(a.fid=Hb.length,Hb.push(a),a.swfac||xd(a),a.pad||(a.pad=0)),Bd(".f"+a.fid+(t.fullsvg||"")+"{"+Jc(a)+"}"),a.src&&Bd("@font-face{\n font-family:"+a.name+";\n src:"+a.src+"}"))}
function Ca(a){a+="font";var c=t[a];if(!c)return B(1,"Unknown font $1","$"+a[1]),G.curfont;if(!c.name||!c.size){a=Object.create(G.curfont);c.name&&(a.name=c.name);c.normal?(a.weight&&(a.weight=null),a.style&&(a.style=null)):(c.weight&&(a.weight=c.weight),c.style&&(a.style=c.style));c.size&&(a.size=c.size);var d=Ad(a);c.class&&(a.class=c.class,d+=" "+c.class);c=Cd[d];if(void 0!=c)return Hb[c];Cd[d]=Hb.length;a.fid=a.used=void 0;c=a}ib(c);return c}function Dd(a,c){var d,e,f="";for(d=0;;){var g=a.indexOf("\\",
d);if(0>g)break;f+=a.slice(d,g);d=a[++g];if(!d)return f+"\\";switch(d){case "0":case "2":if("0"!=a[g+1])break;if(e=df[a[g+2]]){f+=e;d=g+3;continue}break;case "u":d=Number("0x"+a.slice(g+1,g+5));if(isNaN(d)||32>d){f+=a[++g]+"\u0306";d=g+1;continue}d=String.fromCharCode(d);if("\\"==d){g+=4;break}f+=d;d=g+5;continue;case "t":f+=" ";d=g+1;continue;case "n":f+="\n";d=g+1;continue;default:if(e=ef[a.slice(g,g+2)]){f+=e;d=g+2;continue}if((e=a[g+1])&&/[A-Za-z]/.test(e))switch(d){case "`":f+=e+"\u0300";d=g+
2;continue;case "'":f+=e+"\u0301";d=g+2;continue;case "^":f+=e+"\u0302";d=g+2;continue;case "~":f+=e+"\u0303";d=g+2;continue;case "=":f+=e+"\u0304";d=g+2;continue;case "_":f+=e+"\u0305";d=g+2;continue;case ".":f+=e+"\u0307";d=g+2;continue;case '"':f+=e+"\u0308";d=g+2;continue;case "o":f+=e+"\u030a";d=g+2;continue;case "H":f+=e+"\u030b";d=g+2;continue;case "v":f+=e+"\u030c";d=g+2;continue;case "c":f+=e+"\u0327";d=g+2;continue;case ";":f+=e+"\u0328";d=g+2;continue}}"w"==c&&(f+="\\");f+=d;d=g+1}return f+
a.slice(d)}function ff(a){var c;if(u.read_file)if(2<db)B(1,"Too many include levels");else if(c=u.read_file(a)){db++;var d=x(p);Kc(a,c);d.state=p.state;p=d;db--}else B(1,"Cannot read file '$1'",a);else B(1,"No read_file support")}function Kc(a,c,d,e){function f(){var a=c.indexOf("K:",d);if(0>a)return!1;a=c.indexOf("\n",a);if(p.select.test(c.slice(p.bol,a)))return!0;var f=/\n\w*\n/;f.lastIndex=a;V=f.exec(c)?f.lastIndex:e;return!1}function g(a,c){if(!a)return a;var d=a.indexOf("%");if(0==d)return"";
0<d&&(a=a.replace(/([^\\])%.*/,"$1").replace(/\\%/g,"%"));a=a.replace(/\s+$/,"");return c&&0<=a.indexOf("\\")?Dd(a,c):a}function h(){var a;p.tp&&(B(1,"No end of tuplet"),(a=p.tps)&&delete a.tp,delete p.tp);ca&&(B(1,"No end of voice overlay"),Ob(ca.bar?"|":")"));3>p.state&&Da();Ed();var c,d,e=D.length,f=[],g=[];var h=L;for(c=0;c<e;c++)f.push(D[c].sym);var k=e;var l=-1;for(c=0;c<e;c++)h.voices[c]&&(a=h.voices[c].range,a<k&&(k=a),g[a]=c,l++);c=g[k];if(N=k=f[c])for(f[c]=N.next,k.seqst=!0,d=!La[k.type]||
N.type==N.next;;){if(r){h=r;var r=null;l=-1;g=[];for(c=0;c<e;c++)h.voices[c]&&(a=h.voices[c].range,g[a]=c,l++)}var n=h=1E7;for(a=0;a<e;a++){c=g[a];if(void 0==c)break;!(l=f[c])||l.time>h||(c=La[l.type],l.time<h?(h=l.time,n=c):c<n&&(n=c))}if(127<n)break;for(a=0;a<e;a++){c=g[a];if(void 0==c)break;(l=f[c])&&l.time==h&&La[l.type]==n&&(l.type==m.STAVES&&(r=l.sy),d&&(d=0,l.seqst=!0),l.ts_prev=k,k=k.ts_next=l,f[c]=l.next)}d=n}if(N){W.set_bar_num();for(a=D.length;0<=--a;)if(e=D[a],void 0!=e.vtransp)for(e.key.k_transp?
(r=e.key,Fd(r),r.k_old_sf=r.k_sf):r=null,f=e.sym;f;){if(!r)for(;f&&(f.type!=m.KEY||!f.k_transp);f=f.next);for(;f;f=f.next){switch(f.type){case m.GRACE:for(g=f.extra;g;g=g.next)for(e=0;e<=g.nhd;e++)Gd(g,r,g.notes[e]);continue;case m.NOTE:for(e=0;e<=f.nhd;e++)Gd(f,r,f.notes[e]);continue;case m.KEY:r&&(f.k_sf=r.k_sf);Fd(f);if(!f.k_transp)break;r=f;default:continue}break}r=null}Q.P&&(N.parts=Q.P);u.get_abcmodel&&u.get_abcmodel(N,D,abc2svg.sym_name,Q);u.img_out&&W.output_music();N&&Lc.push([N,D,Q,t])}Ia();
Q.W&&gf(Q.W);a=t.infoname.split("\n");e=a.length;for(r=0;r<e;r++)if(f=a[r][0],!(0>t.writefields.indexOf(f))&&(f=Q[f])){if(!q){var q=!0;T("history");ma(t.textspace);var A=G.curfont.size*t.lineskipfac}c=a[r].slice(2);'"'==c[0]&&(c=c.slice(1,-1));ma(A);g=ya(c);R(0,0,c,null,null,g);c=g[0];f=f.split("\n");R(c,0,f[0]);for(g=1;g<f.length;g++)ma(A),R(c,0,f[g]);ma(.3*A);ib(G.curfont)}p.state=0;qb();t=Ea.cfmt;Q=Ea.info;Aa=Ea.char_tb;na=Ea.glovar;Sa=Ea.maps;rb=Ea.mac;jc=Ea.maci;p.tune_v_opts=null;p.scores=null;
p.ufmt=!1;Hd();da.chg=!0;Ia()}function l(a,d){if("end"!=a){d?(p.tune_v_opts||(p.tune_v_opts={}),d=p.tune_v_opts):(p.voice_opts||(p.voice_opts={}),d=p.voice_opts);for(d[a]=[];;){var e=++V;if("%"!=c[e])break;V=c.indexOf("\n",V);if(c[e+1]==q){e+=2;v=0>V?c.slice(e):c.slice(e,V);r=v.match(/\S+/);switch(r[0]){default:d[a].push(g(v,!0));continue;case "score":case "staves":case "tune":case "voice":e-=2}break}}V=p.eol=e-1}}function k(){var a,e=c.indexOf("K:",d);e=c.indexOf("\n",e);var f=c.slice(p.bol,e);for(e in p.tune_opts)if(p.tune_opts.hasOwnProperty(e)&&
(new RegExp(e)).test(f)){var g=p.tune_opts[e];for(a=0;a<g.t_opts.length;a++){var h=g.t_opts[a];switch(h.match(/\S+/)[0]){case "score":case "staves":p.scores||(p.scores=[]);p.scores.push(h);break;default:W.do_pscom(h)}}if(g=g.v_opts)for(a in g)g.hasOwnProperty(a)&&(p.tune_v_opts||(p.tune_v_opts={}),p.tune_v_opts[a]=p.tune_v_opts[a]?p.tune_v_opts[a].concat(g[a]):g[a])}}var r,n="\n";abc2svg.modules&&(abc2svg.modules.hooks.length||abc2svg.modules.g_hooks.length)&&hf();p.file=c;p.fname=a;void 0==d&&(d=
0);e||(e=c.length);for("%abc-"==c.slice(d,d+5)&&(t["abc-version"]=/[1-9.]+/.exec(c.slice(d+5,d+10)));d<e;d=p.eol+1){var V=c.indexOf("\n",d);if(0>V||V>e)V=e;for(p.eol=V;;){V--;switch(c[V]){case " ":case "\t":continue}break}V++;if(V==d)1==p.state?(p.istart=d,B(1,"Empty line in tune header - ignored")):2<=p.state&&(h(),p.select&&(V=c.indexOf("\nX:",p.eol),0>V&&(V=e),p.eol=V));else{p.istart=p.bol=d;p.iend=V;p.line.index=0;var z=c[d];var q=c[d+1];if("%"==z){if(0>p.prefix.indexOf(q))continue;if("a"==c[d+
2]&&"b"==c[d+3]&&"c"==c[d+4]&&" "==c[d+5])d+=6,z=c[d],q=c[d+1];else var y=!0}else"I"==z&&":"==q&&(y=!0);if(y){y=!1;d+=2;var v=c.slice(d,V);if((r=v.match(/([^\s]+)\s*(.*)/))&&"%"!=r[1][0]){switch(r[1]){case "abcm2ps":case "ss-pref":p.prefix=r[2];continue;case "abc-include":ff(g(r[2]));continue}if("begin"==r[1].slice(0,5)){a=r[1].substr(5);var C="\n"+z+q+"end"+a;z=c.indexOf(C,V);0>z?(B(1,"No $1 after %%$2",C.slice(1),r[1]),p.eol=e):(W.do_begin_end(a,g(r[2]),c.slice(V+1,z).replace(/^%?%/gm,"")),p.eol=
c.indexOf("\n",z+6),0>p.eol&&(p.eol=e))}else{switch(r[1]){case "select":if(0!=p.state){B(1,K.not_in_tune,"%%select");continue}a=g(v.slice(7));'"'==a[0]&&(a=a.slice(1,-1));if(!a){delete p.select;continue}a=a.replace(/\(/g,"\\(");a=a.replace(/\)/g,"\\)");p.select=new RegExp(a,"m");continue;case "tune":if(0!=p.state){B(1,K.not_in_tune,"%%tune");continue}a=g(r[2]);if(!a){p.tune_opts={};continue}if("end"==a)continue;p.tune_opts||(p.tune_opts={});for(p.tune_opts[a]=a={t_opts:[]};;){d=++V;if("%"!=c[d])break;
V=c.indexOf("\n",V);if(c[d+1]==q){d+=2;v=0>V?c.slice(d):c.slice(d,V);r=v.match(/([^\s]+)\s*(.*)/);switch(r[1]){case "tune":break;case "voice":l(g(r[2],!0),!0);continue;default:a.t_opts.push(g(v,!0));continue}break}}p.tune_v_opts&&(a.v_opts=p.tune_v_opts,p.tune_v_opts=null);p.eol=d-1;continue;case "voice":if(0!=p.state){B(1,K.not_in_tune,"%%voice");continue}a=g(r[2]);if(!a){p.voice_opts=null;continue}l(a);continue}W.do_pscom(g(v,!0))}}}else if(":"==q&&/[A-Za-z+]/.test(z)){for(d+=2;;){switch(c[d]){case " ":case "\t":d++;
continue}break}if("+"==z){if(!E){B(1,"+: without previous info field");continue}n=" ";z=E}v=g(c.slice(d,V),z);switch(z){case "X":if(0!=p.state){B(1,K.ignored,z);continue}if(p.select&&!f()){V=c.indexOf("\nX:",p.eol);0>V&&(V=e);p.eol=V;continue}Ea.cfmt=x(t);Ea.info=x(Q,2);Ea.char_tb=x(Aa);Ea.glovar=x(na);Ea.maps=x(Sa,1);Ea.mac=x(rb);Ea.maci=x(jc);Q.X=v;p.state=1;u.page_format&&1>Fa&&(Fa=1);p.tune_opts&&k();continue;case "T":switch(p.state){case 0:continue;case 1:case 2:Q.T=void 0==Q.T?v:Q.T+("\n"+v);
continue}a=Ta("title");a.text=v;continue;case "K":switch(p.state){case 0:continue;case 1:Q.K=v}Mc(z,v);continue;case "W":if(0==p.state||0>t.writefields.indexOf(z))break;Q.W=void 0==Q.W?v:Q.W+(n+v);break;case "m":if(2<=p.state){B(1,K.ignored,z);continue}r=v.match(/(.*?)[= ]+(.*)/);if(!r||!r[2]){B(1,K.bad_val,"m:");continue}rb[r[1]]=r[2];jc[r[1][0]]=!0;break;case "s":if(3!=p.state||0>t.writefields.indexOf(z))break;jf(v," "==n);break;case "w":if(3!=p.state||0>t.writefields.indexOf(z))break;kf(v," "==
n);break;case "|":if(2>p.state)continue;p.line.buffer=v;Id();continue;default:if(0<="ABCDFGHNOSZ".indexOf(z)){if(2<=p.state){B(1,K.ignored,z);continue}Q[z]=Q[z]?Q[z]+(n+v):v}else{Mc(z,v);continue}}n="\n";var E=z}else E=void 0,2>p.state||(p.line.buffer=g(c.slice(d,V)),p.line.buffer&&Id())}}db||(2<=p.state&&h(),p.state=0)}function fc(a,c){var d,e=0,f=c;0!=f%12&&v(1,a,"Invalid note duration $1",f);(f/=12)||v(1,a,"Note too short");for(d=5;0!=f&&!(f&1);f>>=1,d--);f>>=1;for(f+1&f&&(a.type!=m.REST||c!=a.p_v.wmeasure)&&
v(0,a,"Non standard note duration $1",c);0<f>>e;)e++;d-=e;if(0<=d)a=m.FULL;else switch(d){default:v(1,a,"Note too long"),d=-4;case -4:a=m.SQUARE;break;case -3:a=a.fmt.squarebreve?m.SQUARE:m.OVALBARS;break;case -2:a=m.OVAL;break;case -1:a=m.EMPTY}return[a,e,d]}function Jd(a){var c,d=a.stem;if(c=a.nhd){var e=.74*Kd[a.head];a.grace&&(e*=.6);if(0<=d){var f=1;var g=c+1;c=a.notes[0].pit}else e=-e,f=c-1,g=-1,c=a.notes[c].pit;for(var h=!1,l=0;f!=g;f+=d){var k=a.notes[f].pit-c;c=a.notes[f].pit;if(!k){if(h){k=
a.notes[f].shhd=a.notes[f-d].shhd+e;l<k&&(l=k);continue}if(f+d!=g&&c+d==a.notes[f+d].pit){a.notes[f].shhd=-e;l<-e&&(l=-e);continue}}0>k&&(k=-k);if(3<k||2<=k&&a.head!=m.SQUARE)h=!1;else if(h=!h)a.notes[f].shhd=e,l<e&&(l=e)}a.xmx=l}}function Ld(a,c){var d,e,f,g,h=a.length;for(d=h-1;0<=--d;)if((g=a[d].shhd)&&!(0<g)){g=c-g;var l=a[d].pit;for(e=h;0<=--e;)if(a[e].acc){var k=a[e].pit;if(k<l-3)break;!(k>l+3)&&a[e].shac<g&&(a[e].shac=g)}}for(e=h;0<=--e;)if(a[e].acc){k=a[e].pit;var m=a[e].shac;m||(m=a[e].shhd,
m=0>m?c-m:c);break}if(!(0>e)){for(f=0;f<e;f++)if(a[f].acc){l=a[f].pit;var n=a[f].shac;n||(n=a[f].shhd,n=0>n?c-n:c);break}if(e==f)a[e].shac=m;else for(k>l+4?(m>n&&(n=m),a[e].shac=a[f].shac=n):(a[e].shac=m,k!=l&&(m+=7),a[f].shac=n=m),n+=7,d=e;--d>f;)if(c=a[d].acc){g=a[d].shac;g<n&&(g=n);l=a[d].pit;for(e=h;--e>d;)a[e].acc&&(k=a[e].pit,!(k>=l+4&&(k>l+4||0>c||0>a[e].acc))&&g>a[e].shac-6&&(m=a[e].shac+7,m>g&&(g=m)));a[d].shac=g}}}function kc(a,c){a.next=c;a.prev=c.prev;a.prev?a.prev.next=a:a.p_v.sym=a;
c.prev=a}function Pb(a,c){(a.ts_next=c)?(a.ts_prev=c.ts_prev,a.ts_prev&&(a.ts_prev.ts_next=a),c.ts_prev=a):(v(2,a,"Bad linkage"),a.ts_prev=null);a.seqst=!a.ts_prev||a.time!=a.ts_prev.time||La[a.ts_prev.type]!=La[a.type]&&0!=La[a.ts_prev.type]||a.ts_prev.v>=a.v;c&&(c.seqst=c.time!=a.time||La[a.type]!=La[c.type]&&0!=La[a.type],c.seqst&&(W.set_width(c),c.a_ly&&lc(c),c.shrink=c.wl,c.prev&&(c.shrink+=c.prev.wr),c.space=0))}function nb(a){a.next&&(a.next.prev=a.prev);a.prev?a.prev.next=a.next:a.p_v.sym=
a.next;a.ts_next&&(a.seqst?a.ts_next.seqst?(a.ts_next.shrink+=a.shrink,a.ts_next.space+=a.space):(a.ts_next.seqst=!0,a.ts_next.shrink=a.shrink,a.ts_next.space=a.space):a.ts_next.seqst&&a.ts_prev&&a.ts_prev.seqst&&!La[a.ts_prev.type]&&(a.ts_next.seqst=!1,a.shrink=a.ts_next.shrink,a.space=a.ts_next.space),a.ts_next.ts_prev=a.ts_prev);a.ts_prev&&(a.ts_prev.ts_next=a.ts_next);N==a&&(N=a.ts_next);Oa==a&&(Oa=a.ts_next)}function Md(a,c,d){var e=a.p_v,f=a.st;a.type==m.BAR&&a.prev&&a.prev.type==m.BAR&&":"!=
a.prev.bar_type[0]&&(a=a.prev);e.last_sym=a.prev;e.last_sym||(e.sym=null);e.time=a.time;e=Nd(e,m.CLEF);e.next=a;a.prev=e;e.clef_type=c;e.clef_line=d;e.st=f;e.clef_small=!0;delete e.second;e.notes=[];e.notes[0]={pit:a.notes[0].pit};for(e.nhd=0;!a.seqst;)a=a.ts_prev;a.type==m.STAVES?(e.ts_next=a.ts_next,e.ts_next.ts_prev=a.ts_next=e,e.ts_prev=a):(Pb(e,a),a.soln&&(e.soln=!0,delete a.soln));return e}function Od(a,c,d){var e,f=0;for(e=0;e<a.a_gch.length;e++){var g=a.a_gch[e];switch(g.type){case "<":g=
g.text.wh[0]+c;g>d&&(d=g);break;case ">":g=g.text.wh[0]+a.wr,g>f&&(f=g)}}a.wr<f&&(a.wr=f);return d}function Pd(a,c){Nc>=m.BLEN/2?c=Nc>=m.BLEN?c/4:c/2:!a.next&&c>=m.BLEN&&(c/=2);a=c>=m.BLEN/4?c<m.BLEN/2?5:c<m.BLEN?6:c<2*m.BLEN?7:c<4*m.BLEN?8:9:c>=m.BLEN/8?4:c>=m.BLEN/16?3:c>=m.BLEN/32?2:c>=m.BLEN/64?1:0;var d=c-(m.BLEN/16/8<<a);var e=sb[a];d&&(0>d?e=sb[0]*c/(m.BLEN/16/8):(9<=a&&(a=8),e+=(sb[a+1]-sb[a])*d/(m.BLEN/16/8<<a)));return e}function Oc(a,c){var d;var e=a.time-c;if(!e){switch(a.type){case m.MREST:return a.wl}return 0}if(a.ts_prev.type==
m.MREST)return 71;for(d=Pd(a,e);!a.dur;){switch(a.type){case m.BAR:return.9*d-7;case m.CLEF:return d-a.wl-a.wr;case m.BLOCK:case m.PART:case m.REMARK:case m.STAVES:case m.TEMPO:a=a.ts_next;if(!a)return d;continue}break}if(a.dur&&e<=m.BLEN/4)for(e=a;e;){if(!e.beam_st){d*=.9;break}e=e.ts_next;if(!e||e.seqst)break}if(a.type==m.NOTE&&-1<=a.nflags&&0<a.stem){var f=!0;for(e=a.ts_prev;e&&e.time==c;e=e.ts_prev)if(e.type==m.NOTE&&(-1>e.nflags||0<e.stem)){f=!1;break}if(f){for(e=a.ts_next;e&&e.time==a.time;e=
e.ts_next)if(e.type==m.NOTE&&(-1>e.nflags||0>e.stem)){f=!1;break}f&&(d*=.9)}}return d}function Qd(a){return{type:m.BAR,bar_type:"|",fname:a.fname,istart:a.istart,iend:a.iend,v:a.v,p_v:a.p_v,st:a.st,dur:0,nhd:0,notes:[{pit:a.notes?a.notes[0].pit:22}],prev:a,fmt:a.fmt}}function mc(a){var c=x(a);c.prev.next=a.ts_prev=a.prev=c.ts_prev.ts_next=c;c.next=c.ts_next=a;a.seqst=!1;a.invis=a.play=!0;c.type=m.REST;delete c.in_tuplet;delete c.sl1;delete c.a_dd;delete c.a_gch;delete c.sls;return c}function lf(a){var c,
d,e,f=a.repeat_n,g=a.repeat_k,h=a.st,l=a.v;a.repeat_n=0;if(0>f){var k=f=-f;for(d=a.prev;d;d=d.prev)if(!d.dur){if(d.type==m.BAR){v(1,d,"Bar in repeat sequence");return}}else if(0>=--k)break;if(d){var r=a.time-d.time;k=g*f;for(c=a;c;c=c.next)if(!c.dur){if(c.type==m.BAR){v(1,c,"Bar in repeat sequence");return}}else if(0>=--k)break;if(c&&c.next){for(c=a.prev;c!=d;c=c.prev)if(c.type==m.NOTE){c.beam_end=!0;break}for(e=g;0<=--e;){k=f;a.dur&&k--;for(c=a.ts_next;0<k;)c.st==h&&(c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&
(c.seqst=!1),c.v==l&&c.dur&&k--),c=c.ts_next;a=mc(a);a.dur=a.notes[0].dur=r;a.rep_nb=-1;a.beam_st=!0;W.set_width(a);a.head=m.SQUARE;for(a=c;a&&(a.st!=h||a.v!=l||!a.dur);a=a.ts_next);}}else v(1,a,K.not_enough_n)}else v(1,a,K.not_enough_n)}else{k=f;for(c=a.prev.prev;c&&(c.type!=m.BAR&&c.time!=N.time||!(0>=--k));c=c.prev);if(c){r=a.time-c.time;k=1==f?g:f;for(c=a;c&&!(c.type==m.BAR&&0>=--k);c=c.next);if(c){k=g;if(2==f&&1<k){c=c.next;if(!c){v(1,a,K.not_enough_m);return}c.repeat_n=f;c.repeat_k=--k}r/=f;
if(2==f){for(c=a.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=mc(a);d.dur=d.notes[0].dur=r;d.invis=!0;c.bar_mrep=2;d=c.next;for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==l)break}else c.invis=c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=mc(d);d.dur=d.notes[0].dur=r;d.invis=!0;W.set_width(d)}else for(d=a,e=g;0<=--e;){for(c=d.ts_next;;c=c.ts_next)if(c.st==h)if(c.type==m.BAR){if(c.v==l)break}else c.invis=
c.play=!0,c.seqst&&c.ts_next.seqst&&(c.seqst=!1);d=mc(d);d.dur=d.notes[0].dur=r;d.beam_st=!0;if(1==g){d.rep_nb=1;break}d.rep_nb=g-e+1;d=c.next}}else v(1,a,K.not_enough_m)}else v(1,a,K.not_enough_m)}}function nc(a){function c(a){if(t.custos&&1==D.length)a:{for(var c=a,d,e,f=c;f.type!=m.NOTE;)if(f=f.next,!f)break a;d=c.p_v;d.last_sym=c.prev;d.time=c.time;d=Nd(d,m.CUSTOS);d.next=c;c.prev=d;d.wl=0;d.wr=4;Pb(d,c);d.shrink=c.shrink;12>d.shrink&&(d.shrink=12);d.space=f.space;d.nhd=f.nhd;d.notes=[];for(e=
0;e<c.notes.length;e++)d.notes[e]={pit:f.notes[e].pit,shhd:0,dur:m.BLEN/4};d.stemless=!0}a.nl=!0;a=a.ts_prev;a.type!=m.BAR&&(c=Qd(a),c.seqst=!0,c.invis=!0,c.time=a.time+a.dur/2,c.wl=0,c.wr=0,c.ts_prev=a,c.next=a.next,c.ts_next=a.ts_next,c.shrink=a.wr+3,a.next&&(a.next.prev=c),a.ts_next.ts_prev=c,a.next=a.ts_next=c,c.space=Oc(c,a.time))}var d;a=function(a){var c,d;for(c=a;c.ts_prev&&c.ts_prev.time==a.time;)c=c.ts_prev,c.bar_type&&(d=c);if(!d)return a;for(c=a;;c=c.ts_next){switch(c.type){default:if(La[c.type])break;
case m.KEY:case m.METER:case m.CLEF:continue}break}for(;d!=a;){if(d.bar_type&&(":"==d.bar_type.slice(-1)||d.text)&&":"!=d.bar_type){var e=d.bar_type.match(/(:*)([^:]*)(:*)/);if(e[3])if(e[1]){var f=e[2].length/2|0;var r=e[1]+"|"+e[2].slice(0,f);e=e[2].slice(f)+"|"+e[3]}else r="||",e="[|"+e[3];else r=e[1]+e[2],e="[";f=x(d);d.bar_type=r;delete d.rbstop;f.bar_type=e;for(kc(f,d.next);!(c.type!=m.BAR||c.v>f.v);)c=c.ts_next;Pb(f,c);c==a&&(a=f);d.text&&(f.invis=!0,delete d.text,delete d.rbstart);delete f.a_dd}d=
d.ts_next}return a}(a);(function(a){var c,d;for(d=a;d;d=d.ts_next){switch(d.type){case m.KEY:if(!a.fmt.keywarn||d.invis)continue;for(c=a.ts_prev;c&&c.type==m.METER;c=c.ts_prev);case m.METER:if(d.type==m.METER){if(!a.fmt.timewarn)continue;c=a.ts_prev}case m.CLEF:if(!d.prev)continue;if(d.type==m.CLEF)for(c=a.ts_prev;c;c=c.ts_prev){switch(c.type){case m.BAR:case m.KEY:case m.METER:continue}break}var e=x(d);Pb(e,c.ts_next);e.ts_next==a&&(a.seqst=!0);for(c=e;c=c.ts_next,c.v!=d.v;);kc(e,c);e.seqst&&(e.shrink=
e.wl,e.prev&&(e.shrink+=e.prev.wr),e.space=Oc(e,e.ts_prev.time),e.next.shrink=e.wr+e.next.wl);continue}if(La[d.type])break}})(a);switch(a.ts_prev.type){case m.STAVES:break;case m.GRACE:if(a=a.next,!a)return a;default:return c(a),a}for(a=a.ts_prev;a&&(!a.seqst||a.type==m.CLEF);a=a.ts_prev);var e=0;for(d=a.type;;a=a.ts_next){if(!a)return a;if(a.type!=d){d=a.type;if(0>e)break;switch(a.type){case m.STAVES:if(!a.ts_prev)return;if(a.ts_prev.type==m.BAR)break;for(;a.ts_next&&(0==La[a.ts_next.type]||a.ts_next.type==
m.CLEF);)a=a.ts_next;if(!a.ts_next||a.ts_next.type!=m.BAR)continue;a=a.ts_next;case m.BAR:if(e)break;e=1;continue;case m.STBRK:a.stbrk_forced?e=-1:nb(a);continue;case m.CLEF:if(e)break;continue;default:if(!e||a.prev&&a.prev.type==m.GRACE)continue}break}}c(a);return a}function Rd(){var a=D[0];W.set_width(a.clef);W.set_width(a.ckey);W.set_width(a.meter);return[a.clef.wl+a.clef.wr+a.ckey.wl+a.ckey.wr,a.meter.wl+a.meter.wr]}function Sd(a,c){for(var d,e,f=0,g=0,h=1-a.fmt.maxshrink;a!=c;)a.seqst&&(d=a.shrink,
g+=d,f=(e=a.space)<d?f+d:f+(d*a.fmt.maxshrink+e*h),a.x=f),a=a.ts_next;c&&(g+=c.wr);return[f,g]}function mf(a,c,d,e){var f,g=c?c.ts_prev:null;var h=Sd(a,c);a.fmt.keywarn&&c&&c.type==m.KEY&&!g.dur&&(h[0]+=c.wr,h[1]+=c.wr);if(h[1]+e<d)return c&&(c=nc(c)),c||g;for(f=h[0]+e;;){var l=Math.ceil(f/d);if(1>=l)return c&&(c=nc(c)),c||g;var k=h=a;var r=a.x-a.shrink-e;var n=r+d;e=r+f/l;r+=f/l*a.fmt.breaklimit;for(a=a.ts_next;a!=c&&!(a.x&&(a.type==m.BAR&&(k=a),a.x>=r));a=a.ts_next);if(a==c)return c&&(c=nc(c)),
c;for(l=null;a!=c;a=a.ts_next)if(r=a.x){if(r>n)break;if(a.type==m.BAR)if(r<e)l=a;else{if(!l||r-e<e-l.x)l=a;break}}if(!l){var p=0,z=k.time;n-=8;for(a=k;a!=c;a=a.ts_next)if(a.beam_st&&p++,a.beam_end&&0<p&&p--,r=a.x){if(r+a.wr>=n)break;if(!p&&!a.in_tuplet)if(0==(a.time-z)%(m.BLEN/4))l=a;else if(!l||a.x<e)l=a;else{if(l>e)break;if(e-l.x<a.x-e)break;l=a;break}}}if(!l)for(l=a=k;a!=c;a=a.ts_next)if(r=a.x)if(a.x<e)l=a;else{if(l>e)break;if(e-l.x<a.x-e)break;l=a;break}for(a=l;a.ts_next&&(a=a.ts_next,!a.seqst););
if(a.nl)for(v(0,a,"Line split problem - adjust maxshrink and/or breaklimit"),l=2,a=a.ts_next;a!=c&&!(a.x&&0>=--l);a=a.ts_next);a=nc(a);if(!a||c&&a.time>=c.time)break;f-=a.x-h.x;e=0}return a}function Pc(a){switch(a.type){case m.CLEF:if(a.second||a.invis){a.ymx=a.ymn=12;break}a.y=6*(a.clef_line-1);switch(a.clef_type){default:a.ymx=a.y+28;a.ymn=a.y-14;break;case "c":a.ymx=a.y+13;a.ymn=a.y-11;break;case "b":a.ymx=a.y+7,a.ymn=a.y-12}a.clef_small&&(a.ymx-=2,a.ymn+=2);26>a.ymx&&(a.ymx=26);-1<a.ymn&&(a.ymn=
-1);a.clef_octave&&(0<a.clef_octave?a.ymx+=12:a.ymn-=12);break;case m.KEY:a.ymx=2<a.k_sf?34:0<a.k_sf?30:26;a.ymn=-2;break;default:a.ymx=24,a.ymn=0}}function nf(){function a(a,c,d){var e=["15mb(","8vb(",null,"8va(","15ma("],f=["15mb)","8vb)",null,"8va)","15ma)"];la.push((d?e:f)[2+c]);Eb(a)}var c,d,e,f,g=P+1,h=new Int16Array(Array(2*g)),l=new Int8Array(Array(g));for(d=0;d<=P;d++)h[d]=0,l[d]=0;for(c=N;c;c=c.ts_next){d=c.st;if(void 0!=c.ottava)for(;c.ottava.length;)(e=c.ottava.shift())?0==l[d]++&&(a(c,
e,!0),h[d]=7*-e):0==--l[d]&&(a(c,-h[d]/7),h[d]=0);switch(c.type){case m.REST:if(1==D.length)break;case m.NOTE:if((e=h[d])&&!c.p_v.ckey.k_drum)for(g=c.nhd;0<=g;g--){var k=c.notes[g];k.opit||(k.opit=k.pit);k.pit+=e}break;case m.GRACE:for(f=c.extra;f;f=f.next)if((e=h[d])&&!c.p_v.ckey.k_drum)for(g=0;g<=f.nhd;g++)k=f.notes[g],k.opit||(k.opit=k.pit),k.pit+=e}}}function Qc(a,c,d){var e;var f=12;var g=20;for(e=c;e&&(e.type!=m.STAVES||e==c);e=e.ts_next)if(e.st==a)if(e.type!=m.NOTE){if(e.type==m.CLEF){if("a"!=
e.clef_type)break;nb(e)}}else e.notes[0].pit<g&&(g=e.notes[0].pit),e.notes[e.nhd].pit>f&&(f=e.notes[e.nhd].pit);if(19<=g||13<=g&&"b"!=d)return"t";if(13>=f||19>=f&&"t"!=d)return"b";"a"==d&&(d=16<=(f+g)/2?"t":"b");g=d;var h=e,l=null;for(e=c;e!=h&&(e.type!=m.STAVES||e==c);e=e.ts_next)if(e.st==a&&e.type==m.NOTE){var k=e.time;if("t"==g){if(12<e.notes[0].pit||20<e.notes[e.nhd].pit){20<e.notes[0].pit&&(l=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==m.NOTE&&19<=f.notes[0].pit)continue;if((f=
e.ts_next)&&f.st==a&&f.time==k&&f.type==m.NOTE&&19<=f.notes[0].pit)continue}else{if(12>e.notes[0].pit||20>e.notes[e.nhd].pit){12>e.notes[e.nhd].pit&&(l=e);continue}if((f=e.ts_prev)&&f.time==k&&f.st==a&&f.type==m.NOTE&&13>=f.notes[0].pit)continue;if((f=e.ts_next)&&f.st==a&&f.time==k&&f.type==m.NOTE&&13>=f.notes[0].pit)continue}if(l){k=e;for(f=e.ts_prev;f!=l;f=f.ts_prev)if(f.st==a){if(f.type==m.BAR&&f.v==e.v){k=":"!=f.bar_type[0]?f:f.next;break}f.type==m.NOTE&&f.beam_st&&!f.p_v.second&&(k=f)}k.time==
l.time?l=e:(l=e,g="t"==g?"b":"t",f=Md(k,g,"t"==g?2:4),f.clef_auto=!0)}else g=d="t"==g?"b":"t",l=e}return d}function oc(a,c,d){a.p_v=c;a.v=c.v;a.st=c.st;a.time=d.time;c.last_sym&&(a.next=c.last_sym.next,a.next&&(a.next.prev=a),c.last_sym.next=a,a.prev=c.last_sym);c.last_sym=a;Pb(a,d)}function of(){var a,c,d;var e=D.length;for(c=0;c<e;c++)if(L.voices[c]){var f=D[c];f.second=L.voices[c].second;f.last_sym=f.sym;for(a=L.voices[c].st;a<P&&!L.st_print[a];)a++;f.st=a;f.second||(C[a].key=f.ckey,C[a].meter=
f.meter)}var g=N;for(d=g.fmt;g;){switch(g.type){case m.CLEF:case m.KEY:case m.METER:switch(g.type){case m.CLEF:C[g.st].clef=g;break;case m.KEY:g.p_v.ckey=g;break;case m.METER:g.p_v.meter=g,pc=0<=t.writefields.indexOf("M")}nb(g);case m.PART:case m.TEMPO:case m.BLOCK:case m.REMARK:g=g.ts_next;continue}break}var h=N;for(c=0;c<e;c++)f=D[c],!L.voices[c]||L.voices[c].second&&!f.bar_start||(a=L.voices[c].st,C[a]&&C[a].clef&&(g=x(C[a].clef),g.v=c,g.p_v=f,g.st=a,g.time=N.time,g.prev=null,g.next=f.sym,g.next&&
(g.next.prev=g),f.sym=f.last_sym=g,g.ts_next=h,g.ts_prev=h?h.ts_prev:null,g.ts_prev?(g.ts_prev.ts_next=g,delete g.seqst):N=g,h&&(h.ts_prev=g,h.type==m.CLEF&&delete h.seqst),delete g.clef_small,g.second=L.voices[c].second,L.st_print[a]||(g.invis=!0),g.fmt=d));for(c=0;c<e;c++)L.voices[c]&&!L.voices[c].second&&L.st_print[L.voices[c].st]&&(f=D[c],a=f.ckey,a.k_sf||a.k_a_acc)&&(g=x(a),oc(g,f,h),delete g.invis,g.k_old_sf=a.k_sf,g.fmt=d);if(pc){for(c=0;c<e;c++)f=D[c],a=f.meter,L.voices[c]&&!L.voices[c].second&&
L.st_print[L.voices[c].st]&&a.a_meter.length&&(g=x(a),oc(g,f,h),g.fmt=d);pc=!1}for(c=0;c<e;c++)f=D[c],f.sls.length&&(g={type:m.BAR,fname:h.fname,bar_type:"|",dur:0,multi:0,invis:!0,sls:f.sls,fmt:d},oc(g,f,h),f.sls=[]);for(c=0;c<e;c++){f=D[c];a=f.bar_start;f.bar_start=null;for(g=h;g&&g.time==h.time;g=g.ts_next)if(g.rbstop){a=null;break}a&&L.voices[c]&&L.st_print[L.voices[c].st]&&(f.last_sym.type==m.BAR?f.last_sym.rbstop||(f.last_sym.rbstart=1):(oc(a,f,h),a.fmt=d))}W.set_pitch(h);g=N;g.seqst=!0;for(e=
0;;){a=g;d=c=0;do W.set_width(g),f=g.wl+e,f>c&&(c=f),g.wr>d&&(d=g.wr),g=g.ts_next;while(g!=h&&!g.seqst);a.shrink=c;a.space=0;if(g==h)break;e=d}f=0;do W.set_width(g),g.a_ly&&lc(g),f<g.wl&&(f=g.wl),g=g.ts_next;while(g&&!g.seqst);h.shrink=d+f;h.space=0}function Rc(a){var c,d,e=D.length,f=0;for(c=0;c<e;c++){var g=D[c];if(L.voices[c]&&(d=(a||g.new_name)&&g.nm?g.nm:g.snm)){if(!h){T("voice");var h=G.curfont}for(g=0;;){var l=d.indexOf("\n",g);g=0>l?ya(d.slice(g)):ya(d.slice(g,l));g=g[0];g>f&&(f=g);if(0>l)break;
g=l+1}}}h&&(f+=4*Sb(" "));g=.5;for(c=0;c<=L.nstaff;c++){if(L.staves[c].flags&1280){g=12;break}L.staves[c].flags&5&&(g=6)}f+=g;a&&(f+=t.indent);return f}function pf(a,c){var d,e,f,g=a.fmt.shiftunison||0;if(3<=g||(e=a.dur)>=m.BLEN||(f=c.dur)>=m.BLEN||a.stemless&&c.stemless||a.dots!=c.dots&&(g&1||0!=a.dots*c.dots)||0<a.stem*c.stem)return!1;var h=d=0;if(a.notes[0].pit>c.notes[0].pit){if(0>a.stem)return!1;for(;c.notes[d].pit!=a.notes[0].pit;)if(++d>c.nhd)return!1}else if(a.notes[0].pit<c.notes[0].pit){if(0>
c.stem)return!1;for(;c.notes[0].pit!=a.notes[h].pit;)if(++h>a.nhd)return!1}if(c.notes[d].acc!=a.notes[h].acc)return!1;var l=h;var k=d;var r=a.notes[h].shhd;var n=c.notes[d].shhd;do{h++;d++;if(h>a.nhd)break;if(d>c.nhd)break;if(c.notes[d].acc!=a.notes[h].acc)return!1;r<a.notes[h].shhd&&(r=a.notes[h].shhd);n<c.notes[d].shhd&&(n=c.notes[d].shhd)}while(c.notes[d].pit==a.notes[h].pit);if(h<=a.nhd){if(d<=c.nhd||0<c.stem)return!1}else if(d<=c.nhd&&0<a.stem)return!1;var p=h;h=d;d=0;if(e!=f)if(e<f&&(e=f,f=
a.dur),e<m.BLEN/2)c.dots?d=2:a.dots&&(d=1);else if(f<m.BLEN/4){if(g&2)return!1;d=c.dur>=m.BLEN/2?2:1}else return!1;d||(d=a.p_v.scale<c.p_v.scale?2:1);if(1==d){for(d=k;d<h;d++)c.notes[d].invis=!0,delete c.notes[d].acc;for(d=0;d<=c.nhd;d++)c.notes[d].shhd+=r}else{for(h=l;h<p;h++)a.notes[h].invis=!0,delete a.notes[h].acc;for(h=0;h<=a.nhd;h++)a.notes[h].shhd+=n}return!0}function qf(a,c,d,e){var f;if(f=c.notes[e].acc){e=2*qc[a.head]+a.xmx+c.notes[e].shac+2;"object"==typeof f&&(e+=2);a.dots&&(e+=6);for(d=
0;d<=c.nhd;d++)c.notes[d].shhd+=e,c.notes[d].shac-=e;c.xmx+=e}else{e=2*qc[c.head]+c.xmx+a.notes[d].shac+2;f=a.notes[d].acc;"object"==typeof f&&(e+=2);c.dots&&(e+=6);for(d=0;d<=a.nhd;d++)a.notes[d].shhd+=e,a.notes[d].shac-=e;a.xmx+=e}}function Sc(a){var c,d=qc[a.head],e=d,f=[];for(c=0;96>c;c++)f.push(-100);if(-2<a.nflags){if(0<a.stem){e=-e;c=2*a.notes[0].pit;var g=2*(Math.ceil((a.ymx-2)/3)+18)}else c=2*(Math.ceil((a.ymn+2)/3)+18),g=2*a.notes[a.nhd].pit;0>c&&(c=0);for(96<=g&&(g=95);c<=g;)f[c++]=e}var h=
a.notes[0<a.stem?0:a.nhd].shhd;for(g=0;g<=a.nhd;g++)e=-a.notes[g].shhd+d+h,c=2*a.notes[g].pit,0>c?c=0:95<=c&&(c=94),e>f[c]&&(f[c]=e),a.head!=m.SQUARE&&--e,e>f[c-1]&&(f[c-1]=e),e>f[c+1]&&(f[c+1]=e);return f}function Tc(a){var c,d=qc[a.head],e=d,f=0<a.nflags&&a.beam_st&&a.beam_end,g=[];for(c=0;96>c;c++)g.push(-100);if(-2<a.nflags){if(0>a.stem){e=-e;c=2*(Math.ceil((a.ymn+2)/3)+18);var h=2*a.notes[a.nhd].pit;var l=c+4}else c=2*a.notes[0].pit,h=2*(Math.ceil((a.ymx-2)/3)+18);0>c&&(c=0);for(96<h&&(h=96);c<
h;)g[c++]=e}if(f)if(0<a.stem)for(c=0==a.xmx?2*a.notes[a.nhd].pit:2*a.notes[0].pit,c+=4,0>c&&(c=0);96>c&&c<=h-4;c++)g[c]=11;else for(c=l,0>c&&(c=0);96>c&&c<=2*a.notes[0].pit-4;c++)g[c]=3.5;l=a.notes[0<a.stem?0:a.nhd].shhd;for(h=0;h<=a.nhd;h++)e=a.notes[h].shhd+d-l,c=2*a.notes[h].pit,0>c?c=0:95<=c&&(c=94),e>g[c]&&(g[c]=e),a.head!=m.SQUARE&&--e,e>g[c-1]&&(g[c-1]=e),e>g[c+1]&&(g[c+1]=e);return g}function rf(){function a(){r=d;d=c;q=u;v=t;B=n;l=h}var c,d,e,f,g,h,l,k=L;for(c=N;c;c=c.ts_next)if(c.type!=
m.NOTE||c.invis)c.type==m.STAVES&&(k=c.sy);else{if(c.xstem&&0>c.ts_prev.stem)for(e=0;e<=c.nhd;e++)c.notes[e].shhd-=7,c.notes[e].shac+=16;for(d=c;;){d=d.ts_next;if(!d)break;if(d.time!=c.time){d=null;break}if(d.type==m.NOTE&&!d.invis&&d.st==c.st)break}if(d){var r=c;k.voices[r.v].range<k.voices[d.v].range?d.dot_low=!0:r.dot_low=!0;if(!(r.ymn>d.ymx||r.ymx<d.ymn||pf(r,d)))if(r.dots||d.dots||!(0<r.stem&&0>d.stem&&r.notes[0].pit==d.notes[d.nhd].pit+1||0>r.stem&&0<d.stem&&r.notes[r.nhd].pit+1==d.notes[0].pit)){var n=
Tc(r);var p=Sc(d);if((e=r.ts_prev)&&e.time==r.time&&e.st==r.st&&e.type==m.NOTE&&!e.invis){var z=Tc(e);for(f=0;96>f;f++)z[f]>n[f]&&(n[f]=z[f])}else e=null;var q=-10;for(f=0;96>f;f++)p[f]+n[f]>q&&(q=p[f]+n[f]);if(!(-3>q&&(d.notes[0].pit&1||!r.dots&&!d.dots||!(r.notes[r.nhd].pit==d.notes[0].pit+2&&r.dot_low||r.notes[r.nhd].pit+2==d.notes[0].pit&&d.dot_low)))){var y=Tc(d);var t=Sc(r);if(e)for(z=Sc(e),f=0;96>f;f++)z[f]>t[f]&&(t[f]=z[f]);var u=h=l=-100;for(f=0;96>f;f++)t[f]+y[f]>u&&(u=t[f]+y[f]),y[f]>l&&
(l=y[f]),n[f]>h&&(h=n[f]);f=0;z=r.nhd;for(g=d.nhd;;){var x=r.notes[z].pit-d.notes[g].pit;switch(x){case 2:r.notes[z].pit&1||(r.dot_low=!1);break;case 1:r.notes[z].pit&1?d.dot_low=!0:r.dot_low=!1;break;case 0:if(r.notes[z].acc!=d.notes[g].acc){f=-1;break}d.notes[g].acc&&(r.notes[z].acc||(r.notes[z].acc=d.notes[g].acc),d.notes[g].acc=0);r.dots&&d.dots&&r.notes[z].pit&1&&(f=1);break;case -1:r.notes[z].pit&1?d.dot_low=!1:r.dot_low=!0;break;case -2:r.notes[z].pit&1||(d.dot_low=!1)}if(0>f)break;if(0<=x&&
0>--z)break;if(0>=x&&0>--g)break}if(0>f)qf(r,d,z,g);else{g=0;r.dots?d.dots?f||(g=1):a():d.dots&&u+h<q+l&&(g=1);var v=p;var B=y;!e&&u+h<q+l&&a();q+=3;0>q&&(q=0);e=0<=r.stem?0:r.nhd;q+=r.notes[e].shhd;e=0<=d.stem?0:d.nhd;q-=d.notes[e].shhd;if(r.dots)if(e=7.7+r.xmx+3.5*r.dots-3.5+3,!g){u=-100;for(z=0;z<=r.nhd;z++)f=r.notes[z].pit,f&1||(r.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),v[f]>u&&(u=v[f]),v[f-1]+1>u&&(u=v[f-1]+1),v[f+1]+1>u&&(u=v[f+1]+1);e+u+2>q&&(q=e+u+2)}else if(e<q+l+d.xmx){for(z=u=0;z<=
r.nhd;z++)f=r.notes[z].pit,f&1||(r.dot_low?f--:f++),f*=2,1>f?f=1:95<=f&&(f=94),B[f]>u&&(u=B[f]),B[f-1]+1>u&&(u=B[f-1]=1),B[f+1]+1>u&&(u=B[f+1]+1);4.5<u&&7.7+r.xmx+2<q+u+d.xmx&&(d.xmx=u+3-7.7)}for(e=d.nhd;0<=e;e--)d.notes[e].shhd+=q;d.xmx+=q;g&&(r.xmx=d.xmx)}}}else{0>r.stem&&(r=d,d=c);q=r.notes[0].shhd+7;for(e=0;e<=d.nhd;e++)d.notes[e].shhd+=q;d.xmx+=q;r.xmx=d.xmx}}}}function sf(a){for(var c=N;c&&!c.nl;c=c.ts_next)c.st==a&&c.type!=m.CLEF&&(c.st++,c.invis=!0)}function tf(){function a(a){var c=C[a],
d=h.staves[a];c||(c=C[a]={});c.y=0;c.stafflines=d.stafflines;c.staffscale=d.staffscale;c.ann_top=c.ann_bot=0}function c(){var a,c,d=h.staves.length;for(a=0;a<d;a++)if(h.staves[a].flags&257){var e=0;for(c=a;a<d;){e|=f[a]?1:2;if(h.staves[a].flags&514)break;a++}if(3==e)for(;c<=a;)f[c]=!0,g[c++]=!0}}var d,e,f=[],g=[],h=L;if(N.type==m.STAVES){var l=N;N=N.ts_next;N.ts_prev=null;l.seqst&&(N.seqst=!0);if(l.p_v.sym=l.next)l.next.prev=null}P=h.nstaff;for(d=0;d<=P;d++)a(d);for(l=N;l&&!l.nl;l=l.ts_next){switch(l.type){case m.STAVES:c();
h.st_print=new Uint8Array(f);for(h=l.sy;P<h.nstaff;)a(++P);f=[];continue;case m.BLOCK:l.play?l.ts_next&&l.ts_next.shrink&&(l.ts_next.shrink=0):(rc.push(l),nb(l));continue}d=l.st;if(d>P){switch(l.type){case m.CLEF:C[d].clef=l;break;case m.KEY:l.p_v.ckey=l;break;case m.METER:l.p_v.meter=l}nb(l)}else if(!f[d]){switch(l.type){default:continue;case m.BAR:if(l.bar_mrep||1<h.staves[d].staffnonote)break;continue;case m.GRACE:break;case m.NOTE:case m.REST:case m.SPACE:case m.MREST:if(!(1<h.staves[d].staffnonote)){if(l.invis)continue;
if(!h.staves[d].staffnonote&&l.type!=m.NOTE)continue}}g[d]=f[d]=!0}}Oa=l;c();h.st_print=new Uint8Array(f);(function(){var a,c,d;for(a=0;a<=P;a++){var e=C[a];e.hlu=[];e.hld=[];if(g[a]){var f=e.stafflines.length;e.topbar=6*(f-1);for(c=0;c<f-1;c++){switch(e.stafflines[c]){case ".":case "-":continue}break}e.botline=e.botbar=6*c;if(c>=f-2)if("."!=e.stafflines[c])e.botbar-=6,e.topbar+=6;else{e.botbar-=12;e.topbar+=12;continue}e.hll=17+2*c;e.hlmap=new Int8Array(Array(2*(f-c+1)));for(d=1;c<f;c++,d+=2)switch(e.stafflines[c]){case "|":case "[":e.hlmap[d-
1]=1,e.hlmap[d]=1,e.hlmap[d+1]=1}}else e.botbar=e.topbar=0}})();for(d=0;d<P;d++)g[d]||sf(d);g[P]||(C[P].topbar=0);of();G.st_print=new Uint8Array(g);if(Oa){l=Oa;delete l.nl;l=l.ts_prev;l.ts_next=null;var k=D.length;for(e=0;e<k;e++){d=D[e];if(d.sym&&d.sym.time<=Oa.time){for(l=Oa.ts_prev;l;l=l.ts_prev)if(l.v==e){d.s_next=l.next;l.next=null;break}if(l)continue}d.s_next=d.sym;d.sym=null}}}function Td(){for(var a=N,c=a.time;a;a=a.ts_next){if(a.time!=c){Ia();return}switch(a.type){case m.NOTE:case m.REST:case m.MREST:case m.SPACE:Ia();
return;default:continue;case m.STAVES:L=a.sy;continue;case m.BLOCK:if(a.play)continue;W.block_gen(a)}nb(a);a.p_v.s_next==a&&(a.p_v.s_next=a.next)}N=null}function Yb(a){a.fname=p.fname;a.istart=p.istart;a.iend=p.iend}function Ud(a){var c={type:m.CLEF,clef_line:2,clef_type:"t",v:n.v,p_v:n,time:n.time,dur:0},d=1;Yb(c);switch(a[0]){case '"':d=a.indexOf('"',1);c.clef_name=a.slice(1,d);d++;break;case "a":if("u"==a[1]){c.clef_type="a";c.clef_auto=!0;d=4;break}d=4;case "C":c.clef_type="c";c.clef_line=3;break;
case "b":d=4;case "F":c.clef_type="b";c.clef_line=4;break;case "n":d=4;c.invis=!0;break;case "t":if("e"==a[1]){c.clef_type="c";c.clef_line=4;break}d=6;case "G":break;case "p":d=4;case "P":c.clef_type="p";c.clef_line=3;n.key.k_sf=0;n.ckey.k_sf=0;n.ckey.k_map=abc2svg.keys[7];n.ckey.k_b40=2;n.ckey.k_drum=!0;break;default:B(1,"Unknown clef '$1'",a);return}"1"<=a[d]&&"9">=a[d]&&(c.clef_line=Number(a[d]),d++);delete n.snd_oct;if("8"!=a[d+1])return c;switch(a[d]){case "^":c.clef_oct_transp=!0;case "+":c.clef_octave=
7;c.clef_oct_transp||(n.snd_oct=12);break;case "_":c.clef_oct_transp=!0;case "-":c.clef_octave=-7,c.clef_oct_transp||(n.snd_oct=-12)}return c}function jb(a,c){var d;var e=new I;e.buffer=a;var f=[];for(a=0;2>a;a++)if(d=e.buffer[e.index]?Lb(e):null)f[a]=abc2svg.pab40(d.pit,d.acc);else{if(1!=a||!c){B(1,K.bad_transp);return}f[a]=242}return f[1]-f[0]}function Vd(a){var c;if(c=a.match(/(.)[=\s]*(\[I:.+\]|".+"|!.+!)$/)){a=c[1];var d=c[2];"\\"==a[0]&&("t"==a[1]?a="\t":a[1]||(a=" "));c=a.charCodeAt(0);if(128<=
c)B(1,K.not_ascii);else{switch(Aa[c][0]){case "0":case "d":case "i":case " ":break;case '"':case "!":case "[":if(1<Aa[c].length)break;default:B(1,"Bad user character '$1'",a);return}switch(d){case "!beambreak!":d=" ";break;case "!ignore!":d="i";break;case "!nil!":case "!none!":d="d"}Aa[c]=d}}else B(1,'Lack of starting [, ! or " in U: / %%user')}function uf(a){if(a){if(/^[\]\[|.-]+$/.test(a))return a.replace(/\]/g,"[");a=parseInt(a);switch(a){case 0:return"...";case 1:return"..|";case 2:return".||";
case 3:return".|||"}if(!(isNaN(a)||0>a||16<a))return"||||||||||||||||".slice(0,a)}}function Ta(a){var c={type:m.BLOCK,subtype:a,dur:0};2==p.state&&Da();"midi"!=a.slice(0,4)&&(n=D[0]);ia(c);return c}function ic(a){n.init||(n.init=!0,Q.V&&(Q.V["*"]&&(a=Q.V["*"].concat(a)),Q.V[n.id]&&(a=Q.V[n.id].concat(a))));a.length&&W.set_vp(a)}function Ic(a,c){c.length&&(Q.V||(Q.V={}),Q.V[a]?Array.prototype.push.apply(Q.V[a],c):Q.V[a]=c)}function vf(a){function c(a){var c;if((c=a.match(/(\d+)\/(\d+)/))&&(a=Number(c[2]))&&
!isNaN(a)&&!(a&a-1)&&(c=Number(c[1]),!isNaN(c)))return m.BLEN*c/a;B(1,"Invalid note duration $1",f)}var d=a,e={type:m.TEMPO,dur:0};Yb(e);0>t.writefields.indexOf("Q")&&(e.invis=!0);if('"'==a[0]){var f=a.match(/"([^"]*)"/);if(!f){B(1,"Unterminated string in Q:");return}e.tempo_str1=f[1];a=a.slice(f[0].length).replace(/^\s+/,"")}if('"'==a.slice(-1)){var g=a.indexOf('"');e.tempo_str2=a.slice(g+1,-1);a=a.slice(0,g).replace(/\s+$/,"")}g=a.indexOf("=");if(0<g){var h=a.slice(0,g).split(/\s+/);for(a=a.slice(g+
1).replace(/^\s+/,"");;){f=h.shift();if(!f)break;g=c(f);if(!g)return;e.tempo_notes||(e.tempo_notes=[]);e.tempo_notes.push(g)}"ca. "==a.slice(0,4)&&(e.tempo_ca="ca. ",a=a.slice(4));g=a.indexOf("/");if(0<g){g=c(a);if(!g)return;e.new_beat=g}else if(e.tempo=Number(a),!e.tempo||isNaN(e.tempo)){B(1,"Bad tempo value");return}}if(3!=p.state){if(1==p.state){Q.Q=d;na.tempo=e;return}Da()}ia(e);na.tempo&&0==n.time&&(na.tempo.invis=!0)}function Mc(a,c){var d;if(!n||!n.ignore||"V"==a)switch(a){case "I":W.do_pscom(c);
break;case "L":2==p.state&&Da();if(d=c.match(/^1\/(\d+)(=(\d+)\/(\d+))?$/)){var e=Number(d[1]);if(!e||0!=(e&e-1))break;e=m.BLEN/e;var f=d[2]?(f=Number(d[4]))?Number(d[3])/f*m.BLEN:0:e}else"auto"==c&&(e=f=-1);if(!f){B(1,"Bad L: value");break}2>p.state?na.ulen=e:(n.ulen=e,n.dur_fact=f/e);break;case "M":a:{d={type:m.METER,dur:0,a_meter:[]};var g={},h=0;var l=0;Yb(d);if(0==c.indexOf("none"))l=4,a=1;else for(a=0;l<c.length&&"="!=c[l];){switch(c[l]){case "C":g.top=c[l++];if(!h)var k=h=4;break;case "c":case "o":g.top=
c[l++];if(!h)switch(h="c"==c[l-1]?2:3,k=4,c[l]){case "|":k/=2;break;case ".":h*=3,k*=2}break;case ".":case "|":h=0;g.top=c[l++];break;case "(":if("("==c[l+1]){var r=!0;g.top=c[l++];d.a_meter.push(g);g={}}for(e=l+1;e<c.length&&")"!=c[e]&&"/"!=c[e];)e++;if(")"==c[e]&&"/"==c[e+1]){l++;continue}case ")":r="("==c[l];g.top=c[l++];d.a_meter.push(g);g={};continue;default:if("0">=c[l]||"9"<c[l]){B(1,"Bad char '$1' in M:",c[l]);break a}k=2;for(g.top=c[l++];;){for(;"0"<=c[l]&&"9">=c[l];)g.top+=c[l++];if(")"==
c[l]){if("/"!=c[l+1])break;l++}if("/"==c[l]){l++;if("0">=c[l]||"9"<c[l]){B(1,"Bad char '$1' in M:",c[l]);break a}for(g.bot=c[l++];"0"<=c[l]&&"9">=c[l];)g.bot+=c[l++];break}if(" "!=c[l]&&"+"!=c[l])break;if(l>=c.length||"("==c[l+1])break;g.top+=c[l++]}h=parseInt(g.top)}r||(g.bot&&(k=parseInt(g.bot)),a+=h*m.BLEN/k);d.a_meter.push(g);for(g={};" "==c[l];)l++;"+"==c[l]&&(g.top=c[l++],d.a_meter.push(g),g={})}if("="==c[l]){k=c.substring(++l).match(/^(\d+)\/(\d+)$/);if(!k){B(1,"Bad duration '$1' in M:",c.substring(l));
break a}a=m.BLEN*k[1]/k[2]}d.wmeasure=a;0>t.writefields.indexOf("M")&&(d.a_meter=[]);if(3!=p.state){if(Q.M=c,na.meter=d,1<=p.state)for(na.ulen||(na.ulen=1>=a||a>=3*m.BLEN/4?m.BLEN/8:m.BLEN/16),l=0;l<D.length;l++)D[l].meter=d,D[l].wmeasure=a}else n.wmeasure=a,sc()?n.meter=d:ia(d)}break;case "U":Vd(c);break;case "P":if(0==p.state)break;if(1==p.state){Q.P=c;break}2==p.state&&Da();d={type:m.PART,text:c,dur:0};0>t.writefields.indexOf(a)&&(d.invis=!0);ia(d);break;case "Q":if(0==p.state)break;vf(c);break;
case "V":Uc(c);3==p.state&&(n.ignore=!J.voices[n.v]);break;case "K":if(!p.state)break;a:{b:{k="FCGDAEB".indexOf(c[0])-1;r=0;a={type:m.KEY,dur:0};Yb(a);e=1;if(-1>k)switch(c[0]){case "H":if("p"!=c[1].toLowerCase()){B(1,"Unknown bagpipe-like key");g=!0;break}a.k_bagpipe=c[1];k="P"==c[1]?0:2;e++;t.temper||(t.temper=new Float32Array([11.62,12.55,2.37,2.37,3.49,0,2.37,2.37,3.49,4.41,5.53,0,3.49,4.41,5.53,7.35,7.35,4.41,5.53,7.35,7.35,8.19,0,7.35,7.35,8.19,9.39,10.51,0,8.19,9.39,10.51,11.62,12.55,0,10.51,
11.62,12.55,2.37,2.37]));break;case "P":B(1,"K:P is deprecated");k=0;g=a.k_drum=!0;break;case "n":if(0==c.indexOf("none")){k=0;a.k_none=!0;e=4;break}default:a.k_map=[];a.k_mode=0;c=[a,Zb(c)];break b}if(!g){switch(c[e]){case "#":k+=7;e++;break;case "b":k-=7,e++}c=c.slice(e).trim();switch(c.slice(0,3).toLowerCase()){default:if("m"!=c[0]||" "!=c[1]&&"\t"!=c[1]&&"\n"!=c[1]){g=!0;break}case "aeo":case "m":case "min":k-=3;r=5;break;case "dor":k-=2;r=1;break;case "ion":case "maj":break;case "loc":k-=5;r=
6;break;case "lyd":k+=1;r=3;break;case "mix":--k;r=4;break;case "phr":k-=4,r=2}g||(c=c.replace(/\w+\s*/,""));0==c.indexOf("exp ")&&((c=c.replace(/\w+\s*/,""))||B(1,"No accidental after 'exp'"),h=!0);e=c[0];if("^"==e||"_"==e||"="==e){a.k_a_acc=[];g=new I;g.buffer=c;do{f=Lb(g);if(!f)break;a.k_a_acc.push(f);for(e=c[g.index];" "==e;)e=c[++g.index]}while("^"==e||"_"==e||"="==e);if(!h){var A=k,v;e=[];f=[];if(0<A)for(h=0;h<A;h++)e[h]=1,f[h]=[26,23,27,24,21,25,22][h];else for(h=0;h<-A;h++)e[h]=-1,f[h]=[22,
25,21,24,20,23,26][h];var z=a.k_a_acc.length;for(A=0;A<z;A++){var q=a.k_a_acc[A];for(v=0;v<h;v++)if(f[v]==q.pit){e[v]=q.acc;break}v==h&&(e[v]=q.acc,f[v]=q.pit,h++)}for(A=0;A<h;A++)(q=a.k_a_acc[A])||(q=a.k_a_acc[A]={}),q.acc=e[A],q.pit=f[A]}c=c.slice(g.index)}else h&&0==c.indexOf("none")&&(k=0,c=c.replace(/\w+\s*/,""))}a.k_sf=k;if(a.k_a_acc)for(a.k_map=[],e=a.k_a_acc.length;0<=--e;)f=a.k_a_acc[e],a.k_map[(f.pit+19)%7]=f.acc;else a.k_map=abc2svg.keys[k+7];a.k_mode=r;a.k_b40=[1,24,7,30,13,36,19,2,25,
8,31,14,37,20,3][k+7];c=[a,Zb(c)]}k=c[0];c=c[1];switch(p.state){case 1:void 0!=k.k_sf||k.k_a_acc||(k.k_sf=0,k.k_none=!0,k.k_map=abc2svg.keys[7]);for(d=0;d<D.length;d++)l=D[d],l.key=x(k),l.okey=x(k),l.ckey=x(k);p.ckey=k;c.length&&Ic("*",c);na.ulen||(na.ulen=m.BLEN/8);p.state=2;break a;case 2:Da(!0)}c.length&&ic(c);n.ckey.k_bagpipe||n.ckey.k_drum||void 0==t.transp&&void 0==n.transp&&void 0==n.shift||(d=(t.transp||0)+(n.transp||0)+(n.shift||0));if(void 0!=n.sndtran||void 0!=n.sndsh)l=(n.sndtran||0)+
(n.sndsh||0);if(void 0==k.k_sf){if(!k.k_a_acc&&void 0==d){if(void 0==l)break a;k.invis=!0}k.k_sf=n.okey.k_sf}n.okey=x(k);void 0!=d&&(n.vtransp=d,k.k_transp=d);void 0!=l&&(k.k_sndtran=l);k.k_old_sf=n.ckey.k_sf;k.k_a_acc&&k.k_a_acc.length||k.k_sf||k.k_old_sf||(k.invis=!0);k.k_b40||(k.k_b40=n.ckey.k_b40);n.ckey=k;sc()?(k.fmt=t,n.key=x(k),k.k_none&&(n.key.k_sf=0)):ia(k)}break;case "N":case "R":Q[a]=Q[a]?Q[a]+("\n"+c):c;break;case "r":if(!u.keep_remark||3!=p.state)break;d={type:m.REMARK,text:c,dur:0};
ia(d);break;default:B(0,"'$1:' line ignored",a)}}function Wd(){var a,c=p.line,d={type:m.BAR,fname:p.fname,istart:p.bol+c.index,dur:0,multi:0};la.length&&"dot"==la[la.length-1]&&(d.bar_dotted=!0,la.pop());ca&&ca.bar&&Ob("|");na.new_nbar&&(d.bar_num=na.new_nbar,na.new_nbar=0);for(a=c.char();;){var e=c.next_char();switch(e){case "|":case "[":case "]":case ":":a+=e;continue}break}":"==a[0]&&(":"==a?(a="|",d.bar_dotted=!0):d.rbstop=2);kb&&tc(d);la.length&&Eb(d);if(p.ottava.length){var f=d;n.cst!=n.st&&
(f={type:m.SPACE,fname:p.fname,istart:p.bol+c.index,dur:0,multi:0,invis:!0,width:1},ia(f));f.ottava=p.ottava;p.ottava=[]}"["!=a.slice(-1)||/[0-9" ]/.test(e)||(a=a.slice(0,-1),c.index--,e="[");":"==a.slice(-1)&&(d.rbstop=2);if("0"<e&&"9">=e){for(d.text=e;;){e=c.next_char();if(0>"0123456789,.-".indexOf(e))break;d.text+=e}d.rbstop=2;d.rbstart=2}else if('"'==e&&"["==a.slice(-1)){for(d.text="";;){e=c.next_char();if(!e){B(1,"No end of repeat string");return}if('"'==e){c.index++;break}d.text+=e}d.rbstop=
2;d.rbstart=2}"]"==a[0]&&(d.rbstop=2,1!=a.length?a=a.slice(1):d.invis=!0);d.iend=p.bol+c.index;d.rbstart&&n.norepbra&&!n.second&&(d.norepbra=!0);if(d.text)if("["==a.slice(-1)&&"["!=a&&(a=a.slice(0,-1)),"1"==d.text[0])n.tie_s&&(n.tie_s_rep=n.tie_s),n.acc_tie?n.acc_tie_rep=n.acc_tie.slice():n.acc_tie_rep&&(n.acc_tie_rep=null);else{if(n.tie_s_rep)for(n.tie_s=x(n.tie_s_rep),n.tie_s.notes=x(n.tie_s.notes),f=0;f<=n.tie_s.nhd;f++)n.tie_s.notes[f]=x(n.tie_s.notes[f]),n.tie_s.notes[f].s=n.tie_s;n.acc_tie_rep&&
(n.acc_tie=n.acc_tie_rep.slice())}if(0>n.ulen&&(f=n.last_sym)&&f.type!=m.MREST&&f.type!=m.BAR){for(;f.type!=m.BAR&&f.prev;)f=f.prev;e=f.time;var g=n.time-e;c=n.wmeasure/g;if(0==e){for(;f&&!f.dur;)f=f.next;f&&f.type==m.REST&&f.invis&&(e+=f.dur*c,f.prev?f.prev.next=f.next:n.sym=f.next,f.next&&(f.next.prev=f.prev),f=f.next)}if(n.wmeasure!=g){for(;f;f=f.next)if(f.time=e,f.dur&&!f.grace&&(f.dur*=c,f.dur_orig*=c,e+=f.dur,f.type==m.NOTE||f.type==m.REST))for(g=0;g<=f.nhd;g++)f.notes[g].dur*=c;n.time=d.time=
e}}if(("["==a||"|:"==a)&&!n.eoln&&(f=n.last_sym)&&f.time==n.time&&f&&f.type==m.BAR){if("["==a&&!f.text&&(0==n.st||J.staves[n.st-1].flags&64||d.norepbra)||"|"==f.bar_type){"["!=a&&(f.bar_type=a);d.text&&(f.text=d.text);d.a_gch&&(f.a_gch=d.a_gch);d.norepbra&&(f.norepbra=d.norepbra);d.rbstart&&(f.rbstart=d.rbstart);d.rbstop&&(f.rbstop=d.rbstop);return}if("|:"==a){if(":|"==f.bar_type){f.bar_type="::";f.rbstop=2;return}if("||"==f.bar_type){f.bar_type="||:";f.rbstop=2;return}}}switch(a){case "[":d.rbstop=
2;case "[]":case "[|]":d.invis=!0;a=d.rbstart?"[":"[]";break;case ":|:":case ":||:":a="::";break;case "||":if("2.2"<=t["abc-version"])break;case "[|":case "|]":d.rbstop=2}d.bar_type=a;n.lyric_restart||(n.lyric_restart=d);n.sym_restart||(n.sym_restart=d);ia(d);d.st=n.st;d.rbstart&&"["!=a&&!n.norepbra&&0<d.st&&!(J.staves[d.st-1].flags&64)&&(f={type:m.BAR,fname:d.fname,istart:d.istart,iend:d.iend,bar_type:"[",multi:0,invis:!0,text:d.text,rbstart:2},ia(f),f.st=d.st,delete d.text,d.rbstart=0);d.bar_dotted||
d.invis||(n.acc=[])}function Zb(a){if(!a)return[];a=a.match(/[^\s"=]+=?|"[^"]+"/g);return a?a:(B(1,"Unterminated string"),[])}function uc(a){Vc.lastIndex=a.index;var c=Vc.exec(a.buffer);if(!c[0])return[1,1];var d=c[1]||1;var e=c[3]||1;c[3]||(e*=1<<c[2].length);a.index=Vc.lastIndex;return[d,e]}function Lb(a){var c=a.char();switch(c){case "^":c=a.next_char();if("^"==c){var d=2;c=a.next_char()}else d=1;break;case "=":d=3;c=a.next_char();break;case "_":c=a.next_char(),"_"==c?(d=-2,c=a.next_char()):d=
-1}if(1==d||-1==d)if("1"<=c&&"9">=c||"/"==c){var e=uc(a);0>d&&(e[0]=-e[0]);t.nedo&&1==e[1]&&(e[0]*=12,e[1]*=t.nedo);d=e;c=a.char()}e=tb.indexOf(c)+16;c=a.next_char();if(16>e)B(1,"'$1' is not a note",a.buffer[a.index-1]);else{for(;"'"==c;)e+=7,c=a.next_char();for(;","==c;)e-=7,c=a.next_char();a={pit:e,shhd:0,shac:0};d&&(a.acc=d);return a}}function vc(){var a=p.line,c=0;la.length&&"dot"==la[la.length-1]&&(c=m.SL_DOTTED,la.pop());switch(a.next_char()){case "'":return a.index++,c+m.SL_ABOVE;case ",":return a.index++,
c+m.SL_BELOW}return c+m.SL_AUTO}function Wc(a,c){var d;for(d=n.sls.length;0<=--d;){var e=n.sls[d];var f=e.note;var g=e.is_note;delete e.is_note;if(f.s!=a.s){e.note=a;c&&(e.is_note=c);var h=g?f:f.s;h.sls||(h.sls=[]);h.sls.push(e);n.sls.splice(d,1);g&&(f.s.sl1=!0);e.grace&&(e.grace.sl1=!0);a.s.grace&&(a.s.sl2=!0);return}}if(a.grace)v(1,a.s,K.bad_slur_end);else{for(h=a.s.prev;h;h=h.prev)if(h.type==m.BAR&&":"==h.bar_type[0]&&h.text){h.sls||(h.sls=[]);h.sls.push({note:a,ty:m.SL_AUTO});c&&(h.sls[h.sls.length-
1].is_note=c);return}B(1,"End of slur without start")}}function Xd(a,c){var d=[0,2,4,5,7,9,11][a%7],e=12*(a/7|0);n.snd_oct&&(e+=n.snd_oct);3==c&&(c=0);if(c)if("object"==typeof c){var f=c[0]/c[1];if(100==c[1])return d+e+f}else f=c;else return t.temper?t.temper[abc2svg.p_b40[a%7]]+e:d+e;if(t.nedo){if("object"!=typeof c)return a=abc2svg.p_b40[a%7]+c,t.temper[a]+e;if(c[1]==t.nedo)return a=abc2svg.p_b40[a%7],t.temper[a]+e+f}else if(!t.temper)return d+(e+f);c=t.temper[abc2svg.p_b40[a%7]];0<f?(a=t.temper[(abc2svg.p_b40[a%
7]+1)%40],a<c&&(a+=12)):(a=t.temper[(abc2svg.p_b40[a%7]+39)%40],a>c&&(a-=12),f=-f);return c+e+(a-c)*f}function Yd(){for(var a,c=p.line,d=c.index,e="";;){a=c.next_char();if(!a){B(1,"No end of decoration");c.index=d;return}if("!"==a)break;e+=a}void 0!=Zd[e]?(na.ottava=!0,p.ottava.push(Zd[e])):la.push(e)}function Id(){function a(a){for(var c=tb[a];0>a;)a+=7,c+=",";for(;14<a;)a-=7,c+="'";return c}function c(c,d){var e,f="",g=c.length;for(e=0;e<g;e++){var h=c[e];f="h"<=h&&"z">=h?f+a(d+h.charCodeAt(0)-
110):f+h}return f}function d(z){for(var q,y,v,x;;){q=A.char();if(!q)break;if(n.ignore)for(;"["!=q||"V"!=A.buffer[A.index+1]||":"!=A.buffer[A.index+2];)if(q=A.next_char(),!q)return;if(!z&&jc[q]){x=0;for(v in rb)if(rb.hasOwnProperty(v)&&v[0]==q){if(0>v.indexOf("n")){if(A.buffer.indexOf(v,A.index)!=A.index)continue;A.index+=v.length}else{a:{y=void 0;var C=v;var V=1;for(x=A.index+1;V<C.length;V++,x++)if(C[V]!=A.buffer[x]){if("n"!=C[V]){x=void 0;break a}y=tb.indexOf(A.buffer[x]);if(0>y){x=void 0;break a}for(;"'"==
A.buffer[x+1];)y+=7,x++;for(;","==A.buffer[x+1];)y-=7,x++}A.index=x;x=y}if(!x)continue}var D=v;y=rb[v];V=A;C=p.istart;p.line=A=new I;p.istart+=V.index;if(0>t.writefields.indexOf("m")){A.buffer=D.replace("n",a(x));D=n.last_sym;var E=n.time;d(!0);D||(D=n.sym);for(D=D.next;D;D=D.next)D.noplay=!0;var H=n.time;var G=n;n=$d(G.id+"-p");J.voices[n.v]||(n.second=!0,J.voices[n.v]={st:G.st,second:!0,range:n.v});n.time=E;D=n.last_sym;p.line=A=new I;p.istart+=V.index;A.buffer=x?c(y,x):y;d(!0);n.time!=H&&B(1,"Bad length of the macro sequence");
D||(D=n.sym);for(;D;D=D.next)D.invis=D.play=!0;n=G}else A.buffer=x?c(y,x):y,d(!0);p.line=A=V;p.istart=C;x=1;break}if(x)continue}y=q.charCodeAt(0);if(128<=y){B(1,K.not_ascii);A.index++;break}y=Aa[y];switch(y[0]){case " ":if(y=n.last_note)y.beam_end=!0,e&&(e.gr_shift=!0);break;case "\n":if(t.barsperstaff)break;n.eoln=!0;break;case "&":if(e){B(1,K.bad_grace);break}q=A.next_char();if(")"==q){Ob(")");break}Ob("&");continue;case "(":q=A.next_char();if("0"<q&&"9">=q){if(e){B(1,K.bad_grace);break}y=A.get_int();
x=wf[y];V=y;q=A.char();if(":"==q&&(q=A.next_char(),"0"<q&&"9">=q&&(x=A.get_int(),q=A.char()),":"==q))if(q=A.next_char(),"0"<q&&"9">=q)V=A.get_int(),A.char();else{B(1,"Invalid 'r' in tuplet");continue}if(0==x||void 0==x)x=0==n.wmeasure%9?3:2;0>k&&(k=l.length);q=t.tuplets;if(n.pos.tup)switch(q=Object.create(q),n.pos.tup&7){case m.SL_ABOVE:q[3]=1;break;case m.SL_BELOW:q[3]=2;break;case m.SL_HIDDEN:q[2]=1}l.push({p:y,q:x,r:V,ro:V,f:q});continue}if("&"==q){if(e){B(1,K.bad_grace);break}Ob("(");break}A.index--;
r.push(vc());continue;case ")":if(y=n.last_sym)switch(y.type){case m.SPACE:y.notes||(y.notes=[],y.notes[0]={});case m.NOTE:case m.REST:break;case m.GRACE:for(y=y.extra;y.next;y=y.next);break;default:y=null}if(!y){B(1,K.bad_char,q);break}y.notes[0].s=y;Wc(y.notes[0]);break;case "!":1<y.length?la.push(y.slice(1,-1)):Yd();break;case '"':if(e){B(1,K.bad_grace);break}ae(y);break;case "[":if(1<y.length){W.do_pscom(y.slice(3,-1));break}x=A.buffer[A.index+1];if(0<='|[]: "'.indexOf(x)||"1"<=x&&"9">=x){if(e){B(1,
K.bar_grace);break}Wd();continue}if(":"==A.buffer[A.index+2]){if(e){B(1,K.bad_grace);break}q=A.buffer.indexOf("]",A.index+1);if(0>q){B(1,"Lack of ']'");break}y=A.buffer.slice(A.index+3,q).trim();p.istart=p.bol+A.index;p.iend=p.bol+ ++q;A.index=0;Mc(x,y);A.index=q;continue}case "n":y=W.new_note(e,r);if(!y)continue;if(e||!y.notes)continue;if(0<=k)y.tp=l.slice(k),k=-1,u&&(y.tp[0].s=u),u=y;else if(!u)continue;v=l[l.length-1];if(0<--v.r)continue;for(;;){q=u;y=v.q/v.p;x=q.time;for(n.time=x+(n.time-x)*y;;){q.in_tuplet=
!0;q.grace||(q.time=x,q.dur&&(q.dur*=y,x+=q.dur));if(!q.next){q.tpe?q.tpe++:q.tpe=1;break}q=q.next}q=v.ro;v.s&&(u=v.s);l.pop();if(!l.length){u=null;break}v=l[l.length-1];v.r-=q;if(0<v.r)break}continue;case "<":if(!n.last_note){B(1,"No note before '<'");break}if(e){B(1,"Cannot have a broken rhythm in grace notes");break}for(x="<"==q?1:-1;"<"==q||">"==q;)x*=2,q=A.next_char();n.brk_rhythm=x;continue;case "i":break;case "{":if(e){B(1,"'{' in grace note");break}f=n.last_note;n.last_note=null;g=la;la=[];
e={type:m.GRACE,fname:p.fname,istart:p.bol+A.index,dur:0,multi:0};switch(n.pos.gst&7){case m.SL_ABOVE:e.stem=1;break;case m.SL_BELOW:e.stem=-1;break;case m.SL_HIDDEN:e.stem=2}ia(e);q=A.next_char();if("/"==q){e.sappo=!0;break}continue;case "|":if(e){B(1,K.bar_grace);break}Wd();continue;case "}":y=n.last_note;if(!e||!y){B(1,K.bad_char,q);break}la.length&&B(1,"Decoration ignored");e.extra=e.next;e.extra.prev=null;e.next=null;n.last_sym=e;e=null;if(!y.prev&&!n.ckey.k_bagpipe){for(q=0;q<=y.nhd;q++)y.notes[q].dur*=
2;y.dur*=2;y.dur_orig*=2}n.last_note=f;la=g;break;case "\\":if(!A.buffer[A.index+1]){h=!0;break}default:B(1,K.bad_char,q)}A.index++}}var e,f,g,h,l=[],k=-1,r=[],A=p.line;if(3!=p.state){if(2!=p.state)return;Da()}if(p.tp){l=p.tp;k=p.tpn;var u=p.tps;p.tp=null}d();l.length&&(p.tp=l,p.tps=u,p.tpn=k);r.length&&B(1,"Start of slur without note");la.length&&(B(1,"Decoration without symbol"),la=[]);e&&(B(1,"No end of grace note sequence"),n.last_sym=e.prev,n.last_note=f,e.prev&&(e.prev.next=null));t.breakoneoln&&
n.last_note&&(n.last_note.beam_end=!0);h||t.barsperstaff||"\n"!=Aa[10]||(n.eoln=!0)}function Xc(a){a=a.charCodeAt(0);if(128<=a){if(768<=a&&880>a)return 0;a=97}return be[a]}function Sb(a){return Xc(a)*G.curfont.swfac}function Pa(a){if("object"==typeof a)return a;var c,d=G.curfont,e=d;var f=a.replace(/<|>|&[^&]*?;|&|  |\$./g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";case "  ":return" \u00a0";default:if("$"==a[0]){if("0"==a[1])c=G.deffont;else if("1"<=a[1]&&
"9">=a[1])c=Ca("u"+a[1]);else break;a="";if(c!=e&&(e!=d&&(a="</tspan>"),e=c,e!=d)){var f=e.class&&e.name==d.name&&e.size==d.size&&e.weight==d.weight&&e.style==d.style?e.class:cb(e);return a+('<tspan\n\tclass="'+f+'">')}}}return a});e!=d&&(f+="</tspan>",G.curfont=e);f=new String(f);"undefined"!=typeof document?ya(f):f.wh=ya(a);return f}function T(a){"string"==typeof a&&(a=Ca(a));be="sans"==a.name.slice(0,4)?xf:ce;G.curfont=G.deffont=a}function R(a,c,d,e,f,g){g||(g=d.wh||ya(d));H+='<text class="'+cb(G.curfont);
"j"!=e&&5<d.length&&G.curfont.wadj&&(H+='" lengthAdjust="'+G.curfont.wadj+'" textLength="'+g[0].toFixed(1));H+='" x="';Qa(a,'" y="',c+.2*g[1]);switch(e){case "c":H+='" text-anchor="middle">';break;case "j":H+='" textLength="'+f.toFixed(1)+'">';break;case "r":H+='" text-anchor="end">';break;default:H+='">'}H+=Pa(d);H+="</text>\n"}function de(a,c){if(t.titletrim){var d=a.lastIndexOf(", ");if(0>d||"A">a[d+2]||"Z"<a[d+2])d=0;else if(1==t.titletrim){if(d<a.length-7||0<=a.indexOf(" ",d+3))d=0}else d<a.length-
t.titletrim-2&&(d=0);d&&(a=a.slice(d+2).trim()+" "+a.slice(0,d))}!c&&0<=t.writefields.indexOf("X")&&(a=Q.X+".  "+a);return t.titlecaps?a.toUpperCase():a}function Vb(){return(da.width-da.lm-da.rm-2)/t.scale}function Yc(a,c){if(a){Ia();a=de(a,c);c?(T("subtitle"),c=t.subtitlespace):(T("title"),c=t.titlespace);var d=ya(a);d[1]+=2*G.curfont.pad;ma(d[1]+c+G.curfont.pad);c=G.curfont.pad;t.titleleft?R(0,c,a,null,null,d):R(Vb()/2,c,a,"c",null,d)}}function ee(a,c,d,e,f){if(!d){if(!e)return;d=e;e=null}e?R(a,
c,d+" ("+e+")",f):R(a,c,d,f)}function wc(a,c){if("s"!=c){Ia();var d=Vb(),e=G.curfont.size,f=e*t.lineskipfac;e*=t.parskipfac;var g,h;switch(c){default:var l=G.curfont;switch(c){case "c":d/=2;break;case "r":d-=l.pad;break;default:d=l.pad}for(g=0;;){var k=a.indexOf("\n",g);if(0>k){var m=Pa(a.slice(g));ma(m.wh[1]*t.lineskipfac+2*l.pad);R(d,l.pad,m,c);break}if(k==g){ma(e);qb();for(ib(G.curfont);"\n"==a[k+1];)ma(f),k++;if(k==a.length)break}else m=Pa(a.slice(g,k)),ma(m.wh[1]*t.lineskipfac+2*l.pad),R(d,l.pad,
m,c);g=k+1}ma(e);qb();break;case "f":case "j":for(g=0;;){k=a.indexOf("\n\n",g);l=0>k?a.slice(g):a.slice(g,k);l=l.split(/\s+/);for(g=m=h=0;g<l.length;g++){var n=ya(l[g])[0];m+=n;m>=d&&(m=Pa(l.slice(h,g).join(" ")),ma(m.wh[1]*t.lineskipfac),R(0,0,m,c,d),h=g,m=n);m+=Sb(" ")}0!=m&&(m=Pa(l.slice(h).join(" ")),ma(m.wh[1]*t.lineskipfac),R(0,0,m));ma(e);qb();if(0>k)break;for(;"\n"==a[k+2];)ma(f),k++;if(k==a.length)break;ib(G.curfont);g=k+2}}}}function gf(a){function c(a,c){var d=0;"$"==a[d]&&"0"<=a[d+1]&&
"9">=a[d+1]&&(d+=2);var e=0;var f=d;if("0"<=a[d]&&"9">=a[d]||"."==a[d+1]){for(;d<a.length&&(d++," "!=a[d]&&":"!=a[d-1]&&"."!=a[d-1]););for(e=d;" "==a[d];)d++}0!=e&&R(c,0,a.slice(f,e),"r");d<a.length&&R(c+5,0,a.slice(d),"l")}var d,e;var f=0;var g=1;T("words");ma(t.wordsspace);$b();a=a.split("\n");var h=a.length;for(d=0;d<h;d++){var l=a[d];if(!l){for(;d+1<h&&!a[d+1];)d++;g++}else if(l.length>f){f=l.length;var k=d}}f=Vb()/2;var m=ya(a[k])[0];k=e=0;if(m<f){var n=g>>1;for(d=0;d<h;d++)if(l=a[d],!l){for(0>=
--n&&(k=d);d+1<h&&!a[d+1];)d++;if(0>=n){e=d+1;break}}g>>=1}if(e){var p=(f-m)/2+10;n=p+f}else n=f-m/2+10;var z=!0;for(d=0;d<k||e<h;d++,e++)ma(t.lineskipfac*G.curfont.size),d<k&&((l=a[d])?c(l,p):ib(G.curfont)),e<h&&((l=a[e])?c(l,n):0==--g&&(d<k?g++:e<h-1&&(n=f-m/2+10,$b()))),a[d+1]||a[e+1]?z=!0:z&&($b(),z=!1)}function dc(a){return a.replace(/[Cco]\||[co]\.|./g,function(a){return(a=Ec["mtr"+a])?a.c:0})}function fe(a){var c,d;if(!Zc[a])if(Zc[a]=!0,d=Gb[a]){for(c=0;;){a=d.indexOf('xlink:href="#',c);if(0>
a)break;a+=13;c=d.indexOf('"',a);fe(d.slice(a,c))}xc+="\n"+d}else v(1,null,"Unknown glyph: '$1'",a)}function ge(a){var c=0;for(a=a.replace(/\x3c!--.*?--\x3e/g,"");;){var d=a.indexOf("<",c);if(0>d)break;var e=a.indexOf('id="',d);if(0>e)break;e+=4;c=a.indexOf('"',e);if(0>c)break;var f=a.slice(e,c);c=a.indexOf(">",c);if(0>c)break;if("/"==a[c-1])c++;else{e=a.indexOf(" ",d);if(0>e)break;e=a.slice(d+1,e);c=a.indexOf("</"+e+">",c);if(0>c)break;c+=3+e.length}"<filter"==a.substr(d,7)?$c+=a.slice(d,c)+"\n":
Gb[f]=a.slice(d,c)}}function ad(){F.started&&(F.started=!1,gb(),H+="</g>\n");if(1!=F.scale||F.color)gb(),H+="<g ",1!=F.scale&&(H=0>F.st?H+D[F.v].scale_str:0>F.v?H+C[F.st].scale_str:H+('transform="translate(0,'+(fa-F.dy).toFixed(1)+") scale("+F.scale.toFixed(2)+')"')),F.color&&(1!=F.scale&&(H+=" "),H+='color="'+F.color+'" fill="'+F.color+'"'),H+=">\n",F.started=!0}function va(a){if(a!=F.color){var c=F.color;F.color=a;ad();return c}}function za(a){a!=F.st&&1!=F.scale&&(F.scale=0);var c=0<=a?C[a].staffscale:
1;var d=0<=a&&1!=c?C[a].y:fa;if(c!=F.scale||d!=F.dy)F.scale=c,F.dy=d,F.st=a,F.v=-1,ad()}function Ma(a){var c=a.p_v.scale;if(1==c)za(a.st);else{var d=fa;1!=C[a.st].staffscale&&(c*=C[a.st].staffscale,d=C[a.st].y);if(c!=F.scale||F.dy!=fa)F.scale=c,F.dy=d,F.st=1==C[a.st].staffscale?-1:a.st,F.v=a.v,ad()}}function Ga(a,c){H&&(0>F.st?C[0].output+=H:1==F.scale?C[F.st].output+=H:C[F.st].sc_out+=H,H="");F.scale=0>a?1:c?1:C[a].staffscale;F.st=a;F.dy=0}function he(a,c,d){if(void 0!=a.istart){var e=a.type,f=a.ymx-
a.ymn+4,g=a.wl||2,h=a.wr||2;a.grace&&(e=m.GRACE);d(c||abc2svg.sym_name[e],a.istart,a.iend,a.x-g-2,C[a.st].y+a.ymn+f-2,g+h+4,f,a)}}function yf(a,c){he(a,c,u.anno_start)}function zf(a,c){he(a,c,u.anno_stop)}function yc(){}function cf(){for(var a;;){a=Ya.shift();if(!a)break;switch(a.type){case m.CLEF:case m.METER:case m.KEY:case m.REST:if(a.type!=m.REST||a.rep_nb){za(a.st);break}case m.GRACE:case m.NOTE:case m.MREST:Ma(a)}Xa(a)}}function S(a,c,d,e,f){c=ob(c);d=pb(d);H+=a.replace(/X|Y|A|B|F|G/g,function(a){switch(a){case "X":return c.toFixed(1);
case "Y":return d.toFixed(1);case "A":return e;case "B":return f;case "F":return e.toFixed(1);default:return f.toFixed(1)}})}function Fb(a,c,d,e,f){gb();S('<g transform="translate(X,Y',a,c);d&&(H+=") rotate("+d.toFixed(2));e&&(H=f?H+(") scale("+e.toFixed(2)+", "+f.toFixed(2)):H+(") scale("+e.toFixed(2)));H+=')">\n';F.g++}function bb(){gb();F.g--;H+="</g>\n"}function ob(a){return F.g?a:(a+Tb)/F.scale}function pb(a){return F.g?-a:1==F.scale?fa-a:0<=F.v?(F.dy-a)/D[F.v].scale:F.dy-a}function Qa(a,c,d){a=
ob(a);d=pb(d);H+=a.toFixed(1)+c+d.toFixed(1)}function Jb(a,c,d){d?S('<path d="mX Y',a,c):S('<path class="stroke" d="mX Y',a,c)}function gb(){var a=[];if(sa[0].length){for(;;){var c=sa[0].shift();if(void 0==c)break;a.push(c.toFixed(1))}H+='<text x="'+a.join(",");for(a=[];;){c=sa[1].shift();if(void 0==c)break;a.push(c.toFixed(1))}H+='"\ny="'+a.join(",");H+='"\n>'+sa[2]+"</text>\n";sa[2]=""}if(sa[3].length){for(H+='<path class="sW" d="';;){c=sa[3].shift();if(void 0==c)break;H+="M"+c.toFixed(1)+" "+sa[3].shift().toFixed(1)+
"v"+sa[3].shift().toFixed(1)}H+='"/>\n'}}function Y(a,c,d){if(Gb[d])fe(d),S('<use x="X" y="Y" xlink:href="#A"/>\n',a,c,d);else{var e=Ec[d];e?(a+=e.x*F.scale,c-=e.y,e.sc?S('<text transform="translate(X,Y) scale(A)">B</text>\n',a,c,e.sc,e.c):(sa[0].push(ob(a)),sa[1].push(pb(c)),sa[2]+=e.c)):v(1,null,"no definition of $1",d)}}function ie(a,c,d){var e=25+3*(d/20|0);var f=15<d?(d-15)/e|0:0;S('<path class="stroke" stroke-width="1.2"\n\tstroke-dasharray="5,A"\n\td="mX YhB"/>\n',a+(d-e*f-5)/2,c+6,Math.round((e-
5)/F.scale),e*f+5)}function Gc(a,c,d,e,f,g){var h=e?2.3:3.5,l=-d;0>d&&(h=-h);a+=h*F.scale;0<=F.v&&(l/=D[F.v].scale);sa[3].push(ob(a));sa[3].push(pb(c));sa[3].push(l);if(f){c+=d;if(0<d)if(g)if(H+='<path d="',e)for(;0<=--f;)S("MX Yl3 1.5 0 2 -3 -1.5z\n",a,c),c-=3;else for(;0<=--f;)S("MX Yl7 3.2 0 3.2 -7 -3.2z\n",a,c),c-=5.4;else if(e)if(H+='<path d="',1==f)S("MX Yc0.6 3.4 5.6 3.8 3 10\n\t1.2 -4.4 -1.4 -7 -3 -7\n",a,c);else for(;0<=--f;)S("MX Yc1 3.2 5.6 2.8 3.2 8\n\t1.4 -4.8 -2.4 -5.4 -3.2 -5.2\n",
a,c),c-=3.5;else{Y(a,c,"flu"+f);return}else if(g){if(H+='<path d="',!e)for(;0<=--f;)S("MX Yl7 -3.2 0 -3.2 -7 3.2z\n",a,c),c+=5.4}else if(e)if(H+='<path d="',1==f)S("MX Yc0.6 -3.4 5.6 -3.8 3 -10\n\t1.2 4.4 -1.4 7 -3 7\n",a,c);else for(;0<=--f;)S("MX Yc1 -3.2 5.6 -2.8 3.2 -8\n\t1.4 4.8 -2.4 5.4 -3.2 5.2\n",a,c),c+=3.5;else{Y(a,c,"fld"+f);return}H+='"/>\n'}}function bd(a,c,d){S('<path class="stroke" stroke-width="0.8" d="mX YhF"/>\n',a,c+3,d)}function je(a,c,d,e){if("fng"==d)S('<text x="X" y="Y" style="font-size:14px" text-anchor="middle">A</text>\n',
a,c,dc(e));else{var f=Af[d];f?(a+=f.dx,c+=f.dy,f.def||(ub+="\n."+d+" {"+f.style+"}",f.def=!0),S('<text x="X" y="Y" class="A"B>',a,c,d,f.anchor||""),T("annotation"),H+=Pa(e),H+="</text>\n"):Y(a,c,d)}}function ke(a,c,d){Fb(a,c,270);a=0;for(d=Math.ceil(d/6);0<=--d;)Y(a,6,"ltr"),a+=6;bb()}function le(a,c,d){c+=4;for(d=Math.ceil(d/6);0<=--d;)Y(a,c,"ltr"),a+=6}function cd(a,c,d,e,f){if(me[d])me[d](a,c,e,f);else v(1,null,"No function for decoration '$1'",d)}function ne(a,c){c=fc(a,c);switch(c[0]){case m.OVAL:a=
"\ueca2";break;case m.EMPTY:a="\ueca3";break;default:switch(c[2]){case 2:a="\ueca9";break;case 1:a="\ueca7";break;default:a="\ueca5"}}c[1]&&(a+='<tspan dx=".1em">\uecb7</tspan>');return a}function oe(a){var c,d=0,e=[];if(!a.tempo_str){t.musicfont.used||Ca("music");T("tempo");a.tempo_str1&&(e.push(a.tempo_str1),d+=ya(a.tempo_str1)[0]);if(a.tempo_notes){var f=' dy="-1"';for(c=0;c<a.tempo_notes.length;c++){var g=ne(a,a.tempo_notes[c]);e.push('<tspan\nclass="'+cb(t.musicfont)+'" style="font-size:'+(1.3*
G.curfont.size).toFixed(1)+'px"'+f+">"+g+"</tspan>");g=1<g.length?2:1;d+=g*G.curfont.swfac;f=""}e.push('<tspan dy="1">=</tspan>');d+=Sb("=");a.tempo_ca&&(e.push(a.tempo_ca),d+=ya(a.tempo_ca)[0]);a.tempo?(e.push(a.tempo),d+=ya(a.tempo.toString())[0]):(g=ne(a,a.new_beat),e.push('<tspan\nclass="'+cb(t.musicfont)+'" style="font-size:'+(1.3*G.curfont.size).toFixed(1)+'px" dy="-1">'+g+"</tspan>"),g=1<g.length?2:1,d+=g*G.curfont.swfac,f="y")}a.tempo_str2&&(f?e.push('<tspan\n\tdy="1">'+a.tempo_str2+"</tspan>"):
e.push(a.tempo_str2),d+=ya(a.tempo_str2)[0]);a.tempo_str=e.join(" ");d+=Sb(" ")*(e.length-1);a.tempo_wh=[d,13]}}function wd(a,c,d){T("tempo");if(G.curfont.box){G.curfont.box=!1;var e=c}H+='<text class="'+cb(G.curfont)+'" x="';Qa(c,'" y="',d+.2*G.curfont.size);H+='">'+a.tempo_str+"</text>\n";e&&(G.curfont.box=!0,bh=G.curfont.size+4,H+='<rect class="stroke" x="',Qa(e-2,'" y="',d+bh-1),H+='" width="'+(a.tempo_wh[0]+2).toFixed(1)+'" height="'+bh.toFixed(1)+'"/>\n');a.invis=!0}function ma(a){fa+=a}function $b(){if(!pa&&
H&&u.img_out&&0!=fa){var a='<svg xmlns="http://www.w3.org/2000/svg" version="1.1"\n\txmlns:xlink="http://www.w3.org/1999/xlink"\n\tcolor="',c="";gb();a=t.fgcolor?a+(t.fgcolor+'" fill="'+t.fgcolor+'"'):a+'black"';a+=' stroke-width=".7"';t.bgcolor&&(a+=' style="background-color: '+t.bgcolor+'"');var d=Ca("music");a+=' class="'+cb(d)+" tune"+Lc.length+'"\n';fa*=t.scale;a=u.imagesize?a+(u.imagesize+' viewBox="0 0 '+da.width.toFixed(0)+" "+fa.toFixed(0)+'">\n'):a+(' viewBox="0 0 '+da.width.toFixed(0)+
" "+fa.toFixed(0)+'" width="'+da.width.toFixed(0)+'px" height="'+fa.toFixed(0)+'px">\n');a+=$c;if(ub||vb)a+="<style>\n."+cb(d)+" text,tspan{fill:currentColor}"+vb+ub+"\n</style>\n";xc&&(a+="<defs>"+xc+"\n</defs>\n");1!=t.scale&&(a+='<g class="g" transform="scale('+t.scale.toFixed(2)+')">\n',c="</g>\n");pe&&pe.ps_flush(!0);0<Fa&&(u.img_out(1==Fa?'<div class="nobrk">':'<div class="nobrk newpage">'),Fa=-1);u.img_out(a+H+c+"</svg>");vb=H="";if(t.fullsvg&&"undefined"==typeof document)for(Zc={},d=0;d<Hb.length;d++)Hb[d].used=
!1;else $c=ub="";xc="";fa=0}}function qb(){$b();0>Fa&&(!p.state||t.splittune)&&(u.img_out("</div>"),Fa=0)}function Bf(){function a(a,c){c=new RegExp(c);if(c.test(n.id)||c.test(n.nm))for(c=0;c<a.length;c++)W.do_pscom(a[c])}var c;if(p.voice_opts)for(c in p.voice_opts)p.voice_opts.hasOwnProperty(c)&&a(p.voice_opts[c],c);if(p.tune_v_opts)for(c in p.tune_v_opts)p.tune_v_opts.hasOwnProperty(c)&&a(p.tune_v_opts[c],c)}function ia(a){a.fname||Yb(a);p.last_sym=a;(a.prev=n.last_sym)?n.last_sym.next=a:n.sym=
a;n.last_sym=a;a.v=n.v;a.p_v=n;a.st=n.cst;a.time=n.time;a.dur&&!a.grace&&(n.time+=a.dur);p.ufmt=!0;a.fmt=t;a.pos=n.pos;n.second&&(a.second=!0);n.floating&&(a.floating=!0);n.eoln&&(a.soln=!0,n.eoln=!1)}function Nd(a,c){c={type:c,dur:0};var d=n;n=a;ia(c);n=d;a=c.prev;a||(a=c.next);a&&(c.fname=a.fname,c.istart=a.istart,c.iend=a.iend);return c}function Ed(a){var c,d;n&&n.clone&&(p.istart=p.eol,qe());if((c=na.tempo)&&0>=lb){var e=J.top_voice;var f=D[e];!f.sym||f.sym.type==m.TEMPO||f.sym.next&&f.sym.next.type==
m.TEMPO||(c=x(c),c.v=e,c.p_v=f,c.st=f.st,c.time=0,c.prev=f.sym,c.next=f.sym.next,c.next&&(c.next.prev=c),f.sym.next=c,c.fmt=t)}for(e=0;e<D.length;e++){f=D[e];if(!a)for(delete f.eoln;;){var g=f.sls.shift();if(!g)break;c=g.note.s;for(d=c.next;d&&(!d.bar_type||":"!=d.bar_type[0]);d=d.next);d?(c.sls||(c.sls=[]),c.sls.push({ty:g.ty,note:{s:d}})):v(1,c,"Lack of ending slur(s)")}for(c=f.sym;c&&!(c.time>=lb);c=c.next);for(;c;c=c.next){switch(c.type){case m.GRACE:c.next&&c.next.type==m.BAR&&c.time--;if(!t.graceword)continue;
for(d=c.next;d;d=d.next){switch(d.type){case m.SPACE:continue;case m.NOTE:d.a_ly&&(c.a_ly=d.a_ly,d.a_ly=null)}break}continue;case m.MREST:for(d=c.next;d;d=d.next){switch(d.type){case m.BAR:case m.GRACE:break;default:if(!d.dur)continue}break}d&&d.type==m.BAR||(v(1,c,"Lack of bar after multi-measure rest"),d=x(c),d.type=m.BAR,d.bar_type="|",d.dur=0,d.time=c.next.time,d.prev=c,d.next=c.next,d.next.prev=d,c.next=d);continue}if(c.feathered_beam){var h;var l=c;g=l.dur;var k=1;for(h=l;h&&!h.beam_end&&h.next;h=
h.next)k++;if(1>=k)delete l.feathered_beam;else{var r=h;d=g/2;f=g/(k-1);var A=l.time;if(0<l.feathered_beam)for(h=l,l=k-1;h!=r;h=h.next,l--)g=(f*l|0)+d,h.dur=g,h.time=A,A+=g;else for(h=l,l=0;h!=r;h=h.next,l++)g=(f*l|0)+d,h.dur=g,h.time=A,A+=g;h.dur=h.time+h.dur-A;h.time=A}}}}}function re(a){var c={voices:[],staves:[],top_voice:0};if(a)L=J=c;else{for(a=0;a<D.length;a++)if(J.voices[a]){var d=J.voices[a].st;d=J.staves[d];var e=D[a];d.staffnonote=e.staffnonote;e.staffscale&&(d.staffscale=e.staffscale)}for(d=
0;d<J.staves.length;d++)c.staves[d]=x(J.staves[d]),c.staves[d].flags=0;J=J.next=c}}function se(a,c){var d="";if(c&&3!=c)if("object"!=typeof c)d=["__","_","","^","^^"][c+2];else{var e=c[0];0<e?d+="^":(d+="_",e=-e);d+=e+"/"+c[1]}d+=tb[(a+75)%7];for(e=a;21<=e;e-=7)d+="'";for(e=a;14>e;e+=7)d+=",";return d}function zc(){var a;if(!n.ckey.k_bagpipe&&!n.ckey.k_drum){t.transp&&n.shift&&B(0,"Mix of old and new transposition syntaxes");if(void 0!=t.transp||void 0!=n.transp||void 0!=n.shift)var c=(t.transp||
0)+(n.transp||0)+(n.shift||0);if(void 0!=n.sndtran||void 0!=n.sndsh)var d=(n.sndtran||0)+(n.sndsh||0);if(void 0==c){if(void 0==d)return}else n.vtransp=c;if(sc())n.okey.fmt=t,n.key=a=x(n.okey);else for(a=n.last_sym;a.type!=m.KEY;)if(a=a.prev,!a){a=n.key;break}void 0!=c&&(a.k_transp=c);void 0!=d&&(a.k_sndtran=d);n.ckey=x(a);n.key.k_none&&(a.k_sf=0)}}function Gd(a,c,d){var e=d.pit;var f=d.acc;!f&&c.k_a_acc&&(f=c.k_map[(e+19)%7]);e=abc2svg.pab40(e,f)+c.k_transp;d.pit=abc2svg.b40p(e);if(f||c.k_a_acc||
c.k_none){e=abc2svg.b40a(e);if(f)c.k_a_acc&&(a=c.k_map[(d.pit+19)%7],a==e&&(e=0)),e||(e=3);else if(c.k_none){if(te(a,d.pit))return}else if(c.k_a_acc){if(te(a,d.pit))return;(a=c.k_map[(d.pit+19)%7])&&(e=3)}else return;d.acc=e}}function ue(a){if("0"==a[0])return 0;if(0<="123456789-+".indexOf(a[0])){var c=parseInt(a);if(isNaN(c)||-36>c||36<c)B(1,K.bad_transp);else return c+=36,40*((c/12|0)-3)+("b"==a.slice(-1)?abc2svg.ifb40:abc2svg.isb40)[c%12]}}function Fd(a){if(!a.k_a_acc&&!a.k_none){var c,d=(a.k_b40+
200+a.k_transp)%40;if(c=abc2svg.b40k[d]-d)a.k_transp=0<a.k_transp?a.k_transp+c:a.k_transp-c,d+=c;a.k_b40=d;c=abc2svg.b40sf[d];a.k_old_sf=a.k_sf;a.k_sf=c;a.k_map=abc2svg.keys[c+7]}}function te(a,c){var d,e=a.time;for(a=a.prev;a;a=a.prev)switch(a.type){case m.BAR:if(a.time<e)return;for(;;){a=a.prev;if(!a)return;if(a.type==m.NOTE){if(a.time+a.dur==e)break;return}if(a.time<e)return}for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==c&&a.notes[d].tie_ty)return a.notes[d].acc;return;case m.NOTE:for(d=0;d<=a.nhd;d++)if(a.notes[d].pit==
c)return a.notes[d].acc}}function $d(a){var c;for(c=0;c<D.length;c++){var d=D[c];if(d.id==a)return d}d=x(n);d.v=D.length;d.id=a;d.sym=d.last_sym=null;d.key=x(n.key);d.sls=[];delete d.nm;delete d.snm;delete d.new_name;delete d.lyric_restart;delete d.lyric_cont;delete d.sym_restart;delete d.sym_cont;delete d.have_ly;delete d.tie_s;D.push(d);return d}function Ob(a){var c;if("|"==a||")"==a)n.last_note?(n.last_note.beam_end=!0,ca?(n.time!=ca.p_voice.time&&(B(1,"Wrong duration in voice overlay"),n.time>
ca.p_voice.time&&(ca.p_voice.time=n.time)),n.acc=[],n=ca.p_voice,ca=null):B(1,"Erroneous end of voice overlay")):B(1,K.nonote_vo);else if("("==a)ca?B(1,"Voice overlay already started"):ca={p_voice:n,time:n.time};else if(n.last_note){n.last_note.beam_end=!0;var d=n.voice_down;if(!d){d=$d(n.id+"o");n.voice_down=d;d.time=0;d.second=!0;var e=d.v;J.voices[e]={st:n.st,second:!0};var f=J.voices[n.v].range;for(c=0;c<J.voices.length;c++)J.voices[c]&&J.voices[c].range>f&&J.voices[c].range++;J.voices[e].range=
f+1}d.ulen=n.ulen;d.dur_fact=n.dur_fact;d.acc=[];if(ca)n!=ca.p_voice&&n.time!=ca.p_voice.time&&(B(1,"Wrong duration in voice overlay"),n.time>ca.p_voice.time&&(ca.p_voice.time=n.time));else{ca={bar:!0,p_voice:n};c=d.time;for(f=n.last_sym;!(f.type==m.BAR||f.time<=c);f=f.prev);ca.time=f.time}d.time=ca.time;n=d;ca.bar&&ca.time&&ia({type:m.BAR,bar_type:a,dur:0,multi:0})}else B(1,K.nonote_vo)}function sc(){var a;if(0!=n.time)return!1;for(a=n.last_sym;a;a=a.prev)if(0!=La[a.type])return!1;return!0}function ve(a){if(sc())n.clef=
a,a.fmt=t;else{ia(a);a.clef_small=!0;var c=a.prev;c&&c.type==m.BAR&&":"!=c.bar_type[0]&&(a.next=c,a.prev=c.prev,a.prev&&(a.prev.next=a),c.prev=a,c.next=null,n.last_sym=c,a.soln&&(delete a.soln,n.eoln=!0))}}function dd(a){var c,d=D.length;if(1==d&&D[0].default&&(delete D[0].default,0==D[0].time)){var e=D[0];e.id=a;t.transp&&2<=p.state&&(a=n,n=e,zc(),n=a);return e}for(c=0;c<d;c++)if(e=D[c],e.id==a)return e;e={v:c,id:a,time:0,new:!0,pos:{},scale:1,ulen:na.ulen,dur_fact:1,key:x(p.ckey),ckey:x(p.ckey),
okey:x(p.ckey),meter:x(na.meter),wmeasure:na.meter.wmeasure,staffnonote:1,clef:{type:m.CLEF,clef_auto:!0,clef_type:"a",time:0},acc:[],sls:[],hy_st:0};D.push(e);return e}function Hd(){P=-1;D=[];n=null;re(!0);lb=-1;G={};ba=[];Db={}}function qe(){var a=n.clone;var c=a.vs,d=a.a,e=a.bol,f=p.istart,g=p,h=p.file;delete n.clone;"["==h[f-1]&&f--;db++;for(a=0;a<c.length;a++)p=Object.create(g),p.line=Object.create(g.line),Uc(c[a],d),Kc(p.fname,h,e,f);db--;p=g}function Uc(a){var c=Zb(a),d=c.shift();if(d)if(n&&
n.clone&&qe(),a=0<d.indexOf(",")?d.split(","):[d],2>p.state)for(;;){d=a.shift();if(!d)break;c.length&&Ic(d,c);"*"!=d&&1==p.state&&(n=dd(d))}else"*"==d?B(1,"Cannot have V:* in tune body"):(n=dd(a[0]),1<a.length&&(a.shift(),n.clone={vs:a,a:c,bol:p.iend},"]"!=p.file[n.clone.bol-1]&&n.clone.bol++),ic(c),2==p.state&&Da(),zc(),a=n.v,n.new&&(delete n.new,0>lb&&(n.st=n.cst=++P,J.nstaff=P,J.voices[a]={st:P,range:a},J.staves[P]={stafflines:n.stafflines||"|||||",staffscale:1})),!n.filtered&&J.voices[a]&&(p.voice_opts||
p.tune_v_opts)&&(n.filtered=!0,Bf()))}function Da(a){var c={type:m.STAVES,dur:0,sy:J};Ia();var d;var e=Vb();ma(t.topspace);if(t.titleformat){var f,g,h;var l={};var k=x(Cf);var r={A:t.infospace,C:t.composerspace,O:t.composerspace,R:t.infospace};var A={};var u="";var z=t.titleformat;for(d=0;;){for(;" "==z[d];)d++;var q=z[d++];if(!q)break;if("A">q||"Z"<q)switch(q){case "+":var y="+";q=z[d++];break;case ",":u+="\n";default:continue;case "<":y="l";q=z[d++];break;case ">":y="r",q=z[d++]}else switch(z[d]){case "-":y=
"l";d++;break;case "1":y="r";d++;break;case "0":d++;default:y="c"}if(l[q])A[q]++;else{if(!Q[q])continue;l[q]=Q[q].split("\n");A[q]=1}u+=y+q}var v={l:t.titlespace,c:t.titlespace,r:t.titlespace};e={l:0,c:.5*e,r:e};var B={},C;z=u+"\n";for(d=0;;){B.l=B.c=B.r=h=0;for(g=d;;){y=z[g++];if("\n"==y)break;q=z[g++];if("+"!=y&&!B[y]&&(C=l[q])){(f=k[q])||(f="history");u=Ca(f);var E=1.1*u.size;r[q]&&(E+=r[q]);h<E&&(h=E);B[y]=E}}v.l+=h-B.l;v.c+=h-B.c;for(v.r+=h-B.r;;){y=z[d++];if("\n"==y)break;q=z[d++];if(l[q].length){C=
l[q].shift();"+"==z[d]&&(A[q]--,d++,q=z[d++],l[q].length&&(C=C?C+(" "+l[q].shift()):" "+l[q].shift()));(f=k[q])||(f="history");u=Ca(f);E=1.1*u.size;r[q]&&(E+=r[q]);T(u);g=e[y];h=v[y]+E;"Q"==q?(W.set_width(na.tempo),na.tempo.invis||("l"!=y&&(oe(na.tempo),w=na.tempo.tempo_wh[0],"c"==y&&(w*=.5),g-=w),wd(na.tempo,g,-h))):C&&("T"==q&&(C=de(C,"s"==k.T[0])),R(g,-h,C,y));"T"==q&&(f=k.T="subtitle",r.T=t.subtitlespace);if(1>=A[q])for("T"==q&&(u=Ca(f),E=1.1*u.size,r[q]&&(E+=r[q]),T(u));0<l[q].length;)h+=E,C=
l[q].shift(),R(g,-h,C,y);A[q]--;v[y]=h}}v.c>v.l&&(v.l=v.c);v.r>v.l&&(v.l=v.r);if(d>=z.length)break;v.c=v.r=v.l}ma(v.l);ma(t.musicspace)}else{if(Q.T&&0<=t.writefields.indexOf("T"))for(q=0;;){y=Q.T.indexOf("\n",q);if(0>y){Yc(Q.T.substring(q),0!=q);break}Yc(Q.T.slice(q,y),0!=q);q=y+1}z=0;p.ckey.k_bagpipe&&!t.infoline&&0<=t.writefields.indexOf("R")&&(A=Q.R);A&&(T("composer"),R(0,-t.composerspace,A),z=t.composerspace);l=Q.A;0<=t.writefields.indexOf("C")&&(k=Q.C);0<=t.writefields.indexOf("O")&&(r=Q.O);
if(k||r||t.infoline){T("composer");ma(t.composerspace);0>t.aligncomposer?(v=0,B=" "):0==t.aligncomposer?(v=.5*e,B="c"):(v=e,B="r");d=z;if(k||r){0<=t.aligncomposer&&z!=d&&ma(z-d);for(q=0;;){ma(G.curfont.size);y=k?k.indexOf("\n",q):-1;if(0>y){ee(v,0,k?k.substring(q):null,r,B);break}R(v,0,k.slice(q,y),B);z+=G.curfont.size;q=y+1}d>z&&ma(d-z)}((A=A?null:Q.R)||l)&&t.infoline&&(T("info"),ma(G.curfont.size+t.infospace),ee(e,0,A,l,"r"),z+=G.curfont.size+t.infospace)}else d=t.composerspace;Q.P&&0<=t.writefields.indexOf("P")&&
(T("parts"),z=t.partsspace+G.curfont.size-z,0<z&&(d+=z),.01<d&&ma(d),R(0,0,Q.P),d=0);ma(d+t.musicspace)}na.new_nbar?(G.nbar=na.new_nbar,na.new_nbar=0):G.nbar=1;p.state=3;D.length?n||(n=D[0>lb?0:J.top_voice]):(Uc("1"),n.clef.istart=n.key.istart,n.clef.iend=n.key.iend,n.default=!0);n.init||a||(ic([]),zc());for(a=0;a<D.length;a++)e=D[a],e.ulen=na.ulen,e.ckey.k_bagpipe&&!e.pos.stm&&(e.pos=x(e.pos),e.pos.stm&=-8,e.pos.stm|=m.SL_BELOW);if(0>lb){P=D.length-1;for(a=0;a<=P;a++)e=D[a],delete e.new,e.st=e.cst=
a,J.voices[a]={st:a,range:a},J.staves[a]={stafflines:e.stafflines||"|||||",staffscale:1};J.nstaff=P}e=n;n=D[J.top_voice];ia(c);n=e}function jf(a,c){var d;if(!n.ignore){if(c){if(c=n.sym_cont,!c){B(1,"+: symbol line without music");return}}else if(n.sym_restart?(n.sym_start=c=n.sym_restart,n.sym_restart=null):c=n.sym_start,c||(c=n.sym),!c){B(1,"s: without music");return}for(d=0;;){for(;" "==a[d]||"\t"==a[d];)d++;var e=a[d];if(!e)break;switch(e){case "|":for(;c&&c.type!=m.BAR;)c=c.next;if(!c){B(1,"Not enough measure bars for symbol line");
return}c=c.next;d++;continue;case "!":case '"':var f=++d;d=a.indexOf(e,f);if(0>d){B(1,"!"==e?"No end of decoration":"No end of guitar chord");d=a.length;continue}var g=a.slice(f-1,d+1);break;case "*":break;default:g=e.charCodeAt(0);if(128>g&&(g=Aa[g],1<g.length&&("!"==g[0]||'"'==g[0]))){e=g[0];break}B(1,K.bad_char,e)}for(;c&&(c.type!=m.NOTE||c.grace);)c=c.next;if(!c){B(1,"Too many elements in symbol line");return}switch(e){case "!":la.push(g.slice(1,-1));Eb(c,c.prev);break;case '"':ae(g),kb&&tc(c)}c=
c.next;d++}n.sym_cont=c}}function kf(a,c){var d;if(!n.ignore){(n.pos.voc&7)!=m.SL_HIDDEN&&(n.have_ly=!0);if(c){c=n.lyric_cont;if(!c){B(1,"+: lyric without music");return}var e=Ca("vocal");G.deffont!=e&&(G.curfont==G.deffont&&(G.curfont=e),G.deffont=e)}else if(T("vocal"),n.lyric_restart?(n.lyric_start=c=n.lyric_restart,n.lyric_restart=null,n.lyric_line=0):(n.lyric_line++,c=n.lyric_start),c||(c=n.sym),!c){B(1,"w: without music");return}e=0;for(d=G.curfont;;){for(;" "==a[e]||"\t"==a[e];)e++;if(!a[e])break;
var f=0;var g=p.istart+e+2;switch(a[e]){case "|":for(;c&&c.type!=m.BAR;)c=c.next;if(!c){B(1,"Not enough measure bars for lyric line");return}c=c.next;e++;continue;case "-":case "_":var h=a[e];f=2;break;case "*":h="";break;default:for(h="";a[e];){switch(a[e]){case "_":case "*":case "|":e--;case " ":case "\t":break;case "~":h+="\u00a0";e++;continue;case "-":f=1;break;case "\\":if(!a[++e])continue;h+=a[e++];continue;case "$":h+=a[e++];var l=a[e];"0"==l?G.curfont=G.deffont:"1"<=l&&"9">=l&&(G.curfont=
Ca("u"+l));default:h+=a[e++];continue}break}}for(;c&&(c.type!=m.NOTE||c.grace);)c=c.next;if(!c){B(1,"Too many words in lyric line");return}h&&(c.pos.voc&7)!=m.SL_HIDDEN&&(h={t:h,font:d,istart:g,iend:g+h.length},f&&(h.ln=f),c.a_ly||(c.a_ly=[]),c.a_ly[n.lyric_line]=h,d=G.curfont);c=c.next;e++}n.lyric_cont=c}}function lc(a){var c,d,e,f,g=a,h=0,l=0,k=0,n=0,p=a.a_ly,t=0;for(e=a.ts_next;e;e=e.ts_next){e.shrink&&(n+=e.shrink,k++);if(e.bar_type){n+=3;break}if(e.a_ly){for(c=e.a_ly.length;0<=--c&&(!(d=e.a_ly[c])||
2==d.ln););if(0<=c)break}}for(c=0;c<p.length;c++)if(d=p[c])if(G.curfont=d.font,d.t=f=Pa(d.t),2==d.ln)d.shift=0;else{var z=Xc(" ")*d.font.swfac;var q=f.wh[0]+1.5*z;if(a.type==m.GRACE)var y=a.wl;else"0"<=f[0]&&"9">=f[0]&&2<f.length||":"==f[1]||"("==f[0]||")"==f[0]?("("!=f[0]&&(z=f.indexOf("\u00a0"),T(d.font),z=0<z?ya(f.slice(0,z))[0]:.2*q),q-=z,y=.4*q,14<y&&(y=14),y+=z,"0"<=f[0]&&"9">=f[0]&&y>t&&(t=y)):(y=.4*q,14<y&&(y=14));d.shift=y;y>l&&(l=y);q-=y;q>h&&(h=q)}for(;!g.seqst;)g=g.ts_prev;g.ts_prev.bar_type&&
(l-=4);g.wl<l&&(g.shrink+=l-g.wl,g.wl=l);n-=6;if(n<h)for(n=(h-n)/k,a=a.ts_next;;){a.shrink&&(a.shrink+=n,g.wr+=n,g=a);if(a==e)break;a=a.ts_next}if(0<t)for(c=0;c<p.length;c++)(d=p[c])&&"0"<=d.t[0]&&"9">=d.t[0]&&(d.shift=t)}function we(a,c,d){var e,f,g;if(a.hy_st&1<<c){var h=!0;a.hy_st&=~(1<<c)}for(e=a.sym;e.type==m.CLEF||e.type==m.KEY||e.type==m.METER;e=e.next);var l=e.prev?e.prev.x:N.x;for(g=0;e;e=e.next)if(f=e.a_ly?e.a_ly[c]:null){f.font!=G.curfont&&(G.curfont=f.font);var k=f.t;var n=k.wh[0];var p=
f.shift;h&&(2==f.ln&&"_"==k?k="-":2!=f.ln&&(ie(l,d,e.x-p-l),h=!1,l=e.x+e.wr));if(t&&(2!=f.ln||"_"!=k)){bd(l+3,d,g-l+3);var t=!1;l=e.x+e.wr}if(2==f.ln)0==g&&l>e.x-18&&(l=e.x-18),"-"==k?h=!0:t=!0,g=e.x-p;else{g=e.x-p;f.ln&&(h=!0);if(u.anno_start||u.anno_stop){var z={st:e.st,istart:f.istart,iend:f.iend,x:g,y:d,ymn:d,ymx:d+G.curfont.size,wl:0,wr:n};Ha(z,"lyrics")}R(g,d,k);Xa(z,"lyrics");l=g+n}}else switch(e.type){case m.REST:case m.MREST:t&&(bd(l+3,d,g-l),t=!1,l=e.x+e.wr)}h&&(g=ua-10,g<l+10&&(g=l+10),
ie(l,d,g-l),a.s_next&&a.s_next.fmt.hyphencont&&(a.hy_st|=1<<c));for(a.s_next;e;e=e.next)if(e.type==m.NOTE){if(!e.a_ly)break;(f=e.a_ly[c])&&f.ln&&"_"==f.t&&(t=!0,g=ua-15,g<l+12&&(g=l+12));break}t&&bd(l+3,d,g-l+3)}function xe(a,c,d,e,f){var g=C[a.st].staffscale;T("vocal");if(0<f){e>-N.fmt.vocalspace&&(e=-N.fmt.vocalspace);e*=g;for(f=0;f<c;f++)e-=1.1*d[f],we(a,f,e);return(e-d[f-1]/6)/g}f=C[a.st].topbar+N.fmt.vocalspace;e<f&&(e=f);e*=g;for(f=c;0<=--f;)we(a,f,e),e+=1.1*d[f];return e/g}function Ye(){var a,
c,d,e,f,g=Array(P+1),h=D.length,l=Array(h),k=Array(h),n=Array(h),p=Array(h),t=0,z=0,q=-1;for(c=0;c<h;c++){var y=D[c];if(y.sym){y.st!=q&&(z=t=0,q=y.st);var v=0;if(y.have_ly)for(l[c]||(l[c]=[]),a=y.sym;a;a=a.next){if(e=a.a_ly){var u=a.x;var x=10;for(d=0;d<e.length;d++)if(f=e[d]){u-=f.shift;x=f.t.wh[0];break}d=ea(y.st,1,u,x);t<d&&(t=d);d=ea(y.st,0,u,x);for(z>d&&(z=d);v<e.length;)l[c][v++]=0;for(d=0;d<e.length;d++)(f=e[d])&&(!l[c][d]||f.t.wh[1]>l[c][d])&&(l[c][d]=f.t.wh[1])}}else d=ea(y.st,1,0,ua),t<
d&&(t=d),d=ea(y.st,0,0,ua),z>d&&(z=d);g[q]||(g[q]={});g[q].top=t;g[q].bot=z;k[c]=v;0!=v&&(n[c]=y.pos.voc?(y.pos.voc&7)==m.SL_ABOVE:D[c+1]&&D[c+1].st==q&&D[c+1].have_ly?!0:!1,n[c]?g[q].a=!0:g[q].b=!0)}}for(c=d=0;c<h;c++)y=D[c],y.sym&&y.have_ly&&(n[c]?p[d++]=c:(q=y.st,Ga(q,!0),0<k[c]&&(g[q].bot=xe(y,k[c],l[c],g[q].bot,1))));for(;0<=--d;)c=p[d],y=D[c],q=y.st,Ga(q,!0),g[q].top=xe(y,k[c],l[c],g[q].top,-1);for(c=0;c<h;c++)if(y=D[c],y.sym){q=y.st;if(g[q].a)for(t=g[q].top+2,a=y.sym.next;a;a=a.next)a.a_ly&&
X(q,1,a.x-2,10,t);if(g[q].b)if(z=g[q].bot-2,0<k[y.v])for(a=y.sym.next;a;a=a.next)a.a_ly&&X(q,0,a.x-2,10,z);else X(q,0,0,ua,z)}}function ae(a){function c(){for(var a="";;){r=l[d++];if(0>"1234567890.-".indexOf(r))return parseFloat(a);a+=r}}var d,e=Ca("annotation"),f=e.size;var g=p.line;var h=p.bol+g.index;if(1<a.length){var l=a.slice(1,-1);var k=h+1}else{for(d=++g.index;;){a=g.buffer.indexOf('"',d);if(0>a){B(1,"No end of guitar chord");return}if("\\"!=g.buffer[a-1])break;d=a+1}l=Dd(g.buffer.slice(g.index,
a));g.index=a;k=p.bol+g.index+1}e.pad&&(f+=e.pad);d=0;for(a="g";;){var r=l[d];if(!r)break;g={text:"",istart:h,iend:k,font:e};switch(r){case "@":a=r;d++;var t=c();if(","!=r){B(1,"',' lacking in annotation '@x,y'");var v=0}else v=c()," "!=r&&d--;g.x=t;v-=.3*f;g.y=v;break;case "^":g.pos=m.SL_ABOVE;case "_":"_"==r&&(g.pos=m.SL_BELOW);case "<":case ">":d++;a=r;break;default:switch(a){case "g":g.font=Ca("gchord");g.pos=n.pos.gch||m.SL_ABOVE;break;case "^":g.pos=m.SL_ABOVE;break;case "_":g.pos=m.SL_BELOW;
break;case "@":g.x=t,v-=f,g.y=v}}for(g.type=a;;){r=l[d];if(!r)break;switch(r){case "\\":r=l[++d];if(!r||"n"==r)break;g.text+="\\";default:g.text+=r;d++;continue;case "&":for(;;){g.text+=r;r=l[++d];switch(r){default:continue;case ";":case void 0:case "\\":}break}if(";"==r){d++;g.text+=r;continue}case ";":}d++;break}g.otext=g.text;kb||(kb=[]);kb.push(g)}}function ye(a,c){var d,e,f=a.split("/");for(d=0;d<f.length;d++){a=f[d];var g=a.search(/[A-G]/);if(!(0>g)){var h=g+1;for(e=0;"#"==a[h]||"\u266f"==a[h];)e++,
h++;for(;"b"==a[h]||"\u266d"==a[h];)e--,h++;var l=ze.indexOf(a[g])+16;l=(abc2svg.pab40(l,e)+c+200)%40;l=abc2svg.b40k[l];f[d]=a.slice(0,g)+ze[abc2svg.b40_p[l]]+Df[abc2svg.b40_a[l]+2]+a.slice(h)}}return f.join("/")}function tc(a){a.a_gch=a.a_gch?a.a_gch.concat(kb):kb;kb=null;if(n.vtransp)for(var c,d=a.a_gch.length;0<=--d;)c=a.a_gch[d],"g"==c.type&&(c.text=ye(c.text,n.vtransp))}function Qe(){function a(a){var c,d,f;for(d=e;d;d=d.ts_next)if(c=d.a_gch){var g=c.length-a-1;if(c=c[g]){if(c.pos==m.SL_ABOVE){var h=
d.x+c.x;(f=c.text.wh[0])&&h+f>ua&&(h=ua-f);f=ea(d.st,1,h,f);"g"==c.type&&f<l[d.st].yup&&(f=l[d.st].yup)}else if(c.pos==m.SL_BELOW||c.pos==m.SL_HIDDEN)continue;else h=d.x+c.x,f=c.y;W.draw_gchord(g,d,h,f)}}}function c(a){for(var c,d,f,g=e;g;g=g.ts_next)(c=g.a_gch)&&(c=c[a])&&c.pos==m.SL_BELOW&&(d=g.x+c.x,(f=c.text.wh[0])&&d+f>ua&&(d=ua-f),f=ea(g.st,0,d,f),"g"==c.type&&f>l[g.st].ydn&&(f=l[g.st].ydn),W.draw_gchord(a,g,d,f))}var d,e,f,g,h=0,l=Array(P+1);for(g=0;g<=P;g++)l[g]={ydn:C[g].botbar-3,yup:C[g].topbar+
4};for(d=N;d;d=d.ts_next)if(f=d.a_gch)for(e||(e=d),g=f.length,g>h&&(h=g);0<=--g;)if("g"==f[g].type){f=f[g];g=f.text.wh[0];f.pos==m.SL_ABOVE?(f=ea(d.st,!0,d.x,g),f>l[d.st].yup&&(l[d.st].yup=f)):f.pos==m.SL_BELOW&&(f=ea(d.st,!1,d.x,g),f<l[d.st].ydn&&(l[d.st].ydn=f));break}if(e)for(Ga(-1),g=0;g<h;g++)a(g),c(g)}function hf(){function a(a){for(var c=0;c<a.length;c++)a[c](W)}var c=abc2svg.modules.hooks,d=abc2svg.modules.g_hooks;Ae?c.length&&(a(c),d.push.apply(d,c),abc2svg.modules.hooks=[]):(c.length&&(d.push.apply(d,
c),abc2svg.modules.hooks=[]),a(d),Ae=!0)}var m=abc2svg.C,ta,K={bad_char:"Bad character '$1'",bad_grace:"Bad character in grace note sequence",bad_transp:"Bad transpose value",bad_val:"Bad value in $1",bar_grace:"Cannot have a bar in grace notes",ignored:"$1: inside tune - ignored",misplaced:"Misplaced '$1' in %%score",must_note:"!$1! must be on a note",must_note_rest:"!$1! must be on a note or a rest",nonote_vo:"No note in voice overlay",not_ascii:"Not an ASCII character",not_enough_n:"Not enough notes/rests for %%repeat",
not_enough_m:"Not enough measures for %%repeat",not_enough_p:"Not enough parameters in %%map",not_in_tune:"Cannot have '$1' inside a tune",notransp:"Cannot transpose with a temperament"},W=this,na={meter:{type:m.METER,wmeasure:1,a_meter:[]}},Q={},p={ctx:{},prefix:"%",state:0,ottava:[],line:new I},Lc=[],pe,Cb={},ba,Db,Bc={dot:"0 stc 5 1 1",tenuto:"0 emb 5 3 3",slide:"1 sld 3 7 0",arpeggio:"2 arp 12 10 0",roll:"3 roll 3,3 6 6",fermata:"3 hld 5,5 7 7",emphasis:"3 accent 3.5,3.5 4 4",lowermordent:"3 lmrd 4,4 5 5",
coda:"3 coda 24 10 10",uppermordent:"3 umrd 4,4 5 5",segno:"3 sgno 22 8 8",trill:"3 trl 14 5 5",upbow:"3 upb 10 5 5",downbow:"3 dnb 9 5 5",gmark:"3 grm 6 5 5",wedge:"0 wedge 7 3 3",turnx:"3 turnx 5,5 6 6",breath:"3 brth 0 1 20",longphrase:"3 lphr 0 1 1",mediumphrase:"3 mphr 0 1 1",shortphrase:"3 sphr 0 1 1",invertedfermata:"3 hld 5,5 7 7",invertedturn:"3 turn 5,5 6 6",invertedturnx:"3 turnx 5,5 6 6",0:"3 fng 5,5 3 3 0",1:"3 fng 5,5 3 3 1",2:"3 fng 5,5 3 3 2",3:"3 fng 5,5 3 3 3",4:"3 fng 5,5 3 3 4",
5:"3 fng 5,5 3 3 5",plus:"3 dplus 7 3 3","+":"3 dplus 7 3 3",accent:"3 accent 3.5,3.5 4 4",">":"3 accent 3.5,3.5 4 4",marcato:"3 marcato 9 3 3","^":"3 marcato 9 3 3",mordent:"3 lmrd 4,4 5 5",open:"3 opend 10 3 3",snap:"3 snap 14 3 3",thumb:"3 thumb 14 3 3",dacapo:"3 dacs 16 20 20 Da Capo",dacoda:"3 dacs 16 20 20 Da Coda","D.C.":"3 dcap 16 10 10","D.S.":"3 dsgn 16 10 10","D.C.alcoda":"3 dacs 16 38 38 D.C. al Coda","D.S.alcoda":"3 dacs 16 38 38 D.S. al Coda","D.C.alfine":"3 dacs 16 38 38 D.C. al Fine",
"D.S.alfine":"3 dacs 16 38 38 D.S. al Fine",fine:"3 dacs 16 10 10 Fine",turn:"3 turn 5,5 6 6","trill(":"3 ltr 8 4 0","trill)":"3 ltr 8 4 0",f:"6 f 18 4 4",ff:"6 ff 18 6 6",fff:"6 fff 18 9 9",ffff:"6 ffff 18 12 12",mf:"6 mf 18 9 9",mp:"6 mp 18 10 10",p:"6 p 18 5 5",pp:"6 pp 18 9 9",ppp:"6 ppp 18 13 13",pppp:"6 pppp 18 17 17",pralltriller:"3 umrd 4,4 5 5",sfz:"6 sfz 18 8 8",ped:"4 ped 18 6 10","ped-up":"4 pedoff 12 4 4","ped(":"4 lped 20 5 5","ped)":"4 lped 20 5 5","crescendo(":"6 cresc 18 0 0","crescendo)":"6 cresc 18 0 0",
"<(":"6 cresc 18 0 0","<)":"6 cresc 18 0 0","diminuendo(":"6 dim 18 0 0","diminuendo)":"6 dim 18 0 0",">(":"6 dim 18 0 0",">)":"6 dim 18 0 0","-(":"8 gliss 0 0 0","-)":"8 gliss 0 0 0","~(":"8 glisq 0 0 0","~)":"8 glisq 0 0 0","8va(":"3 8va 10 0 0","8va)":"3 8va 10 0 0","8vb(":"4 8vb 10 0 0","8vb)":"4 8vb 10 0 0","15ma(":"3 15ma 10 0 0","15ma)":"3 15ma 10 0 0","15mb(":"4 15mb 10 0 0","15mb)":"4 15mb 10 0 0",invisible:"32 0 0 0 0",beamon:"33 0 0 0 0",trem1:"34 0 0 0 0",trem2:"34 0 0 0 0",trem3:"34 0 0 0 0",
trem4:"34 0 0 0 0",xstem:"35 0 0 0 0",beambr1:"36 0 0 0 0",beambr2:"36 0 0 0 0",rbstop:"37 0 0 0 0","/":"38 0 0 6 6","//":"38 0 0 6 6","///":"38 0 0 6 6","beam-accel":"39 0 0 0 0","beam-rall":"39 0 0 0 0",stemless:"40 0 0 0 0",rbend:"41 0 0 0 0",editorial:"42 0 0 0 0","sacc-1":"3 sacc-1 6,4 4 4",sacc3:"3 sacc3 6,5 4 4",sacc1:"3 sacc1 6,4 4 4",courtesy:"43 0 0 0 0","cacc-1":"3 cacc-1 0 0 0",cacc3:"3 cacc3 0 0 0",cacc1:"3 cacc1 0 0 0","tie(":"44 0 0 0 0","tie)":"44 0 0 0 0"},ld=[function(a){var c,d=
a.s,e=a.dd;if(!e.str){if(c="^"==e.ty?1:"_"==e.ty?0:d.multi?0<d.multi:0>d.stem)var f=d.ymx|0;else"w"==e.name[0]?(a.inv=!0,f=d.ymn):f=d.ymn-e.h;-6<f&&24>f&&(c&&(f+=3),f=6*((f+6)/6|0)-6);c?d.ymx=f+e.h:d.ymn="w"==e.name[0]?f-e.h:f;a.y=f;d.type==m.NOTE&&(a.x+=d.notes[0<=d.stem?0:d.nhd].shhd);"d"==e.name[0]&&-1<=d.nflags&&(c?0<d.stem&&(a.x+=3.5):0>d.stem&&(a.x-=3.5))}},function(a){var c,d=a.s,e=d.notes[0].pit,f=5;for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=4+d.notes[c].shac;else switch(g=5-d.notes[c].shhd,
d.head){case m.SQUARE:g+=3.5;break;case m.OVALBARS:case m.OVAL:g+=2}d.notes[c].pit<=e+3&&g>f&&(f=g)}a.x-=f;a.y=3*(e-18)},function(a){var c,d=a.s,e=a.dd,f=5;if(d.type==m.NOTE)for(c=0;c<=d.nhd;c++){if(d.notes[c].acc)var g=5+d.notes[c].shac;else switch(g=6-d.notes[c].shhd,d.head){case m.SQUARE:g+=3.5;break;case m.OVALBARS:case m.OVAL:g+=2}g>f&&(f=g)}g=3*(d.notes[d.nhd].pit-d.notes[0].pit)+4;c=e.h;g<c&&(g=c);a.has_val=!0;a.val=g;a.x-=f;a.y=3*(d.notes[0].pit-18)-3}],md=[null,null,null,Ac,Ac,id],$a=[null,
null,null,null,null,null,function(a){var c,d=a.s,e=a.dd;if(!a.ldst)if((a.pos&m.SL_ALI_MSK)==m.SL_CLOSE||0==(a.pos&m.SL_ALI_MSK)&&0>d.fmt.dynalign)Ac(a);else if(a.start)hd(a);else{a.val=e.wl+e.wr;if(c=bc(d,a.pos))a.up=!0;var f=d.x;if(0<a.ix){var g=ba[a.ix-1];if(g.s==d&&(a.up&&!g.up||!a.up&&g.up)){var h=g.dd;$a[h.func]&&(h=g.x+g.val+4,h>f&&(f=h))}}a.x=f;a.y=ea(d.st,c,f,a.val);c||(a.y-=e.h)}},hd];Abc.prototype.draw_all_deco=function(){if(ba.length){var a,c,d=[],e=[];var f=P;for(c=C[f].y;0<=--f;){var g=
C[f].y;e[f]=.5*(c+24+g);c=g}for(;;){var h=ba.shift();if(!h)break;if((a=h.dd)&&!a.dd_en){var l=h.s;var k=a.glyph;var n=k.indexOf("/");0<n&&(k=0<=l.stem?k.slice(0,n):k.slice(n+1));$a[a.func]?za(l.st):Ma(l);f=h.st;if(C[f].topbar){n=h.x;c=h.y+C[f].y;if(void 0!=h.m)f=l.notes[h.m],f.shhd&&(n+=f.shhd*F.scale);else if($a[a.func]&&((h.pos&m.SL_ALI_MSK)==m.SL_CENTER||0==(h.pos&m.SL_ALI_MSK)&&!l.fmt.dynalign)&&(h.up&&0<f||!h.up&&f<P)){var p=h.up?e[--f]:e[f++];p-=.5*a.h;if(h.up&&c<p||!h.up&&c>p)if(g=ea(f,!h.up,
h.x,h.val)+C[f].y,h.up&&(g-=a.h),h.up&&g>p||!h.up&&g<p)c=p}if((f=u[k])&&"function"==typeof f)f(n,c,h);else if(!W.psdeco(k,n,c,h)){Ha(l,"deco");h.inv&&(Fb(n,c,0,1,-1),n=c=0);if(h.has_val)2!=a.func||0>F.st?cd(n,c,k,h.val/F.scale,h.defl):cd(n,c,k,h.val,h.defl),h.cont&&d.push(h.start);else if(void 0!=a.str)h=a.str,"@"==h[0]&&(a=h.match(/^@([0-9.-]+),([0-9.-]+);?/),n+=Number(a[1]),c+=Number(a[2]),h=h.replace(a[0],"")),je(n,c,k,h);else if(h.lden)if(k=h.dd.glyph,Be[k])Be[k](n,c,h);else v(1,null,"No function for decoration '$1'",
k);else Y(n,c,k);F.g&&bb();Xa(l,"deco")}}}}ba=d}};var Ub,Ya=[],Ef=[[16,16,14,12,10,10],[14,14,10,9,9,9]];Abc.prototype.calculate_beam=function(a,c){var d,e,f,g,h,l;if(!c.beam_st){var k=nd(c);kc(k,c);Pb(k,c);k.x-=12;k.x>c.prev.x+12&&(k.x=c.prev.x+12);k.beam_st=!0;delete k.beam_end;k.tmp=!0;delete k.sls;c=k}var n=e=0;var p=f=!1;var t=c.st;var v=c.v;var q=c.grace?2.3:3.5;for(d=c;d.type!=m.NOTE||(d.nflags>e&&(e=d.nflags),n++,d.st!=t&&(p=!0),d.stem!=c.stem&&(f=!0),g||d.invis||d.stemless&&!d.trem2||(g=
!0),!d.beam_end);d=d.next)if(!d.next){for(;d.type!=m.NOTE;d=d.prev);k=nd(d);k.next=d.next;k.next&&(k.next.prev=k);d.next=k;k.prev=d;k.ts_next=d.ts_next;k.ts_next&&(k.ts_next.ts_prev=k);d.ts_next=k;k.ts_prev=d;delete k.beam_st;k.beam_end=!0;k.tmp=!0;delete k.sls;k.x+=12;k.x<ua-12&&(k.x=ua-12);d=k;n++;break}if(!g)return!1;a.s2=d;if(0==C[t].y){if(p)return!1}else if(!p)return a.s1=c,a.a=(c.ys-d.ys)/(c.xs-d.xs),a.b=c.ys-c.xs*a.a+C[t].y,a.nflags=e,!0;var y=c;var u=100;var x=0;for(k=c;k.type!=m.NOTE||(1==
(l=k.p_v.scale)&&(l=C[k.st].staffscale),0<=k.stem?(g=q+k.notes[0].shhd,k.notes[k.nhd].pit>x&&(x=k.notes[k.nhd].pit,y=k)):(g=-q+k.notes[k.nhd].shhd,k.notes[0].pit<u&&(u=k.notes[0].pit,y=k)),k.xs=k.x+g*l,k!=d);k=k.next);k.grace&&c.fmt.flatbeams?h=0:!f&&3<=n&&y!=c&&y!=d&&(h=0);g=c.ys+C[t].y;void 0==h&&(h=(d.ys+C[d.st].y-g)/(d.xs-c.xs));0!=h&&(h=c.fmt.beamslope*h/(c.fmt.beamslope+Math.abs(h)));n=(g+d.ys+C[d.st].y)/2-h*(d.xs+c.xs)/2;q=0;k=c;if(f)g=.5*((c.grace?3.5:5)*(e-1)+3.2),n=c.stem!=d.stem&&c.nflags<
d.nflags?n+g*d.stem:n+g*c.stem;else if(c.grace)for(;g=h*k.xs+n-C[k.st].y,x=13,x=0<k.stem?x-(g-3*(k.notes[k.nhd].pit-18)):x+(g-3*(k.notes[0].pit-18)),x+=3*(k.nflags-1),x>q&&(q=x),k!=d;k=k.next);else{for(u=3.2+5*(e-1);k.ts_prev&&k.ts_prev.type==m.NOTE&&k.ts_prev.time==k.time&&k.ts_prev.x>c.xs;)k=k.ts_prev;for(;k&&k.time<=d.time;k=k.ts_next)if(!(k.type!=m.NOTE||k.invis||k.st!=t&&k.v!=v)){g=k.v==v?k.xs:k.x;g=h*g+n-C[k.st].y;if(k.v==v)x=Ef[0==k.nhd?0:1][k.nflags],0<k.stem?(26<k.notes[k.nhd].pit&&(x-=2,
28<k.notes[k.nhd].pit&&(x-=2)),x-=g-3*(k.notes[k.nhd].pit-18)):(18>k.notes[0].pit&&(x-=2,16>k.notes[0].pit&&(x-=2)),x-=3*(k.notes[0].pit-18)-g),x+=3.2+5*(k.nflags-1);else{if(0<c.stem)if(0<k.stem){if(k.ymn>g+4||k.ymx<g-u-2)continue;x=k.v>v?k.ymx-g:k.ymn+8-g}else x=k.ymx-g;else if(0>k.stem){if(k.ymx<g-4||k.ymn>g-u-2)continue;x=k.v<v?g-k.ymn:g-k.ymx+8}else x=g-k.ymn;x+=2+u}x>q&&(q=x)}}0<q&&(n+=c.stem*q);if(!p&&!f)for(k=c.next;;k=k.next){switch(k.type){case m.REST:if(v=k.ts_next,!v||v.st!=t||v.type!=
m.NOTE&&v.type!=m.REST)break;case m.BAR:if(k.invis)break;case m.CLEF:g=h*k.x+n;0<c.stem?(g=k.ymx-g+3.2+5*(e-1)+2,0<g&&(n+=g)):(g=k.ymn-g-3.2-5*(e-1)-2,0>g&&(n+=g));break;case m.GRACE:for(v=k.extra;v;v=v.next)g=h*v.x+n,0<c.stem?(g=v.ymx-g+3.2+5*(e-1)+2,0<g&&(n+=g)):(g=v.ymn-g-3.2-5*(e-1)-2,0>g&&(n+=g))}if(k==d)break}0==h&&(n+=Se(c.grace,c.stem,e,n-C[t].y));for(k=c;;k=k.next){switch(k.type){case m.NOTE:k.ys=h*k.xs+n-C[k.st].y;0<k.stem?(k.ymx=k.ys+2.5,k.ts_prev&&0<k.ts_prev.stem&&k.ts_prev.st==k.st&&
k.ts_prev.ymn<k.ymx&&k.ts_prev.x==k.x&&0==k.notes[0].shhd&&(k.ts_prev.x-=3,k.ts_prev.xs-=3)):k.ymn=k.ys-2.5;break;case m.REST:g=h*k.x+n-C[k.st].y;v=3.2+5*(e-1)+(k.head!=m.FULL?4:9);if(0<c.stem){if(g-=v,0==c.multi&&12<g&&(g=12),k.y<=g)break}else if(g+=v,0==c.multi&&12>g&&(g=12),k.y>=g)break;k.head!=m.FULL&&(g=6*((g+3+12)/6|0)-12);k.y=g}if(k==d)break}if(0==C[t].y)return!1;a.s1=c;a.a=h;a.b=n;a.nflags=e;return!0};var rd={};Abc.prototype.draw_hl=function(a){var c,d,e=[],f=C[a.st];if(f.hll){for(c=0;c<=
a.nhd;c++){var g=a.notes[c];f.hlmap[g.pit-f.hll]||e.push([g.pit-18,g.shhd*F.scale])}if(d=e.length){var h=f.stafflines,l=h.length-1,k=l,m=f.botline/6,n=m,p=a.grace?4:1.3*Ce[a.head];g=a.notes[0>a.stem?a.nhd:0];var t=g.shhd;for(c=0;c<e.length;c++){var q=e[c][0];g=(e[c][1]<t?e[c][1]:t)-p;var v=(e[c][1]>t?e[c][1]:t)+p;q<2*m?(q<2*n&&(n=++q>>1),d--):q>2*l&&(k=q>>1,d--);fb(f,q>>1,a.x,g,v)}g=t-p;for(v=t+p;++n<m;)fb(f,n,a.x,g,v);for(;--k>l;)fb(f,k,a.x,g,v);if(d){c=n;for(d=k;c>m&&"-"==h[c];)c--;for(;d<l&&"-"==
h[d];)d++;for(;c<d;c++)"-"==h[c]&&fb(f,c,a.x,g,v)}}}};var De=new Int8Array([24,9,15,21,6,12,18]),Ee=new Int8Array([12,18,24,9,15,21,6]),Fe=new Int8Array([-9,12,-9,-9,12,-9]),Ge=new Int8Array([12,-9,12,-9,12,-9]),He=new Int8Array([9,-12,9,-12,9,-12]),Ie=new Int8Array([-12,9,-12,9,-12,9]);Abc.prototype.draw_keysig=function(a,c){var d=c.k_old_sf,e=C[c.st].y,f,g=c.k_y_clef;g&1&&(g+=7);for(g/=2;0>g;)g+=7;g%=7;if(!c.k_a_acc){if(c.fmt.cancelkey||0==c.k_sf)if(0==c.k_sf||0>d*c.k_sf){var h=De[g];var l=9<h?
Fe:Ge;for(f=0;f<d;f++)Y(a,e+h,"acc3"),h+=l[f],a+=5.5;h=Ee[g];l=18>h?He:Ie;for(f=0;f>d;f--)Y(a,e+h,"acc3"),h+=l[-f],a+=5.5;0!=c.k_sf&&(a+=3)}if(0<c.k_sf){h=De[g];l=9<h?Fe:Ge;for(f=0;f<c.k_sf;f++)Y(a,e+h,"acc1"),h+=l[f],a+=5.5;if(c.fmt.cancelkey&&f<d)for(a+=2;f<d;f++)Y(a,e+h,"acc3"),h+=l[f],a+=5.5}if(0>c.k_sf){h=Ee[g];l=18>h?He:Ie;for(f=0;f>c.k_sf;f--)Y(a,e+h,"acc-1"),h+=l[-f],a+=5.5;if(c.fmt.cancelkey&&f>d)for(a+=2;f>d;f--)Y(a,e+h,"acc3"),h+=l[-f],a+=5.5}}else if(c.k_a_acc.length){l=c.k_a_acc[0].acc;
g=100;var k=[{}];for(f=0;f<c.k_a_acc.length;f++){d=c.k_a_acc[f];for(h=3*(c.k_y_clef+d.pit-18);-3>h;)h+=21;for(;27<h;)h-=21;0!=f&&(h>g+18||h<g-18)?a-=5.5:d.acc!=l&&(a+=3);l=d.acc;k[0].pit=h/3+18;g=h;Fc(a,e+h,d.acc);a+=5.5}}};var Ff="r128 r64 r32 r16 r8 r4 r2 r1 r0 r00".split(" ");Abc.prototype.draw_symbols=function(a){var c={},d;for(d=a.sym;d;d=d.next){if(d.invis)switch(d.type){case m.KEY:a.ckey=d;default:continue;case m.NOTE:}var e=d.st;var f=d.x;va(d.color);switch(d.type){case m.NOTE:Ma(d);d.beam_st&&
!d.beam_end&&W.calculate_beam(c,d)&&od(c);d.invis||(Ha(d),ec(d,!c.s2),Ya.push(d));d==c.s2&&(c.s2=null);break;case m.REST:if(!C[e].topbar)break;var g,h;e=d;var l=C[e.st];if(e.dur_orig==e.p_v.meter.wmeasure||e.rep_nb&&0<=e.rep_nb){e.nflags=e.dur<2*m.BLEN?-2:e.dur<4*m.BLEN?-3:-4;e.dots=0;for(g=e.ts_next;g.time!=e.time+e.dur&&g.ts_next;)g=g.ts_next;f=g.x-g.wl;for(g=e;!g.seqst;)g=g.ts_prev;g=g.ts_prev;f=(f+g.x+g.wr)/2;if(e.a_dd){var k=e;var n=f-e.x;var p=ba.length;for(h=0;h<p;h++)g=ba[h],g.s==k&&(g.x+=
n)}e.x=f}else f=e.x,e.notes[0].shhd&&(f+=e.notes[0].shhd*F.scale);if(!e.invis){g=l.y;if(e.rep_nb)za(e.st),Ha(e),g="|||||"==l.stafflines?g+12:g+(l.topbar+l.botbar)/2,0>e.rep_nb?Y(f,g,"srep"):(Y(f,g,"mrep"),2<e.rep_nb&&e.v==L.top_voice&&0<e.fmt.measrepnb&&!(e.rep_nb%e.fmt.measrepnb)&&sd(f,g+l.topbar,e.rep_nb));else{Ma(e);Ha(e);e.notes[0].color&&va(e.notes[0].color);h=e.y;n=5-e.nflags;7==n&&12==h&&2>=l.stafflines.length&&(h-=6);e.notes[0].invis||Y(f,h+g,Ff[n]);if(6<=n){k=h/6;switch(n){default:switch(l.stafflines[k+
1]){case "|":case "[":break;default:fb(l,k+1,f,-7,7)}9==n&&(h-=6,k--);break;case 7:h+=6,k++;case 6:}switch(l.stafflines[k]){case "|":case "[":break;default:fb(l,k,f,-7,7)}}if(e.dots)for(f+=8,h+=g+3,k=e.dots,n=e.dur_orig/12>>5-e.nflags-k;0<k--;)Y(f,h,n&1<<k?"dot":"dot+"),f+=3.5;va()}Ya.push(e)}break;case m.BAR:break;case m.CLEF:d.time>=C[e].clef.time&&(C[e].clef=d);if(d.second||!C[e].topbar)break;va();za(e);Ha(d);e=C[e].y;d.clef_name?Y(f,e+d.y,d.clef_name):d.clef_small?Y(f,e+d.y,"s"+d.clef_type+"clef"):
Y(f,e+d.y,d.clef_type+"clef");d.clef_octave&&(0<d.clef_octave?(e+=d.ymx-10,d.clef_small&&--e):(e+=d.ymn+6,d.clef_small&&(e+=1)),Y(f-2,e,"oct"));Ya.push(d);break;case m.METER:a.meter=d;if(d.second||!C[d.st].topbar)break;va();za(d.st);Ha(d);qd(d);Ya.push(d);break;case m.KEY:a.ckey=d;if(d.second||!C[d.st].topbar)break;va();za(d.st);Ha(d);W.draw_keysig(f,d);Ya.push(d);break;case m.MREST:Ma(d);f+=32;Ha(d);Y(f,C[d.st].y+12,"mrest");S('<text style="font:bold 15px text,serif"\n\tx ="X" y="Y" text-anchor="middle">A</text>\n',
f,C[d.st].y+28,d.nmes);Ya.push(d);break;case m.GRACE:Ma(d);f=d;l={};for(e=f.extra;;){e.beam_st&&!e.beam_end&&W.calculate_beam(l,e)&&od(l);Ha(e);ec(e,!l.s2);e==l.s2&&(l.s2=null);Ya.push(f);if(!e.next)break;e=e.next}f.sappo&&(e=f.extra,e.next?(g=.5*(e.next.x-e.x)+4,l=.5*(e.ys+e.next.ys)-e.y,l=0<e.stem?l-1:l+1):(g=9,l=0<e.stem?5:-5),k=e.notes[0>e.stem?0:e.nhd],h=e.x+k.shhd*F.scale,k=C[e.st].y+3*(k.pit-18),0<e.stem?(--h,k+=4):(h-=5,k-=4),S('<path class="stroke" d="mX YlF G"/>\n',h,k,g,-l));if(e=f.slur)Ha(f,
"slur"),Jb(e.x0,e.y0+C[f.st].y),H+="c"+e.x1.toFixed(1)+" "+e.y1.toFixed(1)+" "+e.x2.toFixed(1)+" "+e.y2.toFixed(1)+" "+e.x3.toFixed(1)+" "+e.y3.toFixed(1)+'"/>\n',Xa(f,"slur");break;case m.SPACE:case m.STBRK:break;case m.CUSTOS:Ma(d);ec(d,0);break;case m.BLOCK:case m.PART:case m.REMARK:case m.STAVES:case m.TEMPO:break;default:v(2,d,"draw_symbols - Cannot draw symbol "+d.type)}}Ma(a.sym)};var Hb=[],Cd={},yd={serif:1,serifBold:1,"sans-serif":1,"sans-serifBold":1,Palatino:1.1,monospace:1.35},Je={},t=
{"abc-version":"1",annotationfont:{name:"text,sans-serif",size:12},aligncomposer:1,beamslope:.4,bardef:{"[":"","[]":"","|:":"[|:","|::":"[|::","|:::":"[|:::",":|":":|]","::|":"::|]",":::|":":::|]","::":":][:"},breaklimit:.7,breakoneoln:!0,cancelkey:!0,composerfont:{name:"text,serif",style:"italic",size:14},composerspace:6,decoerr:!0,dynalign:!0,footerfont:{name:"text,serif",size:16},fullsvg:"",gchordfont:{name:"text,sans-serif",size:12},gracespace:new Float32Array([4,8,11]),graceslurs:!0,headerfont:{name:"text,serif",
size:16},historyfont:{name:"text,serif",size:16},hyphencont:!0,indent:0,infofont:{name:"text,serif",style:"italic",size:14},infoname:'R "Rhythm: "\nB "Book: "\nS "Source: "\nD "Discography: "\nN "Notes: "\nZ "Transcription: "\nH "History: "',infospace:0,keywarn:!0,leftmargin:1.4*37.8,lineskipfac:1.1,linewarn:!0,maxshrink:.65,maxstaffsep:2E3,maxsysstaffsep:2E3,measrepnb:1,measurefont:{name:"text,serif",style:"italic",size:10},measurenb:-1,musicfont:{name:"music",src:'url("data:application/octet-stream;base64,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NQd1bmlFMDg2B3VuaUUwODcHdW5pRTA4OAd1bmlFMDg5B3VuaUUwOEEHdW5pRTA4Qgd1bmlFMDhDB3VuaUUwOTQHdW5pRTA5NQd1bmlFMEEwB3VuaUUwQTEHdW5pRTBBMgd1bmlFMEEzB3VuaUUwQTQHdW5pRTBBOQd1bmlFMEIzB3VuaUUxMDEHdW5pRTFCOQd1bmlFMUJCB3VuaUUxRTcHdW5pRTFGMgd1bmlFMUY0B3VuaUUxRjcHdW5pRTFGOQd1bmlFMUZDB3VuaUUxRkUHdW5pRTFGRgd1bmlFMjAwB3VuaUUyNDAHdW5pRTI0MQd1bmlFMjQyB3VuaUUyNDMHdW5pRTI0NAd1bmlFMjQ1B3VuaUUyNDYHdW5pRTI0Nwd1bmlFMjQ4B3VuaUUyNDkHdW5pRTI2MAd1bmlFMjYxB3VuaUUyNjIHdW5pRTI2Mwd1bmlFMjY0B3VuaUUyODAHdW5pRTI4MQd1bmlFMjgyB3VuaUUyODMHdW5pRTRBMAd1bmlFNEEyB3VuaUU0QTQHdW5pRTRBOAd1bmlFNEFDB3VuaUU0QzAHdW5pRTRDRQd1bmlFNEUxB3VuaUU0RTIHdW5pRTRFMwd1bmlFNEU0B3VuaUU0RTUHdW5pRTRFNgd1bmlFNEU3B3VuaUU0RTgHdW5pRTRFOQd1bmlFNEVBB3VuaUU0RUUHdW5pRTUwMAd1bmlFNTAxB3VuaUU1MjAHdW5pRTUyMQd1bmlFNTIyB3VuaUU1MjMHdW5pRTUyNAd1bmlFNTI1B3VuaUU1MjkHdW5pRTUyQQd1bmlFNTJCB3VuaUU1MkMHdW5pRTUyRAd1bmlFNTJGB3VuaUU1MzAHdW5pRTUzMQd1bmlFNTM5B3VuaUU1NjYHdW5pRTU2Nwd1bmlFNTY5B3VuaUU1NkMHdW5pRTU2RAd1bmlFNTgyB3VuaUU1RDAHdW5pRTVFMgd1bmlFNjEwB3VuaUU2MTIHdW5pRTYxNAd1bmlFNjE4B3VuaUU2MjQHdW5pRTYzMAd1bmlFNjUwB3VuaUU2NTUHdW5pRTkxMAd1bmlFOTExB3VuaUU5MTIHdW5pRTkxNAd1bmlFOTE1B3VuaUU5MTgHdW5pRTkyMAd1bmlFOTI1B3VuaUU5NUQHdW5pRUEwMgd1bmlFQUE0B3VuaUVDQTIHdW5pRUNBMwd1bmlFQ0E1B3VuaUVDQTcHdW5pRUNBOQd1bmlFQ0I3AAAAAAAAAf//AAIAAQAAAAAAAAAMABQABAAAAAIAAAABAAAAAQAAAAAAAQAAAADZahNDAAAAANGXIhcAAAAA2dy6gQ==") format("truetype")',
size:24},musicspace:6,partsfont:{name:"text,serif",size:15},parskipfac:.4,partsspace:8,pagewidth:793.8,printmargin:0,rightmargin:1.4*37.8,rbmax:4,rbmin:2,repeatfont:{name:"text,serif",size:13},scale:1,slurheight:1,staffsep:46,stemheight:21,stretchlast:.25,stretchstaff:!0,subtitlefont:{name:"text,serif",size:16},subtitlespace:3,sysstaffsep:34,tempofont:{name:"text,serif",weight:"bold",size:12},textfont:{name:"text,serif",size:16},textspace:14,tieheight:1,titlefont:{name:"text,serif",size:20},titlespace:6,
titletrim:!0,topspace:22,tuplets:[0,0,0,0],tupletfont:{name:"text,serif",style:"italic",size:12},vocalfont:{name:"text,serif",weight:"bold",size:13},vocalspace:10,voicefont:{name:"text,serif",weight:"bold",size:13},writefields:"CMOPQsTWw",wordsfont:{name:"text,serif",size:16},wordsspace:5},Ke={bardef:!0,barsperstaff:!0,beamslope:!0,breaklimit:!0,bstemdown:!0,cancelkey:!0,dynalign:!0,flatbeams:!0,gracespace:!0,hyphencont:!0,keywarn:!0,maxshrink:!0,maxstaffsep:!0,measrepnb:!0,rbmax:!0,rbmin:!0,shiftunison:!0,
slurheight:!0,squarebreve:!0,staffsep:!0,stemheight:!0,stretchlast:!0,stretchstaff:!0,tieheight:!0,timewarn:!0,vocalspace:!0},Le={align:"j",center:"c",fill:"f",justify:"j",ragged:"f",right:"r",skip:"s"},ed={above:m.SL_ABOVE,auto:0,below:m.SL_BELOW,down:m.SL_BELOW,hidden:m.SL_HIDDEN,opposite:m.SL_HIDDEN,under:m.SL_BELOW,up:m.SL_ABOVE};Abc.prototype.set_format=function(a,c){if(/.+font(-[\d])?$/.test(a))"soundfont"==a?t.soundfont=c:mb(a,c);else{Ke[a]&&p.ufmt&&(t=Object.create(t));switch(a){case "aligncomposer":case "barsperstaff":case "infoline":case "measurenb":case "rbmax":case "rbmin":case "measrepnb":case "shiftunison":var d=
parseInt(c);if(isNaN(d)){B(1,"Bad integer value");break}t[a]=d;break;case "abc-version":case "bgcolor":case "fgcolor":case "titleformat":t[a]=c;break;case "beamslope":case "breaklimit":case "lineskipfac":case "maxshrink":case "pagescale":case "parskipfac":case "scale":case "slurheight":case "stemheight":case "stretchlast":case "tieheight":d=parseFloat(c);if(isNaN(d)){B(1,K.bad_val,"%%"+a);break}switch(a){case "scale":d/=.75;case "pagescale":a="scale",da.chg=!0}t[a]=d;break;case "annotationbox":case "gchordbox":case "measurebox":case "partsbox":mb(a.replace("box",
"font"),"* * "+(hb(c)?"box":"nobox"));break;case "bstemdown":case "breakoneoln":case "cancelkey":case "checkbars":case "contbarnb":case "custos":case "decoerr":case "flatbeams":case "graceslurs":case "graceword":case "hyphencont":case "keywarn":case "linewarn":case "quiet":case "singleline":case "squarebreve":case "splittune":case "straightflags":case "stretchstaff":case "timewarn":case "titlecaps":case "titleleft":t[a]=hb(c);break;case "dblrepbar":c=":: "+c;case "bardef":d=c.split(/\s+/);2!=d.length?
B(1,K.bad_val,"%%bardef"):(p.ufmt&&(t.bardef=Object.create(t.bardef)),t.bardef[d[0]]=d[1]);break;case "chordalias":d=c.split(/\s+/);d.length?abc2svg.ch_alias[d[0]]=d[1]||"":B(1,K.bad_val,"%%chordalias");break;case "composerspace":case "indent":case "infospace":case "maxstaffsep":case "maxsysstaffsep":case "musicspace":case "partsspace":case "staffsep":case "subtitlespace":case "sysstaffsep":case "textspace":case "titlespace":case "topspace":case "vocalspace":case "wordsspace":d=Ra(c);isNaN(d)?B(1,
K.bad_val,"%%"+a):t[a]=d;break;case "page-format":u.page_format=hb(c);break;case "print-leftmargin":B(0,"$1 is deprecated - use %%printmargin instead","%%"+a),a="printmargin";case "printmargin":case "leftmargin":case "pagewidth":case "rightmargin":d=Ra(c);if(isNaN(d)){B(1,K.bad_val,"%%"+a);break}t[a]=d;da.chg=!0;break;case "concert-score":"play"!=t.sound&&(t.sound="concert");break;case "writefields":var e=c.split(/\s+/);if(hb(e[1]))for(d=0;d<e[0].length;d++)c=e[0][d],0>t.writefields.indexOf(c)&&(t.writefields+=
c);else for(d=0;d<e[0].length;d++)c=e[0][d],0<=t.writefields.indexOf(c)&&(t.writefields=t.writefields.replace(c,""));break;case "dynamic":case "gchord":case "gstemdir":case "ornament":case "stemdir":case "vocal":case "volume":zd(a,c);break;case "font":c=Zb(c);1>=c.length||(d=parseFloat(c[c.length-1]),isNaN(d)||.5>=d?B(1,"Bad scale value in %%font"):yd[c[0]]=d);break;case "fullsvg":if(0!=p.state){B(1,K.not_in_tune,"%%fullsvg");break}t[a]=c;break;case "gracespace":d=c.split(/\s+/);for(c=0;3>c;c++)if(isNaN(Number(d[c]))){B(1,
K.bad_val,"%%gracespace");break}p.ufmt&&(t[a]=new Float32Array(3));for(c=0;3>c;c++)t[a][c]=Number(d[c]);break;case "tuplets":t[a]=c.split(/\s+/);(d=t[a][3])&&ed[d]&&(t[a][3]=ed[d]);break;case "infoname":a:{d=t.infoname.split("\n");e=c[0];for(var f=0;f<d.length;f++)if(d[f][0]==e){1==c.length?d.splice(f,1):d[f]=c;t.infoname=d.join("\n");break a}t.infoname+="\n"+c}break;case "notespacingfactor":d=parseFloat(c);if(isNaN(d)||1>d||2<d){B(1,K.bad_val,"%%"+a);break}c=5;for(e=sb[c];0<=--c;)e/=d,sb[c]=e;c=
5;for(e=sb[c];++c<sb.length;)e*=d,sb[c]=e;break;case "play":t.sound="play";break;case "pos":a=c.match(/(\w*)\s+(.*)/);if(!a||!a[2]){B(1,"Error in %%pos");break}zd(a[1],a[2]);break;case "sounding-score":"play"!=t.sound&&(t.sound="sounding");break;case "staffwidth":d=Ra(c);if(isNaN(d)){B(1,K.bad_val,"%%"+a);break}if(100>d){B(1,"%%staffwidth too small");break}d=t.pagewidth-d-t.leftmargin;if(2>d){B(1,"%%staffwidth too big");break}t.rightmargin=d;da.chg=!0;break;case "textoption":t[a]=Le[c];break;case "dynalign":case "titletrim":d=
Number(c);isNaN(d)?t[a]=hb(c):t[a]=d;break;case "combinevoices":B(1,"%%combinevoices is deprecated - use %%voicecombine instead");break;case "voicemap":Kb("map",c);break;case "voicescale":Kb("scale",c);break;case "rbdbstop":(d=hb(c))&&"2.2"<=t["abc-version"]?t["abc-version"]="1":!d&&"2.2">t["abc-version"]&&(t["abc-version"]="2.2");break;default:0==p.state&&(t[a]=c)}Ke[a]&&p.ufmt&&(p.ufmt=!1)}};Abc.prototype.style_font=Jc;var Ea={},rb={},jc={},ef={"=D":"\u0110","=H":"\u0126","=T":"\u0166","=d":"\u0111",
"=h":"\u0127","=t":"\u0167","/O":"\u00d8","/o":"\u00f8","/L":"\u0141","/l":"\u0142",vL:"\u013d",vl:"\u013e",vd:"\u010f",".i":"\u0131",AA:"\u00c5",aa:"\u00e5",AE:"\u00c6",ae:"\u00e6",DH:"\u00d0",dh:"\u00f0",OE:"\u0152",oe:"\u0153",ss:"\u00df",TH:"\u00de",th:"\u00fe"},df={1:"\u266f",2:"\u266d",3:"\u266e",4:"&#x1d12a;",5:"&#x1d12b;"},db=0;Abc.prototype.tosvg=Kc;var G,C,P,Oa,ua,pc,ac,sb=new Float32Array([8.4,11.2,14.9,19.8,26.3,35,46.6,61.9,82.3,109.5]),Nc,Kd=new Float32Array([10,10,11,13,15]),Ce=new Float32Array([4.7,
5,6,7.2,7.5]),qc=new Float32Array([3.5,3.7,5,6,7]);Abc.prototype.set_width=function(a){var c,d,e;if(!a.play)switch(a.type){case m.NOTE:case m.REST:a.wr=e=Ce[a.head];0<a.xmx&&(a.wr+=a.xmx+4);for(c=a.prev;c&&0==La[c.type];c=c.prev);if(c)switch(c.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:e+=3}for(d=0;d<=a.nhd;d++){var f=a.notes[d];var g=f.shhd;0>g&&e<-g+5&&(e=-g+5);if(g=f.acc)g=f.shac+("object"==typeof g?5.5:3.5),e<g&&(e=g);if(f.a_dd){g=e;var h=0;var l=f.a_dd.length;for(e=0;e<l;e++){var k=
f.a_dd[e];"<"==k.ty&&(k=k.wl+k.wr+8,k>h&&(h=k))}e=g+h}}if(c)switch(c.type){case m.BAR:case m.CLEF:case m.KEY:case m.METER:e-=3}a.a_dd&&(e+=Dc(a));a.beam_st&&a.beam_end&&0<a.stem&&0<a.nflags&&a.wr<a.xmx+9&&(a.wr=a.xmx+9);if(a.dots){if(void 0==a.wl)switch(a.head){case m.SQUARE:case m.OVALBARS:a.xmx+=3;break;case m.OVAL:a.xmx+=1}a.wr<a.xmx+8&&(a.wr=a.xmx+8);2<=a.dots&&(a.wr+=3.5*(a.dots-1))}a.trem2&&a.beam_end&&20>e&&(e=20);f=e;if(c)switch(c.type){case m.NOTE:0<c.stem&&0>a.stem&&7>f&&(f=7);(27<a.y&&
27<c.y||-3>a.y&&-3>c.y)&&6>f&&(f=6);c.tie&&14>f&&(f=14);break;case m.CLEF:if(c.second||c.clef_small)break;f+=8;break;case m.KEY:f+=4}a.a_gch&&(f=Od(a,e,f));a.wl=c&&c.type==m.GRACE?e-4.5:f;return;case m.SPACE:g=a.width/2;a.wr=g;a.a_gch&&(g=Od(a,g,g));a.a_dd&&(g+=Dc(a));a.wl=g;return;case m.BAR:d=a.bar_type;switch(d){case "|":g=5;break;case "[":g=0;break;default:for(g=2+2.8*d.length,c=0;c<d.length;c++)switch(d[c]){case "[":case "]":g+=1;case ":":g+=2}}a.wl=g;a.wr=a.next&&a.next.type!=m.METER?7:5;for(c=
a.prev;c;c=c.prev)if(0!=La[c.type]){c.type==m.GRACE&&(a.wl-=8);break}a.a_dd&&(a.wl+=Dc(a));a.text&&4>a.text.length&&a.next&&a.next.a_gch&&(T("repeat"),a.wr+=ya(a.text)[0]+2,0<t.measurenb&a.bar_num&&a.bar_num%t.measurenb&&(a.wr+=4));return;case m.CLEF:if(a.invis){a.wl=a.wr=1;return}a.wl=a.clef_small?11:12;a.wr=a.clef_small?10:12;a.next&&a.next.type==m.BAR&&(a.wr-=4);return;case m.KEY:if(a.invis){a.wl=a.wr=0;return}a.wl=3;h=4;if(a.k_a_acc){if(f=e=a.k_a_acc.length)d=a.k_a_acc[0].acc;for(c=1;c<e;c++)g=
a.k_a_acc[c],g.pit>a.k_a_acc[c-1].pit+6||g.pit<a.k_a_acc[c-1].pit-6?f--:g.acc!=d&&(h+=3),d=g.acc}else f=a.k_sf,e=a.k_old_sf&&(a.fmt.cancelkey||0==f)?a.k_old_sf:0,0<=f*e?(0>f&&(f=-f),0>e&&(e=-e),e>f&&(f=e)):(f-=e,0>f&&(f=-f),h+=3);a.wr=5.5*f+h;return;case m.METER:f=0;a.x_meter=[];for(c=0;c<a.a_meter.length;c++)switch(e=a.a_meter[c],e.top[0]){case "C":case "c":case "o":a.x_meter[c]=f+6;f+=12;break;case ".":case "|":a.x_meter[c]=a.x_meter[c-1];break;default:g=0;e=!e.bot||e.top.length>e.bot.length?e.top:
e.bot;for(d=0;d<e.length;d++)switch(e[d]){case "(":f+=4;case ")":case "1":g+=4;break;default:g+=12}a.x_meter[c]=f+g/2;f+=g}a.wl=0;a.wr=f+6;return;case m.MREST:a.wl=6;a.wr=66;return;case m.GRACE:if(a.invis)break;g=a.fmt.gracespace[0];d=a.fmt.gracespace[1];c=a.fmt.gracespace[2];f=a.extra;a.prev&&a.prev.type==m.BAR&&(g-=3);for(f.beam_st=!0;;f=f.next){Jd(f);Ld(f.notes,7);h=0;for(e=f.nhd;0<=e;e--)f.notes[e].shac>h&&(h=f.notes[e].shac);g+=h;f.x=g;0>=f.nflags&&(f.beam_st=!0,f.beam_end=!0);e=f.next;if(!e){f.beam_end=
!0;break}0>=e.nflags&&(f.beam_end=!0);f.beam_end&&(e.beam_st=!0,g+=d/4);0>=f.nflags&&(g+=d/4);f.y>e.y+8&&(g-=1.5);g+=d}(e=a.next)&&e.type==m.NOTE&&(f.y>=3*(e.notes[e.nhd].pit-18)?--c:f.beam_st&&f.y<3*(e.notes[e.nhd].pit-18)-4&&(c+=2));a.wl=g+c;a.wr=0;a.a_ly&&lc(a);return;case m.STBRK:a.wl=a.xmx;a.next&&a.next.type==m.CLEF?(a.wr=2,delete a.next.clef_small):a.wr=8;return;case m.CUSTOS:a.wl=a.wr=4;return;case m.TEMPO:oe(a);break;case m.BLOCK:case m.PART:case m.REMARK:case m.STAVES:break;default:v(2,
a,"set_width - Cannot set width for symbol $1",a.type)}a.wl=a.wr=0};var fd={t:-4,c:0,b:4,p:-6},Me=[[18,18],[12,18],[12,12],[0,12],[6,8],[10,10],[6,4],[10,0],[10,4],[10,10]];Abc.prototype.set_pitch=function(a){var c,d,e=m.BLEN,f=P+1,g=new Int16Array(Array(2*f));for(c=0;c<=P;c++){var h=C[c].clef;g[c]=fd[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);t.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave)}for(h=N;h!=a;h=h.ts_next)switch(c=h.st,
h.type){case m.CLEF:g[c]=fd[h.clef_type]+2*h.clef_line;h.clefpit&&(g[c]+=h.clefpit);t.sound?h.clef_octave&&!h.clef_oct_transp&&(g[c]+=h.clef_octave):h.clef_oct_transp&&(g[c]-=h.clef_octave);Pc(h);break;case m.GRACE:for(c=h.extra;c;c=c.next){if((d=g[c.st])&&!h.p_v.ckey.k_drum)for(f=0;f<=c.nhd;f++){var l=c.notes[f];l.opit=l.pit;l.pit+=d}c.ymn=3*(c.notes[0].pit-18)-2;c.ymx=3*(c.notes[c.nhd].pit-18)+2}Pc(h);break;case m.KEY:h.k_y_clef=g[c];default:Pc(h);break;case m.MREST:if(h.invis)break;h.y=12;h.ymx=
39;h.ymn=-2;break;case m.REST:if(1==D.length){h.y=12;h.ymx=24;h.ymn=0;break}case m.NOTE:if((d=g[c])&&!h.p_v.ckey.k_drum)for(f=h.nhd;0<=f;f--)l=h.notes[f],l.opit=l.pit,l.pit+=d;h.type==m.REST&&(h.y=6*((h.notes[0].pit-18)/2|0),h.ymx=h.y+Me[5-h.nflags][0],h.ymn=h.y-Me[5-h.nflags][1]);h.dur<e&&(e=h.dur)}a||(Nc=e)};Abc.prototype.set_stem_dir=function(){for(var a,c,d,e,f,g,h,l=[],k=N,n=L,p=n.nstaff;k;){for(a=0;a<=p;a++)l[a]=[];h=[];for(c=k;c&&c.type!=m.BAR;c=c.ts_next)if(c.type==m.STAVES){if(c!=k)break;
n=k.sy;for(a=p;a<=n.nstaff;a++)l[a]=[];p=n.nstaff}else if(!(c.type!=m.NOTE&&c.type!=m.REST||c.invis)){a=c.st;if(a>p)throw c="*** fatal set_stem_dir(): bad staff number "+a+" max "+p,v(2,null,c),Error(c);d=c.v;e=h[d];e||(e={st1:-1,st2:-1},h[d]=e);0>e.st1?e.st1=a:e.st1!=a&&(a>e.st1?a>e.st2&&(e.st2=a):(e.st1>e.st2&&(e.st2=e.st1),e.st1=a));f=l[a];e=n.voices[d].range;for(d=f.length;0<=--d&&(g=f[d],g.v!=e););if(0>d){g={v:e,ymx:0,ymn:24};for(d=0;d<f.length;d++)if(e<f[d].v){f.splice(d,0,g);break}d==f.length&&
f.push(g)}c.type==m.NOTE&&(c.ymx>g.ymx&&(g.ymx=c.ymx),c.ymn<g.ymn&&(g.ymn=c.ymn),c.xstem&&(c.ts_prev.st!=a-1||c.ts_prev.type!=m.NOTE?(v(1,k,"Bad !xstem!"),c.xstem=!1):(c.ts_prev.multi=1,c.multi=1,c.stemless=!0)))}for(;k!=c;k=k.ts_next)if(!k.multi){switch(k.type){default:continue;case m.REST:if(void 0!=k.combine&&0>k.combine||!k.ts_next||k.ts_next.type!=m.REST||k.ts_next.st!=k.st||k.time!=k.ts_next.time||k.dur!=k.ts_next.dur||k.a_dd&&k.ts_next.a_dd||k.a_gch&&k.ts_next.a_gch||k.invis)break;k.ts_next.a_dd&&
(k.a_dd=k.ts_next.a_dd);k.ts_next.a_gch&&(k.a_gch=k.ts_next.a_gch);nb(k.ts_next);case m.NOTE:case m.GRACE:}a=k.st;d=k.v;e=h[d];f=l[a];if(e&&0<=e.st2)a==e.st1?k.multi=-1:a==e.st2&&(k.multi=1);else if(1>=f.length)k.floating&&(k.multi=a==D[d].st?-1:1);else{e=n.voices[d].range;for(d=f.length;0<=--d&&f[d].v!=e;);0>d||(d==f.length-1?k.multi=-1:(k.multi=1,0!=d&&d+2==f.length&&(f[d].ymn-k.fmt.stemheight>=f[d+1].ymx&&(k.multi=-1),a=k.ts_next,k.ts_prev&&k.ts_prev.time==k.time&&k.ts_prev.st==k.st&&k.notes[k.nhd].pit==
k.ts_prev.notes[0].pit&&k.beam_st&&k.beam_end&&(!a||a.st!=k.st||a.time!=k.time)&&(k.multi=-1))))}}for(;k&&k.type==m.BAR;)k=k.ts_next}};Abc.prototype.set_stems=function(){var a,c,d,e;for(a=N;a;a=a.ts_next)if(a.type!=m.NOTE){if(a.type==m.GRACE){var f=e=a.mid;for(c=a.extra;c;c=c.next){var g=fc(a,c.dur);c.head=g[0];c.dots=g[1];c.nflags=g[2];g=15;1<c.nflags&&(g+=1.2*(c.nflags-1));var h=3*(c.notes[0].pit-18);var l=3*(c.notes[c.nhd].pit-18);0<=a.stem?(c.y=h,c.ys=l+g,l=Math.round(c.ys)):(c.y=l,c.ys=h-g,h=
Math.round(c.ys));l+=2;h-=2;h<f?f=h:l>e&&(e=l);c.ymx=l;c.ymn=h}a.ymx=e;a.ymn=f}}else{Jd(a);c=a.nflags;if(a.beam_st&&!a.beam_end){a.feathered_beam&&(c=++a.nflags);for(g=a.next;g.type!=m.NOTE||(a.feathered_beam&&g.nflags++,!g.beam_end);g=g.next);g.nflags>c&&(c=g.nflags)}else if(!a.beam_st&&a.beam_end){for(g=a.prev;!g.beam_st;g=g.prev);g.nflags>c&&(c=g.nflags)}g=a.fmt.stemheight;switch(c){case 2:g+=0;break;case 3:g+=4;break;case 4:g+=8;break;case 5:g+=12}1!=(d=a.p_v.scale)&&(g*=.5*(d+1));h=3*(a.notes[0].pit-
18);0<a.nhd?(g-=2,l=3*(a.notes[a.nhd].pit-18)):l=h;a.ntrem&&(g+=2*a.ntrem);a.stemless?(0<=a.stem?(a.y=h,a.ys=l):(a.ys=h,a.y=l),a.ymx=l+4,a.ymn=h-4):0<=a.stem?(26<a.notes[a.nhd].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,28<a.notes[a.nhd].pit&&(g-=2)),a.y=h,a.notes[0].tie&&(h-=3),a.ymn=h-4,a.ys=l+g,a.ys<a.mid&&(a.ys=a.mid),a.ymx=a.ys+2.5|0):(18>a.notes[0].pit&&(0>=c||!a.beam_st||!a.beam_end)&&(g-=2,16>a.notes[0].pit&&(g-=2)),a.ys=h-g,a.ys>a.mid&&(a.ys=a.mid),a.ymn=a.ys-2.5|0,a.y=l,a.notes[a.nhd].tie&&
(l+=3),a.ymx=l+4)}};var rc=[];Abc.prototype.block_gen=function(a){switch(a.subtype){case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "scale":case "staffwidth":W.set_format(a.subtype,a.param);break;case "mc_start":pa={posy:fa,maxy:fa,lmarg:t.leftmargin,rmarg:t.rightmargin};break;case "mc_new":if(!pa){v(1,a,"%%multicol new without start");break}fa>pa.maxy&&(pa.maxy=fa);t.leftmargin=pa.lmarg;t.rightmargin=pa.rmarg;da.chg=!0;Ia();fa=pa.posy;break;case "mc_end":if(!pa){v(1,a,
"%%multicol new without start");break}fa<pa.maxy&&(fa=pa.maxy);t.leftmargin=pa.lmarg;t.rightmargin=pa.rmarg;pa=void 0;qb();da.chg=!0;Ia();break;case "ml":u.img_out(a.text);break;case "newpage":if(!u.page_format)break;0>Fa&&u.img_out("</div>");Fa=2;break;case "sep":Ia();ma(a.sk1);H+='<path class="stroke"\n\td="M';Qa((da.width-a.l)/2-da.lm," ",0);H+="h"+a.l.toFixed(1)+'"/>\n';ma(a.sk2);break;case "text":T(a.font);wc(a.text,a.opt);break;case "title":Yc(a.text,!0);break;case "vskip":ma(a.sk)}};Abc.prototype.set_sym_glue=
function(a){var c,d,e=0,f=0,g=0,h=0,l=0;for(c=N;c;c=c.ts_next)c.type!=m.GRACE||d||(d=c),c.seqst&&(e+=c.shrink,c.space?c.space<c.shrink?(l+=c.shrink,f+=c.shrink):f+=c.space:h+=c.shrink);if(f){var k=!Oa||Oa.type==m.BLOCK&&!Oa.play||rc.length;c=N;if(e>=a){e>a&&v(1,c,"Line too much shrunk $1 $2 $3",e.toFixed(1),f.toFixed(1),a.toFixed(1));for(g=0;c;c=c.ts_next)c.seqst&&(g+=c.shrink),c.x=g;ac=0}else if(k&&f+h>a*(1-c.fmt.stretchlast)||!k&&(f+h>a||c.fmt.stretchstaff)){f==l&&(f+=5);for(k=4;0<=--k;){var n=
(a-h-l)/(f-l);g=l=f=0;for(c=N;c;c=c.ts_next)c.seqst&&(c.space?c.space*n<=c.shrink?(l+=c.shrink,f+=c.shrink,g+=c.shrink):(f+=c.space,g+=c.space*n):g+=c.shrink),c.x=g;if(.1>Math.abs(g-a))break}ac=n}else for(n=(a-h-l)/f,ac<n&&(n=ac);c;c=c.ts_next)c.seqst&&(g+=c.space*n<=c.shrink?c.shrink:c.space*n),c.x=g;ua=g;for(c=d;c;c=c.ts_next)if(c.type==m.GRACE)for(g=c.gr_shift?c.prev.x+c.prev.wr:c.x-c.wl,a=c.extra;a;a=a.next)a.x+=g}else ua=0};Abc.prototype.output_music=function(){var a,c=D.length,d,e=D.length,
f=L,g=f.nstaff;for(pc=0<=t.writefields.indexOf("M");;){f=f.next;if(!f)break;f.nstaff>g&&(g=f.nstaff)}P=g;for(var h,l=N;l.ts_next;)l=l.ts_next;l.type!=m.BAR&&(h=Qd(l),h.seqst=!0,h.invis=!0,h.time=l.time+(l.dur||0),h.ts_prev=l,l.next=l.ts_next=h);for(d=0;d<e;d++){var k=D[d];var n=void 0,p=void 0,v=void 0,u=void 0,q=void 0,y=!0,B=127;for(q=k.sym;q;q=q.next)if(q.type==m.NOTE){B=q.notes[0].pit;break}for(q=k.sym;q;q=q.next){q.a_gch&&W.gch_build(q);switch(q.type){case m.MREST:y=!0;break;case m.BAR:if(n=
q.fmt.bardef[q.bar_type])q.bar_type=n;q.beam_on||(y=!0);q.next||!q.prev||q.invis||q.prev.head!=m.OVALBARS||(q.prev.head=m.SQUARE);break;case m.GRACE:for(u=q.extra;u;u=u.next)u.notes.sort(abc2svg.pitcmp);break;case m.NOTE:case m.REST:if(n=fc(q,q.dur_orig),q.head=n[0],q.dots=n[1],q.nflags=n[2],-2>=q.nflags&&(q.stemless=!0),q.xstem&&(q.nflags=0),q.trem1&&(q.nflags=0<q.nflags?q.nflags+q.ntrem:q.ntrem),!q.next||!q.next.trem2)if(q.trem2)q.prev.trem2=!0,q.prev.nflags=--q.nflags,q.prev.head=++q.head,0<q.nflags?
q.nflags+=q.ntrem:(-2>=q.nflags&&(q.stemless=!0,q.prev.stemless=!0),q.nflags=q.ntrem),q.prev.nflags=q.nflags;else{v=q.nflags;q.ntrem&&(v+=q.ntrem);q.type==m.REST&&q.beam_end&&!q.beam_on&&(q.beam_end=!1,y=!0);if(y||0>=v)if(p&&(p.beam_end=!0,p=null),0>=v)q.beam_st=!0,q.beam_end=!0;else if(q.type==m.NOTE||q.beam_on)q.beam_st=!0,y=!1;q.beam_end&&(y=!0);if(q.type==m.NOTE||q.beam_on)p=q}}if(q.type==m.NOTE)for(q.nhd&&q.notes.sort(abc2svg.pitcmp),B=q.notes[0].pit,u=q.prev;u&&u.type==m.REST;u=u.prev)u.notes[0].pit=
B;else q.notes||(q.notes=[],q.notes[0]={},q.nhd=0),q.notes[0].pit=B}p&&(p.beam_end=!0);k.ckey=k.key;for(var E=void 0,G=void 0,F=k.sym;F;)if(F.type!=m.BAR||!F.rbstart||F.norepbra)F=F.next;else for(E=0,G=null,F=F.next;F;F=F.next)if(F.type==m.BAR){if(F.rbstop)break;if(!F.next){F.rbstop=2;break}E++;E==F.fmt.rbmin&&(G=F);if(E==F.fmt.rbmax){G&&(F=G);F.rbstop=1;break}}}if(1<e){var K,I,J;for(K=0;K<D.length;K++){var Q=D[K];var S=!1;var ea=Q.st;for(I=Q.sym;I;I=I.next){if(!I.floating){for(;I&&!I.floating;)I=
I.next;if(!I)break;S=!1}if(I.dur)if(19<=I.notes[0].pit)S=!1;else if(12>=I.notes[I.nhd].pit)S=!0,I.st++;else{var X=127;for(J=I.ts_prev;J&&J.st==ea&&J.v!=I.v;J=J.ts_prev)J.type==m.NOTE&&J.notes[0].pit<X&&(X=J.notes[0].pit);if(127==X)S&&I.st++;else if(I.notes[I.nhd].pit>X-3)S=!1;else{var Y=-127;for(J=I.ts_next;J&&J.st==ea+1&&J.v!=I.v;J=J.ts_next)J.type==m.NOTE&&J.notes[J.nhd].pit>Y&&(Y=J.notes[J.nhd].pit);if(-127==Y)S&&I.st++;else{if(I.notes[0].pit<Y+3)S=!0;else if(X-=I.notes[I.nhd].pit,Y=I.notes[0].pit-
Y,!S){if(X<Y+3)continue;S=!0}else if(X<Y-3){S=!1;continue}I.st++}}}else S&&I.st++}}if(na.mrest_p){var T;for(T=N;T;T=T.ts_next)if(T.type==m.MREST){if(!T.seqst&&La[T.ts_prev.type])var ba=T;else for(ba=T.ts_next;!ba.seqst&&ba.type==m.MREST&&ba.nmes==T.nmes;)ba=ba.ts_next;if(ba.seqst)T=ba.ts_prev;else for(;T.type==m.MREST;){for(var la,fa,R,ha,pa,ca=T,ya=ca.nmes,za=ca.dur/ya,qa=ca.next;!qa.bar_type;)qa=qa.next;for(pa=qa;!qa.bar_num;)qa=qa.ts_prev;la=qa.bar_num-ca.nmes;ca.type=m.REST;ca.dur=ca.dur_orig=
za;ca.nflags=-2;ca.head=m.FULL;fa=ca.time+za;for(ha=ca;0<--ya;){qa=x(pa);delete qa.soln;delete qa.a_gch;delete qa.a_dd;delete qa.text;delete qa.rbstart;delete qa.rbstop;kc(qa,pa);for(qa.time=fa;ha.time<fa;)ha=ha.ts_next;for(;ha&&ha.v<ca.v&&ha.type==m.BAR;)ha=ha.ts_next;if(ha)Pb(qa,ha),ha.type==m.BAR&&delete ha.bar_num;else{for(ha=ca;ha.ts_next;)ha=ha.ts_next;ha.ts_next=qa;qa.ts_prev=ha;qa.ts_next=null}la++;qa.seqst?(qa.bar_num=la,R=qa.ts_next):(delete qa.bar_num,R=qa.ts_prev);qa.bar_type=R.bar_type||
"|";R.bar_num&&!R.seqst&&delete R.bar_num;R=x(ca);delete R.a_dd;delete R.soln;delete R.a_gch;qa.next?(R.next=qa.next,R.next.prev=R):R.next=null;qa.next=R;R.prev=qa;for(R.time=fa;ha&&!ha.dur&&ha.time==fa;)ha=ha.ts_next;for(;ha&&ha.v<ca.v&&(!(ha=ha.ts_next)||!ha.seqst););if(ha)Pb(R,ha);else{for(ha=ca;ha.ts_next;)ha=ha.ts_next;ha.ts_next=R;R.ts_prev=ha;R.ts_next=null}fa+=za;ca=ha=R}T=T.ts_next}}}}na.ottava&&"play"!=t.sound&&nf();var O,Z,wa,ia=Array(P+1),ka=L,Da=[];C=Array(P+1);for(O=0;O<=P;O++)ia[O]=
{autoclef:!0},C[O]={output:"",sc_out:""};for(Z=0;Z<D.length;Z++){var Ba=D[Z];ka.voices[Z]&&(O=ka.voices[Z].st,ka.voices[Z].second||(ka.staves[O].staffnonote=Ba.staffnonote,Ba.staffscale&&(ka.staves[O].staffscale=Ba.staffscale),ka.voices[Z].sep&&(ka.staves[O].sep=ka.voices[Z].sep),ka.voices[Z].maxsep&&(ka.staves[O].maxsep=ka.voices[Z].maxsep),Ba.clef.clef_auto||delete ia[O].autoclef))}for(Z=0;Z<D.length;Z++)if(Ba=D[Z],ka.voices[Z]&&!ka.voices[Z].second){O=ka.voices[Z].st;var aa=Ba.clef;ia[O].autoclef&&
(aa.clef_type=Qc(O,N,aa.clef_type),aa.clef_line="t"==aa.clef_type?2:4);ia[O].clef=C[O].clef=aa}for(O=0;O<=ka.nstaff;O++)Da[O]=3*(ka.staves[O].stafflines.length-1);for(aa=N;aa;aa=aa.ts_next){aa.repeat_n&&lf(aa);switch(aa.type){case m.STAVES:ka=aa.sy;for(O=0;O<=P;O++)ia[O].autoclef=!0;for(Z=0;Z<D.length;Z++)if(ka.voices[Z]){Ba=D[Z];O=ka.voices[Z].st;ka.voices[Z].second||(ka.staves[O].staffnonote=Ba.staffnonote,Ba.staffscale&&(ka.staves[O].staffscale=Ba.staffscale),ka.voices[Z].sep&&(ka.staves[O].sep=
ka.voices[Z].sep),ka.voices[Z].maxsep&&(ka.staves[O].maxsep=ka.voices[Z].maxsep));var sa=Ba.clef;sa.clef_auto||(ia[O].autoclef=!1)}for(O=0;O<=ka.nstaff;O++)Da[O]=3*(ka.staves[O].stafflines.length-1);for(Z=0;Z<D.length;Z++)if(ka.voices[Z]&&!ka.voices[Z].second){Ba=D[Z];O=ka.voices[Z].st;sa=Ba.clef;if(sa.clef_auto){var Ka=Qc(O,aa,ia[O].clef?ia[O].clef.clef_type:"a");var Ca="t"==Ka?2:4}else Ka=sa.clef_type,Ca=sa.clef_line;if(!ia[O].clef)sa.clef_auto&&("a"!=sa.type&&(Ba.clef=x(Ba.clef)),Ba.clef.clef_type=
Ka,Ba.clef.clef_line=Ca),C[O].clef=ia[O].clef=Ba.clef;else if(Ka!=ia[O].clef.clef_type||Ca!=ia[O].clef.clef_line){for(wa=aa.ts_prev;wa&&wa.time==aa.time&&(wa.v!=Z||wa.st!=O);)wa=wa.ts_prev;if(!wa||wa.time!=aa.time){for(wa=aa.ts_next;wa&&(wa.v!=Z||wa.st!=O);)wa=wa.ts_next;wa&&wa.time==aa.time||(wa=aa)}wa.type!=m.CLEF&&(wa=Md(wa,Ka,Ca),sa.clef_auto&&(wa.clef_auto=!0));ia[O].clef=Ba.clef=wa}}continue;default:aa.mid=Da[aa.st];continue;case m.CLEF:}"a"==aa.clef_type&&(aa.clef_type=Qc(aa.st,aa.ts_next,
ia[aa.st].clef.clef_type),aa.clef_line="t"==aa.clef_type?2:4);Ba=aa.p_v;Ba.clef=aa;if(aa.second)nb(aa);else{O=aa.st;if(ia[O].clef){if(aa.clef_type==ia[O].clef.clef_type&&aa.clef_line==ia[O].clef.clef_line)continue}else C[O].clef=aa;ia[O].clef=aa}}ka=L;for(Z=0;Z<D.length;Z++)if(ka.voices[Z]&&(sa=D[Z].sym)&&127==sa.notes[0].pit){O=ka.voices[Z].st;switch(C[O].clef.clef_type){default:var Ha=22;break;case "c":Ha=16;break;case "b":Ha=10}for(aa=sa;aa;aa=aa.next)aa.notes[0].pit=Ha}W.set_pitch(null);1<c&&
W.set_stem_dir();for(a=0;a<c;a++){var ta,va,Ea=void 0,Ia=void 0,U,Ga=-1;for(U=D[a].sym;U;U=U.next)if(U.type!=m.NOTE){if(U.type==m.GRACE){var ja=U.extra;if(2==ja.stem)Ea=U;else for(U.stem||0!=(U.stem=U.multi)||(U.stem=1);ja;ja=ja.next)ja.stem=U.stem,ja.multi=U.multi}}else{if(U.stem||0!=(U.stem=U.multi))U.beam_st&&!U.beam_end&&(Ia=!0);else{var Aa=U.mid/3+18;if(Ia)U.stem=Ga;else if(U.beam_st&&!U.beam_end){Ia=!0;var Fa=ta=0;for(ja=U;ja;ja=ja.next)if(ja.type==m.NOTE){if(ja.stem||ja.multi){U.stem=ja.stem||
ja.multi;break}Fa+=ja.nhd+1;for(va=0;va<=ja.nhd;va++)ja.notes[va].pit>=Aa&&ta++;if(ja.beam_end)break}if(!U.stem)if(ta*=2,ta>Fa)U.stem=-1;else if(ta<Fa)U.stem=1;else{ta=U.notes[U.nhd].pit;var Qa=U.notes[0].pit;for(ja=U.next;ja&&(ja.type!=m.NOTE||(ja.notes[ja.nhd].pit>ta&&(ta=ja.notes[ja.nhd].pit),ja.notes[0].pit<Qa&&(Qa=ja.notes[0].pit),!ja.beam_end));ja=ja.next);ja.beam_end&&(ta+Qa<2*Aa?U.stem=1:ta+Qa>2*Aa?U.stem=-1:U.fmt.bstemdown&&(U.stem=-1))}U.stem||(U.stem=Ga)}else{Fa=(U.notes[U.nhd].pit+U.notes[0].pit)/
2;if(Fa==Aa&&1<U.nhd){for(va=0;va<U.nhd&&!(U.notes[va].pit>=Aa);va++);Fa=2*va<U.nhd?Aa-1:Aa+1}U.stem=Fa<Aa?1:Fa>Aa||U.fmt.bstemdown?-1:Ga}}U.beam_end&&(Ia=!1);Ga=U.stem;if(Ea){for(ja=Ea.extra;ja;ja=ja.next)ja.stem=-Ga;Ea.stem=-Ga;Ea=null}}}W.set_stems();Td();if(N){var Ua,wb,Ra,Ta;for(Ua=N;Ua;)if(Ua.type!=m.NOTE||Ua.invis)Ua=Ua.ts_next;else{var kb=Ua.st;var ob=Ua.time;var cb=!1;for(wb=Ua;wb&&wb.time==ob&&wb.type==m.NOTE&&wb.st==kb;wb=wb.ts_next)if(!cb)for(Ra=0;Ra<=wb.nhd;Ra++)if(wb.notes[Ra].acc){cb=
!0;break}if(cb){var sb=Kd[Ua.head];for(Ta=[];Ua!=wb;Ua=Ua.ts_next)Array.prototype.push.apply(Ta,Ua.notes);Ta.sort(abc2svg.pitcmp);Ld(Ta,sb)}else Ua=wb}if(1<c){var M,Pa,Ma,$a=[],Xa=L;for(M=N;M;M=M.ts_next)if(!M.invis&&(M.type==m.STAVES&&(Xa=M.sy),M.dur)){var xb=$a[M.v];xb||(xb={},$a[M.v]=xb);xb.s=M;xb.st=M.st;xb.end_time=M.time+M.dur;if(M.type==m.REST){var yb=-127;var zb=127;var hb=Ma=!1;for(Pa=0;Pa<=$a.length;Pa++)if((xb=$a[Pa])&&xb.s&&xb.st==M.st&&Pa!=M.v&&!(xb.end_time<=M.time)){hb=!0;var oa=xb.s;
Xa.voices[Pa].range<Xa.voices[M.v].range?oa.time==M.time?oa.ymn<zb&&(zb=oa.ymn,oa.dots&&(Ma=!0)):oa.y<zb&&(zb=oa.y):oa.time==M.time?oa.ymx>yb&&(yb=oa.ymx,oa.dots&&(Ma=!0)):oa.y>yb&&(yb=oa.y)}var Hb=M.time+M.dur;for(oa=M.ts_next;oa&&!(oa.time>=Hb);oa=oa.ts_next)oa.st==M.st&&oa.dur&&!oa.invis&&(hb=!0,Xa.voices[oa.v].range<Xa.voices[M.v].range?oa.time==M.time?oa.ymn<zb&&(zb=oa.ymn,oa.dots&&(Ma=!0)):oa.y<zb&&(zb=oa.y):oa.time==M.time?oa.ymx>yb&&(yb=oa.ymx,oa.dots&&(Ma=!0)):oa.y>yb&&(yb=oa.y));if(hb){if(127==
zb&&12>M.y){var xa=12-M.y;M.y+=xa;M.ymx+=xa;M.ymn+=xa}-127==yb&&12<M.y&&(xa=M.y-12,M.y-=xa,M.ymx-=xa,M.ymn-=xa);xa=zb-M.ymx;if(0>xa)if(xa=6*Math.ceil(-xa/6),M.ymn-xa>=yb)M.y-=xa,M.ymx-=xa,M.ymn-=xa;else{var Ya=Ma?15:10;M.notes[0].shhd=Ya;M.xmx=Ya}else xa=yb-M.ymn,0<xa&&(xa=6*Math.ceil(xa/6),M.ymx+xa<=zb?(M.y+=xa,M.ymx+=xa,M.ymn+=xa):(Ya=Ma?15:10,M.notes[0].shhd=Ya,M.xmx=Ya))}else M.y=12,M.ymx=24,M.ymn=0}}rf()}for(var lb,Va,fb,Wa,eb=N,ra=eb,gb=0,ib=[],Sa=[],jb=gb,Bb=eb.time;;){do!eb.a_gch&&!eb.a_ly||
fb||(fb=eb),W.set_width(eb),Va=eb.st,void 0==ib[Va]&&(ib[Va]=0),void 0==Sa[Va]&&(Sa[Va]=0),lb=ib[Va]+Sa[Va]+eb.wl,lb>jb&&(jb=lb),eb=eb.ts_next;while(eb&&!eb.seqst);ra.shrink=jb-gb;ra.space=ra.ts_prev?Oc(ra,Bb):0;0==ra.space&&ra.ts_prev&&ra.ts_prev.type==m.SPACE&&ra.ts_prev.seqst&&(ra.space=ra.ts_prev.space/=2);if(ra.dur&&ra.dur!=ra.notes[0].dur){if(!Wa){for(Wa=ra;Wa.prev&&Wa.prev.dur&&Wa.prev.dur!=Wa.prev.notes[0].dur;)Wa=Wa.prev;for(;!Wa.seqst;)Wa=Wa.ts_prev}}else if(Wa&&Wa.v==ra.v){for(var Ib=Wa,
Cb=ra,Db=Ib.time,Jb=Cb.time-Db,Fb=Pd(Ib,Jb),bb=Ib,Gb=0;bb=bb.ts_next,bb.seqst&&(Gb+=bb.space,bb.bar_type&&(Gb+=10)),bb!=Cb;);for(Fb=(Fb+Gb)/2/Jb;Ib=Ib.ts_next,Ib.seqst&&(Ib.space=Fb*(Ib.time-Db),Db=Ib.time),Ib!=Cb;);Wa=null}ra.shrink||ra.space||ra.type!=m.CLEF||(delete ra.seqst,ra.time=Bb);Bb=ra.time;if(!eb)break;for(Va=0;Va<Sa.length;Va++)Sa[Va]=0;gb=jb;do Va=ra.st,ib[Va]=gb,ra.wr>Sa[Va]&&(Sa[Va]=ra.wr),ra=ra.ts_next;while(!ra.seqst)}if(fb)for(var Za=fb,pb,db,rb,Qb,Lb,tb=0,ub=0;Za;Za=Za.ts_next)if(Za.shrink&&
(tb+=Za.shrink,ub++),Za.a_ly&&lc(Za),Za.a_gch)for(pb=0;pb<Za.a_gch.length;pb++)if(db=Za.a_gch[pb],!("g"!=db.type||0>db.y)){if(rb&&rb>tb+db.x)for(Za.prev&&Za.prev.type==m.BAR&&ub--,Lb=(rb-tb-db.x)/ub;Qb=Qb.ts_next,Qb.shrink&&(Qb.shrink+=Lb),Qb!=Za&&Qb.type!=m.BAR;);Qb=Za;rb=db.text.wh[0];tb=ub=0;break}var Mb=Rc(!0);if(t.singleline){a=Rd();var vb=Mb+a[0]+a[1]+Sd(N,null)[0];da.width=vb*t.scale+da.lm+da.rm+2}else{var Eb=vb=Vb(),mb=Mb,Ja,Na=N;if(mb){var Rb=Rc();Eb-=Rb;mb-=Rb}Rb=Rd();Eb-=Rb[0];mb+=Rb[1];
t.custos&&1==D.length&&(Eb-=12);if(Rb=Na.fmt.barsperstaff)for(Ja=Na;Ja;Ja=Ja.ts_next)if(Ja.type==m.BAR&&Ja.bar_num&&!(0<--Rb)){for(;Ja.ts_next&&Ja.ts_next.type==m.BAR;)Ja=Ja.ts_next;Ja.ts_next&&(Ja.ts_next.soln=!0);Rb=Na.fmt.barsperstaff}for(Ja=Na;Na;Na=Na.ts_next){if(Na.ts_next)if(Na.soln){Na.soln=!1;if(Na.time==Ja.time)continue;for(;!Na.seqst;)Na=Na.ts_prev}else continue;else Na=null;Ja=mf(Ja,Na,Eb,mb);if(!Ja)break;Na=Ja;mb=0}}var Sb=N;for(a=c;0<=--a;)D[a].osym=D[a].sym;for(ac=1.2;;){tf();W.set_sym_glue(vb-
Mb);if(ua){Mb&&(Tb+=Mb);We();var Ub=$e();af(Mb);bf();var Ab;for(Ab=0;Ab<=P;Ab++)C[Ab].sc_out&&(H+="<g "+C[Ab].scale_str+">\n"+C[Ab].sc_out+"</g>\n",C[Ab].sc_out=""),C[Ab].output&&(H+='<g transform="translate(0,'+(-C[Ab].y).toFixed(1)+')">\n'+C[Ab].output+"</g>\n",C[Ab].output="");ma(Ub);for(Mb&&(Tb-=Mb);rc.length;)W.block_gen(rc.shift())}qb();Kb&&(Kb.ts_next.ts_prev=Kb);if(!Oa)break;Oa.ts_prev.ts_next=N=Oa;Td();if(!N)break;var Kb=N.ts_prev;N.ts_prev=null;for(var Wb,Nb,Ob=D.length;0<=--Ob;)Nb=D[Ob],
Nb.sym&&Nb.s_prev&&(Nb.sym.prev=Nb.s_prev),Wb=Nb.s_next,(Nb.sym=Wb)?(Wb.prev&&(Wb.prev.next=Wb),Nb.s_prev=Wb.prev,Wb.prev=null):Nb.s_prev=null;vb=Vb();Mb=Rc()}N=Sb;for(a=c;0<=--a;){var Xb=D[a];Xb.sym&&Xb.s_prev&&(Xb.sym.prev=Xb.s_prev);Xb.sym=Xb.osym}}};var kb,la=[],pa,Sa={},wf=new Int8Array([0,1,3,2,3,0,2,0,3,0]),tb="CDEFGABcdefgab";Abc.prototype.set_vp=function(a){for(var c,d,e,f,g;;){d=a.shift();if(!d)break;if("="==d.slice(-1)&&!a.length){B(1,K.bad_val,d);break}switch(d){case "clef=":c=a.shift();
break;case "clefpitch=":if(d=a.shift())if(f=tb.indexOf(d[0]),0<=f){switch(d[1]){case "'":f+=7;break;case ",":f-=7,","==d[2]&&(f-=7)}g=4-f;break}B(1,K.bad_val,d);break;case "octave=":f=parseInt(a.shift());isNaN(f)?B(1,K.bad_val,d):n.octave=f;break;case "cue=":n.scale="on"==a.shift()?.7:1;break;case "instrument=":d=a.shift();f=d.indexOf("/");0>f?(f=0,n.sndtran=jb("c"+d)):(n.sndtran=jb("c"+d.slice(f+1)),f=jb(d.replace("/","")));n.transp=t.sound?n.sndtran:f;break;case "map=":n.map=a.shift();break;case "name=":case "nm=":n.nm=
a.shift();'"'==n.nm[0]&&(n.nm=n.nm.slice(1,-1));n.new_name=!0;break;case "stem=":case "pos=":d="pos="==d?a.shift().slice(1,-1).split(" "):["stm",a.shift()];f=ed[d[1]];if(void 0==f){B(1,K.bad_val,"%%pos");break}switch(d[2]){case "align":f|=m.SL_ALIGN;break;case "center":f|=m.SL_CENTER;break;case "close":f|=m.SL_CLOSE}e||(e={});e[d[0]]=f;break;case "scale=":f=parseFloat(a.shift());isNaN(f)||.5>f||2<f?B(1,K.bad_val,"%%voicescale"):n.scale=f;break;case "score=":if(t.nedo){B(1,K.notransp);break}d=a.shift();
if(t.sound)break;n.transp=jb(d,!0);break;case "shift=":if(t.nedo){B(1,K.notransp);break}n.shift=n.sndsh=jb(a.shift());break;case "sound=":if(t.nedo){B(1,K.notransp);break}n.sndtran=jb(a.shift());t.sound&&(n.transp=n.sndtran);break;case "subname=":case "sname=":case "snm=":n.snm=a.shift();'"'==n.snm[0]&&(n.snm=n.snm.slice(1,-1));break;case "stafflines=":f=uf(a.shift());void 0==f?B(1,"Bad %%stafflines value"):void 0!=n.st?J.staves[n.st].stafflines=f:n.stafflines=f;break;case "staffnonote=":f=parseInt(a.shift());
isNaN(f)?B(1,"Bad %%staffnonote value"):n.staffnonote=f;break;case "staffscale=":f=parseFloat(a.shift());isNaN(f)||.3>f||2<f?B(1,"Bad %%staffscale value"):n.staffscale=f;break;case "transpose=":if(t.nedo){B(1,K.notransp);break}f=ue(a.shift());void 0==f?B(1,K.bad_transp):(n.sndtran=f,t.sound&&(n.transp=f));break;default:switch(d.slice(0,4)){case "treb":case "bass":case "alto":case "teno":case "perc":c=d;break;default:0<="GFC".indexOf(d[0])?c=d:"="==d.slice(-1)&&a.shift()}}}if(e)for(d in n.pos=x(n.pos),
e)e.hasOwnProperty(d)&&(n.pos[d]=e[d]);c&&(c=Ud(c))&&(g&&(c.clefpit=g),ve(c))};var Vc=/(\d*)(\/*)(\d*)/g;Abc.prototype.new_note=function(a,c){var d;var e=[];var f=p.line,g=la;la=[];p.stemless=!1;var h={type:m.NOTE,fname:p.fname,stem:0,multi:0,nhd:0,xmx:0};h.istart=p.bol+f.index;n.color&&(h.color=n.color);if(n.tie_s){var l=n.tie_s;n.tie_s=null}a?h.grace=!0:(kb&&tc(h),p.repeat_n&&(h.repeat_n=p.repeat_n,h.repeat_k=p.repeat_k,p.repeat_n=0));var k=f.char();switch(k){case "X":h.invis=!0;case "Z":h.type=
m.MREST;k=f.next_char();h.nmes="0"<k&&"9">=k?f.get_int():1;h.dur=n.wmeasure*h.nmes;if(n.second){delete n.eoln;n.time+=h.dur;return}1==h.nmes?(h.type=m.REST,h.dur_orig=h.dur,h.notes=[{pit:18,dur:h.dur}]):na.mrest_p=!0;break;case "y":h.type=m.SPACE;h.invis=!0;h.dur=0;k=f.next_char();h.width="0"<=k&&"9">=k?f.get_int():10;l&&(n.tie_s=l,l=null);break;case "x":h.invis=!0;case "z":h.type=m.REST;f.index++;var r=uc(f);h.dur_orig=(0>n.ulen?m.BLEN:n.ulen)*r[0]/r[1];h.dur=h.dur_orig*n.dur_fact;h.notes=[{pit:18,
dur:h.dur_orig}];break;case "[":r=!0,k=f.next_char();default:if(n.acc_tie){var t=n.acc_tie;n.acc_tie=null}for(h.notes=[];;){if(r)for(;k;){k=k.charCodeAt(0);if(128<=k){B(1,K.not_ascii);return}k=Aa[k];switch(k[0]){case "(":e.push(vc());k=f.char();continue;case "!":1<k.length?la.push(k.slice(1,-1)):Yd();k=f.next_char();continue}break}var u=f;k=h.grace?m.BLEN/4:0>n.ulen?m.BLEN:n.ulen;(d=Lb(u))?("0"==u.char()&&(p.stemless=!0,u.index++),u=uc(u),d.dur=k*u[0]/u[1]):d=void 0;if(!d)return;n.octave&&(d.pit+=
7*n.octave);u=d.pit+19;(k=d.acc)?n.acc[u]=k:(k=n.acc[u],!k&&t&&(k=t[u]),k||(k=n.ckey.k_map[u%7]||0));if(n.map&&Sa[n.map])a:{var x=d,q=x.pit,y=se(q,k),C=Sa[n.map];if(!(C[y]||(y="o"+y.replace(/[',]+/,""),C[y]||(y="k"+tb[(q+75-11*n.ckey.k_sf)%7],C[y]||(y="all",C[y])))))break a;x.map=C=C[y];C[1]&&(x.pit=C[1].pit,x.acc=C[1].acc);C[2]&&(x.color=C[2]);if(y=C[3])x.midi=Xd(y.pit+19,y.acc)}d.midi||(d.midi=Xd(u,k));n.ckey.k_sndtran&&(d.midi+=abc2svg.b40m(n.ckey.k_sndtran+122)-36);if(e.length){for(;;){k=e.shift();
if(!k)break;n.sls.push({is_note:!0,note:d,ty:k})}d.s=h}la.length&&Cc(h,d);h.notes.push(d);if(!r)break;for(k=f.char();;){switch(k){case ")":d.s=h;Wc(d,!0);k=f.next_char();continue;case "-":d.tie_ty=vc();d.s=h;n.tie_s=h;if(n.acc[u]||t&&t[u])n.acc_tie||(n.acc_tie=[]),n.acc_tie[u]=n.acc[u]||t[u];k=f.char();continue;case ".":k=f.next_char();switch(k){case "-":case "(":la.push("dot");continue}B(1,"Misplaced dot")}break}if("]"==k){f.index++;r=uc(f);h.nhd=h.notes.length-1;for(k=0;k<=h.nhd;k++)d=h.notes[k],
d.dur=d.dur*r[0]/r[1];break}}if(c.length)for(;;){k=c.shift();if(!k)break;h.notes[0].s=h;n.sls.push({note:h.notes[0],ty:k});a&&(n.sls[n.sls.length-1].grace=a)}h.dur_orig=h.notes[0].dur;h.dur=h.notes[0].dur*n.dur_fact}if(h.grace&&h.type!=m.NOTE)B(1,K.bad_grace);else{if(h.notes){if(a){c=n.ckey.k_bagpipe?8:4;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=c;h.dur/=c;h.dur_orig/=c;a.stem&&(h.stem=a.stem)}else{switch(n.pos.stm&7){case m.SL_ABOVE:h.stem=1;break;case m.SL_BELOW:h.stem=-1;break;case m.SL_HIDDEN:h.stemless=
!0}if(e=n.brk_rhythm){n.brk_rhythm=0;r=n.last_note;if(0<e){c=2*e-1;h.dur=h.dur*c/e;h.dur_orig=h.dur_orig*c/e;for(k=0;k<=h.nhd;k++)h.notes[k].dur=h.notes[k].dur*c/e;r.dur/=e;r.dur_orig/=e;for(k=0;k<=r.nhd;k++)r.notes[k].dur/=e}else{e=-e;c=2*e-1;h.dur/=e;h.dur_orig/=e;for(k=0;k<=h.nhd;k++)h.notes[k].dur/=e;r.dur=r.dur*c/e;r.dur_orig=r.dur_orig*c/e;for(k=0;k<=r.nhd;k++)r.notes[k].dur=r.notes[k].dur*c/e}n.time=r.time+r.dur;for(r=r.next;r;r=r.next)r.time=n.time}}n.last_note=h;for(k=f.char();;){switch(k){case "-":c=
vc();for(k=0;k<=h.nhd;k++)h.notes[k].tie_ty=c,h.notes[k].s=h;a?a.tie_s=n.tie_s=a:n.tie_s=h;for(k=0;k<=h.nhd;k++)if(d=h.notes[k],u=d.pit+19,n.acc[u]||t&&t[u])n.acc_tie||(n.acc_tie=[]),n.acc_tie[u]=n.acc[u]||t[u];k=f.char();continue;case ")":h.notes[0].s=h;Wc(h.notes[0]);k=f.next_char();continue;case ".":la.push("dot");k=f.next_char();continue}break}if(l){for(t=0;t<=h.nhd;t++)if(c=h.notes[t],r=c.midi,l.type!=m.GRACE)for(k=0;k<=l.nhd;k++){if(l.notes[k].tie_ty&&l.notes[k].midi==r){l.notes[k].tie_n=c;
c.s=h;l.tie_s=h;break}}else for(k=l.extra;k;k=k.next)if(k.notes[0].tie_ty&&k.notes[0].midi==r){k.tie_s=h;k.notes[0].tie_n=c;c.s=h;k.notes[0].s=k;l.tie_s=h;break}l.tie_s?l.time+l.dur!=(h.time||n.time)&&(h.ti2=l):v(1,l,"Bad tie")}}ia(h);a||(n.lyric_restart||(n.lyric_restart=h),n.sym_restart||(n.sym_restart=h));g.length&&(la=g,Eb(h,h.prev));p.ottava.length&&(a?a.ottava=p.ottava:h.ottava=p.ottava,p.ottava=[]);p.stemless&&(h.stemless=!0);h.iend=p.bol+f.index;return h}};var Aa='0;0;0;0;0;0;0;0;0; ;\n;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0; ;!;";i;\n;0;&;0;(;);i;0;0;-;!dot!;0;0;0;0;0;0;0;0;0;0;0;|;i;<;n;<;i;i;n;n;n;n;n;n;n;!fermata!;d;d;d;!emphasis!;!lowermordent!;d;!coda!;!uppermordent!;d;d;!segno!;!trill!;d;d;d;n;d;n;[;\\;|;n;n;i;n;n;n;n;n;n;n;d;d;d;d;d;d;d;d;d;d;d;d;d;!upbow!;!downbow!;d;n;n;n;{;|;};!gmark!;0'.split(";"),
Zd={"8va(":1,"8va)":0,"15ma(":2,"15ma)":0,"8vb(":-1,"8vb)":0,"15mb(":-2,"15mb)":0},Bb,Bd="undefined"!=typeof document?function(a){var c;t.fullsvg&&(vb+="\n"+a);if(!Bb)if(abc2svg.sheet)for(Bb=abc2svg.sheet,c=Bb.cssRules.length;0<=--c;)Bb.deleteRule(c);else c=document.createElement("style"),document.head.appendChild(c),abc2svg.sheet=Bb=c.sheet;for(a=a.match(/[^{]+{[^}]+}/g);;){c=a.shift();if(!c)break;Bb.insertRule(c,Bb.cssRules.length)}}:function(a){vb+="\n"+a},ce=new Float32Array([0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.333,.408,.5,.5,.833,.778,.333,.333,.333,.5,.564,.25,.564,.25,.278,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278,.278,.564,.564,.564,.444,.921,.722,.667,.667,.722,.611,.556,.722,.722,.333,.389,.722,.611,.889,.722,.722,.556,.722,.667,.556,.611,.722,.722,.944,.722,.722,.611,.333,.278,.333,.469,.5,.333,.444,.5,.444,.5,.444,.333,.5,.5,.278,.278,.5,.278,.778,.5,.5,.5,.5,.333,.389,.278,.5,.5,.722,.5,.5,.444,.48,.2,.48,.541,.5]),xf=new Float32Array([0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278,.278,.355,.556,.556,.889,.667,.191,.333,.333,.389,.584,.278,.333,.278,.278,.556,.556,.556,.556,.556,.556,.556,.556,.556,.556,.278,.278,.584,.584,.584,.556,1.015,.667,.667,.722,.722,.667,.611,.778,.722,.278,.5,.667,.556,.833,.722,.778,.667,.778,.722,.667,.611,.722,.667,.944,.667,.667,.611,.278,.278,.278,.469,.556,.333,.556,.556,.5,.556,.556,.278,.556,.556,.222,.222,.5,.222,.833,.556,.556,.556,.556,.333,.5,.278,.556,.5,.722,.5,.5,.5,.334,.26,.334,
.584,.512]),be=ce,ya="undefined"!=typeof document?function(){var a=document.createElement("text");a.style.position="absolute";a.style.top="-1000px";a.style.padding="0";document.body.appendChild(a);return function(c){if(c.wh)return c.wh;var d=G.curfont,e=d.size,f=0,g=0,h=0;a.className=cb(d);a.style.lineHeight=1;if("object"==typeof c)return a.innerHTML=c,c.wh=[a.clientWidth,a.clientHeight],c.wh;for(c=c.replace(/<|>|&[^&]*?;|&|  /g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case "&":return"&amp;";
case "  ":return" \u00a0"}return a});;){h=c.indexOf("$",h);if(0>h)break;var l=c[h+1];if("0"==l)d=G.deffont;else if("1"<=l&&"9">=l)d=Ca("u"+l);else{h++;continue}a.innerHTML=c.slice(g,h);f+=a.clientWidth;d.size>e&&(e=d.size);a.style.font=Jc(d).slice(5);g=h+=2}a.innerHTML=c.slice(g);f+=a.clientWidth;G.curfont=d;return[f,e]}}():function(a){var c=G.curfont,d=c.swfac,e=c.size,f=0,g,h=a.length;for(g=0;g<h;g++){var l=a[g];switch(l){case "$":l=a[g+1];if("0"==l)c=G.deffont;else if("1"<=l&&"9">=l)c=Ca("u"+l);
else{l="$";break}g++;d=c.swfac;c.size>e&&(e=c.size);continue;case "&":var k=a.indexOf(";",g);0<k&&10>k-g&&(g=k,l="a")}f+=Xc(l)*d}G.curfont=c;return[f,e]},Cf={A:"info",C:"composer",O:"composer",P:"parts",Q:"tempo",R:"info",T:"title",X:"title"},H="",ub="\n.stroke{stroke:currentColor;fill:none}\n.bW{stroke:currentColor;fill:none;stroke-width:1}\n.bthW{stroke:currentColor;fill:none;stroke-width:3}\n.slW{stroke:currentColor;fill:none;stroke-width:.7}\n.slthW{stroke:currentColor;fill:none;stroke-width:1.5}\n.sW{stroke:currentColor;fill:none;stroke-width:.7}\n.box{outline: 1px solid black;outline-offset: 1px}",
vb="",Tb=t.leftmargin/t.scale,fa=0,da={width:t.pagewidth,lm:t.leftmargin,rm:t.rightmargin},Zc={},xc="",$c="",F={scale:1,dy:0,st:-1,v:-1,g:0},Fa=0,Ec={"mtr ":{x:0,y:0,c:" "},brace:{x:0,y:0,c:"\ue000"},lphr:{x:0,y:24,c:"\ue030"},mphr:{x:0,y:24,c:"\ue038"},sphr:{x:0,y:27,c:"\ue039"},rdots:{x:-1,y:0,c:"\ue043"},dsgn:{x:-4,y:-4,c:"\ue045"},dcap:{x:-4,y:-4,c:"\ue046"},sgno:{x:-6,y:0,c:"\ue047"},coda:{x:-12,y:-6,c:"\ue048"},tclef:{x:-8,y:0,c:"\ue050"},cclef:{x:-8,y:0,c:"\ue05c"},bclef:{x:-8,y:0,c:"\ue062"},
pclef:{x:-6,y:0,c:"\ue069"},spclef:{x:-6,y:0,c:"\ue069"},stclef:{x:-8,y:0,c:"\ue07a"},scclef:{x:-8,y:0,c:"\ue07b"},sbclef:{x:-7,y:0,c:"\ue07c"},oct:{x:0,y:2,c:"\ue07d"},mtr0:{x:0,y:0,c:"\ue080"},mtr1:{x:0,y:0,c:"\ue081"},mtr2:{x:0,y:0,c:"\ue082"},mtr3:{x:0,y:0,c:"\ue083"},mtr4:{x:0,y:0,c:"\ue084"},mtr5:{x:0,y:0,c:"\ue085"},mtr6:{x:0,y:0,c:"\ue086"},mtr7:{x:0,y:0,c:"\ue087"},mtr8:{x:0,y:0,c:"\ue088"},mtr9:{x:0,y:0,c:"\ue089"},mtrC:{x:0,y:0,c:"\ue08a"},"mtr+":{x:0,y:0,c:"\ue08c"},"mtr(":{x:0,y:0,c:"\ue094"},
"mtr)":{x:0,y:0,c:"\ue095"},HDD:{x:-7,y:0,c:"\ue0a0"},breve:{x:-7,y:0,c:"\ue0a1"},HD:{x:-5.2,y:0,c:"\ue0a2"},Hd:{x:-3.8,y:0,c:"\ue0a3"},hd:{x:-3.7,y:0,c:"\ue0a4"},ghd:{x:2,y:0,c:"\ue0a4",sc:.66},pshhd:{x:-3.7,y:0,c:"\ue0a9"},pfthd:{x:-3.7,y:0,c:"\ue0b3"},x:{x:-3.7,y:0,c:"\ue0a9"},"circle-x":{x:-3.7,y:0,c:"\ue0b3"},srep:{x:-5,y:0,c:"\ue101"},"dot+":{x:-5,y:0,sc:.7,c:"\ue101"},diamond:{x:-4,y:0,c:"\ue1b9"},triangle:{x:-4,y:0,c:"\ue1bb"},dot:{x:-1,y:0,c:"\ue1e7"},flu1:{x:-.3,y:0,c:"\ue240"},fld1:{x:-.3,
y:0,c:"\ue241"},flu2:{x:-.3,y:0,c:"\ue242"},fld2:{x:-.3,y:0,c:"\ue243"},flu3:{x:-.3,y:3.5,c:"\ue244"},fld3:{x:-.3,y:-4,c:"\ue245"},flu4:{x:-.3,y:8,c:"\ue246"},fld4:{x:-.3,y:-9,c:"\ue247"},flu5:{x:-.3,y:12.5,c:"\ue248"},fld5:{x:-.3,y:-14,c:"\ue249"},"acc-1":{x:-1,y:0,c:"\ue260"},"cacc-1":{x:-18,y:0,c:"\ue26a\ue260\ue26b"},"sacc-1":{x:-1,y:0,sc:.7,c:"\ue260"},acc3:{x:-1,y:0,c:"\ue261"},cacc3:{x:-18,y:0,c:"\ue26a\ue261\ue26b"},sacc3:{x:-1,y:0,sc:.7,c:"\ue261"},acc1:{x:-2,y:0,c:"\ue262"},cacc1:{x:-18,
y:0,c:"\ue26a\ue262\ue26b"},sacc1:{x:-2,y:0,sc:.7,c:"\ue262"},acc2:{x:-3,y:0,c:"\ue263"},"acc-2":{x:-3,y:0,c:"\ue264"},"acc-1_2":{x:-2,y:0,c:"\ue280"},"acc-3_2":{x:-3,y:0,c:"\ue281"},acc1_2:{x:-1,y:0,c:"\ue282"},acc3_2:{x:-3,y:0,c:"\ue283"},accent:{x:-3,y:2.5,c:"\ue4a0"},stc:{x:-1,y:-2,c:"\ue4a2"},emb:{x:-4,y:-2,c:"\ue4a4"},wedge:{x:-1,y:0,c:"\ue4a8"},marcato:{x:-3,y:-2,c:"\ue4ac"},hld:{x:-7,y:2,c:"\ue4c0"},brth:{x:0,y:0,c:"\ue4ce"},r00:{x:-1.5,y:0,c:"\ue4e1"},r0:{x:-1.5,y:0,c:"\ue4e2"},r1:{x:-3.5,
y:-6,c:"\ue4e3"},r2:{x:-3.2,y:0,c:"\ue4e4"},r4:{x:-3,y:0,c:"\ue4e5"},r8:{x:-3,y:0,c:"\ue4e6"},r16:{x:-4,y:0,c:"\ue4e7"},r32:{x:-4,y:0,c:"\ue4e8"},r64:{x:-4,y:0,c:"\ue4e9"},r128:{x:-4,y:0,c:"\ue4ea"},mrest:{x:-10,y:0,c:"\ue4ee"},mrep:{x:-6,y:0,c:"\ue500"},mrep2:{x:-9,y:0,c:"\ue501"},p:{x:-4,y:-6,c:"\ue520"},f:{x:-2.5,y:-6,c:"\ue522"},pppp:{x:-15,y:-6,c:"\ue529"},ppp:{x:-11,y:-6,c:"\ue52a"},pp:{x:-8,y:-6,c:"\ue52b"},mp:{x:-8.5,y:-6,c:"\ue52c"},mf:{x:-8,y:-6,c:"\ue52d"},ff:{x:-6,y:-6,c:"\ue52f"},fff:{x:-9,
y:-6,c:"\ue530"},ffff:{x:-12,y:-6,c:"\ue531"},sfz:{x:-9,y:-6,c:"\ue539"},trl:{x:-4,y:-4,c:"\ue566"},turn:{x:-5,y:3,c:"\ue567"},turnx:{x:-5,y:3,c:"\ue569"},umrd:{x:-7,y:2,c:"\ue56c"},lmrd:{x:-7,y:2,c:"\ue56d"},dplus:{x:-4,y:0,c:"\ue582"},sld:{x:-8,y:12,c:"\ue5d0"},grm:{x:-2,y:0,c:"\ue5e2"},dnb:{x:-4,y:0,c:"\ue610"},upb:{x:-3,y:0,c:"\ue612"},opend:{x:-2,y:0,c:"\ue614"},roll:{x:0,y:2,c:"\ue618"},thumb:{x:0,y:0,c:"\ue624"},snap:{x:-2,y:0,c:"\ue630"},ped:{x:-10,y:0,c:"\ue650"},pedoff:{x:-5,y:0,c:"\ue655"},
mtro:{x:0,y:0,c:"\ue911"},mtrc:{x:0,y:0,c:"\ue915"},"mtr.":{x:0,y:0,c:"\ue920"},"mtr|":{x:0,y:0,c:"\ue925"},longa:{x:-4.7,y:0,c:"\ue95d"},custos:{x:-4,y:3,c:"\uea02"},ltr:{x:2,y:6,c:"\ueaa4"}},Gb={},Ha=u.anno_start?yf:yc,Xa=u.anno_stop?zf:yc;Abc.prototype.out_svg=function(a){H+=a};Abc.prototype.sx=ob;Abc.prototype.sy=pb;Abc.prototype.sh=function(a){return 0>F.st?a/F.scale:a};Abc.prototype.ax=function(a){return a+Tb};Abc.prototype.ay=function(a){return 0>F.st?fa-a:fa+(F.dy-a)*F.scale-F.dy};Abc.prototype.ah=
function(a){return 0>F.st?a:a*F.scale};Abc.prototype.out_sxsy=Qa;Abc.prototype.xypath=Jb;var sa=[[],[],"",[],[],[]],Af={crdc:{dx:0,dy:5,style:"font:italic 14px text,serif"},dacs:{dx:0,dy:3,style:"font:16px text,serif",anchor:' text-anchor="middle"'},pf:{dx:0,dy:5,style:"font:italic bold 16px text,serif"},"@":{dx:0,dy:5,style:"font:12px text,sans-serif"}};Abc.prototype.out_lped=function(a,c,d,e){c+=4;e.nost||Y(a,c,"ped");e.noen||Y(a+d+6,c,"pedoff")};var me={arp:ke,cresc:function(a,c,d,e){a+=d;d=-d;
S('<path class="stroke"\n\td="mX YlA ',a,c+5,d);H=e.nost?H+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):H+("-4l"+(-d).toFixed(1)+' -4"/>\n')},dim:function(a,c,d,e){S('<path class="stroke"\n\td="mX YlA ',a,c+5,d);H=e.noen?H+("-2.2m0 -3.6l"+(-d).toFixed(1)+' -2.2"/>\n'):H+("-4l"+(-d).toFixed(1)+' -4"/>\n')},ltr:le,lped:function(a,c,d,e){W.out_lped(a,c,d,e)},"8va":function(a,c,d,e){e.nost?d-=5:(S('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy="-4" style="font-size:10px">va</tspan></text>\n',
a-8,c),a+=12,d-=12);c+=6;S('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||S('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"8vb":function(a,c,d,e){e.nost?d-=5:(S('<text x="X" y="Y" style="font:italic bold 12px text,serif">8<tspan dy=".5" style="font-size:10px">va</tspan></text>\n',a-8,c),a+=10,d-=10);S('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||S('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)},"15ma":function(a,c,d,e){e.nost?d-=5:(S('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy="-4" style="font-size:10px">ma</tspan></text>\n',
a-10,c),a+=20,d-=20);c+=6;S('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||S('<path class="stroke" d="mX Yv6"/>\n',a+d,c)},"15mb":function(a,c,d,e){e.nost?d-=5:(S('<text x="X" y="Y" style="font:italic bold 12px text,serif">15<tspan dy="-.5" style="font-size:10px">ma</tspan></text>\n',a-10,c),a+=18,d-=18);S('<path class="stroke" stroke-dasharray="6,6" d="mX YhF"/>\n',a,c,d);e.noen||S('<path class="stroke" d="mX Yv-6"/>\n',a+d,c)}},Be={glisq:function(a,c,d){d=d.start;var e=
d.x,f=d.y+C[d.st].y;c=Math.atan2(f-c,a-e);a=(a-e)/Math.cos(c);Fb(e,f,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a=(a-e-6)/6|0;for(1>a&&(a=1);0<=--a;)Y(e,0,"ltr"),e+=6;bb()},gliss:function(a,c,d){d=d.start;var e=d.x,f=d.y+C[d.st].y;c=-Math.atan2(c-f,a-e);a=(a-e)/Math.cos(c);Fb(e,f,c/Math.PI*180);e=d.s.dots?13+d.s.xmx:8;a-=e+8;Jb(e,0);H+="h"+a.toFixed(1)+'" stroke-width="1"/>\n';bb()}};Abc.prototype.blk_flush=qb;var J,L,D,n,lb,ca,N,La=new Uint8Array([4,1,8,0,3,5,6,9,9,0,9,3,0,7,0,0,0,0]);Abc.prototype.set_bar_num=
function(){var a,c,d,e=G.nbar,f=0,g=0,h=D[L.top_voice].meter.wmeasure;for(a=N;;a=a.ts_next){if(!a)return;switch(a.type){case m.METER:h=a.wmeasure;case m.CLEF:case m.KEY:case m.STBRK:continue;case m.BAR:a.bar_num&&(e=a.bar_num)}break}for(c=a.ts_next;c;c=c.ts_next)if(c.type==m.BAR&&c.time){c.time<h&&(a=c,f=a.time);break}for(;a;a=a.ts_next)if(a.seqst)switch(a.type){case m.METER:e+=(a.time-f)/h;f=a.time;h=a.wmeasure;break;case m.BAR:if(!a.invis)if(c=a.time,a.bar_num)e=a.bar_num,g=f=c;else if(1==h)a.bar_dotted||
(a.text&&(t.contbarnb||("1"==a.text[0]?d=e:e=d)),a.bar_num=++e);else{var l=e+(c-f)/h;var k=l-(l|0);t.checkbars&&(k&&!a.bar_dotted&&a.next||c>g+h&&a.prev.type!=m.MREST)&&v(0,a,"Bad measure duration");c>g+h&&(l|=0,k=0,f=c,e=l);a.text?"1"==a.text[0]?(d=t.contbarnb?f+k*h:c,k||(a.bar_num=l)):(f=t.contbarnb?d:f+(c-d),l=e+(c-f)/h,l==(l|0)&&(a.bar_num=l)):(k&&(l-=k),a.bar_num=l);k||(g=c)}}};Abc.prototype.do_pscom=function(a){var c;if(c=a.match(/(\w|-)+/)){c=c[0];if(n&&n.ignore)switch(c){case "staves":case "score":break;
default:return}a=a.replace(c,"").trim();if(" lock"==a.slice(-5))Je[c]=!0,a=a.slice(0,-5).trim();else if(Je[c])return;"title"==c.slice(0,5)&&2==p.state&&Da();switch(c){case "center":T("text");if(2<=p.state){c=Ta("text");c.text=a;c.opt="c";c.font=t.textfont;return}wc(a,"c");return;case "clef":2<=p.state&&(2==p.state&&Da(),(c=Ud(a))&&ve(c));return;case "deco":c=a.match(/(\S*)\s+(.*)/);Bc[c[1]]=c[2];return;case "linebreak":for(c=0;128>c;c++)"\n"==Aa[c]&&(Aa[c]="0");a=a.split(/\s+/);for(c=0;c<a.length;c++){var d=
a[c];switch(d){case "!":case "$":case "*":case ";":case "?":case "@":break;case "<none>":continue;case "<EOL>":d="\n";break;default:B(1,"Bad value '$1' in %%linebreak - ignored",d);continue}Aa[d.charCodeAt(0)]="\n"}return;case "map":a:if(a){var e="";c=a.split(/\s+/);if(3>c.length)B(1,not_enough_p);else{var f=c[1];if("*"==f[0]||0==f.indexOf("all"))f="all";else{if(0==f.indexOf("octave,")||0==f.indexOf("key,"))e=f[0],f=f.split(",")[1],f=f.replace(/[,']+/,"").toUpperCase(),0==f.indexOf("key,")&&(f=f.replace(/[=^_]+/,
""));d=new I;d.buffer=f;d=Lb(d);if(!d){B(1,"Bad note in %%map");break a}f=e+se(d.pit,d.acc)}(d=Sa[c[0]])||(Sa[c[0]]=d={});(a=d[f])||(d[f]=a=[]);c.shift();c.shift();if(c.length){c=Zb(c.join(" "));f=0;if(0>c[0].indexOf("=")){"*"!=c[0][0]&&(d=new I,d.buffer=c[0],a[1]=Lb(d));if(!c[1])break a;f++;0>c[1].indexOf("=")&&(a[0]=c[1].split(","),f++)}for(;f<c.length;f++)switch(c[f]){case "heads=":if(!c[++f]){B(1,not_enough_p);break}a[0]=c[f].split(",");break;case "print=":case "play=":if(!c[++f]){B(1,not_enough_p);
break}d=new I;d.buffer=c[f];d=Lb(d);"r"==c[f-1][1]?a[1]=d:a[3]=d;break;case "color=":c[++f]?a[2]=c[f]:B(1,not_enough_p)}}}}return;case "maxsysstaffsep":case "sysstaffsep":if(3==p.state){d=Ra(a);if(isNaN(d)){B(1,K.bad_val,"%%"+c);return}J.voices[n.v]["m"==c[0]?"maxsep":"sep"]=d;return}break;case "multicol":if(2<=p.state){2==p.state&&Da();n=D[0];Ta("mc_"+a);break}switch(a){case "start":pa={maxy:0,lmarg:t.leftmargin,rmarg:t.rightmargin};break;case "new":if(!pa){B(1,"%%multicol new without start");break}fa>
pa.maxy&&(pa.maxy=fa);t.leftmargin=pa.lmarg;t.rightmargin=pa.rmarg;da.chg=!0;Ia();fa=0;break;case "end":if(!pa){B(1,"%%multicol end without start");break}fa<pa.maxy&&(fa=pa.maxy);t.leftmargin=pa.lmarg;t.rightmargin=pa.rmarg;pa=void 0;qb();da.chg=!0;Ia();break;default:B(1,"Unknown keyword '$1' in %%multicol",a)}return;case "ottava":if(3!=p.state){if(2!=p.state)return;Da()}c=parseInt(a);if(isNaN(c)||-2>c||2<c){B(1,K.bad_val,"%%ottava");return}na.ottava=!0;p.ottava.push(c);return;case "repbra":n&&(n.norepbra=
!hb(a));return;case "repeat":if(3!=p.state)return;if(!n.last_sym){B(1,"%%repeat cannot start a tune");return}if(a.length){a=a.split(/\s+/);c=parseInt(a[0]);a=parseInt(a[1]);if(isNaN(c)||1>c||n.last_sym.type==m.BAR&&2<c){B(1,"Incorrect 1st value in %%repeat");return}if(isNaN(a))a=1;else if(1>a){B(1,"Incorrect 2nd value in %%repeat");return}}else a=c=1;p.repeat_n=n.last_sym.type==m.BAR?c:-c;p.repeat_k=a;return;case "sep":Ia();var g=da.width-da.lm-da.rm;d=f=e=0;if(a&&(a=a.split(/\s+/),d=Ra(a[0]),a[1]&&
(f=Ra(a[1]),a[2]&&(e=Ra(a[2]))),isNaN(d)||isNaN(f)||isNaN(e))){B(1,K.bad_val,"%%sep");return}1>d&&(d=14);1>f&&(f=d);1>e&&(e=90);if(2<=p.state){c=Ta(c);c.x=(g-e)/2/t.scale;c.l=e/t.scale;c.sk1=d;c.sk2=f;return}ma(d);H+='<path class="stroke"\n\td="M';Qa((g-e)/2/t.scale," ",0);H+="h"+(e/t.scale).toFixed(1)+'"/>\n';ma(f);qb();return;case "setbarnb":d=parseInt(a);if(isNaN(d)||1>d){B(1,"Bad %%setbarnb value");break}2==p.state&&Da();na.new_nbar=d;return;case "staff":if(3!=p.state){if(2!=p.state)return;Da()}d=
parseInt(a);if(isNaN(d)){B(1,"Bad %%staff value '$1'",a);return}c="+"==a[0]||"-"==a[0]?n.cst+d:d-1;if(0>c||c>P){B(1,"Bad %%staff number $1 (cur $2, max $3)",c,n.cst,P);return}delete n.floating;n.cst=c;return;case "staffbreak":if(3!=p.state){if(2!=p.state)return;Da()}c={type:m.STBRK,dur:0};"f"==a.slice(-1)&&(c.stbrk_forced=!0,a=a.replace(/\sf$/,""));if(a){d=Ra(a);if(isNaN(d)){B(1,K.bad_val,"%%staffbreak");return}c.xmx=d}else c.xmx=14;ia(c);return;case "stafflines":case "staffscale":case "staffnonote":Kb(c,
a);return;case "staves":case "score":if(0==p.state)return;p.scores&&0<p.scores.length&&(a=p.scores.shift(),c=a.match(/([^\s]+)\s*(.*)/),a=c[2],c=c[1]);var h;b:{d={};f=[];e=!1;var l=h=g=0,k=0,r=0,v=a.match(/[^[\]|{}()*+\s]+|[^\s]/g);if(v){for(;;){var C=v.shift();if(!C)break;switch(C){case "[":if(k||2<=h+l){B(1,K.misplaced,"[");e=!0;break}g|=0==h+l?4:1024;l++;r<<=8;r|=4;break;case "{":if(k||h||2<=l){B(1,K.misplaced,"{");e=!0;break}g|=l?256:1;h++;r<<=8;r|=1;break;case "(":if(k){B(1,K.misplaced,"(");
e=!0;break}g|=16;k++;r<<=8;r|=16;break;case "*":!h||k||g&257||(g|=128);break;case "+":g|=4096;break;case "]":case "}":case ")":B(1,"Bad voice ID in %%score");e=!0;break;default:for(a=C;;){C=v.shift();if(!C)break;switch(C){case "]":if(!(r&4)){B(1,K.misplaced,"]");e=!0;break}l--;g|=0==h+l?8:2048;r>>=8;continue;case "}":if(!(r&1)){B(1,K.misplaced,"}");e=!0;break}h--;g|=l?512:2;g&=-129;r>>=8;continue;case ")":if(!(r&16)){B(1,K.misplaced,")");e=!0;break}k--;g|=32;r>>=8;continue;case "|":g|=64;continue}break}d[a]?
(B(1,"Double voice in %%score"),e=!0):(d[a]=!0,f.push([a,g]));g=0;C&&v.unshift(C)}}0!=r&&(B(1,"'}', ')' or ']' missing in %%score"),e=!0);if(!e&&f.length){a=f;break b}}else B(1,K.bad_val,"%%score");a=void 0}if(a){D.length&&Ed(!0);g=0;f=!0;for(e=0;e<D.length;e++)d=D[e],d.time>g&&(g=d.time),d.sym&&(f=!1);if(f||0==g&&0>lb)J.staves=[],J.voices=[];else{for(e=0;e<J.voices.length;e++)if(J.voices[e]){n=D[e];break}n.time=g;d={type:m.STAVES,dur:0};ia(d);J.nstaff=P;re();d.sy=J}lb=g;for(e=0;e<D.length;e++)d=
D[e],delete d.second,delete d.ignore,delete d.floating;for(f=h=0;f<a.length;f++)for(d=a[f][0],d=dd(d),d.time=g,e=d.v,a[f][0]=d;;){J.voices[e]={};J.voices[e].range=h++;d=d.voice_down;if(!d)break;e=d.v}J.top_voice=a[0][0].v;if("t"==c[1])for(f=0;f<a.length;f++)h=a[f][1],h&257&&3!=(h&3)&&768!=(h&768)&&0==a[f+1][1]&&!(h&16||a[f+2][1]&16)&&(a[f+2][1]&514?a[f+1][1]|=128:0==a[f+2][1]&&a[f+3][1]&514&&(a[f][1]|=16,a[f+1][1]|=32,a[f+2][1]|=16,a[f+3][1]|=32));g=-1;for(f=0;f<a.length;f++)if(h=a[f][1],48==(h&48)&&
(h&=-49,a[f][1]=h),d=a[f][0],h&128?(d.floating=!0,d.second=!0):(g++,J.staves[g]||(J.staves[g]={stafflines:d.stafflines||"|||||",staffscale:1}),J.staves[g].flags=0),e=d.v,d.st=d.cst=J.voices[e].st=g,J.staves[g].flags|=h,h&16){for(h=d;f<a.length-1&&!(d=a[++f][0],e=d.v,a[f][1]&4096?(h.second=!0,h=d):d.second=!0,d.st=d.cst=J.voices[e].st=g,a[f][1]&32););J.staves[g].flags|=a[f][1]}0>g&&(g=0);J.nstaff=P=g;if("c"==c[1])for(g=0;g<P;g++)J.staves[g].flags^=64;for(e=0;e<D.length;e++)if(d=D[e],J.voices[e]){for(h=
d.voice_down;h;)f=h.v,h.st=h.cst=J.voices[f].st=g,h=h.voice_down;J.voices[e].second=d.second;g=d.st;!(0<g)||d.norepbra||J.staves[g-1].flags&64||(d.norepbra=!0)}n=2<=p.state?D[J.top_voice]:null}return;case "text":T("text");if(2<=p.state){c=Ta(c);c.text=a;c.opt=t.textoption;c.font=t.textfont;return}wc(a,t.textoption);return;case "transpose":if(t.sound)return;d=ue(a);if(void 0==d&&(d=jb(a),void 0==d)){B(1,K.bad_transp);return}switch(p.state){case 0:t.transp=0;case 1:case 2:t.transp=(t.transp||0)+d;return}for(c=
n.last_sym;c;c=c.prev){switch(c.type){case m.NOTE:c=x(n.okey);c.k_old_sf=n.ckey.k_sf;ia(c);break;case m.KEY:break;default:continue}break}n.transp=d;zc();return;case "tune":return;case "user":Vd(a);return;case "voicecolor":n&&(n.color=a);return;case "vskip":d=Ra(a);if(isNaN(d)){B(1,K.bad_val,"%%vskip");return}if(0>d){B(1,"%%vskip cannot be negative");return}if(2<=p.state){c=Ta(c);c.sk=d;return}ma(d);return;case "newpage":case "leftmargin":case "rightmargin":case "pagescale":case "pagewidth":case "printmargin":case "scale":case "staffwidth":if(2<=
p.state){c=Ta(c);c.param=a;return}if("newpage"==c){qb();u.page_format&&(Fa=2);return}}W.set_format(c,a)}};Abc.prototype.do_begin_end=function(a,c,d){switch(a){case "js":Ka(d);break;case "ml":2<=p.state?(a=Ta(a),a.text=d):(qb(),u.img_out&&u.img_out(d));break;case "svg":for(c=0;;){a=d.indexOf("<style",c);if(0>a)break;a=d.indexOf(">",a);c=d.indexOf("</style>",a);if(0>c){B(1,"No </style> in %%beginsvg sequence");break}ub+=d.slice(a+1,c).replace(/\s+$/,"")}for(c=0;;){a=d.indexOf("<defs>\n",c);if(0>a)break;
c=d.indexOf("</defs>",a);if(0>c){B(1,"No </defs> in %%beginsvg sequence");break}ge(d.slice(a+6,c))}break;case "text":c=Le[c],c||(c=t.textoption),T("text"),2<=p.state?(a=Ta(a),a.text=d,a.opt=c,a.font=t.textfont):wc(d,c)}};var ze="CDEFGAB",Df=["bb","b","","#","##"];Abc.prototype.gch_build=function(a){var c,d=0,e=0;for(c=0;c<a.a_gch.length;c++){var f=a.a_gch[c];if("g"==f.type)f.text=f.text.replace(/##|#|=|bb|b|  /g,function(a){switch(a){case "##":return"&#x1d12a;";case "#":return"\u266f";case "=":return"\u266e";
case "b":return"\u266d";case "  ":return" \u00a0"}return"&#x1d12b;"});else if("@"==f.type&&!u.anno_start&&!u.anno_stop){T(f.font);f.text=Pa(f.text);f.text.wh=[0,0];continue}T(f.font);f.text=Pa(f.text);var g=f.text.wh;g[1]+=2*f.font.pad;switch(f.type){case "@":break;case "^":case "_":g=.4*g[0];8<g&&(g=8);f.x=-g;break;case "<":f.x=-(g[0]+6);d-=g[1];f.y=d+g[1]/2;break;case ">":f.x=6;e-=g[1];f.y=e+g[1]/2;break;default:g=.4*g[0],8<g&&(g=8),f.x=-g}}d/=2;e/=2;for(c=0;c<a.a_gch.length;c++)switch(f=a.a_gch[c],
f.type){case "<":f.y-=d;break;case ">":f.y-=e}};Abc.prototype.draw_gchord=function(a,c,d,e){a=c.a_gch[a];var f=a.text.wh[1];var g=a.font.pad;var h=a.text.wh[0]+2*g,l=0;a.font.figb&&(f*=2.4,l=1.3*a.font.size);switch(a.type){case "_":e-=f+g;X(c.st,0,d,h,e-g);break;case "^":e=ea(c.st,1,d,h);e+=g;X(c.st,1,d,h,e+f+g);break;case "<":case ">":"<"==a.type?(c.notes[0].acc&&(d-=c.notes[0].shac),d-=g):(c.xmx&&(d+=c.xmx),c.dots&&(d+=1.5+3.5*c.dots),d+=g);e+=(c.type==m.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>
1)-18):12)-f/2;24<e&&X(c.st,1,d,h,e+f+g);0>e&&X(c.st,0,d,h,e-g);break;default:0<=e?(e+=g,X(c.st,1,d,h,e+f+g)):(e-=f+g,X(c.st,0,d,h,e-g));break;case "@":e+=(c.type==m.NOTE?3*((c.notes[c.nhd].pit+c.notes[0].pit>>1)-18):12)+.2*f,0<e?(g=e+.8*f,g>C[c.st].ann_top&&(C[c.st].ann_top=g)):(g=e,g<C[c.st].ann_bot&&(C[c.st].ann_bot=g))}ib(a.font);T(a.font);Ga(c.st);u.anno_start&&u.anno_start("annot",a.istart,a.iend,d-2,e+f+2,h+4,f+4,c);R(d,e+l,a.text);u.anno_stop&&u.anno_stop("annot",a.istart,a.iend,d-2,e+f+2,
h+4,f+4,c)};Hd();Abc.prototype.a_de=function(){return ba};Abc.prototype.add_style=function(a){ub+=a};Abc.prototype.cfmt=function(){return t};Abc.prototype.clone=x;Abc.prototype.deco_put=function(a,c){la.push(a);Eb(c)};Abc.prototype.defs_add=ge;Abc.prototype.dh_put=function(a,c,d){la.push(a);Cc(c,d)};Abc.prototype.draw_meter=qd;Abc.prototype.draw_note=ec;Abc.prototype.errs=K;Abc.prototype.font_class=cb;Abc.prototype.gch_tr1=ye;Abc.prototype.get_bool=hb;Abc.prototype.get_cur_sy=function(){return L};
Abc.prototype.get_curvoice=function(){return n};Abc.prototype.get_delta_tb=function(){return fd};Abc.prototype.get_decos=function(){return Bc};Abc.prototype.get_font=Ca;Abc.prototype.get_font_style=function(){return vb};Abc.prototype.get_glyphs=function(){return Gb};Abc.prototype.get_img=function(){return da};Abc.prototype.get_maps=function(){return Sa};Abc.prototype.get_multi=function(){return pa};Abc.prototype.get_newpage=function(){if(block.newpage)return block.newpage=!1,!0};Abc.prototype.get_posy=
function(){var a=fa;fa=0;return a};Abc.prototype.get_staff_tb=function(){return C};Abc.prototype.get_top_v=function(){return J.top_voice};Abc.prototype.get_tsfirst=function(){return N};Abc.prototype.get_unit=Ra;Abc.prototype.get_voice_tb=function(){return D};Abc.prototype.glout=gb;Abc.prototype.goto_tune=Da;Abc.prototype.info=function(){return Q};Abc.prototype.new_block=Ta;Abc.prototype.out_arp=ke;Abc.prototype.out_deco_str=je;Abc.prototype.out_deco_val=cd;Abc.prototype.out_ltr=le;Abc.prototype.param_set_font=
mb;Abc.prototype.parse=p;Abc.prototype.psdeco=yc;Abc.prototype.psxygl=yc;Abc.prototype.set_cur_sy=function(a){L=a};Abc.prototype.set_dscale=Ga;Abc.prototype.set_font=T;Abc.prototype.set_a_gch=function(a,c){kb=c;tc(a)};Abc.prototype.set_hl=fb;Abc.prototype.set_pagef=function(){Fa=1};Abc.prototype.set_scale=Ma;Abc.prototype.set_tsfirst=function(a){N=a};Abc.prototype.set_v_param=Kb;Abc.prototype.strwh=ya;Abc.prototype.stv_g=function(){return F};Abc.prototype.svg_flush=$b;Abc.prototype.syntax=B;Abc.prototype.tunes=
Lc;Abc.prototype.unlksym=nb;Abc.prototype.use_font=ib;Abc.prototype.vskip=ma;Abc.prototype.xy_str=R;Abc.prototype.xygl=Y;var Ae};var Abc=abc2svg.Abc;"object"==typeof module&&"object"==typeof exports&&(exports.abc2svg=abc2svg,exports.Abc=Abc);abc2svg.loadjs||(abc2svg.loadjs=function(u,x,E){E&&E()});
abc2svg.modules={ambitus:{},begingrid:{fn:"grid3"},beginps:{fn:"psvg"},break:{},capo:{},chordnames:{},clip:{},clairnote:{fn:"clair"},voicecombine:{fn:"combine"},diagram:{fn:"diag"},equalbars:{},gamelan:{},grid:{},grid2:{},jazzchord:{},jianpu:{},mdnn:{},MIDI:{},pageheight:{fn:"page"},pedline:{},percmap:{fn:"perc"},soloffs:{},sth:{},strtab:{},temperament:{fn:"temper"},nreq:0,hooks:[],g_hooks:[],load:function(u,x,E){function v(){return"object"==typeof user&&user.errmsg?user.errmsg:"function"==typeof abc2svg.printErr?
abc2svg.printErr:"function"==typeof alert?function(v){alert(v)}:"object"==typeof console?console.log:function(){}}function I(){0==--abc2svg.modules.nreq&&abc2svg.modules.cbf()}var B=this.nreq;u=u.match(/(^|\n)(%%|I:).+?\b/g);if(!u)return!0;this.cbf=x||function(){};this.errmsg=E||v();for(E=0;E<u.length;E++){var Ka=u[E].replace(/\n?(%%|I:)/,"");(x=abc2svg.modules[Ka])&&!x.loaded&&(x.loaded=!0,x.fn&&(Ka=x.fn),this.nreq++,abc2svg.loadjs(Ka+"-1.js",I,function(){abc2svg.modules.errmsg("Error loading the module "+
Ka);I()}))}return this.nreq==B}};abc2svg.version="1.21.1";abc2svg.vdate="2021-07-12";
abc2svg.MIDI={do_midi:function(u){var x,E=u.split(/\s+/);u=this.cfmt();if(x=this.get_curvoice()){if(x.ignore)return;void 0==x.chn&&(x.chn=9>x.v?x.v:x.v+1)}switch(E[1]){case "chordname":u.chord||(u.chord={});u.chord.names||(u.chord.names={});u.chord.names[E[2]]=E.slice(3);break;case "chordprog":u.chord||(u.chord={});u.chord.prog=E[2];E[3]&&"octave="==E[3].slice(0,7)&&(u.chord.trans=Number(E[3].slice(7)));break;case "chordvol":var v=Number(E[2]);if(isNaN(v)||0>v||127<v){this.syntax(1,this.errs.bad_val,
"%%MIDI chordvol");break}u.chord||(u.chord={});u.chord.vol=v/127;break;case "gchordon":case "gchordoff":u.chord||(u.chord={});2==this.parse.state&&this.goto_tune();if(2<=this.parse.state&&this.get_curvoice()){var I=this.new_block("midigch");I.play=!0;I.on="n"==E[1][7]}else u.chord.gchon="n"==E[1][7];break;case "channel":v=parseInt(E[2]);if(isNaN(v)||0>=v||16<v){this.syntax(1,this.errs.bad_val,"%%MIDI channel");break}if(9!=--v){3==this.parse.state?(I=this.new_block("midichn"),I.play=!0,I.chn=v):this.set_v_param("channel",
v);break}abc2svg.MIDI.do_midi.call(this,"MIDI control 0 1");abc2svg.MIDI.do_midi.call(this,"MIDI control 32 0");break;case "drummap":v=Number(E[3]);if(isNaN(v)){this.syntax(1,this.errs.bad_val,"%%MIDI drummap");break}for(x="C ^C D _E E F ^F G ^G A _B B".split(" ")[v%12];60>v;)x+=",",v+=12;for(;72<v;)x+="'",v-=12;this.do_pscom("map MIDIdrum "+E[2]+" play="+x);this.set_v_param("mididrum","MIDIdrum");break;case "program":void 0!=E[3]?(abc2svg.MIDI.do_midi.call(this,"MIDI channel "+E[2]),v=E[3]):v=E[2];
v=parseInt(v);if(isNaN(v)||0>v||127<v){this.syntax(1,this.errs.bad_val,"%%MIDI program");break}3==this.parse.state?(I=this.new_block("midiprog"),I.play=!0,I.instr=v):this.set_v_param("instr",v);break;case "control":x=parseInt(E[2]);if(isNaN(x)||0>x||127<x){this.syntax(1,"Bad controller number in %%MIDI");break}v=parseInt(E[3]);if(isNaN(v)||0>v||127<v){this.syntax(1,"Bad controller value in %%MIDI");break}3==this.parse.state?(I=this.new_block("midictl"),I.play=!0,I.ctrl=x,I.val=v):this.set_v_param("midictl",
E[2]+" "+E[3]);break;case "temperamentequal":if(x=parseInt(E[2]),isNaN(x)||5>x||255<x)this.syntax(1,this.errs.bad_val,"%%MIDI "+E[1]);else{53==x&&(I=this.get_glyphs(),I.acc12_53='<text id="acc12_53" x="-1">&#xe282;</text>',I.acc24_53='<text id="acc24_53" x="-1">&#xe282;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',I.acc36_53='<text id="acc36_53" x="-1">&#xe262;\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>',I.acc48_53='<text id="acc48_53" x="-1">&#xe262;</text>',I.acc60_53=
'<g id="acc60_53">\n\t<text style="font-size:1.2em" x="-1">&#xe282;</text>\n\t<path class="stroke" stroke-width="1.6" d="M-2 1.5l7 -3"/>\n</g>',I["acc-60_53"]='<text id="acc-60_53" x="-1">&#xe260;</text>',I["acc-48_53"]='<g id="acc-48_53">\n\t<text x="-1">&#xe260;</text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',I["acc-36_53"]='<g id="acc-36_53">\n\t<text x="-1">&#xe260;\t\t<tspan x="0" y="-10" style="font-size:8px">3</tspan></text>\n\t<path class="stroke" stroke-width="1" d="M-3 -5.5l5 -2"/>\n</g>',
I["acc-24_53"]='<text id="acc-24_53" x="-2">&#xe280;\t<tspan x="0" y="-10" style="font-size:8px">2</tspan></text>',I["acc-12_53"]='<text id="acc-12_53" x="-2">&#xe280;</text>');u.nedo=x;x=12*(7.019550008653874*x/12+.5|0)/x;(6.85>x||7.2<x)&&this.syntax(0,this.errs.bad_val,"%%MIDI "+E[1]);v=[2,25,8,31,14,37,20,3,26,9,32,15,38,21,4,27,10,33,16,39];I=[0,19,36,13,30,7,24,1,18,35,12,29,6,23,0,17];var B=21-3*x;b=new Float32Array(40);for(E=0;E<v.length;E++)b[v[E]]=(x*E+B)%12;for(E=1;E<=I.length;E++)b[I[E]]=
12-(x*E-B)%12;u.temper=b}}},set_vp:function(u,x){var E,v=this.get_curvoice();for(E=0;E<x.length;E++)switch(x[E]){case "channel=":v.chn=x[++E];break;case "instr=":v.instr=x[++E];break;case "midictl=":v.midictl||(v.midictl=[]);var I=x[++E].split(" ");v.midictl[I[0]]=Number(I[1]);break;case "mididrum=":v.map||(v.map={}),v.map=x[++E]}u(x)},do_pscom:function(u,x){"MIDI "==x.slice(0,5)?abc2svg.MIDI.do_midi.call(this,x):u(x)},set_hooks:function(u){u.do_pscom=abc2svg.MIDI.do_pscom.bind(u,u.do_pscom);u.set_vp=
abc2svg.MIDI.set_vp.bind(u,u.set_vp)}};abc2svg.modules.hooks.push(abc2svg.MIDI.set_hooks);abc2svg.modules.MIDI.loaded=!0;
abc2svg.perc={do_perc:function(u){new Int8Array([0,0,1,2,2,3,3,4,5,5,6,6]);new Int8Array([3,1,3,-1,3,3,1,3,-1,3,-1,3]);var x={"a-b-d":35,"a-s":38,"b-d-1":36,ca:69,cl:75,co:56,"c-c":52,"c-c-1":49,"c-c-2":57,"c-h-h":42,"e-s":40,"h-a":67,"h-b":60,"h-c":39,"h-f-t":43,"h-m-t":48,"h-ti":65,"h-to":50,"h-w-b":76,"l-a":68,"l-b":61,"l-c":64,"l-f-t":41,"l-g":74,"l-m-t":47,"l-ti":66,"l-to":45,"l-w":72,"l-w-b":77,m:70,"m-c":78,"m-h-c":62,"m-t":80,"o-c":79,"o-h-c":63,"o-h-h":46,"o-t":81,"p-h-h":44,"r-b":53,"r-c-1":51,
"r-c-2":59,"s-c":55,"s-g":73,"s-s":37,"s-w":71,t:54,v:58};u=u.split(/\s+/);var E=u[1].replace(/[=_^]/,"");this.do_pscom("map MIDIdrum "+u[1]+" play="+function(v){var u;if(/^[_^]*[A-Ga-g][,']*$/.test(v))return v;var B=Number(v);if(isNaN(B)){v=v.toLowerCase(v);var E=v[0];for(u=0;;){u=v.indexOf("-",u);if(0>u)break;u+=1;E+="-"+v[u]}B=x[E];if(!B){switch(v[0]){case "c":switch(v[1]){case "a":B=x.ca;break;case "l":B=x.cl;break;case "o":B=x.co}break;case "h":case "l":if(u=v.indexOf("-"),"t"==v[u+1])switch(v[u+
2]){case "i":case "o":B=x[E+v[u+2]]}}if(!B)return}}for(v="C ^C D _E E F ^F G ^G A _B B".split(" ")[B%12];60>B;)v+=",",B+=12;for(;72<=B;)v+="'",B-=12;return v}(u[2])+" print="+E+(u[3]?" heads="+u[3]:""));this.set_v_param("perc","MIDIdrum")},set_perc:function(u){var x,E=this.get_curvoice();for(x=0;x<u.length;x++)switch(u[x]){case "perc=":E.map||(E.map={}),E.map=u[x+1],E.midictl||(E.midictl=[]),E.midictl[0]=1}},do_pscom:function(u,x){"percmap "==x.slice(0,8)?abc2svg.perc.do_perc.call(this,x):u(x)},set_vp:function(u,
x){abc2svg.perc.set_perc.call(this,x);u(x)},set_hooks:function(u){u.do_pscom=abc2svg.perc.do_pscom.bind(u,u.do_pscom);u.set_vp=abc2svg.perc.set_vp.bind(u,u.set_vp)}};abc2svg.modules.hooks.push(abc2svg.perc.set_hooks);abc2svg.modules.percmap.loaded=!0;
abc2svg.pedline={draw_all_deco:function(u){var x,E=this.a_de();if(E.length){if(this.cfmt().pedline)for(x=0;x<E.length;x++){var v=E[x];"ped)"==v.dd.name&&(v.prev&&"ped)"==v.prev.dd.name?(v.defl.nost=!0,v.prev.defl.noen=!0,v.x=v.prev.s.x-5,v.val=v.s.x-v.x-5,v.prev.prev||(v.prev.val=v.x-v.prev.x)):(v.x-=3,v.val+=10))}u()}},out_lped:function(u,x,E,v,I){this.cfmt().pedline?(this.xypath(x,E+16),I.nost?(this.out_svg("l2.5 6"),v-=2.5):this.out_svg("v6"),I.noen?this.out_svg("h"+(v-2.5).toFixed(1)+'l2.5 -6"/>\n'):
this.out_svg("h"+v.toFixed(1)+'v-6"/>\n')):u(x,E,v,I)},set_fmt:function(u,x,E){"pedline"==x?this.cfmt().pedline=E:u(x,E)},set_hooks:function(u){u.draw_all_deco=abc2svg.pedline.draw_all_deco.bind(u,u.draw_all_deco);u.out_lped=abc2svg.pedline.out_lped.bind(u,u.out_lped);u.set_format=abc2svg.pedline.set_fmt.bind(u,u.set_format)}};abc2svg.modules.hooks.push(abc2svg.pedline.set_hooks);abc2svg.modules.pedline.loaded=!0;
